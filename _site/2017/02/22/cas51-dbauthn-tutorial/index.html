<!DOCTYPE html>
<html>
<head>
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MZG9L7');</script>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>CAS 5 Database Authentication Tutorial &#8211; Apereo Community Blog</title>
    <link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Learn how to configure database authentication in CAS 5.">
    <meta name="robots" content="all">
    <meta name="author" content="Apereo Project Participants">
    
    <meta name="keywords" content="">
    <link rel="canonical" href="https://apereo.github.io/2017/02/22/cas51-dbauthn-tutorial/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Apereo Community Blog" href="/feed.xml" />

    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css"
          integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd"
          crossorigin="anonymous">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js"></script>
    
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/js/bootstrap.min.js"
            integrity="sha384-vZ2WRJMwsjRMW/8U7i6PWi6AlO1L79snBrmgiDpgIWJ82z8eA5lenwvxbMV1PAh7"
            crossorigin="anonymous"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?202303081604" type="text/css">

    <!-- Fonts -->
    
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- MathJax -->
    
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js??config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <!-- Verifications -->
    
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="CAS 5 Database Authentication Tutorial">
    <meta property="og:description" content="This is a blog managed and edited by the Apereo project participants. It is typically used to post project updates, announce news, etc.">
    <meta property="og:url" content="https://apereo.github.io/2017/02/22/cas51-dbauthn-tutorial/">
    <meta property="og:site_name" content="Apereo Community Blog">
    
    <meta property="og:image" content="https://apereo.github.io/images/me.jpeg">
    

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@Apereo" />
        <meta name="twitter:creator" content="@Apereo" />
    
    <meta name="twitter:title" content="CAS 5 Database Authentication Tutorial" />
    <meta name="twitter:description" content="Learn how to configure database authentication in CAS 5." />
    <meta name="twitter:url" content="https://apereo.github.io/2017/02/22/cas51-dbauthn-tutorial/" />
    
    <meta name="twitter:image" content="https://apereo.github.io/images/me.jpeg" />
    

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">

    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-83384532-1', 'auto');
       ga('send', 'pageview');
    </script>
    

    
    
</head>

<body class="site animated fade-in-down">
  

  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MZG9L7"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MZG9L7');</script>
  
  
	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="https://apereo.github.io" class="site-title">Apereo Community Blog</a>
      <nav class="site-nav">
        



    
    
    
    
        <a href="/about/">About</a>
    

    

    
    
    
    
        <a href="/contact/">Say Hello</a>
    

    

    
    
    
    
        <a href="/tags/">All Posts</a>
    

    

    
    
    
    
        <a href="/search/">Search</a>
    

    


      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="social-icons-right">
    
      <a class="fa fa-github" href="https://github.com/apereo"></a>
    
    
    
    
    <a class="fa fa-rss" href="/feed.xml"></a>
    
      <a class="fa fa-twitter" href="https://twitter.com/Apereo"></a>
    
    
    
    
    
      <a class="fa fa-envelope" href="mailto:info@apereo.org"></a>
    
    
    
    
    
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>CAS 5 Database Authentication Tutorial</h1>
  <span class="post-meta">Wednesday, Feb 22, 2017</span><br>
  
  <span class="post-meta small">
  
    6 minute read
  
  </span>
</div>

<article class="post-content">
  <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>This is a short and sweet tutorial on how to configure CAS to authenticate against a database and then resolve/release attributes.
Most of the material is based on the <a href="https://apereo.github.io/cas/development/installation/Database-Authentication.html">available documentation</a>.</p>

<p>This tutorial specifically focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.1.0-RC2-SNAPSHOT</code></li>
  <li>HSQLDB <code class="highlighter-rouge">2.3.4</code></li>
  <li>Java 8</li>
  <li>Apache Tomcat <code class="highlighter-rouge">8.5.11</code></li>
</ul>

<h1 id="database">Database</h1>

<p>To keep things rather simple, we’ll be installing an instance of <a href="http://hsqldb.org/">HSQLDB</a>. For this exercise, I am running <code class="highlighter-rouge">2.3.4</code>, though note that the recipe is for the most part the same when dealing with other database instances as well, whether installed manually or run in a dockerized fashion.</p>

<p>So running HSQL shows me:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Server@2ff4acd0]: <span class="o">[</span>Thread[main,5,main]]: checkRunning<span class="o">(</span><span class="nb">false</span><span class="o">)</span> entered
<span class="o">[</span>Server@2ff4acd0]: <span class="o">[</span>Thread[main,5,main]]: checkRunning<span class="o">(</span><span class="nb">false</span><span class="o">)</span> exited
<span class="o">[</span>Server@2ff4acd0]: Startup sequence initiated from main<span class="o">()</span> method
<span class="o">[</span>Server@2ff4acd0]: Could not load properties from file
<span class="o">[</span>Server@2ff4acd0]: Using cli/default properties only
<span class="o">[</span>Server@2ff4acd0]: Initiating startup sequence...
<span class="o">[</span>Server@2ff4acd0]: Server socket opened successfully <span class="k">in </span>46 ms.
<span class="o">[</span>Server@2ff4acd0]: Database <span class="o">[</span><span class="nv">index</span><span class="o">=</span>0, <span class="nv">id</span><span class="o">=</span>0, <span class="nv">db</span><span class="o">=</span>file:mydb, <span class="nb">alias</span><span class="o">=</span>xdb] opened successfully <span class="k">in </span>349 ms.
<span class="o">[</span>Server@2ff4acd0]: Startup sequence completed <span class="k">in </span>396 ms.
<span class="o">[</span>Server@2ff4acd0]: 2017-02-21 13:44:37.717 HSQLDB server 2.3.4 is online on port 9001
<span class="o">[</span>Server@2ff4acd0]: To close normally, connect and execute SHUTDOWN SQL
<span class="o">[</span>Server@2ff4acd0]: From <span class="nb">command </span>line, use <span class="o">[</span>Ctrl]+[C] to abort abruptly
</code></pre></div></div>

<p>Great. Moving on…</p>

<h1 id="create-schema">Create Schema</h1>

<p>In my setup, I have two tables: one called <code class="highlighter-rouge">USERS</code> where user accounts are kept and another called <code class="highlighter-rouge">USERATTRS</code> where user attributes are kept. My <code class="highlighter-rouge">USERS</code> table is rather simple, but the <code class="highlighter-rouge">USERATTRS</code> follows something of a <em>multi-row</em> setup. You want to learn more about this setup <a href="https://apereo.github.io/cas/development/integration/Attribute-Resolution.html#person-directory">here</a>.</p>

<p>So here goes the SQL:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">USERS</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">USERATTRS</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">USERATTRS</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">INT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">IDENTITY</span> <span class="p">,</span>
  <span class="n">uid</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">attrname</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">attrvalue</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">USERS</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">INT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">IDENTITY</span> <span class="p">,</span>
  <span class="n">uid</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">psw</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">USERS</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">psw</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'mmoayyed'</span><span class="p">,</span> <span class="s1">'TheBestPasswordEver'</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">USERATTRS</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span>  <span class="n">attrname</span><span class="p">,</span> <span class="n">attrvalue</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'mmoayyed'</span><span class="p">,</span> <span class="s1">'firstname'</span><span class="p">,</span> <span class="s1">'Misagh'</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">USERATTRS</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">attrvalue</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'mmoayyed'</span><span class="p">,</span> <span class="s1">'lastname'</span><span class="p">,</span> <span class="s1">'Moayyed'</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">USERATTRS</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">attrvalue</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'mmoayyed'</span><span class="p">,</span> <span class="s1">'phone'</span><span class="p">,</span> <span class="s1">'+13476452319'</span><span class="p">);</span>
</code></pre></div></div>

<p>Note that for the time being, I am just keeping the password as plain-text in the table. No encoding or anything has taken place.</p>

<h1 id="deploy-cas">Deploy CAS</h1>

<p>Hop over to <a href="https://apereo.github.io/cas/development/installation/Maven-Overlay-Installation.html">the overlay installation</a> and get CAS built and deployed. The CAS version I am using today is <code class="highlighter-rouge">5.1.0-RC2-SNAPSHOT</code>. It does not matter whether you end up using Maven or Gradle. Choose what fits you best. When you have a baseline functioning build, continue on.</p>

<h1 id="configure-cas">Configure CAS</h1>

<p>Follow the steps <a href="https://apereo.github.io/cas/development/installation/Database-Authentication.html">described here</a> to add the needed CAS modules. Once the module/dependency is added to your build, hop over to <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#database-authentication">the settings page</a> and add the properties.</p>

<p><em>Note that I did not have to add any additional JARs and such for database drivers. CAS ships with a few <a href="https://apereo.github.io/cas/development/installation/JDBC-Drivers.html">automatically and by default</a></em></p>

<p>For this tutorial, this is what I actually needed to make this work:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.jdbc.query[0]</span><span class="py">.sql</span><span class="p">=</span><span class="s">SELECT * FROM USERS WHERE uid=?</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.url</span><span class="p">=</span><span class="s">jdbc:hsqldb:hsql://localhost:9001/xdb</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.dialect</span><span class="p">=</span><span class="s">org.hibernate.dialect.HSQLDialect</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.user</span><span class="p">=</span><span class="s">sa</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.password</span><span class="p">=</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.driverClass</span><span class="p">=</span><span class="s">org.hsqldb.jdbcDriver</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.fieldPassword</span><span class="p">=</span><span class="s">psw</span>
</code></pre></div></div>

<p>I also need to disable static authentication. It would also be very nice if I could turn on <code class="highlighter-rouge">DEBUG</code> logs and see what CAS attempts to do:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">logging.level.org.apereo</span><span class="p">=</span><span class="s">DEBUG</span>
<span class="py">cas.authn.accept.users</span><span class="p">=</span>
</code></pre></div></div>

<h1 id="build-and-deploy">Build and Deploy</h1>

<p>Once you get CAS built and deployed, logs should indicate something like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-02-21 14:20:18,267 DEBUG <span class="o">[</span>org.apereo.cas.configuration.support.Beans] - &lt;No password encoder shall be created given the requested encoder <span class="nb">type</span> <span class="o">[</span>NONE]&gt;
2017-02-21 14:20:18,277 DEBUG <span class="o">[</span>org.apereo.cas.adaptors.jdbc.config.CasJdbcAuthenticationConfiguration] - &lt;Created authentication handler <span class="o">[</span>QueryDatabaseAuthenticationHandler] to handle database url at <span class="o">[</span>jdbc:hsqldb:hsql://localhost:9001/xdb]&gt;
</code></pre></div></div>

<p>Log in with <code class="highlighter-rouge">mmoayyed</code> and <code class="highlighter-rouge">TheBestPasswordEver</code> and you should be in. Viola!</p>

<h1 id="password-encoding">Password Encoding</h1>

<p>As an extra bonus exercise, let’s turn on <code class="highlighter-rouge">MD5</code> password encoding. The MD5 hash of <code class="highlighter-rouge">TheBestPasswordEver</code> is <code class="highlighter-rouge">ca541f57a3041c3b85c553d12d3e64a8</code>.</p>

<p>So we will update the database accordingly.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">USERS</span> <span class="k">SET</span> <span class="n">psw</span><span class="o">=</span><span class="s1">'ca541f57a3041c3b85c553d12d3e64a8'</span> <span class="k">WHERE</span> <span class="n">uid</span><span class="o">=</span><span class="s1">'mmoayyed'</span><span class="p">;</span>
</code></pre></div></div>

<p>Then configure CAS to handle <code class="highlighter-rouge">MD5</code> password encoding:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.jdbc.query[0]</span><span class="py">.passwordEncoder.type</span><span class="p">=</span><span class="s">DEFAULT</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.passwordEncoder.encodingAlgorithm</span><span class="p">=</span><span class="s">MD5</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.passwordEncoder.characterEncoding</span><span class="p">=</span><span class="s">UTF-8</span>
</code></pre></div></div>

<h1 id="build-and-deploy-1">Build and Deploy</h1>

<p>Once you get CAS built and deployed, logs should indicate something like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-02-21 14:44:31,884 DEBUG <span class="o">[</span>org.apereo.cas.configuration.support.Beans] - &lt;Creating default password encoder with encoding alg <span class="o">[</span>MD5] and character encoding <span class="o">[</span>UTF-8]&gt;
</code></pre></div></div>

<p>Build and deploy. Log in with <code class="highlighter-rouge">mmoayyed</code> and <code class="highlighter-rouge">TheBestPasswordEver</code> and you should be in. Logs may indicate:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-02-21 14:45:55,517 DEBUG <span class="o">[</span>org.apereo.cas.util.crypto.DefaultPasswordEncoder] - &lt;Encoded password via algorithm <span class="o">[</span>MD5] and character-encoding <span class="o">[</span>UTF-8] is <span class="o">[</span>ca541f57a3041c3b85c553d12d3e64a8]&gt;
2017-02-21 14:45:55,517 DEBUG <span class="o">[</span>org.apereo.cas.util.crypto.DefaultPasswordEncoder] - &lt;Provided password does match the encoded password&gt;
2017-02-21 14:45:55,519 DEBUG <span class="o">[</span>org.apereo.cas.authentication.AbstractAuthenticationManager] - &lt;Authentication handler <span class="o">[</span>QueryDatabaseAuthenticationHandler] successfully authenticated <span class="o">[</span>mmoayyed]&gt;
</code></pre></div></div>

<p>Good job! Lets get some attributes now.</p>

<h1 id="attributes">Attributes</h1>

<p>Because the <code class="highlighter-rouge">USERATTRS</code> follows something of a <em>multi-row</em> setup, we want to make sure CAS <a href="(https://apereo.github.io/cas/development/integration/Attribute-Resolution.html#person-directory)">can understand</a> the specifics of this schema model. Today, CAS is unable to retrieve attributes as part of authentication directly so we need to set up a separate attribute repository instance that CAS will contact once the user is fully authenticated. In our case, the attribute repository is the same database instance. So the configuration may look something like this:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.singleRow</span><span class="p">=</span><span class="s">false</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.sql</span><span class="p">=</span><span class="s">SELECT * FROM USERATTRS WHERE {0}</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.username</span><span class="p">=</span><span class="s">uid</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.url</span><span class="p">=</span><span class="s">jdbc:hsqldb:hsql://localhost:9001/xdb</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.columnMappings.attrname</span><span class="p">=</span><span class="s">attrvalue</span>
</code></pre></div></div>

<p>Once CAS understands the schema, we should then specify which attributes really should be retrieved by CAS.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.attributeRepository.attributes.firstname</span><span class="p">=</span><span class="s">firstname</span>
<span class="py">cas.authn.attributeRepository.attributes.lastname</span><span class="p">=</span><span class="s">lastname</span>
<span class="c"># cas.authn.attributeRepository.attributes.phone=phone
</span></code></pre></div></div>

<p>Note how I am skipping over <code class="highlighter-rouge">phone</code>.</p>

<p>The above says, <em>Retrieve attributes <code class="highlighter-rouge">firstname</code> and <code class="highlighter-rouge">lastname</code> from the repositories and keep them as they are</em>.
If we wanted to, we could virtually rename the attributes to for instance <code class="highlighter-rouge">TheFir$tN@me</code> and <code class="highlighter-rouge">simpleL@stnam3</code>.</p>

<h1 id="release-attributes">Release Attributes</h1>

<p>There are multiple ways of <a href="https://apereo.github.io/cas/development/integration/Attribute-Release.html">releasing attributes</a>. For this tutorial, I am going to release them globally to all applications:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.attributeRepository.defaultAttributesToRelease</span><span class="p">=</span><span class="s">firstname,lastname</span>
</code></pre></div></div>

<p>Note how I am skipping over <code class="highlighter-rouge">phone</code>.</p>

<h1 id="build-and-deploy-2">Build and Deploy</h1>

<p>For this to actually be tested, we need a client to which we can release attributes, right? You can use whatever client/application you like, as long as it’s able to retrieve attributes. I ended up using <a href="https://github.com/cas-projects/cas-sample-java-webapp">this</a>. When attempting to access the application, I get redirected to CAS. Once I log in and return, I see the following in the CAS logs on startup:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-02-21 14:54:04,885 DEBUG <span class="o">[</span>org.apereo.cas.config.CasPersonDirectoryConfiguration] - &lt;Configured multi-row JDBC attribute repository <span class="k">for</span> <span class="o">[</span>jdbc:hsqldb:hsql://localhost:9001/xdb]&gt;
2017-02-21 14:54:04,889 DEBUG <span class="o">[</span>org.apereo.cas.config.CasPersonDirectoryConfiguration] - &lt;Configured multi-row JDBC column mappings <span class="k">for</span> <span class="o">[</span>jdbc:hsqldb:hsql://localhost:9001/xdb] are <span class="o">[{</span><span class="nv">attrname</span><span class="o">=</span>attrvalue<span class="o">}]&gt;</span>
2017-02-21 14:54:04,890 DEBUG <span class="o">[</span>org.apereo.cas.config.CasPersonDirectoryConfiguration] - &lt;Configured result attribute mapping <span class="k">for</span> <span class="o">[</span>jdbc:hsqldb:hsql://localhost:9001/xdb] to be <span class="o">[{</span><span class="nv">firstname</span><span class="o">=</span>firstname, <span class="nv">lastname</span><span class="o">=</span>lastname<span class="o">}]&gt;</span>
</code></pre></div></div>

<p>Which shows that CAS has been able to understand the schema and map columns to attributes. Logging into the client application also shows me:</p>

<p><img src="https://cloud.githubusercontent.com/assets/1205228/23163353/5c39f42a-f847-11e6-806e-6d4e3ca88805.png" alt="image" /></p>

<h1 id="so">So…</h1>

<p>I hope this brief tutorial was of some assistance to you. Remember that the point here is not to enumerate best practices and such. It’s just to show the possibilities. It’s important that you start off simple and make changes one step at a time. Once you have a functional environment, you can gradually and slowly add customizations to move files, tables and queries around.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

</article>


  <div class="share-page">
  Share this post!

  <div class="share-links">
    
      <a class="fa fa-facebook" href="https://facebook.com/sharer.php?u=https%3A%2F%2Fapereo.github.io%2F2017%2F02%2F22%2Fcas51-dbauthn-tutorial%2F" rel="nofollow" target="_blank" title="Share on Facebook"></a>
    

    
      <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?text=CAS+5+Database+Authentication+Tutorial&amp;url=https%3A%2F%2Fapereo.github.io%2F2017%2F02%2F22%2Fcas51-dbauthn-tutorial%2F" rel="nofollow" target="_blank" title="Share on Twitter"></a>
    

    
      <a class="fa fa-google-plus" href="https://plus.google.com/share?url=https%3A%2F%2Fapereo.github.io%2F2017%2F02%2F22%2Fcas51-dbauthn-tutorial%2F" rel="nofollow" target="_blank" title="Share on Google+"></a>
    

    
      <a class="fa fa-linkedin" href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fapereo.github.io%2F2017%2F02%2F22%2Fcas51-dbauthn-tutorial%2F&amp;title=CAS+5+Database+Authentication+Tutorial" rel="nofollow" target="_blank" title="Share on LinkedIn"></a>
    

    
      <a class="fa fa-digg" href="http://digg.com/submit?url=https%3A%2F%2Fapereo.github.io%2F2017%2F02%2F22%2Fcas51-dbauthn-tutorial%2F&amp;title=CAS+5+Database+Authentication+Tutorial" rel="nofollow" target="_blank" title="Share on Digg"></a>
    

    
      <a class="fa fa-tumblr" href="http://www.tumblr.com/share/link?url=https%3A%2F%2Fapereo.github.io%2F2017%2F02%2F22%2Fcas51-dbauthn-tutorial%2F&amp;name=CAS+5+Database+Authentication+Tutorial" rel="nofollow" target="_blank" title="Share on Tumblr"></a>
    

    
      <a class="fa fa-reddit" href="http://reddit.com/submit?url=https%3A%2F%2Fapereo.github.io%2F2017%2F02%2F22%2Fcas51-dbauthn-tutorial%2F&amp;title=CAS+5+Database+Authentication+Tutorial" rel="nofollow" target="_blank" title="Share on Reddit"></a>
    

    
      <a class="fa fa-stumbleupon" href="http://www.stumbleupon.com/submit?url=https%3A%2F%2Fapereo.github.io%2F2017%2F02%2F22%2Fcas51-dbauthn-tutorial%2F&amp;title=CAS+5+Database+Authentication+Tutorial" rel="nofollow" target="_blank" title="Share on StumbleUpon"></a>
    

    
      <a class="fa fa-hacker-news" onclick="parent.postMessage('submit','*')" href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fapereo.github.io%2F2017%2F02%2F22%2Fcas51-dbauthn-tutorial%2F&amp;t=CAS+5+Database+Authentication+Tutorial" rel="nofollow" target="_blank" title="Share on Hacker News"></a>
    
  </div>
</div>




  <div class="py2 post-footer">
  <!-- <img src="/images/me.jpeg" alt="John Otander" class="avatar" /> -->

  <p>
    Follow Apereo on <a href="https://twitter.com/Apereo">Twitter</a>.
  </p>
</div>










  <h3 class="related-post-title">Related Posts</h3>
  
    <div class="post ml2">
      <a href="/2019/02/01/610rc1-release/" class="post-link">
        <h4 class="post-title">CAS 6.1.0 RC1 Feature Release</h4>
        <p class="post-summary">...in which I present an overview of CAS 6.1.0 RC1 release.</p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2018/12/24/cas53-oohlalamobile-saml2-integration/" class="post-link">
        <h4 class="post-title">Apereo CAS - OohLala Mobile SAML2 Integration</h4>
        <p class="post-summary">Learn how to integrate OohLala Mobile with Apereo CAS running as a SAML2 identity provider.</p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2018/12/24/cas53-oclc-saml2-integration/" class="post-link">
        <h4 class="post-title">Apereo CAS - Cranium Cafe SAML2 Integration</h4>
        <p class="post-summary">Learn how to integrate Cranium Cafe with Apereo CAS running as a SAML2 identity provider.</p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2018/12/24/cas53-elumen-saml2-integration/" class="post-link">
        <h4 class="post-title">Apereo CAS - eLumen SAML2 Integration</h4>
        <p class="post-summary">Learn how to integrate eLumen with Apereo CAS running as a SAML2 identity provider.</p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2018/12/23/cas53-getrave-saml2-integration/" class="post-link">
        <h4 class="post-title">Apereo CAS - Rave SAML2 Integration</h4>
        <p class="post-summary">Learn how to integrate Rave with Apereo CAS running as a SAML2 identity provider.</p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2018/12/22/cas53-hiretouch-saml2-integration/" class="post-link">
        <h4 class="post-title">Apereo CAS - HireTouch SAML2 Integration</h4>
        <p class="post-summary">Learn how to integrate HireTouch with Apereo CAS running as a SAML2 identity provider.</p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2018/12/06/cas53-office365-saml2-integration/" class="post-link">
        <h4 class="post-title">Apereo CAS - Microsoft Office 365 SAML2 Integration</h4>
        <p class="post-summary">Learn how to integrate Microsoft Office 365 with Apereo CAS running as a SAML2 identity provider.</p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2018/12/04/cas53-happyfox-saml2-integration/" class="post-link">
        <h4 class="post-title">Apereo CAS - HappyFox SAML2 Integration</h4>
        <p class="post-summary">Learn how to integrate HappyFox with Apereo CAS running as a SAML2 identity provider.</p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2018/12/04/cas53-cisco-webex-saml2-integration/" class="post-link">
        <h4 class="post-title">Apereo CAS - Cisco Webex SAML2 Integration</h4>
        <p class="post-summary">Learn how to integrate Cisco Webex with Apereo CAS running as a SAML2 identity provider.</p>
      </a>
    </div>
  
    <div class="post ml2">
      <a href="/2018/12/03/cas53-vmwareidentitymgr-saml2-integration/" class="post-link">
        <h4 class="post-title">Apereo CAS - VMware Identity Manager SAML2 Integration</h4>
        <p class="post-summary">Learn how to integrate VMware Identity Manager with Apereo CAS running as a SAML2 identity provider.</p>
      </a>
    </div>
  


      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    <small>
      Theme crafted with &lt;3 by <a href="http://johnotander.com">John Otander</a> (<a href="https://twitter.com/4lpine">@4lpine</a>).<br>
      &lt;/&gt; available on <a href="https://github.com/johnotander/pixyll">Github</a>.
    </small>
  </div>

          
</footer>
<!-- AnchorJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.0.0/anchor.min.js"></script>
<script>
    anchors.options.visible = 'always';
    anchors.add('article h1, article h2, article h3, article h4, article h5, article h6');
</script>

	
</body>
</html>
