<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title></title>
    <link>https://apereo.github.io</link>
    <description>
      This is a blog managed and edited by the Apereo project participants. It is typically used to post project updates, announce news, etc.
    </description>
    
        
            <item>
                <title>CAS 6.1.0 RC1 Feature Release</title>
                <link>https://apereo.github.io/2019/02/01/610rc1-release/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br />This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">6.0.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v6.0.0">December 28th, 2018</a>. Since then, the project has been moving forward with development of the next feature release that is tagged as <code class="highlighter-rouge">6.1.0</code>. Please review the <a href="https://apereo.github.io/cas/developer/Release-Policy.html">release policy</a> to learn more about the scope of the release. This post intends to highlight some of the improvements and enhancements packed into the <strong>first</strong> release candidate in the <code class="highlighter-rouge">6.1.0</code> series.</p>

<!--
You can read about the previous release candidate [here](https://apereo.github.io/2018/10/26/600rc3-release/).
-->

<h2 class="no_toc" id="shake-well-before-use">Shake Well Before Use</h2>

<p>We strongly recommend that you take advantage of the release candidates as they come out. Waiting for a <code class="highlighter-rouge">GA</code> release is only going to set you up for unpleasant surprises. A <code class="highlighter-rouge">GA</code> is simply <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">a tag and nothing more</a>. Note that CAS releases are <em>strictly</em> time-based releases; they are not scheduled or based on specific benchmarks, statistics or completion of features. To gain confidence in a particular release, it is strongly recommended that you start early by experimenting with release candidates and/or follow-up snapshots.</p>

<p>In order to start experimenting with release candidates, at any given time, you should be able to append <code class="highlighter-rouge">-SNAPSHOT</code> to the CAS version specified in order to take advantage of snapshot builds as changes are made and published.</p>

<h3 class="no_toc" id="overlay">Overlay</h3>

<p>In the <code class="highlighter-rouge">gradle.properties</code> of <a href="https://github.com/apereo/cas-overlay-template">the overlay</a>, adjust the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">casVersion</span><span class="p">=</span><span class="s">6.1.0-RC1</span>
</code></pre></div></div>

<h2 class="no_toc" id="changes">Changes</h2>

<ul id="markdown-toc">
  <li><a href="#new--noteworthy" id="markdown-toc-new--noteworthy">New &amp; Noteworthy</a>    <ul>
      <li><a href="#hazelcast-wan-replication" id="markdown-toc-hazelcast-wan-replication">Hazelcast WAN Replication</a></li>
      <li><a href="#saml2-metadata-management-via-json" id="markdown-toc-saml2-metadata-management-via-json">SAML2 Metadata Management via JSON</a></li>
      <li><a href="#saml2-signing-credential-fingerprint" id="markdown-toc-saml2-signing-credential-fingerprint">SAML2 Signing Credential Fingerprint</a></li>
      <li><a href="#password-synchronization" id="markdown-toc-password-synchronization">Password Synchronization</a></li>
    </ul>
  </li>
  <li><a href="#small-stuff" id="markdown-toc-small-stuff">Small Stuff</a></li>
  <li><a href="#library-upgrades" id="markdown-toc-library-upgrades">Library Upgrades</a></li>
  <li><a href="#resources" id="markdown-toc-resources">Resources</a></li>
  <li><a href="#get-involved" id="markdown-toc-get-involved">Get Involved</a></li>
  <li><a href="#credits" id="markdown-toc-credits">Credits</a></li>
</ul>

<h3 id="new--noteworthy">New &amp; Noteworthy</h3>

<h4 id="hazelcast-wan-replication">Hazelcast WAN Replication</h4>

<p>Hazelcast WAN replication using static discovery is now <a href="https://apereo.github.io/cas/development/ticketing/Hazelcast-Ticket-Registry.html">supported by CAS</a>.</p>

<h4 id="saml2-metadata-management-via-json">SAML2 Metadata Management via JSON</h4>

<p>SAML2 service provider integrations that do not necessarily provide metadata may be managed dynamically inside a <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html#service-provider-metadata">standalone JSON file</a>.</p>

<h4 id="saml2-signing-credential-fingerprint">SAML2 Signing Credential Fingerprint</h4>

<p><a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html#saml-services">SAML services</a> are given the ability
to filter the signing credential used in the metadata by its <code class="highlighter-rouge">SHA-1</code> fingerprint.</p>

<h4 id="password-synchronization">Password Synchronization</h4>

<p>Support for <a href="https://apereo.github.io/cas/development/installation/Password-Synchronization.html">password synchronization</a> is now available.</p>

<h3 id="small-stuff">Small Stuff</h3>

<ul>
  <li><a href="https://apereo.github.io/cas/development/installation/Rest-Authentication.html">REST Authentication</a> can now display warnings as part of the authentication flow.</li>
  <li><a href="https://apereo.github.io/cas/development/password_management/Password-Management-REST.html">REST Password Management</a> may now support endpoints protected via Basic AuthN.</li>
</ul>

<h3 id="library-upgrades">Library Upgrades</h3>

<ul>
  <li>Hibernate</li>
  <li>Gradle</li>
  <li>Azure KeyVault</li>
  <li>OpenSAML</li>
</ul>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://apereo.github.io/cas/development/">Documentation</a></li>
  <li><a href="https://github.com/apereo/cas/milestones">Release Schedule</a></li>
  <li><a href="https://apereo.github.io/cas/developer/Release-Policy.html">Release Policy</a></li>
</ul>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="credits">Credits</h2>

<p>Big thanks to all who participate in the development of this release to submit patches and contribute improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2019/02/01/610rc1-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 6.1.0 RC1 release.
                    
                </description>
                <pubDate>Fri, 01 Feb 2019 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - OohLala Mobile SAML2 Integration</title>
                <link>https://apereo.github.io/2018/12/24/cas53-oohlalamobile-saml2-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<div class="alert alert-info">
  <strong>Contributed Content</strong><br />Paul Spaude of Unicon, Inc was kind enough to contribute this guide.
</div>

<p>Ready Communication’s OohLala Mobile provides a mobile community and communication tools for higher education. As a SAML2 service provider, it can be integrated with CAS running as a SAML identity provider and this blog post provides a quick walkthrough of how to make that integration possible.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h1 id="cas-configuration">CAS Configuration</h1>

<p>First, ensure that your CAS deployment is equipped to act as a <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-SAML2-Authentication.html">SAML2 identity provider</a>. Next, you may also use the <a href="https://apereo.github.io/cas/5.3.x/installation/JSON-Service-Management.html">JSON Service Registry</a> to keep track of the relying-party registration record in JSON definition files.</p>

<p>The JSON file to contain the service provider relying-party record would be as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://integration.oohlalamobile.com/saml/[instance-name]/metadata"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"OohLaLa"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"metadataLocation"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://integration.oohlalamobile.com/saml/[instance-name]/metadata"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"encryptAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signResponses"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"attributeReleasePolicy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.ReturnAllowedAttributeReleasePolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"allowedAttributes"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.ArrayList"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s2">"givenName"</span><span class="p">,</span><span class="s2">"sn"</span><span class="p">,</span><span class="s2">"mail"</span><span class="p">,</span><span class="s2">"uid"</span><span class="p">]]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A few things to point out:</p>

<ul>
  <li>You will need to adjust the <code class="highlighter-rouge">metadataLocation</code> to match your instance.</li>
  <li>Make sure CAS has retrieved the allowed attributes (i.e. <code class="highlighter-rouge">givenName</code>, <code class="highlighter-rouge">sn</code> etc) listed in the JSON definition file.</li>
  <li>Make sure the SP metadata has the correct entity id, matching the instance.</li>
</ul>

<h1 id="finale">Finale</h1>

<p>Thanks to Paul Spaude of Unicon, Inc who was kind enough to share the above integration notes. If you too have an integration with a well-known SAML2 service provider, please consider sharing that guide in form of a blog post here as well.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/12/24/cas53-oohlalamobile-saml2-integration/</guid>
                <description>
                    
                    Learn how to integrate OohLala Mobile with Apereo CAS running as a SAML2 identity provider.
                    
                </description>
                <pubDate>Mon, 24 Dec 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Cranium Cafe SAML2 Integration</title>
                <link>https://apereo.github.io/2018/12/24/cas53-oclc-saml2-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<div class="alert alert-info">
  <strong>Contributed Content</strong><br />Paul Spaude of Unicon, Inc was kind enough to contribute this guide.
</div>

<p>Cranium Cafe is a virtual teleconferencing platform that creates a simple, mobile in-office appointment. As a SAML2 service provider, it can be integrated with CAS running as a SAML identity provider and this blog post provides a quick walkthrough of how to make that integration possible.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h1 id="cas-configuration">CAS Configuration</h1>

<p>First, ensure that your CAS deployment is equipped to act as a <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-SAML2-Authentication.html">SAML2 identity provider</a>. Next, you may also use the <a href="https://apereo.github.io/cas/5.3.x/installation/JSON-Service-Management.html">JSON Service Registry</a> to keep track of the relying-party registration record in JSON definition files.</p>

<p>The JSON file to contain the service provider relying-party record would be as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://my.craniumcafe.com/login/saml2"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"CraniumCafe"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"metadataLocation"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://my.craniumcafe.com/login/saml2_metadata"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"encryptAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signResponses"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"attributeReleasePolicy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.ReturnMappedAttributeReleasePolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"allowedAttributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.TreeMap"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"eduPersonScopedAffiliation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"groovy { return attributes['eduPersonAffiliation'].get(0) + '@example.org' }"</span><span class="w">
      </span><span class="s2">"displayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"displayName"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"mail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mail"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"eduPersonPrincipalName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"groovy { return attributes['eduPersonPrincipalName'].get(0) + '@example.org' }"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A few things to point out:</p>

<ul>
  <li>You will need to adjust the <code class="highlighter-rouge">metadataLocation</code> to match your instance.</li>
  <li>Make sure CAS has retrieved the allowed attributes (i.e. <code class="highlighter-rouge">eduPersonPrincipalName</code>, <code class="highlighter-rouge">mail</code> etc) listed in the JSON definition file.</li>
  <li>Make sure the SP metadata has the correct entity id, matching the instance.</li>
</ul>

<h1 id="finale">Finale</h1>

<p>Thanks to Paul Spaude of Unicon, Inc who was kind enough to share the above integration notes. If you too have an integration with a well-known SAML2 service provider, please consider sharing that guide in form of a blog post here as well.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/12/24/cas53-oclc-saml2-integration/</guid>
                <description>
                    
                    Learn how to integrate Cranium Cafe with Apereo CAS running as a SAML2 identity provider.
                    
                </description>
                <pubDate>Mon, 24 Dec 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - eLumen SAML2 Integration</title>
                <link>https://apereo.github.io/2018/12/24/cas53-elumen-saml2-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<div class="alert alert-info">
  <strong>Contributed Content</strong><br />Paul Spaude of Unicon, Inc was kind enough to contribute this guide.
</div>

<p>eLumen is a higher-ed, assessment and curriculum management system that gives real insight into each students’ engagement and progress—while satisfying the growing demands of accreditation and other compliance mandates. As a SAML2 service provider, it can be integrated with CAS running as a SAML identity provider and this blog post provides a quick walkthrough of how to make that integration possible.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h1 id="cas-configuration">CAS Configuration</h1>

<p>First, ensure that your CAS deployment is equipped to act as a <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-SAML2-Authentication.html">SAML2 identity provider</a>. Next, you may also use the <a href="https://apereo.github.io/cas/5.3.x/installation/JSON-Service-Management.html">JSON Service Registry</a> to keep track of the relying-party registration record in JSON definition files.</p>

<p>The JSON file to contain the service provider relying-party record would be as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"[entity-id].elumenapp.com"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ELumen"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"metadataLocation"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/elumen-metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"encryptAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signResponses"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"attributeReleasePolicy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.ReturnMappedAttributeReleasePolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"allowedAttributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.TreeMap"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uid"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"eduPersonPrincipalName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"groovy { return attributes['eduPersonPrincipalName'].get(0) + '@exampl.org' }"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A few things to point out:</p>

<ul>
  <li>You will need to adjust the <code class="highlighter-rouge">metadataLocation</code> to match your instance.</li>
  <li>Make sure CAS has retrieved the allowed attributes (i.e. <code class="highlighter-rouge">eduPersonPrincipalName</code>, <code class="highlighter-rouge">uid</code> etc) listed in the JSON definition file.</li>
  <li>Make sure the SP metadata has the correct entity id, matching the instance.</li>
</ul>

<h1 id="finale">Finale</h1>

<p>Thanks to Paul Spaude of Unicon, Inc who was kind enough to share the above integration notes. If you too have an integration with a well-known SAML2 service provider, please consider sharing that guide in form of a blog post here as well.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/12/24/cas53-elumen-saml2-integration/</guid>
                <description>
                    
                    Learn how to integrate eLumen with Apereo CAS running as a SAML2 identity provider.
                    
                </description>
                <pubDate>Mon, 24 Dec 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Rave SAML2 Integration</title>
                <link>https://apereo.github.io/2018/12/23/cas53-getrave-saml2-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<div class="alert alert-info">
  <strong>Contributed Content</strong><br />Paul Spaude of Unicon, Inc was kind enough to contribute this guide.
</div>

<p>Rave is a mass notification system designed to deliver fast and effective messaging for routine and emergency communications. As a SAML2 service provider, Rave can be integrated with CAS running as a SAML identity provider and this blog post provides a quick walkthrough of how to make that integration possible.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h1 id="cas-configuration">CAS Configuration</h1>

<p>First, ensure that your CAS deployment is equipped to act as a <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-SAML2-Authentication.html">SAML2 identity provider</a>. Next, you may also use the <a href="https://apereo.github.io/cas/5.3.x/installation/JSON-Service-Management.html">JSON Service Registry</a> to keep track of the relying-party registration record in JSON definition files.</p>

<p>The JSON file to contain the service provider relying-party record would be as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.getrave.com/shibboleth-sp"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Rave"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"metadataLocation"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"encryptAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signResponses"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"requiredNameIdFormat"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oasis:names:tc:SAML:2.0:nameid-format:transient"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"attributeReleasePolicy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.ReturnMappedAttributeReleasePolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"allowedAttributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.TreeMap"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"employeeNumber"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oid:1.2.840.113556.1.2.610"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"eduPersonPrincipalName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"groovy { return attributes['eduPersonPrincipalName'].get(0) + '@example.org' }"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A few things to point out:</p>

<ul>
  <li>You will need to adjust the <code class="highlighter-rouge">metadataLocation</code> to match your instance.</li>
  <li>Make sure CAS has retrieved the allowed attributes (i.e. <code class="highlighter-rouge">employeeNumber</code>, <code class="highlighter-rouge">eduPersonPrincipalName</code> etc) listed in the JSON definition file.</li>
  <li>Make sure the SP metadata has the correct entity id, matching the Rave instance.</li>
</ul>

<h1 id="finale">Finale</h1>

<p>Thanks to Paul Spaude of Unicon, Inc who was kind enough to share the above integration notes. If you too have an integration with a well-known SAML2 service provider, please consider sharing that guide in form of a blog post here as well.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/12/23/cas53-getrave-saml2-integration/</guid>
                <description>
                    
                    Learn how to integrate Rave with Apereo CAS running as a SAML2 identity provider.
                    
                </description>
                <pubDate>Sun, 23 Dec 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - HireTouch SAML2 Integration</title>
                <link>https://apereo.github.io/2018/12/22/cas53-hiretouch-saml2-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<div class="alert alert-info">
  <strong>Contributed Content</strong><br />Paul Spaude of Unicon, Inc was kind enough to contribute this guide.
</div>

<p><a href="http://hiretouch.com">HireTouch</a> offers talent management solutions and is built specifically for human resources departments and hiring managers. As a SAML2 service provider, HireTouch can be integrated with CAS running as a SAML identity provider and this blog post provides a quick walkthrough of how to make that integration possible.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h1 id="cas-configuration">CAS Configuration</h1>

<p>First, ensure that your CAS deployment is equipped to act as a <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-SAML2-Authentication.html">SAML2 identity provider</a>. Next, you may also use the <a href="https://apereo.github.io/cas/5.3.x/installation/JSON-Service-Management.html">JSON Service Registry</a> to keep track of the relying-party registration record in JSON definition files.</p>

<p>The JSON file to contain the service provider relying-party record would be as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://[instance].hiretouch.com/admin/saml/consume"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"HireTouch"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"metadataLocation"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"encryptAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signResponses"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"attributeReleasePolicy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.ReturnAllowedAttributeReleasePolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"allowedAttributes"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.ArrayList"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s2">"uid"</span><span class="p">]]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A few things to point out:</p>

<ul>
  <li>You will need to adjust the <code class="highlighter-rouge">metadataLocation</code> to match your instance.</li>
  <li>Make sure CAS has retrieved the allowed attributes (i.e. <code class="highlighter-rouge">uid</code> etc) listed in the JSON definition file.</li>
  <li>Make sure the SP metadata has the correct entity id, matching the HireTouch instance.</li>
</ul>

<h1 id="finale">Finale</h1>

<p>Thanks to Paul Spaude of Unicon, Inc who was kind enough to share the above integration notes. If you too have an integration with a well-known SAML2 service provider, please consider sharing that guide in form of a blog post here as well.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/12/22/cas53-hiretouch-saml2-integration/</guid>
                <description>
                    
                    Learn how to integrate HireTouch with Apereo CAS running as a SAML2 identity provider.
                    
                </description>
                <pubDate>Sat, 22 Dec 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Microsoft Office 365 SAML2 Integration</title>
                <link>https://apereo.github.io/2018/12/06/cas53-office365-saml2-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<div class="alert alert-info">
  <strong>Contributed Content</strong><br />Paul Spaude of Unicon, Inc was kind enough to contribute this guide.
</div>

<p>Office 365 is a line of subscription services offered by Microsoft, as part of the Microsoft Office product line. As a SAML2 service provider, Office 365  can be integrated with CAS running as a SAML identity provider and this blog post provides a quick walkthrough of how to make that integration possible.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h1 id="office-365-configuration">Office 365 Configuration</h1>

<p>The following resources should come in handy:</p>

<ul>
  <li><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/single-sign-on-saml-protocol">Azure Active Directory: Single Sign-On SAML protocol</a></li>
  <li><a href="https://blogs.perficient.com/2015/04/01/office-365-why-you-need-to-understand-immutableid/">Office 365 – Why You Need to Understand ImmutableID</a></li>
</ul>

<p>Azure Active Directory SAML2 metadata may be <a href="https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml">found here</a>.</p>

<h1 id="cas-configuration">CAS Configuration</h1>

<p>First, ensure that your CAS deployment is equipped to act as a <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-SAML2-Authentication.html">SAML2 identity provider</a>. Next, you may also use the <a href="https://apereo.github.io/cas/5.3.x/installation/JSON-Service-Management.html">JSON Service Registry</a> to keep track of the relying-party registration record in JSON definition files.</p>

<p>The JSON file to contain the service provider relying-party record would be as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:federation:MicrosoftOnline"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Office365_SP"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft Office 365 / Azure AD"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="s2">"metadataLocation"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"file:///path/to/WindowsAzureAD-metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"encryptAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signAssertions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signResponses"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"requiredNameIdFormat"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"usernameAttributeProvider"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.PrincipalAttributeRegisteredServiceUsernameProvider"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"usernameAttribute"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"objectGUID"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"attributeReleasePolicy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.ReturnMappedAttributeReleasePolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"allowedAttributes"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.TreeMap"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"userPrincipalName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"IDPEmail"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A few things to point out:</p>

<ul>
  <li>You will need to adjust the <code class="highlighter-rouge">metadataLocation</code> to match your data and the Office 365 instance.</li>
  <li>Make sure CAS has retrieved the allowed attributes (i.e. <code class="highlighter-rouge">IDPEmail</code>, <code class="highlighter-rouge">objectGUID</code> etc) listed in the JSON definition file. This is required in the final generated SAML2 response to create the proper <code class="highlighter-rouge">NameIDFormat</code> element.</li>
  <li>Make sure the SP metadata has the correct entity id, matching your Office 365 instance address.</li>
</ul>

<h1 id="finale">Finale</h1>

<p>Thanks to Paul Spaude of Unicon, Inc who was kind enough to share the above integration notes. If you too have an integration with a well-known SAML2 service provider, please consider sharing that guide in form of a blog post here as well.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/12/06/cas53-office365-saml2-integration/</guid>
                <description>
                    
                    Learn how to integrate Microsoft Office 365 with Apereo CAS running as a SAML2 identity provider.
                    
                </description>
                <pubDate>Thu, 06 Dec 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - HappyFox SAML2 Integration</title>
                <link>https://apereo.github.io/2018/12/04/cas53-happyfox-saml2-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>HappyFox is an all-in-one help desk ticketing system. As a SAML2 service provider, HappyFox can be integrated with CAS running as a SAML identity provider and this blog post provides a quick walkthrough of how to make that integration possible.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h1 id="happyfox-configuration">HappyFox Configuration</h1>

<p>Use <a href="https://support.happyfox.com/kb/article/515-using-saml-for-single-sign-on/">these instructions</a> to set up HappyFox as a SAML2 service provider.</p>

<h1 id="cas-configuration">CAS Configuration</h1>

<p>First, ensure that your CAS deployment is equipped to act as a <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-SAML2-Authentication.html">SAML2 identity provider</a>. Next, you may also use the <a href="https://apereo.github.io/cas/5.3.x/installation/JSON-Service-Management.html">JSON Service Registry</a> to keep track of the HappyFox relying-party registration record in JSON definition files.</p>

<p>The JSON file to contain the service provider relying-party record would be as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://[name].happyfox.com/saml/metadata/"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"HappyFox"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HappyFox"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"metadataLocation"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"file:/etc/cas/config/saml/happyfox-metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"usernameAttributeProvider"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.PrincipalAttributeRegisteredServiceUsernameProvider"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"usernameAttribute"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"mail"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Note that HappyFox does not provide its own SP metadata and you will have to create it youself. The following is example of what that metadata may look like:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="nt">&lt;md:EntityDescriptor</span> <span class="na">xmlns:md=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:metadata"</span>
                     <span class="na">validUntil=</span><span class="s">"2050-12-05T19:27:46Z"</span>
                     <span class="na">cacheDuration=</span><span class="s">"PT604800S"</span>
                     <span class="na">entityID=</span><span class="s">"https://[name].happyfox.com/saml/metadata/"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;md:SPSSODescriptor</span> <span class="na">AuthnRequestsSigned=</span><span class="s">"false"</span> <span class="na">WantAssertionsSigned=</span><span class="s">"false"</span>
                        <span class="na">protocolSupportEnumeration=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:protocol"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;md:NameIDFormat&gt;</span>urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress<span class="nt">&lt;/md:NameIDFormat&gt;</span>
        <span class="nt">&lt;md:AssertionConsumerService</span> <span class="na">Binding=</span><span class="s">"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"</span>
                                     <span class="na">Location=</span><span class="s">"https://[name].happyfox.com/saml/callback/"</span>
                                     <span class="na">index=</span><span class="s">"0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/md:SPSSODescriptor&gt;</span>
<span class="nt">&lt;/md:EntityDescriptor&gt;</span>
</code></pre></div></div>

<p>A few things to point out:</p>

<ul>
  <li>You will need to adjust the <code class="highlighter-rouge">serviceId</code> and <code class="highlighter-rouge">metadataLocation</code> to match your data and the HappyFox instance.</li>
  <li>Make sure CAS has retrieved the allowed attributes (i.e. <code class="highlighter-rouge">mail</code> etc) listed in the JSON definition file. This is required in the final generated SAML2 response to create the proper <code class="highlighter-rouge">NameIDFormat</code> element.</li>
  <li>Make sure the SP metadata has the correct entity id, matching your HappyFox instance address.</li>
</ul>

<h1 id="finale">Finale</h1>

<p>If you too have an integration with a well-known SAML2 service provider, please consider sharing that guide in form of a blog post here as well.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/12/04/cas53-happyfox-saml2-integration/</guid>
                <description>
                    
                    Learn how to integrate HappyFox with Apereo CAS running as a SAML2 identity provider.
                    
                </description>
                <pubDate>Tue, 04 Dec 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Cisco Webex SAML2 Integration</title>
                <link>https://apereo.github.io/2018/12/04/cas53-cisco-webex-saml2-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<div class="alert alert-info">
  <strong>Contributed Content</strong><br />Keith Conger of Colorado College, an active member of the CAS community, was kind enough to contribute this guide.
</div>

<p>Cisco Webex, formerly WebEx Communications Inc., is a company that provides on-demand collaboration, online meeting, web conferencing and videoconferencing applications. As a SAML2 service provider, Cisco Webex can be integrated with CAS running as a SAML identity provider and this blog post provides a quick walkthrough of how to make that integration possible.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h1 id="cisco-webex-configuration">Cisco Webex Configuration</h1>

<p>Download the service provider metadata and upload the CAS identity provider metadata. No other configuration is required.</p>

<h1 id="cas-configuration">CAS Configuration</h1>

<p>First, ensure that your CAS deployment is equipped to act as a <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-SAML2-Authentication.html">SAML2 identity provider</a>. Next, you may also use the <a href="https://apereo.github.io/cas/5.3.x/installation/JSON-Service-Management.html">JSON Service Registry</a> to keep track of the Cisco Webex relying-party registration record in JSON definition files.</p>

<p>The JSON file to contain the Cisco Webex record would be as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">org.apereo.cas.support.saml.services.SamlRegisteredService</span><span class="w">
  </span><span class="err">serviceId</span><span class="p">:</span><span class="w"> </span><span class="err">^https</span><span class="p">:</span><span class="err">//idbroker.webex.com/.*</span><span class="w">
  </span><span class="err">name</span><span class="p">:</span><span class="w"> </span><span class="err">Cisco</span><span class="w"> </span><span class="err">Webex</span><span class="w">
  </span><span class="err">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="err">description</span><span class="p">:</span><span class="w"> </span><span class="err">Cisco</span><span class="w"> </span><span class="err">Webex</span><span class="w">
  </span><span class="err">usernameAttributeProvider</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">org.apereo.cas.services.PrincipalAttributeRegisteredServiceUsernameProvider</span><span class="w">
    </span><span class="err">usernameAttribute</span><span class="p">:</span><span class="w"> </span><span class="err">mail</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="err">attributeReleasePolicy</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">org.apereo.cas.services.ReturnMappedAttributeReleasePolicy</span><span class="w">
    </span><span class="err">allowedAttributes</span><span class="p">:</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">java.util.TreeMap</span><span class="w">
      </span><span class="err">givenName</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">java.util.ArrayList</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">firstName</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
      </span><span class="err">mail</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">java.util.ArrayList</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">email</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
      </span><span class="err">sn</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">java.util.ArrayList</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">lastName</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
      </span><span class="err">displayName</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">java.util.ArrayList</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">displayName</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="err">metadataLocation</span><span class="p">:</span><span class="w"> </span><span class="err">/path/to/webex-metadata.xml</span><span class="w">
  </span><span class="err">signAssertions</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="err">skipGeneratingSubjectConfirmationNotBefore</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="err">requiredNameIdFormat</span><span class="p">:</span><span class="w"> </span><span class="err">urn</span><span class="p">:</span><span class="err">oasis</span><span class="p">:</span><span class="err">names</span><span class="p">:</span><span class="err">tc</span><span class="p">:</span><span class="err">SAML</span><span class="p">:</span><span class="mf">1.1</span><span class="p">:</span><span class="err">nameid-format</span><span class="p">:</span><span class="err">emailAddress</span><span class="w">
  </span><span class="err">signResponses</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A few things to point out:</p>

<ul>
  <li>You will need to adjust the <code class="highlighter-rouge">serviceId</code> and <code class="highlighter-rouge">metadataLocation</code> to match your data and the Cisco Webex instance.</li>
  <li>Make sure CAS has retrieved the allowed attributes (i.e. <code class="highlighter-rouge">mail</code>, <code class="highlighter-rouge">givenName</code>, etc) listed in the JSON definition file.</li>
</ul>

<h1 id="finale">Finale</h1>

<p>Thanks to Keith Conger of Colorado College who was kind enough to share the above integration notes. If you too have an integration with a well-known SAML2 service provider, please consider sharing that guide in form of a blog post here as well.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/12/04/cas53-cisco-webex-saml2-integration/</guid>
                <description>
                    
                    Learn how to integrate Cisco Webex with Apereo CAS running as a SAML2 identity provider.
                    
                </description>
                <pubDate>Tue, 04 Dec 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - VMware Identity Manager SAML2 Integration</title>
                <link>https://apereo.github.io/2018/12/03/cas53-vmwareidentitymgr-saml2-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<div class="alert alert-info">
  <strong>Contributed Content</strong><br />Keith Conger of Colorado College, an active member of the CAS community, was kind enough to contribute this guide.
</div>

<p>VMware Identity Manager is identity management for the mobile cloud era that delivers on consumer-simple expectations like one-touch access to nearly any app, from any device, optimized with AirWatch Conditional Access. As a SAML2 service provider, VMware Identity Manager can be integrated with CAS running as a SAML identity provider and this blog post provides a quick walkthrough of how to make that integration possible.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h1 id="vmware-identity-manager-configuration">VMware Identity Manager Configuration</h1>

<ul>
  <li>Register CAS as an identity provider</li>
</ul>

<p><img width="1100" src="https://user-images.githubusercontent.com/1205228/49401590-d9c07a00-f704-11e8-9f65-3813a078d924.png" /></p>

<ul>
  <li>Configure authentication methods</li>
</ul>

<p><img width="1000" alt="screen shot 2018-11-27 at 3 01 55 pm" src="https://user-images.githubusercontent.com/1205228/49401739-49cf0000-f705-11e8-8c7b-c862f69f7d63.png" /></p>

<h1 id="cas-configuration">CAS Configuration</h1>

<p>First, ensure that your CAS deployment is equipped to act as a <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-SAML2-Authentication.html">SAML2 identity provider</a>. Next, you may also use the <a href="https://apereo.github.io/cas/5.3.x/installation/JSON-Service-Management.html">JSON Service Registry</a> to keep track of the VMware Identity Manager relying-party registration record in JSON definition files.</p>

<p>The JSON file to contain the VMware Identity Manager registration record would be as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">org.apereo.cas.support.saml.services.SamlRegisteredService</span><span class="w">
  </span><span class="err">serviceId</span><span class="p">:</span><span class="w"> </span><span class="err">your-vmware-idm-entity-id</span><span class="w">
  </span><span class="err">name</span><span class="p">:</span><span class="w"> </span><span class="err">VMware</span><span class="w"> </span><span class="err">Identity</span><span class="w"> </span><span class="err">Manager</span><span class="w">
  </span><span class="err">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="err">description</span><span class="p">:</span><span class="w"> </span><span class="err">VMware</span><span class="w"> </span><span class="err">Identity</span><span class="w"> </span><span class="err">Manager</span><span class="w">
  </span><span class="err">attributeReleasePolicy</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">org.apereo.cas.services.ReturnMappedAttributeReleasePolicy</span><span class="w">
    </span><span class="err">allowedAttributes</span><span class="p">:</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">java.util.TreeMap</span><span class="w">
      </span><span class="err">givenName</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">java.util.ArrayList</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">firstName</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
      </span><span class="err">mail</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">java.util.ArrayList</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">email</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
      </span><span class="err">sAMAccountName</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">java.util.ArrayList</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">userName</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
      </span><span class="err">sn</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">java.util.ArrayList</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">lastName</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
      </span><span class="err">userPrincipalName</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">java.util.ArrayList</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">userPrincipalName</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="err">metadataLocation</span><span class="p">:</span><span class="w"> </span><span class="err">/path/to/vmware-idm.xml</span><span class="w">
  </span><span class="err">signAssertions</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="err">skipGeneratingSubjectConfirmationNotBefore</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="err">signResponses</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A few things to point out:</p>

<ul>
  <li>You will of course need to adjust the <code class="highlighter-rouge">serviceId</code> and <code class="highlighter-rouge">metadataLocation</code> to match your data and VMware Identity Manager instance.</li>
  <li>Make sure CAS has retrieved the allowed attributes (i.e. <code class="highlighter-rouge">mail</code>, <code class="highlighter-rouge">givenName</code>, etc) listed in the JSON definition file.</li>
</ul>

<h1 id="finale">Finale</h1>

<p>Thanks to Keith Conger of Colorado College who was kind enough to share the above integration notes. If you too have an integration with a well-known SAML2 service provider, please consider sharing that guide in form of a blog post here as well.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/12/03/cas53-vmwareidentitymgr-saml2-integration/</guid>
                <description>
                    
                    Learn how to integrate VMware Identity Manager with Apereo CAS running as a SAML2 identity provider.
                    
                </description>
                <pubDate>Mon, 03 Dec 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 6.0.0 RC4 Feature Release</title>
                <link>https://apereo.github.io/2018/11/30/600rc4-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.3.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.3.0">June 29th, 2018</a>. Since then, the project has been moving forward with development of the next feature release that is tagged as <code class="highlighter-rouge">6.0.0</code>. Note that this is a <strong>major release</strong> of the CAS software which <em>may</em> present significant changes in architecture, configuration or behavior. Please review the <a href="https://apereo.github.io/cas/developer/Release-Policy.html">release policy</a> to learn more about the scope of the release.</p>

<p>This post intends to highlight some of the improvements and enhancements packed into the <strong>fourth</strong> release candidate in the <code class="highlighter-rouge">6.0.0</code> series.</p>

<p>You can read about the previous release candidate <a href="https://apereo.github.io/2018/10/26/600rc3-release/">here</a>.</p>

<h2 class="no_toc" id="shake-well-before-use">Shake Well Before Use</h2>

<p>We strongly recommend that you take advantage of the release candidates as they come out. Waiting for a <code class="highlighter-rouge">GA</code> release is only going to set you up for unpleasant surprises. A <code class="highlighter-rouge">GA</code> is simply <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">a tag and nothing more</a>. Note that CAS releases are <em>strictly</em> time-based releases; they are not scheduled or based on specific benchmarks, statistics or completion of features. To gain confidence in a particular release, it is strongly recommended that you start early by experimenting with release candidates and/or follow-up snapshots.</p>

<p>In order to start experimenting with release candidates, at any given time, you should be able to append <code class="highlighter-rouge">-SNAPSHOT</code> to the CAS version specified in order to take advantage of snapshot builds as changes are made and published.</p>

<h3 class="no_toc" id="overlay">Overlay</h3>

<p>In the <code class="highlighter-rouge">gradle.properties</code> of <a href="https://github.com/apereo/cas-overlay-template">the overlay</a>, adjust the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">casVersion</span><span class="p">=</span><span class="s">6.0.0-RC4</span>
</code></pre></div></div>

<h2 class="no_toc" id="changes">Changes</h2>

<ul id="markdown-toc">
  <li><a href="#known-issues" id="markdown-toc-known-issues">Known Issues</a></li>
  <li><a href="#new--noteworthy" id="markdown-toc-new--noteworthy">New &amp; Noteworthy</a>    <ul>
      <li><a href="#actuator-endpoint-ids" id="markdown-toc-actuator-endpoint-ids">Actuator Endpoint Ids</a></li>
      <li><a href="#sms-via-groovy--rest" id="markdown-toc-sms-via-groovy--rest">SMS via Groovy &amp; REST</a></li>
      <li><a href="#dockerized-cas-overlay" id="markdown-toc-dockerized-cas-overlay">Dockerized CAS Overlay</a></li>
      <li><a href="#command-line-shell" id="markdown-toc-command-line-shell">Command-line Shell</a></li>
      <li><a href="#service-environments" id="markdown-toc-service-environments">Service Environments</a></li>
      <li><a href="#recaptcha-v3" id="markdown-toc-recaptcha-v3">reCAPTCHA v3</a></li>
      <li><a href="#bucket4j-integration" id="markdown-toc-bucket4j-integration">Bucket4j Integration</a></li>
      <li><a href="#amazon-cognito-authentication" id="markdown-toc-amazon-cognito-authentication">Amazon Cognito Authentication</a></li>
      <li><a href="#soap-authentication" id="markdown-toc-soap-authentication">SOAP Authentication</a></li>
      <li><a href="#jdbc-naming-strategy" id="markdown-toc-jdbc-naming-strategy">JDBC Naming Strategy</a></li>
      <li><a href="#consent-review-endpoint" id="markdown-toc-consent-review-endpoint">Consent Review Endpoint</a></li>
    </ul>
  </li>
  <li><a href="#small-stuff" id="markdown-toc-small-stuff">Small Stuff</a></li>
  <li><a href="#library-upgrades" id="markdown-toc-library-upgrades">Library Upgrades</a></li>
  <li><a href="#resources" id="markdown-toc-resources">Resources</a></li>
  <li><a href="#get-involved" id="markdown-toc-get-involved">Get Involved</a></li>
  <li><a href="#credits" id="markdown-toc-credits">Credits</a></li>
</ul>
<h3 id="known-issues">Known Issues</h3>
<p>The <code class="highlighter-rouge">cas.admin-pages-security.ip</code> property has been renamed to <code class="highlighter-rouge">cas.monitor.endpoints.endpoint.defaults.access[0]</code> but due to an issue, a NullPointerException will occur on startup if you use that property (in canonical form or relaxed, etc) rather than pointing at the new property name. Change the property name or don’t use the property in order to avoid the issue.</p>

<h3 id="new--noteworthy">New &amp; Noteworthy</h3>

<h4 id="actuator-endpoint-ids">Actuator Endpoint Ids</h4>

<p>CAS <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">actuator endpoints</a> are named to be more consistent with Spring Boot guidelines, to remove startup warnings and prevents errors in future upgrades to Spring Boot <code class="highlighter-rouge">2.2.x</code>. Previous endpoints that were created using <em>kebab-case</em> identifiers such as <code class="highlighter-rouge">spring-webflow</code> are now switched over to use <em>camel-case</em> instead, such as <code class="highlighter-rouge">springWebflow</code>.</p>

<h4 id="sms-via-groovy--rest">SMS via Groovy &amp; REST</h4>

<p><a href="https://apereo.github.io/cas/development/installation/SMS-Messaging-Configuration.html">Sending SMS messages</a> is now also possible via Groovy scripts or a REST API.</p>

<h4 id="dockerized-cas-overlay">Dockerized CAS Overlay</h4>

<p>The <a href="https://github.com/apereo/cas-overlay-template">CAS WAR Overlay</a> is equipped to build Docker images using <code class="highlighter-rouge">jib</code>.</p>

<h4 id="command-line-shell">Command-line Shell</h4>

<p>The <a href="https://apereo.github.io/cas/development/installation/Configuring-Commandline-Shell.html">CAS Command-line Shell</a> gets a few upgrades to stay compatible with the most recent changes to the build, as well as a few new commands to generate crypto keys or encrypt/sign data, etc.</p>

<h4 id="service-environments">Service Environments</h4>

<p>Each registered application in the registry may be assigned a set of <a href="https://apereo.github.io/cas/development/services/Configuring-Service-Environments.html">environment names</a>.</p>

<h4 id="recaptcha-v3">reCAPTCHA v3</h4>

<p>Support for <a href="https://apereo.github.io/cas/development/integration/Configuring-Google-reCAPTCHA.html">reCAPTCHA v3</a> is now added to CAS.</p>

<h4 id="bucket4j-integration">Bucket4j Integration</h4>

<p>Authentication throttling support can now integrate with <a href="https://apereo.github.io/cas/development/installation/Configuring-Authentication-Throttling.html">Bucket4j</a> to handle capacity throttling for authentication requests.</p>

<h4 id="amazon-cognito-authentication">Amazon Cognito Authentication</h4>

<p>CAS is able to leverage <a href="https://apereo.github.io/cas/development/installation/AWS-Cognito-Authentication.html">Amazon Cognito</a> for authentication.</p>

<h4 id="soap-authentication">SOAP Authentication</h4>

<p>CAS is able to leverage <a href="https://apereo.github.io/cas/development/installation/SOAP-Authentication.html">SOAP APIs</a> for authentication.</p>

<h4 id="jdbc-naming-strategy">JDBC Naming Strategy</h4>

<p>Additional options are exposed to help remap database <em>virtual</em> table names to logical names either via static settings or Groovy scripts, 
when database schemas and queries are created. This allows one to translate CAS-provided table names to those that might work better 
with older or less forgiving database platforms that have restrictions on naming, etc.</p>

<h4 id="consent-review-endpoint">Consent Review Endpoint</h4>

<p>Reviewing consent decisions is now possible using the new <code class="highlighter-rouge">consentReview</code> endpoint that acts as a Spring Boot actuator endpoint.</p>

<h3 id="small-stuff">Small Stuff</h3>

<ul>
  <li>Small number of bug fixes to handle authorization correctly for <a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">delegated authentication</a>.</li>
  <li>The configuration settings for Spring Cloud configuration modules for MongoDb, DynamoDb, JDBC, etc should properly be recognized by CAS again.</li>
  <li>The background job to reload CAS registered service is made conditional to only execute in case a reloadable storage option is registered.</li>
  <li>A number of additional test cases for AWS S3 functionality.</li>
  <li>Improvements to the crypto algorithm selection used to generate secure random numbers.</li>
  <li>CAS configuration can now be recognized via Groovy closures.</li>
  <li>Security response headers can support all CAS registered service definition types.</li>
  <li>Minor improvements to database attribute fetching and processing of SQL <code class="highlighter-rouge">Array</code> objects.</li>
  <li>CAS configuration watch can operate on both the configuration directory and the standalone <em>direct</em> configuration file.</li>
  <li>CAS multifactor authentication via RADIUS gains the ability to enforce a limit on the number of allowed authentication attempts.</li>
  <li>Secret keys used for various signing and encryption operations can now properly be recognized via CAS settings.</li>
  <li>SAML2 SLO functionality receives a number of improvements to handle various forms of bindings.</li>
  <li>CAS configuration properties that are renamed or moved to a new location should be reported on startup when used.</li>
  <li>Most if not all custom shell commands used by the CAS overlay are moved into the Gradle build script.</li>
  <li>Authentication throttling backed by Hazelcast gains its own independant set of properties.</li>
</ul>

<h3 id="library-upgrades">Library Upgrades</h3>

<ul>
  <li>Spring Boot</li>
  <li>Spring</li>
  <li>Gradle</li>
  <li>Lombok</li>
  <li>Micrometer</li>
  <li>Spring Integration</li>
  <li>Apache Tomcat</li>
  <li>Person Directory</li>
  <li>CAS Security Filter</li>
  <li>Amazon SDK</li>
  <li>JUnit</li>
  <li>Nexmo</li>
  <li>Spring Data</li>
</ul>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://apereo.github.io/cas/development/">Documentation</a></li>
  <li><a href="https://github.com/apereo/cas/milestones">Release Schedule</a></li>
  <li><a href="https://apereo.github.io/cas/developer/Release-Policy.html">Release Policy</a></li>
</ul>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="credits">Credits</h2>

<p>Big thanks to all who participate in the development of this release to submit patches and contribute improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/11/30/600rc4-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 6.0.0 RC4 release.
                    
                </description>
                <pubDate>Fri, 30 Nov 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Scripting Multifactor Authentication Triggers</title>
                <link>https://apereo.github.io/2018/11/22/cas5-groovy-mfa/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<div class="alert alert-info">
  <strong>Contributed Content</strong><br />Keith Conger of Colorado College, an active member of the CAS community, was kind enough to contribute this guide.
</div>

<p>If you have configured multifactor authentication with CAS with a provider (i.e. <a href="https://apereo.github.io/cas/5.3.x/installation/DuoSecurity-Authentication.html">Duo Security</a>), you may find yourself in need of conditionally triggering MFA based on a variety of factors rather dynamically. Here is a possible scenario:</p>

<ul>
  <li>Allow internal access to a service without forcing MFA via IP range</li>
  <li>Rejecting external access to a service unless in MFA LDAP group</li>
</ul>

<p>CAS provides a large number of strategies to <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-Multifactor-Authentication-Triggers.html">trigger multifactor authentication</a>. To deliver the use case, we can take advantage of a Groovy-based trigger to implement said conditions. The script is invoked by CAS globally (regardless of application, user, MFA provider, etc) whose outcome should determine whether an MFA provider can take control of the subsequent step in the authentication flow.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java <code class="highlighter-rouge">8</code></li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h2 id="configuration">Configuration</h2>

<p>With <a href="https://apereo.github.io/cas/5.3.x/installation/DuoSecurity-Authentication.html">Duo Security</a> configured as our multifactor authentication provider, we can start off with the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.audit.alternateClientAddrHeaderName</span><span class="p">=</span><span class="s">X-Forwarded-For</span>
<span class="py">cas.authn.mfa.groovyScript</span><span class="p">=</span><span class="s">file:/path/to/GroovyScript.groovy</span>
</code></pre></div></div>

<p>Here, we are teaching CAS to use the <code class="highlighter-rouge">X-Forwarded-For</code> header when fetching client IP addresses, and we are also indicating a reference path to our yet-to-be-written Groovy script.</p>

<p>The script itself would have the following structure:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.*</span>
<span class="kn">import</span> <span class="nn">org.apereo.inspektr.common.web.*</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">GroovyMfaScript</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">privateIPPattern</span> <span class="o">=</span> <span class="s2">"(^127\\.0\\.0\\.1)"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">mfaGroupPattern</span> <span class="o">=</span> <span class="s2">"CN=MFA-Enabled"</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">servicePattern</span> <span class="o">=</span> <span class="s2">"https://app.example.org"</span><span class="o">;</span>

    <span class="kt">def</span> <span class="n">String</span> <span class="nf">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">service</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="kt">def</span> <span class="n">registeredService</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
        <span class="kt">def</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
        <span class="kt">def</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">3</span><span class="o">];</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">service</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">servicePattern</span><span class="o">))</span> <span class="o">{</span>
            <span class="kt">def</span> <span class="n">clientInfo</span> <span class="o">=</span> <span class="n">ClientInfoHolder</span><span class="o">.</span><span class="na">getClientInfo</span><span class="o">();</span>
            <span class="kt">def</span> <span class="n">clientIp</span> <span class="o">=</span> <span class="n">clientInfo</span><span class="o">.</span><span class="na">getClientIpAddress</span><span class="o">();</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s2">"Client IP [{}]"</span><span class="o">,</span> <span class="n">clientIp</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">clientIp</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">privateIPPattern</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s2">"Internal IP address"</span><span class="o">);</span>

                <span class="kt">def</span> <span class="n">memberOf</span> <span class="o">=</span> <span class="n">authentication</span><span class="o">.</span><span class="na">principal</span><span class="o">.</span><span class="na">attributes</span><span class="o">[</span><span class="s1">'memberOf'</span><span class="o">]</span>
                <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">group</span> <span class="o">:</span> <span class="n">memberOf</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">group</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">mfaGroupPattern</span><span class="o">))</span> <span class="o">{</span>
                        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s2">"In MFA group"</span><span class="o">);</span>
                        <span class="k">return</span> <span class="s2">"mfa-duo"</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="s2">"mfa-duo"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The above script goes through the following conditions:</p>

<ul>
  <li>The requesting application is <code class="highlighter-rouge">https://app.example.org</code>.</li>
  <li>The incoming client IP address matches the pattern <code class="highlighter-rouge">(^127\\.0\\.0\\.1)</code>.</li>
  <li>The authenticated user carries a <code class="highlighter-rouge">memberOf</code> attribute with a value of <code class="highlighter-rouge">CN=MFA-Enabled</code>.</li>
</ul>

<p>If all of those conditions are true, then MFA is activated…or else ignored. Note that the function of a Groovy trigger is not specific to a multifactor authentication provider. So long as the conditions execute correctly and the provider is configured properly, it can be used to signal any provider back to the authentication flow.</p>

<h2 id="finale">Finale</h2>

<p>Thanks to Keith Conger of Colorado College who was kind enough to share the above integration notes.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/11/22/cas5-groovy-mfa/</guid>
                <description>
                    
                    Learn how Apereo CAS may be configured to trigger multifactor authentication using Groovy conditionally decide whether MFA should be triggered for internal vs. external access, taking into account IP ranges, LDAP groups, etc.
                    
                </description>
                <pubDate>Thu, 22 Nov 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS 6.0.x - Building CAS Feature Modules</title>
                <link>https://apereo.github.io/2018/11/20/cas60x-codebase-feature-build/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<h1 id="overview">Overview</h1>

<p>This quick walkthrough effectively aims for the following objectives:</p>

<ul>
  <li>A quick development environment setup using IntelliJ IDEA.</li>
  <li>Building and running the CAS web application using Gradle.</li>
  <li>Changing feature modules and testing out behavior.</li>
  <li>Testing changes and writing unit tests.</li>
  <li>Stepping into the code using a debugger.</li>
</ul>

<h1 id="development-environment">Development Environment</h1>

<p>Follow the <a href="https://apereo.github.io/cas/developer/Build-Process-6X.html">instructions posted here</a> to obtain the CAS source code. Remember to indicate the relevant <code class="highlighter-rouge">branch</code> in the commands indicated to obtain the right source code for the CAS version at hand. In this tutorial and just like before, the branch to use would be <code class="highlighter-rouge">6.0.x</code> (at the time of writing this post, the appropriate branch is <code class="highlighter-rouge">master</code>).</p>

<p>To understand what branches are available, <a href="https://github.com/apereo/cas/branches">see this link</a>. Your CAS version is closely tied to the branches listed in the codebase. For example, if you are deploying CAS <code class="highlighter-rouge">5.1.8</code>, then the relevant branch to check out would be <code class="highlighter-rouge">5.1.x</code>. Remember that branches always contain the most recent changeset and version of the release line. You might be deploying <code class="highlighter-rouge">5.1.8</code> while the <code class="highlighter-rouge">5.1.x</code> might be marching towards <code class="highlighter-rouge">5.1.10</code>. This requires that you first upgrade to the latest available patch release for the CAS version at hand and if the problem or use case continues to manifest, you can then check out the appropriate source branch and get fancy <sub>[1]</sub>.</p>

<div class="alert alert-info">
<strong>Keep Up</strong><br />It is <b>STRONGLY</b> recommended that you keep up with the patch releases as they come out. Test early and have the environment on hand for when the time comes to dabble into the source. Postponing patch upgrades in the interest of time will eventually depreciate your lifespan.</div>

<p>It is important that to let IntelliJ IDEA open and refresh the Gradle project (using the <em>Refresh</em> button on the Gradle window’s toolbar) once you do the initial import. Running <code class="highlighter-rouge">./gradlew idea</code> <strong>MAY</strong> work but it may also completely mess up the project structure especially if the plugin is not quite compatible with your IDE version. Note that similar tasks are available for eclipse.</p>

<p>For best results, try with IntelliJ IDEA <code class="highlighter-rouge">2018.3</code> (Ultimate Edition). Given the size of the CAS projects and the number of sub-modules, you need to make sure you have enough memory available for IDEA and that your custom JVM settings are correctly set per <a href="https://apereo.github.io/cas/developer/Build-Process-6X.html">the instructions here</a> for IntelliJ IDEA.</p>

<h1 id="system-requirements">System Requirements</h1>

<p>It’s best to get familiar with <a href="https://apereo.github.io/cas/6.0.x/planning/Installation-Requirements.html">CAS system requirements</a>. Most importantly, this means that your system must be prepped with JDK <code class="highlighter-rouge">11</code>. Just about any JDK variant from any JDK vendor would do the job.</p>

<div class="alert alert-danger">
  <strong>Important changes in Oracle JDK 11 License</strong><br />With JDK 11 Oracle has updated the license terms on which Oracle JDK is offered. The new Oracle Technology Network License Agreement for Oracle Java SE is substantially different from the licenses under which previous versions of the JDK were offered. <b>Please review</b> the new terms carefully before downloading and using this product. Oracle also offers this software under the GPL License on jdk.java.net/11.</div>

<p>For basic development and prototyping, try with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-version</span>

java version <span class="s2">"11"</span> 2018-09-25
Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment 18.9 <span class="o">(</span>build 11+28<span class="o">)</span>
Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM 18.9 <span class="o">(</span>build 11+28, mixed mode<span class="o">)</span>
</code></pre></div></div>

<h1 id="running-cas">Running CAS</h1>

<p>The CAS web application itself can be started from the command-prompt using an embedded Apache Tomcat container. In fact, this process is no different from deploying CAS using the same embedded Apache Tomcat container which means you will need to follow the <a href="https://apereo.github.io/cas/developer/Build-Process-6X.html">instructions posted here</a> in the way that certificates and other configurations are needed in <code class="highlighter-rouge">/etc/cas/config</code>, etc to ensure CAS can function as you need it. All feature modules and behavior that would be stuffed into the web application artifact continue to read settings from the same location, as they would be when activated from an overlay. The process is exactly the same.</p>

<p>I use the following alias in my bash profile to spin up CAS using an embedded Apache Tomcat container. You might want to do the same thing:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">bc</span><span class="o">=</span><span class="s1">'clear; cd ~/Workspace/cas/webapp/cas-server-webapp-tomcat; \
    ../../gradlew build bootRun --configure-on-demand --build-cache --parallel \
    -x test -x javadoc -x check -DenableRemoteDebugging=true --stacktrace \
    -DskipNestedConfigMetadataGen=true -DskipGradleLint=true -DskipSass=true \
    -DskipNodeModulesCleanUp=true -DskipNpmCache=true -DskipNpmLint=true'</span>
</code></pre></div></div>

<p>Then, I simply execute the following in the terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> bc
</code></pre></div></div>

<p>Since you’re running <code class="highlighter-rouge">bootRun</code> under the <code class="highlighter-rouge">cas-server-webapp-tomcat</code> module, the servlet container used will be based on Apache Tomcat. You can navigate to a different module that bases itself on top of a different servlet container such as Jetty.</p>

<div class="alert alert-info">
<strong>On Windows</strong><br />You can apply the same strategy on Windows by creating a <code>bc.bat</code> file and making sure it's available on the <code>PATH</code>. The syntax of course needs to be adjusted to account for file paths and commands.</div>

<p>To understand the meaning and function behind various command-line arguments, please see <a href="https://apereo.github.io/cas/developer/Build-Process-6X.html">instructions posted here</a>. You may optionally decide to tweak each setting if you are interested in a particular build variant, such as generating javadocs, running tests, etc. One particular flag of interest is the addition of <code class="highlighter-rouge">enableRemoteDebugging</code>, which allows you, later on, to connect a remote debugger to CAS on a specific port (i.e. <code class="highlighter-rouge">5000</code>) and step into the code. More on that later.</p>

<h1 id="testing-modules">Testing Modules</h1>

<p>Per <a href="https://apereo.github.io/cas/developer/Build-Process-6X.html">instructions posted here</a>, the inclusion of a particular build module in the Gradle build script of the CAS web application should allow the build process to automatically allow the module to be packaged and become available to the runtime. You may include the module reference in the <a href="https://github.com/apereo/cas/blob/6.0.x/gradle/webapp.gradle"><code class="highlighter-rouge">webapp.gradle</code></a> file, which is the common parent to build descriptors that do stuff with CAS web applications. Making changes in this file will ensure that it will be included <em>by default</em> in the generic CAS web application, regardless of how it is configured to run using a servlet container, which means you need to be extra careful about the sort of changes you make here and what is kept and what is checked in for follow-up pull requests and reviews.</p>

<p>So for reference and our task at hand, the file would look like the following:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dependencies</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">implementation</span> <span class="nf">project</span><span class="o">(</span><span class="s2">":support:cas-server-support-some-module"</span><span class="o">)</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note the reference locates the module using its full path. The next time you run <code class="highlighter-rouge">bc</code>, the final CAS web application will have enabled <code class="highlighter-rouge">some-module</code> functionality when it’s booting up inside Apache Tomcat allowing you to make changes to said module and begin testing. The same command, <code class="highlighter-rouge">bc</code>, can be used over and over again to run CAS locally and test the change until the desired functionality is there.</p>

<p>Once done, you may then commit the change to a relevant branch (of your fork, which is something you should have done earlier when you cloned the codebase) and push upstream (again, to your fork) in order to prepare a pull request and send in the change targetted at the right destination branch. More info on that workflow <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">is available here</a>.</p>

<h1 id="debugging-cas">Debugging CAS</h1>

<p>One of the very useful things you can include in your build is the ability to allow for remote debugging via <code class="highlighter-rouge">-DenableRemoteDebugging=true</code>. Both <a href="https://www.jetbrains.com/help/idea/run-debug-configuration-remote-debug.html">IntelliJ IDEA</a> and eclipse allow you ways to connect to a port remotely and activate a debugger in order to step into the code and troubleshoot. This is hugely useful, especially in cases where you can make a change to a source file and <em>rebuild</em> the component live hot-reloading the <code class="highlighter-rouge">.class</code> file to allow the changes to kick in the very next time execution passes through without restarting the servlet container. Depending on how significant the change is, this should save you quite a bit of time.</p>

<p>There are also much fancier tools such as <a href="https://zeroturnaround.com/software/jrebel/">JRebel</a> that let you do the same with a lot more power and flexibility.</p>

<p>The remote debugging port by default is <code class="highlighter-rouge">5000</code> and should be auto-incremented in case the port is busy or occupied by some other process. You should get notices and prompts from the build, if and when that happens.</p>

<p>A very useful flag that you may consider adding to your shell alias is <code class="highlighter-rouge">-DremoteDebuggingSuspend=true</code>, which allows you to suspend the JVM until a debugger tool is attached to the running process. This is handy in situations where you need to debug and troubleshoot a particular component or behavior that executes early during startup (i.e. fetching CAS configuration settings or servlet container bootstrapping) and you don’t want the runtime to proceed too quickly and forcing you to miss the troubleshooting window.</p>

<p>With the inclusion of this new flag, the build outcome sort of looks like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> Task :webapp:cas-server-webapp-tomcat:bootRun
Listening <span class="k">for </span>transport dt_socket at address: 5000
</code></pre></div></div>

<h1 id="overlay">Overlay</h1>

<p>Sometimes, it’s useful to test the new change from the perspective of the <a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a>. While the behavior should be identical, this step can be used in quick smoke tests and to ensure the proper set of dependencies and modules are published and <em>installed</em> correctly and picked up by the overlay build process without any conflicts or duplicates.</p>

<p>To publish and <em>install</em> CAS artifacts locally, you may try the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Build CAS and install...</span>
<span class="nb">alias </span><span class="nv">bci</span><span class="o">=</span><span class="s1">'clear; cd ~/Workspace/cas \
    ./gradlew clean build install --configure-on-demand --build-cache --parallel \
    -x test -x javadoc -x check -DenableRemoteDebugging=true --stacktrace \
    -DskipNestedConfigMetadataGen=true -DskipGradleLint=true -DskipSass=true \
    -DskipNodeModulesCleanUp=true -DskipNpmCache=true \
    -DskipNpmLint=true -DskipBootifulArtifact=true'</span>
</code></pre></div></div>

<p>Be patient. This might take some time.</p>

<p>A rather important flag in the above build is <code class="highlighter-rouge">-DskipBootifulArtifact=true</code>. This stops the Gradle build from applying the Spring Boot plugin to bootify application components, mainly the various CAS web application artifacts. This is required because the <a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a> needs to operate on a <em>vanilla</em> web application untouched by Spring Boot plugins (a.k.a <em>non-bootiful</em>) before it can explode and repackage it with Spring Boot. Note that the CAS build and release processes automatically take this flag into account when snapshots or releases are published and more conveniently, whether you are working on the CAS codebase or overlay, you get to work with the same bootiful web application without any extra hassle.</p>

<p>Once the artifacts are successfully installed, you can pick up the <code class="highlighter-rouge">-SNAPSHOT</code> artifacts in overlay by changing the CAS version and resume testing.</p>

<h1 id="writing-tests">Writing Tests</h1>

<p>Ideally, changes that are introduced need to be tested using either simple unit tests or integration tests.</p>

<h2 id="unit-tests">Unit Tests</h2>

<p>Writing unit tests is rather easy. If you have added a few changes to <code class="highlighter-rouge">src/main/java/org/apereo/cas/SomeCasComponent.java</code>, you will need to create the corresponding test component under <code class="highlighter-rouge">src/test/java/org/apereo/cas/SomeCasComponentTests.java</code> for the build to identify and execute it. The outline of <code class="highlighter-rouge">SomeCasComponentTests</code> would look something like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>

<span class="nd">@SpringBootTest</span><span class="o">(</span><span class="n">classes</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">SomeCasComponentConfiguration</span><span class="o">.</span><span class="na">class</span>
<span class="o">})</span>
<span class="nd">@TestPropertySource</span><span class="o">(</span><span class="n">properties</span> <span class="o">=</span> <span class="o">{</span><span class="s">"cas.some.property=value"</span><span class="o">})</span>
<span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="n">CasConfigurationProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeCasComponentTests</span> <span class="o">{</span>
    <span class="nd">@ClassRule</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">SpringClassRule</span> <span class="n">SPRING_CLASS_RULE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringClassRule</span><span class="o">();</span>

    <span class="nd">@Rule</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="n">ConditionalIgnoreRule</span> <span class="n">conditionalIgnoreRule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConditionalIgnoreRule</span><span class="o">();</span>

    <span class="nd">@Rule</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="n">SpringMethodRule</span> <span class="n">springMethodRule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringMethodRule</span><span class="o">();</span>

    <span class="nd">@Rule</span>
    <span class="kd">public</span> <span class="n">ExpectedException</span> <span class="n">thrown</span> <span class="o">=</span> <span class="n">ExpectedException</span><span class="o">.</span><span class="na">none</span><span class="o">();</span>

    <span class="cm">/*
        Injected via SomeCasComponentConfiguration...
    */</span>
    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"someCasComponent"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">SomeCasComponent</span> <span class="n">someCasComponent</span><span class="o">;</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">verifyStuffHappens</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// Invoke someCasComponent.someMethod() and examine/assert the output</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In short, you need to make sure all the correct <em>Configuration</em> classes are included to bootstrap the build so that the required objects can be injected into the test class at runtime. You may also need to include additional modules and dependencies in the <code class="highlighter-rouge">build.gradle</code> file of the project to make sure the test runner has access to all required classes:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">testImplementation</span> <span class="nf">project</span><span class="o">(</span><span class="s2">":support:cas-server-support-xyz"</span><span class="o">)</span>
    <span class="n">testImplementation</span> <span class="nf">project</span><span class="o">(</span><span class="nl">path:</span> <span class="s2">":support:cas-server-support-xyz"</span><span class="o">,</span> <span class="nl">configuration:</span> <span class="s2">"tests"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>For best examples, scan the codebase to find similar test classes and try to follow the same pattern and structure as others to keep things as consistent as possible.</p>

<h2 id="integration-tests">Integration Tests</h2>

<p>If the change you are working on has a dependency on an external system such as a REST API or SQL database, you will need to make sure the test class is categorized appropriately. For example, let’s assume that <code class="highlighter-rouge">SomeCasComponentTests</code> requires an external Redis NoSQL database which means that your test class should indicate this as such:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Category</span><span class="o">(</span><span class="n">RedisCategory</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ConditionalIgnore</span><span class="o">(</span><span class="n">condition</span> <span class="o">=</span> <span class="n">RunningContinuousIntegrationCondition</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeCasComponentTests</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note that the test execution would always fail if the Redis database isn’t installed, running and configured correctly for everyone else working on the same CAS codebase. To work around this, we have also added a condition for the test runner to only execute the test when the <a href="https://travis-ci.org/apereo/cas/builds">CAS CI environment</a> is handling the test execution. The CI environment, given the appropriate category, will bootstrap and initialize the required dependencies and systems (typically via Docker) for the tests to execute which allows you to run the tests locally with a (Redis) database of your own while allowing the CI process to handle the test execution all the same, automatically and with the needed external dependencies.</p>

<p>Again, for better examples simply scan the codebase to find similar test classes.</p>

<h1 id="running-tests">Running Tests</h1>

<p>Our Gradle test commands need to be slightly modified to only run the tests that need to run based on the category of interest. For example, to run all Redis-related tests our test command would look like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>clear
<span class="nb">cd</span> ~/Workspace/cas
./gradlew clean testRedis <span class="nt">-x</span> <span class="nb">test</span> <span class="nt">-x</span> javadoc <span class="se">\</span>
    <span class="nt">--build-cache</span> <span class="nt">--configure-on-demand</span> <span class="nt">-DtestCategoryType</span><span class="o">=</span>REDIS
    <span class="nt">-x</span> check <span class="nt">--parallel</span> <span class="nt">-DskipNestedConfigMetadataGen</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    <span class="nt">-DskipNestedConfigMetadataGen</span><span class="o">=</span><span class="nb">true</span> <span class="nt">-DskipSass</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    <span class="nt">-DskipNodeModulesCleanUp</span><span class="o">=</span><span class="nb">true</span> <span class="nt">-DskipNpmCache</span><span class="o">=</span><span class="nb">true</span><span class="s1">'
</span></code></pre></div></div>

<p>Or, to run simple unit tests our test command would look like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>clear
<span class="nb">cd</span> ~/Workspace/cas
./gradlew clean <span class="nb">test</span> <span class="nt">-x</span> javadoc <span class="se">\</span>
    <span class="nt">--build-cache</span> <span class="nt">--configure-on-demand</span> <span class="nt">-DtestCategoryType</span><span class="o">=</span>SIMPLE
    <span class="nt">-x</span> check <span class="nt">--parallel</span> <span class="nt">-DskipNestedConfigMetadataGen</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    <span class="nt">-DskipNestedConfigMetadataGen</span><span class="o">=</span><span class="nb">true</span> <span class="nt">-DskipSass</span><span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    <span class="nt">-DskipNodeModulesCleanUp</span><span class="o">=</span><span class="nb">true</span> <span class="nt">-DskipNpmCache</span><span class="o">=</span><span class="nb">true</span><span class="s1">'
</span></code></pre></div></div>

<p>Note the use of the <code class="highlighter-rouge">testCategoryType</code> parameter as well as the actual task that runs the tests (<code class="highlighter-rouge">test</code> vs <code class="highlighter-rouge">testRedis</code>). To learn more about other available categories and how they are executed, please <a href="https://github.com/apereo/cas/tree/6.0.x/ci/tests">take a look here</a>.</p>

<div class="alert alert-info">
<strong>But it works on my machine...</strong><br />Ultimately, all tests need to execute and pass on the CAS CI environment. There are the occasional phantom and unrelated failures which can usually be safely ignored but the canonical reference for tests and verifications is always the CI environment. When you write tests, try not to make assumptions that would later fail when the test is examined by CI.</div>

<h1 id="so">So…</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p>Happy Coding,</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

<p>[1] There are ways to get around this <em>limitation</em>, by specifically downloading the source code for the exact CAS version at hand. I am skipping over those since they only lead to complications, suffering and further evil in most cases.</p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/11/20/cas60x-codebase-feature-build/</guid>
                <description>
                    
                    An overview of how various CAS features modules today can be changed and tested from the perspective of a CAS contributor working on the codebase itself to handle a feature request, bug fix, etc.
                    
                </description>
                <pubDate>Tue, 20 Nov 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 6.0.x Deployment - WAR Overlays</title>
                <link>https://apereo.github.io/2018/11/16/cas60-gettingstarted-overlay/</link>
                <content:encoded>
                    <![CDATA[
                    <p>This is a short and sweet tutorial on how to deploy CAS via <a href="https://apereo.github.io/cas/6.0.x/installation/WAR-Overlay-Installation.html">the WAR Overlay method</a>.</p>

<p>This tutorial specifically requires and focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">6.0.x</code></li>
  <li>Java 11</li>
</ul>

<div class="alert alert-info">
  <strong>Need Help?</strong><br />If you ever get stuck and are in need of additional assistance, start by reviewing the suggestions <a href="https://apereo.github.io/cas/6.0.x/installation/Troubleshooting-Guide.html">provided here</a>. You may also look at available support options <a href="https://apereo.github.io/cas/Support.html">provided here</a>.
</div>

<ul id="markdown-toc">
  <li><a href="#overlaywhat" id="markdown-toc-overlaywhat">Overlay…What?</a></li>
  <li><a href="#overlays-anatomy" id="markdown-toc-overlays-anatomy">Overlay’s Anatomy</a>    <ul>
      <li><a href="#properties" id="markdown-toc-properties">Properties</a></li>
      <li><a href="#dependencies" id="markdown-toc-dependencies">Dependencies</a></li>
    </ul>
  </li>
  <li><a href="#the-build" id="markdown-toc-the-build">The Build</a></li>
  <li><a href="#configuration" id="markdown-toc-configuration">Configuration</a>    <ul>
      <li><a href="#keep-track" id="markdown-toc-keep-track">Keep Track</a></li>
    </ul>
  </li>
  <li><a href="#ldap-authentication" id="markdown-toc-ldap-authentication">LDAP Authentication</a></li>
  <li><a href="#registering-applications" id="markdown-toc-registering-applications">Registering Applications</a>    <ul>
      <li><a href="#configuration-1" id="markdown-toc-configuration-1">Configuration</a></li>
    </ul>
  </li>
  <li><a href="#ticketing" id="markdown-toc-ticketing">Ticketing</a>    <ul>
      <li><a href="#configuration-2" id="markdown-toc-configuration-2">Configuration</a></li>
    </ul>
  </li>
  <li><a href="#multifactor-authentication-via-duo-security" id="markdown-toc-multifactor-authentication-via-duo-security">Multifactor Authentication via Duo Security</a>    <ul>
      <li><a href="#configuration-3" id="markdown-toc-configuration-3">Configuration</a></li>
    </ul>
  </li>
  <li><a href="#monitoring--status" id="markdown-toc-monitoring--status">Monitoring &amp; Status</a>    <ul>
      <li><a href="#configuration-4" id="markdown-toc-configuration-4">Configuration</a></li>
    </ul>
  </li>
  <li><a href="#overlay-customization" id="markdown-toc-overlay-customization">Overlay Customization</a></li>
  <li><a href="#user-interface-customizations" id="markdown-toc-user-interface-customizations">User Interface Customizations</a></li>
  <li><a href="#deploy" id="markdown-toc-deploy">Deploy</a>    <ul>
      <li><a href="#deploy-behind-a-proxy" id="markdown-toc-deploy-behind-a-proxy">Deploy Behind a Proxy</a></li>
    </ul>
  </li>
  <li><a href="#what-about" id="markdown-toc-what-about">What About…?</a></li>
  <li><a href="#so" id="markdown-toc-so">So…</a></li>
</ul>

<h1 id="overlaywhat">Overlay…What?</h1>

<p>Overlays are a strategy to combat repetitive code and/or resources. Rather than downloading the CAS codebase and building it from source, overlays allow you to download a pre-built vanilla CAS web application server provided by the project itself, override/insert specific behavior into it and then merge it all back together to produce the final (web application) artifact. You can find a lot more about how overlays work <a href="https://apereo.github.io/cas/6.0.x/installation/WAR-Overlay-Installation.html">here</a>.</p>

<p>The concept of the WAR Overlay is NOT a CAS invention. It’s specifically an <em>Apache Maven</em> feature and of course, there are techniques and plugins available to apply the same concept to Gradle-based builds as well. For this tutorial, the Gradle overlay we will be working with is <a href="https://github.com/apereo/cas-overlay-template">available here</a>.</p>

<div class="alert alert-info">
  <strong>Gradle WAR Overlay</strong><br />The Maven WAR overlay template is now deprecated and moved aside. The reference overlay project simply resides here and is transformed to use the Gradle build tool instead. This is done to reduce maintenance overhead and simplify the deployment strategy while allowing future attempts to make auto-generation of the overlay as comfortable as possible.
</div>

<p>Once you have forked and cloned the repository locally, you’re ready to begin.</p>

<div class="alert alert-info">
  <strong>Note</strong><br />Remember to switch to the appropriate branch. Today, the <code>master</code> branch of the repository applies to CAS <code>6.0.x</code> deployments. That may not necessarily remain true when you start your own deployment. So examine the branches and make sure you <code>checkout</code> the one matching your intended CAS version.
</div>

<h1 id="overlays-anatomy">Overlay’s Anatomy</h1>

<p>Similar to Grey’s, a <em>Gradle</em> WAR overlay is composed of several facets the most important of which are the <code class="highlighter-rouge">build.gradle</code> and <code class="highlighter-rouge">gradle.properties</code> file. These are build-descriptor files whose job is to teach Gradle how to obtain, build, configure (and in certain cases deploy) CAS artifacts.</p>

<div class="alert alert-info">
  <strong>KISS</strong><br />You do not need to download Gradle separately. The project provides one for you automatically with the embedded Gradle Wrapper.
</div>

<p>The CAS Gradle Overlay is composed of several sections. The ones you need to worry about are the following.</p>

<h2 id="properties">Properties</h2>

<p>In <code class="highlighter-rouge">gradle.properties</code> file, project settings and versions are specified:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.version</span><span class="p">=</span><span class="s">6.0.0</span>
<span class="py">springBootVersion</span><span class="p">=</span><span class="s">2.1.0.RELEASE</span>

<span class="py">appServer</span><span class="p">=</span><span class="s">-tomcat</span>

<span class="py">gradleVersion</span><span class="p">=</span><span class="s">4.10.2</span>
<span class="py">tomcatVersion</span><span class="p">=</span><span class="s">9</span>
<span class="py">tomcatFullVersion</span><span class="p">=</span><span class="s">9.0.12</span>

<span class="py">group</span><span class="p">=</span><span class="s">org.apereo.cas</span>
<span class="py">sourceCompatibility</span><span class="p">=</span><span class="s">11</span>
<span class="py">targetCompatibility</span><span class="p">=</span><span class="s">11</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">gradle.properties</code> file describes what versions of CAS, Spring Boot, and Java are required for the deployment. You are in practice mostly concerned with the <code class="highlighter-rouge">cas.version</code> setting and as new (maintenance) releases come out, it would be sufficient to simply update that version and re-run the build.</p>

<p>This might be a good time to review the CAS project’s <a href="https://apereo.github.io/cas/developer/Release-Policy.html">Release Policy</a> as well as <a href="https://apereo.github.io/cas/developer/Maintenance-Policy.html">Maintenance Policy</a>.</p>

<h2 id="dependencies">Dependencies</h2>

<p>The next piece describes the <em>dependencies</em> of the overlay build. These are the set of components almost always provided by the CAS project that will be packaged up and put into the final web application artifact. At a minimum, you need to have the <code class="highlighter-rouge">cas-server-webapp-${appServer}</code> module available because that is the web application into which you intend to inject your settings and customizations if any. Also, note that the module declarations are typically configured to download the CAS version instructed by the property <code class="highlighter-rouge">cas.version</code>.</p>

<p>Here is an example:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dependencies</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">hasProperty</span><span class="o">(</span><span class="s2">"external"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-webapp:${casServerVersion}"</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-webapp${project.appServer}:${casServerVersion}"</span>
    <span class="o">}</span>
    <span class="c1">// Other dependencies may be listed here...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Including a CAS module/dependency in the <code class="highlighter-rouge">build.gradle</code> simply advertises to CAS <em>your intention</em> of turning on a new feature or a variation of a current behavior. Do NOT include something in your build just because it looks and sounds cool. Remember that the point of an overlay is to only keep track of things you actually need and care about, and no more.</p>

<div class="alert alert-warning">
  <strong>Remember</strong><br />Keep your build clean and tidy. A messy build often leads to a messy deployment, complicates your upgrade path and is a documented cause of early hair loss. Keep changes down to the absolute essentials and document their need for your deployment. If you review the configuration a year from now, you should have an idea of why things are the way they are.
</div>

<h1 id="the-build">The Build</h1>

<p>Now that you have a basic understanding of the build descriptor, it’s time to actually run the build. A Gradle build is often executed by passing specific goals/commands to Gradle itself, aka <code class="highlighter-rouge">gradlew</code>. So for instance in the terminal and once inside the project directory you could execute things like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
gradlew clean
</code></pre></div></div>

<p>The WAR Overlay project provides you with an embedded Gradle <em>wrapper</em> whose job is to first determine whether you have Gradle installed. If not, it will download and configure one for you based on the project’s needs.</p>

<p>So, how are you supposed to know what commands/goals can be passed to the build? You can hit the Gradle guides and docs to study these for sure, but the Overlay project also provides you with a shell script that wraps itself around the Gradle wrapper and provides an easy facade for you to remember commands and their use.</p>

<div class="alert alert-info">
  <strong>Note</strong><br />When in doubt, <code>gradlew tasks</code> is a good starting position to learn what tasks are available in the project.
</div>

<p>This is the <code class="highlighter-rouge">build.sh</code> file, which you can run as such:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
./build.sh <span class="nb">help
</span>Usage: build.sh ...
</code></pre></div></div>

<p>The <code class="highlighter-rouge">help</code> command describes the set of available operations you may carry out with the build script.</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />Docs grow old. Always consult the overlay project's <code>README</code> file to keep to date.
</div>

<p>As an example, here’s what I see if I were to run the <code class="highlighter-rouge">package</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh copy package

Creating configuration directory under /etc/cas
Copying configuration files from etc/cas to /etc/cas/config
etc/cas/config/application.yml -&gt; /etc/cas/config/application.yml
etc/cas/config/cas.properties -&gt; /etc/cas/config/cas.properties
etc/cas/config/log4j2.xml -&gt; /etc/cas/config/log4j2.xml

Starting a Gradle Daemon <span class="o">(</span>subsequent builds will be faster<span class="o">)</span>
Configuration on demand is an incubating feature.

BUILD SUCCESSFUL <span class="k">in </span>14s
2 actionable tasks: 2 executed
...
</code></pre></div></div>

<p>You can see that the build attempts to download, clean, compile and package all artifacts, and finally, it produces a <code class="highlighter-rouge">build/libs/cas.war</code> which you can then use for actual deployments.</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />You are allowed to pass any of Gradle's native command-line arguments to the <code>build.sh</code> file.
</div>

<h1 id="configuration">Configuration</h1>

<p>I am going to skip over the configuration of <code class="highlighter-rouge">/etc/cas/config</code> and all that it deals with. If you need the reference, you may always <a href="https://apereo.github.io/cas/6.0.x/configuration/Configuration-Management.html">use this guide</a> to study various aspects of CAS configuration.</p>

<p>Suffice it to say that, quite simply, CAS deployment expects <em>the main</em> configuration file to be found under <code class="highlighter-rouge">/etc/cas/config/cas.properties</code>. This is a key-value store that is able to dictate and alter the behavior of the running CAS software.</p>

<p>As an example, you might encounter something like:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.server.name</span><span class="p">=</span><span class="s">https://cas.example.org:8443</span>
<span class="py">cas.server.prefix</span><span class="p">=</span><span class="s">https://cas.example.org:8443/cas</span>
<span class="py">logging.config</span><span class="p">=</span><span class="s">file:/etc/cas/config/log4j2.xml</span>
</code></pre></div></div>

<p>…which at a minimum, identifies the CAS server’s URL and prefix and instructs the running server to locate the logging configuration at <code class="highlighter-rouge">file:/etc/cas/config/log4j2.xml</code>. The overlay by default ships with a <code class="highlighter-rouge">log4j2.xml</code> that you can use to customize logging locations, levels, etc. Note that the presence of all that is contained inside <code class="highlighter-rouge">/etc/cas/config/</code> is optional. CAS will continue to fall back onto defaults if the directory and the files within are not found.</p>

<h2 id="keep-track">Keep Track</h2>

<p>It is <strong>VERY IMPORTANT</strong> that you contain and commit the entire overlay directory (save the obvious exclusions such as the <code class="highlighter-rouge">build</code> directory) into some sort of source control system, such as <code class="highlighter-rouge">git</code>. Treat your deployment just like any other project with tags, releases, and functional baselines.</p>

<h1 id="ldap-authentication">LDAP Authentication</h1>

<p>We need to first establish a primary mode of validating credentials by sticking with <a href="https://apereo.github.io/cas/6.0.x/installation/LDAP-Authentication.html">LDAP authentication</a>. The strategy here, as indicated by the CAS documentation, is to declare the intention/module in the build script:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-support-ldap:${casServerVersion}"</span>
</code></pre></div></div>

<p>…and then configure the relevant <code class="highlighter-rouge">cas.authn.ldap[x]</code> settings for the directory server in use. Most commonly, that would translate into the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.ldap[0]</span><span class="py">.type</span><span class="p">=</span><span class="s">AUTHENTICATED</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.ldapUrl</span><span class="p">=</span><span class="s">ldaps://ldap1.example.org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.baseDn</span><span class="p">=</span><span class="s">dc=example,dc=org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.searchFilter</span><span class="p">=</span><span class="s">cn={user}</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindDn</span><span class="p">=</span><span class="s">cn=Directory Manager,dc=example,dc=org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindCredential</span><span class="p">=</span><span class="s">...</span>
</code></pre></div></div>

<p>To resolve and fetch the needed attributes which will be used later by CAS for release, the simplest way would be to let LDAP authentication retrieve the attributes directly from the directory server.  The following setting allows us to do just that:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.ldap[0]</span><span class="py">.principalAttributeList</span><span class="p">=</span><span class="s">memberOf,cn,givenName,mail</span>
</code></pre></div></div>

<h1 id="registering-applications">Registering Applications</h1>

<p>Client applications that wish to use the CAS server for authentication must be registered with the server apriori. CAS provides a number of <a href="https://apereo.github.io/cas/6.0.x/services/Service-Management.html#storage">facilities to keep track of the registration records</a> and you may choose any that fits your needs best. In more technical terms, CAS deals with service management using two specific components: Individual implementations that support a form of a database are referred to as <em>Service Registry</em> components and they are many. There is also a parent component that sits on top of the configured service registry as more of an orchestrator that provides a generic facade and entry point for the rest of CAS without entangling all other operations and subsystems with the specifics and particulars of a storage technology.</p>

<p>In this tutorial, we are going to try to configure CAS with <a href="https://apereo.github.io/cas/6.0.x/services/JSON-Service-Management.html">the JSON service registry</a>.</p>

<h2 id="configuration-1">Configuration</h2>

<p>First, ensure you have declared the appropriate module/intention in the build:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-support-json-service-registry:${casServerVersion}"</span>
</code></pre></div></div>

<p>Next, you must teach CAS how to look up JSON files to read and write registration records. This is done in the <code class="highlighter-rouge">cas.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.serviceRegistry.initFromJson</span><span class="p">=</span><span class="s">false</span>
<span class="py">cas.serviceRegistry.json.location</span><span class="p">=</span><span class="s">file:/etc/cas/services</span>
</code></pre></div></div>

<p>…where a sample <code class="highlighter-rouge">ApplicationName-1001.json</code> would then be placed inside <code class="highlighter-rouge">/etc/cas/services</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ApplicationName"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h1 id="ticketing">Ticketing</h1>

<p>A robust CAS deployment requires the presence and configuration of an <em>internal</em> database that is responsible for <a href="https://apereo.github.io/cas/6.0.x/ticketing/Configuring-Ticketing-Components.html">keeping track of tickets</a> issued by CAS. CAS itself comes by default with a memory-based node-specific cache that is often more than sufficient for smaller deployments or certain variations of a <a href="https://apereo.github.io/cas/6.0.x/planning/High-Availability-Guide.html">clustered deployment</a>. Just like the service management facility, large variety of databases and storage options are supposed by CAS under the facade of a <em>Ticket Registry</em>.</p>

<p>In this tutorial, we are going to configure CAS to use a <a href="https://apereo.github.io/cas/6.0.x/ticketing/Hazelcast-Ticket-Registry.html">Hazelcast Ticket Registry</a> with the assumption that our deployment is going to be deployed in an AWS-sponsored environment. Hazelcast Ticket Registry is often a decent choice when deploying CAS in a cluster and can take advantage of AWS’s native support for Hazelcast in order to read node metadata properly and locate other CAS nodes in the same cluster in order to present a common, global and shared ticket registry. This is an ideal choice that requires very little manual work and/or troubleshooting, comparing to using options such as Multicast or manually noting down the address and location of each CAS server in the cluster.</p>

<h2 id="configuration-2">Configuration</h2>

<p>First, ensure you have declared the appropriate module/intention in the build:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-support-hazlcast-ticket-registry:${casServerVersion}"</span>
</code></pre></div></div>

<p>Next, the AWS-specific configuration of Hazelcast would go into our <code class="highlighter-rouge">cas.properties</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.ticket.registry.hazelcast.cluster.discovery.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.accessKey</span><span class="p">=</span><span class="s">...</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.secretKey</span><span class="p">=</span><span class="s">...</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.region</span><span class="p">=</span><span class="s">us-east-1</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.securityGroupName</span><span class="p">=</span><span class="s">...</span>
<span class="c"># cas.ticket.registry.hazelcast.cluster.discovery.aws.tagKey=
# cas.ticket.registry.hazelcast.cluster.discovery.aws.tagValue=
</span></code></pre></div></div>

<p>That should do it.</p>

<p>Of course, if you are working on a more modest CAS deployment in an environment that is more or less owned by you and you prefer more explicit control over CAS node registrations in your cluster, the following settings would be more ideal:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.ticket.registry.hazelcast.cluster.instanceName=localhost
# cas.ticket.registry.hazelcast.cluster.port=5701
# cas.ticket.registry.hazelcast.cluster.portAutoIncrement=true
</span><span class="py">cas.ticket.registry.hazelcast.cluster.members</span><span class="p">=</span><span class="s">123.321.123.321,223.621.123.521,...</span>
</code></pre></div></div>

<h1 id="multifactor-authentication-via-duo-security">Multifactor Authentication via Duo Security</h1>

<p>As a rather common use case, the majority of CAS deployments that intend to turn on multifactor authentication support tend to do so via <a href="https://apereo.github.io/cas/6.0.x/installation/DuoSecurity-Authentication.html">Duo Security</a>. We will be going through the same exercise here where we let CAS trigger Duo Security for users who belong to the <code class="highlighter-rouge">mfa-eligible</code> group, indicated by the <code class="highlighter-rouge">memberOf</code> attribute on the LDAP user account.</p>

<h2 id="configuration-3">Configuration</h2>

<p>First, ensure you have declared the appropriate module/intention in the build:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-support-duo:${casServerVersion}"</span>
</code></pre></div></div>

<p>Then, put specific Duo Security settings in `cas.properties. Things such as the secret key, integration key, etc which should be provided by your Duo Security subscription:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.mfa.duo[0]</span><span class="py">.duoSecretKey</span><span class="p">=</span>
<span class="err">cas.authn.mfa.duo[0]</span><span class="py">.duoApplicationKey</span><span class="p">=</span>
<span class="err">cas.authn.mfa.duo[0]</span><span class="py">.duoIntegrationKey</span><span class="p">=</span>
<span class="err">cas.authn.mfa.duo[0]</span><span class="py">.duoApiHost</span><span class="p">=</span>
</code></pre></div></div>

<p>At this point, we have enabled Duo Security and we just need to find a way to instruct CAS to route the authentication flow over to Duo Security in the appropriate condition. Our task here is to build a special condition that activates multifactor authentication if any of the values assigned to the attribute <code class="highlighter-rouge">memberOf</code> contain the value <code class="highlighter-rouge">mfa-eligible</code>. This condition is placed in the <code class="highlighter-rouge">cas.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.mfa.globalPrincipalAttributeNameTriggers</span><span class="p">=</span><span class="s">memberOf</span>
<span class="py">cas.authn.mfa.globalPrincipalAttributeValueRegex</span><span class="p">=</span><span class="s">mfa-eligible</span>
</code></pre></div></div>

<p>If the above condition holds true and CAS is to route to a multifactor authentication flow, that would obviously be one supported and provided by Duo Security since that’s the only provider that is currently configured to CAS.</p>

<h1 id="monitoring--status">Monitoring &amp; Status</h1>

<p>Many CAS deployments rely on the <code class="highlighter-rouge">/status</code> endpoint for monitoring the health and activity of the CAS deployment. This endpoint is typically secured via an IP address, allowing external monitoring tools and load balancers to reach the endpoint and parse the output. In this quick exercise, we are going to accomplish that task, allowing the <code class="highlighter-rouge">status</code> endpoint to be available over HTTP to <code class="highlighter-rouge">localhost</code>.</p>

<h2 id="configuration-4">Configuration</h2>

<p>To enable and expose the <code class="highlighter-rouge">status</code> endpoint, the following settings should come in handy:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">management.endpoints.web.base-path</span><span class="p">=</span><span class="s">/actuator</span>
<span class="py">management.endpoints.web.exposure.include</span><span class="p">=</span><span class="s">status</span>
<span class="py">management.endpoint.status.enabled</span><span class="p">=</span><span class="s">true</span>

<span class="py">cas.monitor.endpoints.endpoint.status.access</span><span class="p">=</span><span class="s">IP_ADDRESS</span>
<span class="py">cas.monitor.endpoints.endpoint.status.requiredIpAddresses</span><span class="p">=</span><span class="s">127.0.0.1</span>
</code></pre></div></div>

<p>Remember that the default path for endpoints exposed over the web is at <code class="highlighter-rouge">/actuator</code>, such as <code class="highlighter-rouge">/actuator/status</code>.</p>

<h1 id="overlay-customization">Overlay Customization</h1>

<p>The <code class="highlighter-rouge">build/libs</code> directory contains the results of the overlay process. Since I have not actually customized and overlaid anything yet, all configuration files simply match their default and are packaged as such. As an example, let’s grab <a href="https://apereo.github.io/cas/6.0.x/ux/User-Interface-Customization-Localization.html">the default message bundle</a> and change the text associated with <code class="highlighter-rouge">screen.welcome.instructions</code>.</p>

<div class="alert alert-warning">
  <strong>Remember</strong><br />Do NOT ever make changes in the <code>build</code> directory. The changesets will be cleaned out and set back to defaults every time you do a build. Follow the overlay process to avoid surprises.
</div>

<p>First, I will need to move the file to my project directory so that during the overlay process Gradle can use that instead of what is provided by default.</p>

<p>Here we go:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh getresource messages.properties

Exploded the CAS web application file at build/cas
Searching <span class="k">for </span>resource name messages.properties...
Found resource<span class="o">(</span>s<span class="o">)</span>:
build/cas/WEB-INF/classes/messages.properties
Created resource at src/main/resources/messages.properties
src/main/resources/messages.properties
</code></pre></div></div>

<p>Then I’ll leave everything in that file alone, except the line I want to change.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="py">screen.welcome.instructions</span><span class="p">=</span><span class="s">Speak friend and enter.</span>
<span class="err">...</span>
</code></pre></div></div>

<p>Then I’ll package things up as usual.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh package
</code></pre></div></div>

<p>If I <code class="highlighter-rouge">explode</code> the built web application again and look at <code class="highlighter-rouge">build/cas/WEB-INF/classes/messages.properties</code> after the build, I should see that the overlay process has picked and overlaid onto the default <em>my version</em> of the file.</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />Only overlay and modify files you actually need and try to use externalized resources and configuration as much as possible. Just because you CAN override something in the default package, it doesn't mean that you should.
</div>

<h1 id="user-interface-customizations">User Interface Customizations</h1>

<p>In order to modify the CAS HTML views, each file first needs to be brought over into the overlay. You can use the <code class="highlighter-rouge">build.sh listviews</code> command to see what HTML views are available for customizations. Once chosen, simply use <code class="highlighter-rouge">build.sh getview footer.html</code> to bring the view into your overlay.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Exploded the CAS web application file at build/cas
Searching <span class="k">for </span>view name footer.html...
Found view<span class="o">(</span>s<span class="o">)</span>:
build/cas/WEB-INF/classes/templates/fragments/footer.html
Created view at src/main/resources/templates/fragments/footer.html
src/main/resources/templates/fragments/footer.htm
</code></pre></div></div>

<p>Now that you have the <code class="highlighter-rouge">footer.html</code> brought into the overlay, you can simply modify the file at <code class="highlighter-rouge">src/main/resources/templates/fragments/footer.html</code>, and then repackage and run the build as usual.</p>

<h1 id="deploy">Deploy</h1>

<p>You have a number of options when it comes to deploying the final <code class="highlighter-rouge">cas.war</code> file. The easiest approach would be to simply use the <code class="highlighter-rouge">build.sh run</code> command and have the overlay be deployed inside an embedded container. By default, the CAS web application expects to run on the secure port <code class="highlighter-rouge">8443</code> which requires that you create a keystore file at <code class="highlighter-rouge">/etc/cas/</code> named <code class="highlighter-rouge">thekeystore</code>.</p>

<h2 id="deploy-behind-a-proxy">Deploy Behind a Proxy</h2>

<p>Using the embedded Apache Tomcat container provided by CAS automatically is the recommended approach in almost all cases (The embedded bit; not the Apache Tomcat bit) as the container configuration is entirely automated by CAS and its version is guaranteed to be compatible with the running CAS deployment. Furthermore, updates and maintenance of the servlet container are handled at the CAS project level where you as the adopter are only tasked with making sure your deployment is running the latest available release to take advantage of such updates.</p>

<p>If you wish to run CAS via the embedded Apache Tomcat container behind a proxy or load balancer and have that entity terminate SSL, you will need to open up a communication channel between the proxy and CAS such that (as an example):</p>

<ul>
  <li>Apache Tomcat runs on port 8080, assuming that’s what the proxy uses to talk to CAS.</li>
  <li>Apache Tomcat has SSL turned off.</li>
  <li>Apache Tomcat connector listening on the above port is marked as secure.</li>
</ul>

<p>The above tasklist translates to the following properties expected to be found in your <code class="highlighter-rouge">cas.properties</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">server.port</span><span class="p">=</span><span class="s">8080</span>
<span class="py">server.ssl.enabled</span><span class="p">=</span><span class="s">false</span>
<span class="py">cas.server.tomcat.http.enabled</span><span class="p">=</span><span class="s">false</span>
<span class="py">cas.server.tomcat.httpProxy.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.server.tomcat.httpProxy.secure</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.server.tomcat.httpProxy.scheme</span><span class="p">=</span><span class="s">https</span>
</code></pre></div></div>

<h1 id="what-about">What About…?</h1>

<p>For more content, <a href="https://apereo.github.io/tags/#CAS">please see this link</a>.</p>

<h1 id="so">So…</h1>

<p>It’s important that you start off simple and make changes one step at a time. Once you have a functional environment, you can gradually and slowly add customizations to move files around.</p>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/11/16/cas60-gettingstarted-overlay/</guid>
                <description>
                    
                    Learn how to configure and build your own CAS deployment via the WAR overlay method, get rich quickly, stay healthy indefinitely and respect family and friends in a few very easy steps.
                    
                </description>
                <pubDate>Fri, 16 Nov 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Jib at CAS Docker Images</title>
                <link>https://apereo.github.io/2018/11/09/cas6-docker-jib/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>Unless you’ve been living under a rock, you’ve probably heard about <a href="https://www.docker.com/">Docker</a>. By combining its container engine technology and container platform, Docker enables you to bring traditional and cloud-native applications into an automated and secure supply chain, advancing dev to ops collaboration and reducing time to value.</p>

<p>CAS <a href="https://github.com/apereo/cas-webapp-docker">embraced Docker</a> a while ago by providing a sample <code class="highlighter-rouge">Dockerfile</code> template to kickstart the builds. This template simply wraps the necessary environment and components, such as OS and Java, around an existing WAR Overlay project. There is a fair amount of smarts and creativity that could go into the build to optimize build layers, take advantage of Docker <em>multi-stage builds</em> and more to produce an ideal CAS image for deployment.</p>

<p>This tutorial focuses on an alternative approach to building CAS docker images by using <a href="https://github.com/GoogleContainerTools/jib">Jib</a>. Jib is an open-source Java containerizer from Google that lets Java developers build containers using the tools they know. It is a container image builder that handles all the steps of packaging your application into a container image. It does not require you to write a Dockerfile or have Docker installed, and it is directly integrated into Maven and Gradle.</p>

<p>Starting with CAS <code class="highlighter-rouge">6</code>, The existing Gradle overlay embraces the <a href="https://github.com/GoogleContainerTools/jib/tree/master/jib-gradle-plugin#quickstart">Jib Gradle Plugin</a> to provide easy-to-use out-of-the-box tooling for building CAS docker images. Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">6.0.0-RC4</code></li>
  <li>Java 11</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a> (The <code class="highlighter-rouge">master</code> branch specifically)</li>
  <li><a href="https://www.docker.com/get-started">Docker</a></li>
</ul>

<h2 id="overview">Overview</h2>

<p>Once you have cloned the CAS WAR overlay, a rather simplified workflow for building a CAS Docker image using <code class="highlighter-rouge">jib</code> is as follows:</p>

<ol>
  <li>Create a valid keystore at <code class="highlighter-rouge">${overlay-path}/etc/cas/thekeystore</code></li>
  <li>Massage your CAS configuration for settings and logging at <code class="highlighter-rouge">${overlay-path}/etc/cas/config</code></li>
  <li>Build the CAS overlay to produce and run the docker image.</li>
</ol>

<p>Assuming you have completed the first two steps, let’s move on to the build step.</p>

<h2 id="docker-image">Docker Image</h2>

<p>If you execute the build shell script, you should be greeted with a new <code class="highlighter-rouge">docker</code> command as such:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh <span class="nb">help

</span>Apereo CAS
Enterprise Single SignOn <span class="k">for </span>all earthlings and beyond
<span class="k">*****************************************************</span>
Usage: build.sh <span class="o">[</span>...]
    ...
    docker: Build a Docker image based on the current build and configuration
    ...
</code></pre></div></div>

<p>Seems like the one we might need. Let’s run it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh docker

...
Configuration on demand is an incubating feature.
warning: Setting image creation <span class="nb">time </span>to current <span class="nb">time</span><span class="p">;</span> your image may not be reproducible.

Containerizing application to Docker daemon as org.apereo.cas/cas...
Getting base image adoptopenjdk/openjdk11:jdk11-alpine-nightly-slim...
Building dependencies layer...
Building snapshot dependencies layer...
Building resources layer...
Building classes layer...
The base image requires auth. Trying again <span class="k">for </span>adoptopenjdk/openjdk11:jdk11-alpine-nightly-slim...
Finalizing...

Container entrypoint <span class="nb">set </span>to <span class="o">[</span>docker/entrypoint.sh]
Loading to Docker daemon...

Built image to Docker daemon as org.apereo.cas/cas
</code></pre></div></div>

<p>What’s happening here is that the Gradle build is invoking the <code class="highlighter-rouge">jib</code> plugin to fetch a base image, and then build all other required layers on top of it. Our CAS settings and logging configuration, etc as well as the <code class="highlighter-rouge">cas.war</code> are moved into the image to subsequently be handled via the startup shell script, which is the point where we instruct the build and Docker to use an <em>entrypoint</em> allowing our image to turn into a running container.</p>

<p>If you query for available Docker images, you might see:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker images
...
org.apereo.cas/cas latest 34a3d3502970 4 minutes ago 551MB
...
</code></pre></div></div>

<p>…which may then conveniently be executed via the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--name</span> cas <span class="nt">-p</span> 8443:8443 <span class="nt">-d</span> org.apereo.cas/cas
docker logs <span class="nt">-f</span> cas
</code></pre></div></div>

<p>That is all it takes.</p>

<h2 id="aftermath">Aftermath</h2>

<p>It is evidently very convenient to use the same CAS build to generate a Docker image without dabbling too much into the specifics and nuances of a <code class="highlighter-rouge">Dockerfile</code> syntax. There are also few configuration options available in the Gradle build that allow one to decide the base image, expose ports and assign tags and labels. More interestingly and while the CAS build tries to keep things simple, <code class="highlighter-rouge">jib</code> really makes pushing images to remote registries easy by supporting the likes of Docker Hub, Google Container Registry and Amazon Elastic Container Registry all in on spot using a familiar consistent syntax.</p>

<p>In doing so, it should be noted that the <code class="highlighter-rouge">jib</code> plugin and project is relatively new with the initial project announcement dating back to July 2018. Furthermore, support for Spring Boot projects and especially those that build WARs and double-specifically those that depend and work with WAR Overlays such as CAS is extremely brand new. It is completely plausible that future iterations of the plugin allow tighter integrations with the Docker engine to produce better-optimized images, expose more configuration knobs and keep improving WAR support. If the current behavior and capabilities of this plugin do not meet the requirements, you’re welcome to continue using the native <code class="highlighter-rouge">Dockerfile</code> approach and keep an eye towards newer versions of the plugin.</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/11/09/cas6-docker-jib/</guid>
                <description>
                    
                    Learn how you may use Jib, an open-source Java containerizer from Google, and its Gradle plugin to build CAS docker images seamlessly without stepping too deep into scripting Dockerfile commands.
                    
                </description>
                <pubDate>Fri, 09 Nov 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS 6 - Administrative Endpoints &amp; Monitoring</title>
                <link>https://apereo.github.io/2018/11/06/cas6-admin-endpoints-security/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>CAS, being a Spring-Boot application at heart, includes a number of endpoints to help you monitor and manage the server when it’s pushed to production. You can choose to manage and monitor the deployment using HTTP endpoints, referred to as <em>actuators</em>. This tutorial provides a basic overview of the endpoints provided by both Spring Boot and CAS and also provides instructions on how such endpoints can be secured for access and win.</p>

<p>This tutorial specifically requires and focuses on:</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">6.0.0-RC4</code></li>
  <li>Java 11</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a> (The <code class="highlighter-rouge">master</code> branch specifically)</li>
  <li><a href="https://stedolan.github.io/jq/">CLI JSON Processor <code class="highlighter-rouge">jq</code></a></li>
</ul>

<h1 id="actuawhat">Actua…What?</h1>

<p>In essence, actuator endpoints bring production-ready features to CAS. Monitoring a running CAS instance, gathering metrics, understanding traffic or the state of our database becomes trivial with such endpoints. The main benefit of these endpoints is that we can get production grade tools without having to actually implement these features ourselves. Actuators are mainly used to expose operational information about the running application – health, metrics, info, dump, env, etc. These are HTTP endpoints or JMX beans to enable us to interact with it.</p>

<div class="alert alert-info">
<strong>Definition</strong><br />An actuator is a manufacturing term, referring to a mechanical device for moving or controlling something. Actuators can generate a large amount of motion from a small change.</div>

<p>The full list of endpoints provided to your CAS deployment <a href="https://apereo.github.io/cas/development/monitoring/Monitoring-Statistics.html">is posted here</a>. Note that you do not need to do anything extra special to get these endpoints added to your deployment; these are all available by default and just need to be turned on and secured for access.</p>

<h1 id="endpoints">Endpoints</h1>

<p>Starting with Spring Boot <code class="highlighter-rouge">2</code> and CAS <code class="highlighter-rouge">6.0.x</code>, the actuator endpoints and their method of security are entirely revamped. Here are the main differences:</p>

<ul>
  <li>Endpoints can individually be exposed over the web under HTTP.</li>
  <li>Security of each endpoint using the combo of <code class="highlighter-rouge">enabled</code> and <code class="highlighter-rouge">sensitive</code> is now gone, and each endpoint entirely embraces Spring Security for protection.</li>
  <li>Endpoints internally are marked as <code class="highlighter-rouge">@Endpoint</code> and can be standalone or extensions of existing endpoints such as <code class="highlighter-rouge">/health</code>.</li>
  <li>Enabling an endpoint may pass through several layers of security: Default setting if undefined, globally or per endpoint.</li>
</ul>

<h2 id="examples">Examples</h2>

<p>Let’s go through a number of scenarios that might be helpful. Bear in mind that in order to work with an endpoint, you must go through the following steps:</p>

<ul>
  <li>The endpoint must be enabled.</li>
  <li>The endpoint may be somehow exposed.</li>
  <li>The endpoint may be somehow secured.</li>
</ul>

<p>Remember that the default path for endpoints exposed over the web is at <code class="highlighter-rouge">/actuator</code>, such as <code class="highlighter-rouge">/actuator/status</code>.</p>

<h3 id="example-1">Example 1</h3>

<p>Expose the CAS <code class="highlighter-rouge">status</code> endpoint over the web, enable it and make sure its protected via basic authentication:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">management.endpoints.web.exposure.include</span><span class="p">=</span><span class="s">status</span>
<span class="py">management.endpoint.status.enabled</span><span class="p">=</span><span class="s">true</span>

<span class="py">cas.monitor.endpoints.endpoint.status.access</span><span class="p">=</span><span class="s">AUTHENTICATED</span>

<span class="py">spring.security.user.name</span><span class="p">=</span><span class="s">casuser</span>
<span class="py">spring.security.user.password</span><span class="p">=</span><span class="s">Mellon</span>
</code></pre></div></div>

<h3 id="example-2">Example 2</h3>

<p>Expose the CAS <code class="highlighter-rouge">status</code> endpoint over the web, enable it and make sure a list of IP addresses can reach it:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">management.endpoints.web.exposure.include</span><span class="p">=</span><span class="s">status</span>
<span class="py">management.endpoint.status.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.monitor.endpoints.endpoint.status.access</span><span class="p">=</span><span class="s">IP_ADDRESS</span>
<span class="py">cas.monitor.endpoints.endpoint.status.requiredIpAddresses</span><span class="p">=</span><span class="s">1.2.3.4,0.0.0.0</span>
</code></pre></div></div>

<h3 id="example-3">Example 3</h3>

<p>Expose the Spring Boot <code class="highlighter-rouge">health</code> and <code class="highlighter-rouge">info</code> endpoints over the web, enable them and make sure access to <code class="highlighter-rouge">health</code> is secured via basic authentication:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">management.endpoints.web.exposure.include</span><span class="p">=</span><span class="s">health,info</span>

<span class="py">management.endpoint.health.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">management.endpoint.health.show-details</span><span class="p">=</span><span class="s">always</span>

<span class="py">management.endpoint.info.enabled</span><span class="p">=</span><span class="s">true</span>

<span class="py">cas.monitor.endpoints.endpoint.health.access</span><span class="p">=</span><span class="s">AUTHENTICATED</span>
<span class="py">cas.monitor.endpoints.endpoint.info.access</span><span class="p">=</span><span class="s">ANONYMOUS</span>

<span class="py">spring.security.user.name</span><span class="p">=</span><span class="s">casuser</span>
<span class="py">spring.security.user.password</span><span class="p">=</span><span class="s">Mellon</span>
</code></pre></div></div>

<h3 id="example-4">Example 4</h3>

<p>Enable and expose all endpoints with no regard for security:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">management.endpoints.web.exposure.include</span><span class="p">=</span><span class="s">*</span>
<span class="py">management.endpoints.enabled-by-default</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.monitor.endpoints.endpoint.defaults.access</span><span class="p">=</span><span class="s">ANONYMOUS</span>
</code></pre></div></div>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />The above collection of settings <strong>MUST</strong> only be used for demo purposes and serve as an <strong>EXAMPLE</strong>. It is not wise to enable and expose all actuator endpoints to the web and certainly, the security of the exposed endpoints should be taken into account very seriously. None of the CAS or Spring Boot actuator endpoints are enabled by default. For production, you should carefully choose which endpoints to expose.
</div>

<h3 id="example-5">Example 5</h3>

<p>In addition to the usual, let’s remap the path to endpoints to start with <code class="highlighter-rouge">endpoints</code> instead
of <code class="highlighter-rouge">actuator</code>, and lets rename the <code class="highlighter-rouge">status</code> endpoint to be <code class="highlighter-rouge">heartbeat</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">management.endpoints.web.path-mapping.status</span><span class="p">=</span><span class="s">heartbeat</span>
<span class="py">management.endpoints.web.base-path</span><span class="p">=</span><span class="s">/endpoints</span>
<span class="py">management.endpoints.web.exposure.include</span><span class="p">=</span><span class="s">status</span>
<span class="py">management.endpoint.status.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.monitor.endpoints.endpoint.status.access</span><span class="p">=</span><span class="s">IP_ADDRESS</span>
<span class="py">cas.monitor.endpoints.endpoint.status.requiredIpAddresses</span><span class="p">=</span><span class="s">1.2.3.4</span>
</code></pre></div></div>

<h2 id="dashboard">Dashboard</h2>

<p>Note that all GUIs related to CAS endpoints are removed and will be slightly transitioned over to the <a href="https://apereo.github.io/cas/development/services/Installing-ServicesMgmt-Webapp.html">CAS Management Web Application</a>. However, while the screens may be gone the underlying functionality remains all the same. For example, provided the endpoint is correctly enabled and secured you can invoke the <code class="highlighter-rouge">statistics</code> endpoint to get the required data:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> https://sso.example.org/cas/actuator/statistics | jq
</code></pre></div></div>

<p>…where you’d see something like this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"upTime"</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w">
  </span><span class="s2">"totalMemory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1 GB"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"expiredTgts"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"expiredSts"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"maxMemory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4 GB"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"freeMemory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"615 MB"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"unexpiredTgts"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"unexpiredSts"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Over time, this data should become accessible via the management application. Remember that for endpoints which are native to and provided by Spring Boot, you may always try the <a href="https://apereo.github.io/2018/10/22/cas6-springboot-admin-server/">Spring Boot Admin Server</a>.</p>

<h1 id="so">So…</h1>

<p>It’s important that you start off simple and make changes one step at a time. Once you have a functional environment, you can gradually and slowly add customizations to move files around.</p>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/11/06/cas6-admin-endpoints-security/</guid>
                <description>
                    
                    Gain insight into your running Apereo CAS 6 deployment in production. Learn how to monitor and manage the server by using HTTP endpoints and gather metrics to diagnose issues and improve performance.
                    
                </description>
                <pubDate>Tue, 06 Nov 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - SAML2 Metadata with MongoDb</title>
                <link>https://apereo.github.io/2018/11/03/cas6-saml2-metadata-mongodb/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p><a href="https://www.mongodb.com">MongoDB</a> is a free and open-source cross-platform document-oriented database program. Classified as a NoSQL database program, MongoDB uses JSON-like documents with schemata and is supported in CAS in many different ways. In this walkthrough, we are going to take a pass at getting <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-DynamicMetadata.html#mongodb">CAS connected to MongoDB</a> to store SAML2 identity provider <em>and</em> service provider metadata documents.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">6.0.0-RC4</code></li>
  <li>Java 11</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a> (The <code class="highlighter-rouge">master</code> branch specifically)</li>
  <li><a href="https://www.docker.com/get-started">Docker</a></li>
</ul>

<h2 id="mongodb">MongoDB</h2>

<p>To run MongoDB for development and testing, we can use the provided Docker image:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 27017:27017 <span class="nt">-e</span> <span class="nv">MONGO_INITDB_ROOT_USERNAME</span><span class="o">=</span>root <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">MONGO_INITDB_ROOT_PASSWORD</span><span class="o">=</span>secret <span class="nt">--name</span><span class="o">=</span><span class="s2">"mongodb-server"</span> mongo:4.0-xenial
docker ps
</code></pre></div></div>

<p>This runs a MongoDB database server which is useful for development but <strong>SHOULD NOT</strong> be used in production.</p>

<p>To access the MongoDB instance using a UI, run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--link</span> mongodb-server <span class="nt">-d</span> <span class="nt">-p</span> 8081:8081 <span class="se">\</span>
  <span class="nt">-e</span> <span class="s1">'ME_CONFIG_MONGODB_ADMINUSERNAME=root'</span> <span class="se">\</span>
  <span class="nt">-e</span> <span class="s1">'ME_CONFIG_MONGODB_ADMINPASSWORD=secret'</span> <span class="se">\</span>
  <span class="nt">-e</span> <span class="s1">'ME_CONFIG_MONGODB_SERVER=mongodb-server'</span> mongo-express
</code></pre></div></div>

<p>The <code class="highlighter-rouge">ME_CONFIG_MONGODB_SERVER</code> is the address of the docker container that runs the MongoDB server. By default, Docker containers use the container as the DNS host name. So we can just specify the <code class="highlighter-rouge">mongodb-server</code> the name of the container that runs our MongoDB instance.</p>

<p>Shell into the container:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CID</span><span class="o">=</span>docker ps <span class="nt">-aqf</span> <span class="nv">name</span><span class="o">=</span>mongodb-server
docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$CID</span> /bin/bash
</code></pre></div></div>

<p>When inside the container:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mongo <span class="nt">--host</span> mongodb://root:secret@localhost:27017
use database cas<span class="p">;</span>

<span class="c"># Create a database user for authentication</span>
db.createUser<span class="o">({</span>user:<span class="s2">"casuser"</span>, <span class="nb">pwd</span>:<span class="s2">"Mellon"</span>, roles: <span class="o">[</span><span class="s2">"readWrite"</span>, <span class="s2">"dbAdmin"</span><span class="o">]})</span>
</code></pre></div></div>

<p>Point your browser to <code class="highlighter-rouge">http://localhost:8081</code> and let’s create a collection called <code class="highlighter-rouge">cas-saml-sp-metadata</code> with the following document:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47908722-10576a80-dea3-11e8-82e1-b812c085d1c0.png" alt="image" /></p>

<p>Note the <code class="highlighter-rouge">value</code> field which contains a base64-encoded version of the metadata for a SAML2 service provider which makes it easier to get the metadata added to the MongoDB document. I am also skipping over the metadata signature that would have been used to validate its integrity and that could have just as easily been added to the document using a <code class="highlighter-rouge">signature</code> field.</p>

<p>That should do for now. Let’s get CAS running.</p>

<h2 id="cas">CAS</h2>

<h3 id="saml2-service-provider-metadata">SAML2 Service Provider Metadata</h3>

<p>So in order to enable a CAS integration with MongoDB <em>directly</em>, you want to start with the <a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a>, clone the project and follow <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">the notes here</a> to get CAS acting as SAML2 identity provider. In its simplest form, it comes to down to the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.samlIdp.entityId</span><span class="p">=</span><span class="s">https://sso.example.org/idp</span>
<span class="py">cas.authn.samlIdp.scope</span><span class="p">=</span><span class="s">example.org</span>
<span class="py">cas.authn.samlIdp.metadata.location</span><span class="p">=</span><span class="s">file:/etc/cas/config/saml</span>
</code></pre></div></div>

<p>…and this module in the CAS build:</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-support-saml-idp:${project.'cas.version'}"</span>
</code></pre></div></div>

<p>To keep things simple, we could use the <a href="https://apereo.github.io/cas/development/services/JSON-Service-Management.html">JSON service registry</a> to manage our SAML2 service provider definitions. Here is what our service definition might look like for SAML2 service provider in a <code class="highlighter-rouge">SAML-1.json</code> file:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;your-sp-entity-id&gt;"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"SAML"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"This SP has its metadata in MongoDB somewhere."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"metadataLocation"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"mongodb://"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The metadata location in the registration record above simply needs to be specified as <code class="highlighter-rouge">mongodb://</code> to signal to CAS that SAML metadata for our service provider must be fetched from MongoDB data sources defined in CAS configuration. As the next step, let’s <a href="(https://apereo.github.io/cas/development/installation/Configuring-SAML2-DynamicMetadata.html#mongodb)">teach CAS</a> about our MongoDB setup. Just like before, you’d need this module in your CAS build:</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-support-saml-idp-metadata-mongo:${project.'cas.version'}"</span>
</code></pre></div></div>

<p>…and CAS needs to know how to connect to MongoDB to fetch stuff:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.samlIdp.metadata.mongo.host</span><span class="p">=</span><span class="s">localhost</span>
<span class="py">cas.authn.samlIdp.metadata.mongo.port</span><span class="p">=</span><span class="s">27017</span>
<span class="py">cas.authn.samlIdp.metadata.mongo.userId</span><span class="p">=</span><span class="s">casuser</span>
<span class="py">cas.authn.samlIdp.metadata.mongo.password</span><span class="p">=</span><span class="s">Mellon</span>
<span class="py">cas.authn.samlIdp.metadata.mongo.collection</span><span class="p">=</span><span class="s">cas-saml-sp-metadata</span>
<span class="py">cas.authn.samlIdp.metadata.mongo.databaseName</span><span class="p">=</span><span class="s">cas</span>
</code></pre></div></div>

<p>That’s it. Build and run CAS. At this point, you should be able to log into service provider successfully whose metadata is fetched and processed by CAS from MongoDB.</p>

<h3 id="saml2-identity-provider-metadata">SAML2 Identity Provider Metadata</h3>

<p>If you examine your CAS startup logs, you might notice the following statement:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>...FileSystemSamlIdPMetadataLocator] - &lt;Metadata directory location is at <span class="o">[</span>/etc/cas/config/saml]&gt;
</code></pre></div></div>

<p>…which matches our setting above:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.samlIdp.metadata.location</span><span class="p">=</span><span class="s">file:/etc/cas/config/saml</span>
</code></pre></div></div>

<p>Metadata artifacts that belong to CAS as a SAML2 identity provider may also be managed and stored via MongoDb. This includes things such as the metadata XML document, signing and encryption keys, etc. While CAS has the ability to generate brand new metadata in MongoDB, let’s instead figure out how our existing metadata might be relocated to MongoDB.</p>

<p>Let’s create a MongoDB collection called <code class="highlighter-rouge">saml-idp-metadata</code> in our <code class="highlighter-rouge">cas</code> database to hold IdP artifacts with the following document in it:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"signingCertificate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"signingKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"encryptionCertificate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"encryptionKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Here is the drill:</p>

<ul>
  <li>The metadata, signing and encryption <em>certificates</em> may be base64-encoded.</li>
  <li>The signing and encryption <em>keys</em> <strong>MUST</strong> be signed and encrypted using CAS crypto settings and keys.</li>
</ul>

<p>The signing secret key and the encryption secret key are both JWKs of size 512 and 256. We can use the <a href="https://apereo.github.io/cas/development/installation/Configuring-Commandline-Shell.html">command-line shell</a> to create the two keys:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cas&gt; generate-key key-size 512
<span class="nv">$signingKey</span>
cas&gt; generate-key key-size 256
<span class="nv">$encryptionKey</span>
</code></pre></div></div>

<p>Once you have the keys, you can try to secure the metadata keys:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cas&gt; cipher-text file /etc/cas/config/saml/idp-signing.key signing-key <span class="nv">$signingKey</span> encryption-key <span class="nv">$encryptionKey</span>
...
cas&gt; cipher-text file /etc/cas/config/saml/idp-encryption.key signing-key <span class="nv">$signingKey</span> encryption-key <span class="nv">$encryptionKey</span>
...
</code></pre></div></div>

<p>The signing and encryption SAML2 metadata keys plus the base64-encoded versions of the signing and encryption certificates and the metadata XML can next be put into the MongoDB document.</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47927581-f2a4f800-ded8-11e8-8180-5e299be02114.png" alt="image" /></p>

<p>CAS settings will then take on the following form:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.authn.samlIdp.metadata.location=file:/etc/cas/config/saml
</span><span class="py">cas.authn.samlIdp.metadata.mongo.idpMetadataCollection</span><span class="p">=</span><span class="s">saml-idp-metadata</span>
<span class="py">cas.authn.samlIdp.metadata.mongo.crypto.encryption.key</span><span class="p">=</span><span class="s">$encryptionKey</span>
<span class="py">cas.authn.samlIdp.metadata.mongo.crypto.signing.key</span><span class="p">=</span><span class="s">$signingKey</span>
</code></pre></div></div>

<p>Build and run CAS. At this point, you should be able to log into the service provider successfully with CAS using its own SAML2 metadata from MongoDB to produce a SAML2 response, etc.</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/11/03/cas6-saml2-metadata-mongodb/</guid>
                <description>
                    
                    CAS distributed SAML2 metadata management using MongoDB, where you learn how to store metadata documents inside MongoDB for CAS as a SAML2 identity provider and all other registered SAML2 service providers.
                    
                </description>
                <pubDate>Sat, 03 Nov 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Slurp Configuration with Groovy</title>
                <link>https://apereo.github.io/2018/11/02/cas6-groovy-config-slurper/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>CAS allows you to externalize your configuration settings so you can work with the same CAS instance in different environments. You can use properties files, YAML files, environment variables and command-line arguments (just to name a few!) to externalize and provide configuration. These strategies present a very flexible and powerful way to manage CAS configuration for production deployments in a variety of use cases.</p>

<p>As your CAS deployment moves through the deployment pipeline from dev to test and into production, you can manage the configuration between those environments separately, and be certain that each tier has everything it needs to run when the server migrates. Tier-specific configuration is usually managed and activated through the use of application (aka. Spring) <em>profiles</em> while the rest of the more common settings are gathered centrally that apply to all environments. When you run CAS in <a href="https://apereo.github.io/cas/development/configuration/Configuration-Server-Management.html#standalone">standalone mode</a> specially, the default configuration directory on the filesystem (i.e. <code class="highlighter-rouge">/etc/cas/config</code>) may include <code class="highlighter-rouge">(cas|application).(yaml|yml|properties)</code> files that can be used to control behavior. Such configuration files may also specifically apply to a profile (i.e. <code class="highlighter-rouge">ldap.properties</code>) that can be activated using <code class="highlighter-rouge">spring.profiles.active</code> or <code class="highlighter-rouge">spring.profiles.include</code> settings.</p>

<p>Starting with CAS <code class="highlighter-rouge">6</code>, Groovy can also serve as a strategy for loading configuration in a way that allows one to consolidate common and tier-specific files in one place. This tutorial explores that possibility with a starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">6.0.0-RC4</code></li>
  <li>Java 11</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a> (The <code class="highlighter-rouge">master</code> branch specifically)</li>
</ul>

<h2 id="groovy-configslurper">Groovy <code class="highlighter-rouge">ConfigSlurper</code></h2>

<p>If you are familiar with Groovy, then <code class="highlighter-rouge">ConfigSlurper</code> is no stranger to you. This is a utility class for reading configuration files defined in the form of Groovy scripts. Configuration settings can be defined using dot notation or scoped using closures:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">grails</span><span class="o">.</span><span class="na">webflow</span><span class="o">.</span><span class="na">stateless</span> <span class="o">=</span> <span class="kc">true</span>
 <span class="n">smtp</span> <span class="o">{</span>
     <span class="n">mail</span><span class="o">.</span><span class="na">host</span> <span class="o">=</span> <span class="s1">'smtp.myisp.com'</span>
     <span class="n">mail</span><span class="o">.</span><span class="na">auth</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="s1">'server'</span>
 <span class="o">}</span>
 <span class="n">resources</span><span class="o">.</span><span class="na">URL</span> <span class="o">=</span> <span class="s2">"http://localhost:80/resources"</span>
</code></pre></div></div>

<p>CAS takes advantage of this very component, allowing you to isolate tier-specific settings in form of conditional closures. In the simplest scenario, it expects to find a <code class="highlighter-rouge">cas.groovy</code> file in the same configuration directory while running <em>standalone</em> mode that might look like this:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">profiles</span> <span class="o">{</span>
    <span class="n">dev</span> <span class="o">{</span>
        <span class="n">cas</span><span class="o">.</span><span class="na">authn</span><span class="o">.</span><span class="na">accept</span><span class="o">.</span><span class="na">users</span><span class="o">=</span><span class="s2">"test::dev"</span>
    <span class="o">}</span>
    <span class="n">prod</span> <span class="o">{</span>
        <span class="n">cas</span><span class="o">.</span><span class="na">authn</span><span class="o">.</span><span class="na">accept</span><span class="o">.</span><span class="na">users</span><span class="o">=</span><span class="s2">"test::prod"</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">cas</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">setting</span><span class="o">=</span><span class="s2">"value"</span>
</code></pre></div></div>

<p>When you run CAS using the <code class="highlighter-rouge">dev</code> profile, the collection of settings that are picked up from the script are:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.accept.users</span><span class="p">=</span><span class="s">"test::dev"</span>
<span class="py">cas.common.setting</span><span class="p">=</span><span class="s">"value"</span>
</code></pre></div></div>

<p>…and when you run CAS using the <code class="highlighter-rouge">prod</code> profile, the collection of settings that are picked up from the script are:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.accept.users</span><span class="p">=</span><span class="s">"test::prod"</span>
<span class="py">cas.common.setting</span><span class="p">=</span><span class="s">"value"</span>
</code></pre></div></div>

<p>For small configuration changes between tiers, this is arguably simpler than having, for example, <code class="highlighter-rouge">cas.properties</code>, <code class="highlighter-rouge">dev.properties</code> and <code class="highlighter-rouge">prod.properties</code> files. For anything else larger and more complicated, you still may want to think about separating settings into multiple files or perhaps consider using the <a href="https://apereo.github.io/2018/10/25/cas6-cloud-config-server/">Spring Cloud Config Server</a>.</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/11/02/cas6-groovy-config-slurper/</guid>
                <description>
                    
                    Learn how CAS configuration may be consumed via Groovy to simplify and consolidate settings for multiple deployment environments and profiles.
                    
                </description>
                <pubDate>Fri, 02 Nov 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Configuration Management with MongoDb</title>
                <link>https://apereo.github.io/2018/10/31/cas6-configuration-mongodb/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p><a href="https://www.mongodb.com">MongoDB</a> is a free and open-source cross-platform document-oriented database program. Classified as a NoSQL database program, MongoDB uses JSON-like documents with schemata. MongoDB is developed by MongoDB Inc., and is published under a combination of the Server Side Public License and the Apache License.</p>

<p>MongoDB is supported in CAS in many different ways. In this walkthrough, we are going to take a pass at getting <a href="https://apereo.github.io/cas/development/configuration/Configuration-Server-Management.html#mongodb">CAS connected to MongoDB</a> to store properties and settings. We will also try to reload settings dynamically in real-time as they are changed and updated inside MongoDB databases.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">6.0.0-RC4</code></li>
  <li>Java 11</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a> (The <code class="highlighter-rouge">master</code> branch specifically)</li>
  <li><a href="https://www.docker.com/get-started">Docker</a></li>
  <li><a href="https://stedolan.github.io/jq/">CLI JSON Processor <code class="highlighter-rouge">jq</code></a></li>
</ul>

<h2 id="mongodb">MongoDB</h2>

<p>To run MongoDB for development and testing, we can use the provided Docker image:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 27017:27017 <span class="nt">-e</span> <span class="nv">MONGO_INITDB_ROOT_USERNAME</span><span class="o">=</span>root <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">MONGO_INITDB_ROOT_PASSWORD</span><span class="o">=</span>secret <span class="nt">--name</span><span class="o">=</span><span class="s2">"mongodb-server"</span> mongo:4.0-xenial
docker ps
</code></pre></div></div>

<p>This runs a MongoDB database server which is useful for development but <strong>SHOULD NOT</strong> be used in production.</p>

<p>To access the MongoDB instance using a UI, run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--link</span> mongodb-server <span class="nt">-d</span> <span class="nt">-p</span> 8081:8081 <span class="se">\</span>
  <span class="nt">-e</span> <span class="s1">'ME_CONFIG_MONGODB_ADMINUSERNAME=root'</span> <span class="se">\</span>
  <span class="nt">-e</span> <span class="s1">'ME_CONFIG_MONGODB_ADMINPASSWORD=secret'</span> <span class="se">\</span>
  <span class="nt">-e</span> <span class="s1">'ME_CONFIG_MONGODB_SERVER=mongodb-server'</span> mongo-express
</code></pre></div></div>

<p>The <code class="highlighter-rouge">ME_CONFIG_MONGODB_SERVER</code> is the address of the docker container that runs the MongoDB server. By default, Docker containers use the container as the DNS host name. So we can just specify the <code class="highlighter-rouge">mongodb-server</code> the name of the container that runs our MongoDB instance.</p>

<p>Shell into the container:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CID</span><span class="o">=</span>docker ps <span class="nt">-aqf</span> <span class="nv">name</span><span class="o">=</span>mongodb-server
docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$CID</span> /bin/bash
</code></pre></div></div>

<p>When inside the container:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mongo <span class="nt">--host</span> mongodb://root:secret@localhost:27017
use database cas<span class="p">;</span>

<span class="c"># Create a database user for authentication</span>
db.createUser<span class="o">({</span>user:<span class="s2">"casuser"</span>, <span class="nb">pwd</span>:<span class="s2">"Mellon"</span>, roles: <span class="o">[</span><span class="s2">"readWrite"</span>, <span class="s2">"dbAdmin"</span><span class="o">]})</span>
</code></pre></div></div>

<p>When ready, point your browser to <code class="highlighter-rouge">http://localhost:8081</code> and let’s create a few documents with CAS settings in them. MongoDb documents are required to be found in the collection <code class="highlighter-rouge">MongoDbProperty</code>, as the following document:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"the-setting-name"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"the-setting-value"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>So I am going to create a MongoDB database called <code class="highlighter-rouge">cas</code> inside which the <code class="highlighter-rouge">MongoDbProperty</code> needs to be created. Next, each of the below settings will be housed inside an indibidual MongoDB document that matches the above JSON structure:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.accept.users</span><span class="p">=</span><span class="s">casuser::MongoDB</span>
<span class="py">management.endpoints.web.exposure.include</span><span class="p">=</span><span class="s">*</span>
<span class="py">management.endpoints.enabled-by-default</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.monitor.endpoints.endpoint.defaults.access</span><span class="p">=</span><span class="s">AUTHENTICATED</span>
<span class="py">spring.security.user.name</span><span class="p">=</span><span class="s">casuser</span>
<span class="py">spring.security.user.password</span><span class="p">=</span><span class="s">Mellon</span>
</code></pre></div></div>

<p>The end result will look something like this:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47649468-9e291200-db92-11e8-8cac-c993411c697b.png" alt="image" /></p>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />The above collection of settings <strong>MUST</strong> only be used for demo purposes and serve as an <strong>EXAMPLE</strong>. It is not wise to enable and expose all actuator endpoints to the web and certainly, the security of the exposed endpoints should be taken into account very seriously. None of the CAS or Spring Boot actuator endpoints are enabled by default. For production, you should carefully choose which endpoints to expose.
</div>

<p>You may also want to create an index on <code class="highlighter-rouge">name</code>:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47649572-f3652380-db92-11e8-9762-aaef042c7c58.png" alt="image" /></p>

<p>That should do for now. Let’s get CAS running.</p>

<h2 id="cas">CAS</h2>

<p>Integration with MongoDB in CAS to manage configuration can be done in a number of ways:</p>

<ul>
  <li>
    <p>If you have the <a href="https://apereo.github.io/2018/10/25/cas6-cloud-config-server/">Spring Cloud Config Server</a> deployed, MongoDB could be one of its many sources for settings and properties. In this scenario, you will just need to make sure the CAS server can talk to the Spring Cloud Config Server correctly, and the Config Server is then in charge of communicating with MongoDB to fetch settings, etc.</p>
  </li>
  <li>
    <p>Alternatively, you may decide to connect your CAS server directly to MongoDB and fetch settings. This is the approach we are going to try in this tutorial for a quick win, but do note that the strategy is almost the same if we were to use the Cloud Config server.</p>
  </li>
</ul>

<p>So in order to enable a CAS integration with MongoDB <em>directly</em>, you want to start with the <a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a>, clone the project and then put the following settings into a <code class="highlighter-rouge">src/main/resources/bootstrap.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">cas</span>
<span class="py">spring.profiles.active</span><span class="p">=</span><span class="s">mongodb</span>
<span class="py">cas.spring.cloud.mongo.uri</span><span class="p">=</span><span class="s">mongodb://casuser:Mellon@localhost:27017/cas</span>
</code></pre></div></div>

<p>Of course, don’t forget to include the required module in your CAS build:</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-support-configuration-cloud-mongo:${project.'cas.version'}"</span>
</code></pre></div></div>

<p>Build and deploy. At this point, you should be able to log into CAS using <code class="highlighter-rouge">casuser</code> and <code class="highlighter-rouge">MongoDB</code> as the credentials!</p>

<h3 id="refresh--reload">Refresh &amp; Reload</h3>

<p>If a setting changes, MongoDB has no way to broadcast the updated value(s) to its own clients, such as the CAS server itself. Therefore, in order to broadcast such change events, CAS presents various endpoints that allow the user to <a href="https://apereo.github.io/cas/development/configuration/Configuration-Management-Reload.html">refresh the configuration</a> as needed. This means that an adopter would simply change a required CAS setting and then would submit a request to CAS to <em>refresh</em> its current state. At runtime! All CAS internal components that are affected by the external change are quietly reloaded and the setting takes immediate effect, completely removing the need for container restarts or CAS re-deployments.</p>

<p>For example, start by changing the value of <code class="highlighter-rouge">cas.authn.accept.users</code> in MongoDB to something like <code class="highlighter-rouge">casuser::HelloWorld</code>. Then, execute the following command to refresh the CAS application context:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> casuser:Mellon https://sso.example.org/cas/actuator/refresh <span class="nt">-d</span> <span class="o">{}</span> <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>

...
<span class="o">[</span><span class="s2">"cas.authn.accept.users"</span><span class="o">]</span>
</code></pre></div></div>

<p>At this point, you should be able to log into CAS using <code class="highlighter-rouge">casuser</code> and <code class="highlighter-rouge">HelloWorld</code> as the credentials!</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/10/31/cas6-configuration-mongodb/</guid>
                <description>
                    
                    CAS distributed configuration management using MongoDb, where you learn how to store and secure CAS configuration settings and properties inside MongoDb.
                    
                </description>
                <pubDate>Wed, 31 Oct 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Integration with HashiCorp Vault</title>
                <link>https://apereo.github.io/2018/10/30/cas6-configuration-vault/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p><a href="https://www.vaultproject.io/">Vault</a> is a tool for securely accessing secrets. A secret is anything that you want to tightly control access to, such as API keys, passwords, certificates, and more. Vault provides a unified interface to any secret while providing tight access control and recording a detailed audit log.</p>

<p>The CAS integration with vault <a href="https://apereo.github.io/cas/development/configuration/Configuration-Properties-Security.html#vault">has been available</a> for some time. In this walkthrough, we are going to take a pass at getting CAS connected to Vault to store properties and settings. We will also try to reload settings dynamically in real-time as they are changed and updated inside Vault.</p>

<div class="alert alert-success">
  <strong>More HashiCorp</strong><br />You may also be interested in a CAS integration with <a href="https://apereo.github.io/2018/10/22/cas6-consul-discovery/">HashCorp Consul</a>.
</div>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">6.0.0-RC4</code></li>
  <li>Java 11</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a> (The <code class="highlighter-rouge">master</code> branch specifically)</li>
  <li><a href="https://www.docker.com/get-started">Docker</a></li>
  <li><a href="https://stedolan.github.io/jq/">CLI JSON Processor <code class="highlighter-rouge">jq</code></a></li>
</ul>

<h2 id="vault">Vault</h2>

<p>To run Vault for development and testing, we can use the provided Docker image:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--cap-add</span><span class="o">=</span>IPC_LOCK <span class="nt">-d</span> <span class="nt">-e</span> <span class="s1">'VAULT_DEV_ROOT_TOKEN_ID=CAS'</span> <span class="nt">-p</span> 8200:8200 <span class="nt">--name</span><span class="o">=</span>vault vault
docker ps
</code></pre></div></div>

<p>This runs a completely in-memory Vault server, which is useful for development but <strong>SHOULD NOT</strong> be used in production. Note the environment variable <code class="highlighter-rouge">VAULT_DEV_ROOT_TOKEN_ID</code> which sets the ID of the initially generated root token to the given value. We will use this token, later on, to log into the Vault UI and it will be also be utilized when CAS attempts to connect to Vault.</p>

<p>To access the Vault UI, point your browser to <code class="highlighter-rouge">http://localhost:8200/ui</code> and use the above token to log into Vault where you’d be greeted with the following screen:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47616833-06b2b900-dad7-11e8-99bc-5c44c0d900d2.png" alt="image" /></p>

<p>So, let’s create a few secrets. Secrets inside Vault can be managed inside folders where from the CAS perspective, the folder hierarchy is expected to match the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/secret/{application}/{profile}
/secret/{application}
</code></pre></div></div>

<p>…where <code class="highlighter-rouge">application</code> is the value of <code class="highlighter-rouge">spring.application.name</code> which is by default <code class="highlighter-rouge">cas</code> and the <code class="highlighter-rouge">profile</code> is any a tag/label assigned to a collection of settings that would be activated and fetched if the CAS server is deployed using said profile(s). So, as an example, we can create a secret for <code class="highlighter-rouge">cas.authn.accept.users</code> with the value of <code class="highlighter-rouge">casuser::Vault</code>. We will put this secret inside the path <code class="highlighter-rouge">/secret/cas/vault</code> where <code class="highlighter-rouge">cas</code> is the name of our application and <code class="highlighter-rouge">vault</code> is the profile name we shall activate when running CAS.</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47643977-35399e00-db82-11e8-9ca3-4202c3125476.png" alt="image" /></p>

<p>Note that I have added a number of other settings to allow access to the CAS actuator endpoints. This will allow us to refresh the state of CAS application context, once a setting is updated with a new value.</p>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />The above collection of settings <strong>MUST</strong> only be used for demo purposes and serve as an <strong>EXAMPLE</strong>. It is not wise to enable and expose all actuator endpoints to the web and certainly, the security of the exposed endpoints should be taken into account very seriously. None of the CAS or Spring Boot actuator endpoints are enabled by default. For production, you should carefully choose which endpoints to expose.
</div>

<p>That should do for now. Let’s get CAS running.</p>

<h2 id="cas">CAS</h2>

<p>Integration with Vault in CAS is handled using <a href="https://cloud.spring.io/spring-cloud-vault/">Spring Cloud Vault</a> and can be done in a number of ways:</p>

<ul>
  <li>
    <p>If you have the <a href="https://apereo.github.io/2018/10/25/cas6-cloud-config-server/">Spring Cloud Config Server</a> deployed, Vault could be one of its many sources for settings and properties. In this scenario, you will just need to make sure the CAS server can talk to the Spring Cloud Config Server correctly, and the Config Server is then in charge of communicating with Vault to fetch settings, etc.</p>
  </li>
  <li>
    <p>Alternatively, you may decide to connect your CAS server directly to Vault and fetch settings. This is the approach we are going to try in this tutorial for a quick win, but do note that the strategy is almost the same if we were to use the Cloud Config server.</p>
  </li>
</ul>

<p>So in order to enable a CAS integration with Vault <em>directly</em>, you want to start with the <a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a>, clone the project and then put the following settings into a <code class="highlighter-rouge">src/main/resources/bootstrap.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">cas</span>
<span class="py">spring.profiles.active</span><span class="p">=</span><span class="s">vault</span>

<span class="py">spring.cloud.vault.host</span><span class="p">=</span><span class="s">localhost</span>
<span class="py">spring.cloud.vault.port</span><span class="p">=</span><span class="s">8200</span>
<span class="py">spring.cloud.vault.token</span><span class="p">=</span><span class="s">CAS</span>
<span class="py">spring.cloud.vault.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.cloud.vault.reactive.enabled</span><span class="p">=</span><span class="s">false</span>
<span class="py">spring.cloud.vault.fail-fast</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.cloud.vault.scheme</span><span class="p">=</span><span class="s">http</span>

<span class="py">spring.cloud.vault.kv.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.cloud.vault.kv.backend</span><span class="p">=</span><span class="s">secret</span>
</code></pre></div></div>

<p>We are teaching CAS to find our Vault server at <code class="highlighter-rouge">http://localhost:8200</code> and use the generated token <code class="highlighter-rouge">CAS</code> for authenticated requests.</p>

<div class="alert alert-warning">
  <strong>Authentication</strong><br />Besides a token, there are many other ways to ensure requests to Vault are authenticated such AppIds, roles, AWS-EC2, etc. See <a href="https://cloud.spring.io/spring-cloud-vault/">Spring Cloud Vault</a> for more info.
</div>

<p>We have also enabled the versioned Key-Value secret backend. The key-value backend allows storage of arbitrary values as key-value store. A single context can store one or many key-value tuples. Contexts can be organized hierarchically. Per our previous work in Vault, the backend is called <code class="highlighter-rouge">secret</code>.</p>

<p>Note that there are many other types of backends supported. See <a href="https://cloud.spring.io/spring-cloud-vault/">Spring Cloud Vault</a> for more info.</p>

<p>Of course, don’t forget to include the required module in your CAS build:</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-support-configuration-cloud-vault:${project.'cas.version'}"</span>
</code></pre></div></div>

<p>Build and deploy. At this point, you should be able to log into CAS using <code class="highlighter-rouge">casuser</code> and <code class="highlighter-rouge">Vault</code> as the credentials!</p>

<h3 id="refresh--reload">Refresh &amp; Reload</h3>

<p>If a secret changes, Vault has no way to broadcast the updated value(s) to its own clients, such as the CAS server itself. Therefore, in order to broadcast such change events CAS presents various endpoints that allow the user to <a href="https://apereo.github.io/cas/development/configuration/Configuration-Management-Reload.html">refresh the configuration</a> as needed. This means that an adopter would simply change a required CAS setting and then would submit a request to CAS to <em>refresh</em> its current state. At runtime! All CAS internal components that are affected by the external change are quietly reloaded and the setting takes immediate effect, completely removing the need for container restarts or CAS re-deployments.</p>

<p>For example, start by changing the value of <code class="highlighter-rouge">cas.authn.accept.users</code> in Vault to something like <code class="highlighter-rouge">casuser::HelloWorld</code>. Then, execute the following command to refresh the CAS application context:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> casuser:Mellon https://sso.example.org/cas/actuator/refresh <span class="nt">-d</span> <span class="o">{}</span> <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>

...
<span class="o">[</span><span class="s2">"cas.authn.accept.users"</span><span class="o">]</span>
</code></pre></div></div>

<p>At this point, you should be able to log into CAS using <code class="highlighter-rouge">casuser</code> and <code class="highlighter-rouge">HelloWorld</code> as the credentials!</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/10/30/cas6-configuration-vault/</guid>
                <description>
                    
                    CAS distributed configuration management using HashCorp Vault, where you learn how to store and secure CAS configuration settings and properties inside Vault.
                    
                </description>
                <pubDate>Tue, 30 Oct 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 6.0.0 RC3 Feature Release</title>
                <link>https://apereo.github.io/2018/10/26/600rc3-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.3.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.3.0">June 29th, 2018</a>. Since then, the project has been moving forward with development of the next feature release that is tagged as <code class="highlighter-rouge">6.0.0</code>. Note that this is a <strong>major release</strong> of the CAS software which <em>may</em> present significant changes in architecture, configuration or behavior. Please review the <a href="https://apereo.github.io/cas/developer/Release-Policy.html">release policy</a> to learn more about the scope of the release.</p>

<p>This post intends to highlight some of the improvements and enhancements packed into the <strong>third</strong> release candidate in the <code class="highlighter-rouge">6.0.0</code> series.</p>

<p>You can read about the previous release candidate <a href="https://apereo.github.io/2018/09/14/600rc2-release/">here</a>.</p>

<h2 class="no_toc" id="shake-well-before-use">Shake Well Before Use</h2>

<p>We strongly recommend that you take advantage of the release candidates as they come out. Waiting for a <code class="highlighter-rouge">GA</code> release is only going to set you up for unpleasant surprises. A <code class="highlighter-rouge">GA</code> is simply <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">a tag and nothing more</a>. Note that CAS releases are <em>strictly</em> time-based releases; they are not scheduled or based on specific benchmarks, statistics or completion of features. To gain confidence in a particular release, it is strongly recommended that you start early by experimenting with release candidates and/or follow-up snapshots.</p>

<p>In order to start experimenting with release candidates, at any given time, you should be able to append <code class="highlighter-rouge">-SNAPSHOT</code> to the CAS version specified in order to take advantage of snapshot builds as changes are made and published.</p>

<h3 class="no_toc" id="overlay">Overlay</h3>

<p>In the <code class="highlighter-rouge">gradle.properties</code> of <a href="https://github.com/apereo/cas-overlay-template">the overlay</a>, adjust the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">casVersion</span><span class="p">=</span><span class="s">6.0.0-RC3</span>
</code></pre></div></div>

<h2 class="no_toc" id="changes">Changes</h2>

<ul id="markdown-toc">
  <li><a href="#new--noteworthy" id="markdown-toc-new--noteworthy">New &amp; Noteworthy</a>    <ul>
      <li><a href="#jdk-11" id="markdown-toc-jdk-11">JDK 11</a></li>
      <li><a href="#couchdb-support" id="markdown-toc-couchdb-support">CouchDb Support</a></li>
      <li><a href="#saml2-idp-single-logout" id="markdown-toc-saml2-idp-single-logout">SAML2 IdP Single Logout</a></li>
      <li><a href="#delegated-authn-via-hiorg-server" id="markdown-toc-delegated-authn-via-hiorg-server">Delegated AuthN via HiOrg-Server</a></li>
      <li><a href="#saml2-encryptable-attributes" id="markdown-toc-saml2-encryptable-attributes">SAML2 Encryptable Attributes</a></li>
      <li><a href="#multifactor-authentication--duo-security" id="markdown-toc-multifactor-authentication--duo-security">Multifactor Authentication &amp; Duo Security</a></li>
      <li><a href="#radius-multifactor-authentication" id="markdown-toc-radius-multifactor-authentication">RADIUS Multifactor Authentication</a></li>
      <li><a href="#spring-boot-administration-server" id="markdown-toc-spring-boot-administration-server">Spring Boot Administration Server</a></li>
      <li><a href="#saml2-idp-metadata-via-amazon-s3" id="markdown-toc-saml2-idp-metadata-via-amazon-s3">SAML2 IdP Metadata via Amazon S3</a></li>
    </ul>
  </li>
  <li><a href="#smaller-stuff" id="markdown-toc-smaller-stuff">Smaller Stuff</a></li>
  <li><a href="#library-upgrades" id="markdown-toc-library-upgrades">Library Upgrades</a></li>
  <li><a href="#resources" id="markdown-toc-resources">Resources</a></li>
  <li><a href="#get-involved" id="markdown-toc-get-involved">Get Involved</a></li>
  <li><a href="#credits" id="markdown-toc-credits">Credits</a></li>
</ul>

<h3 id="new--noteworthy">New &amp; Noteworthy</h3>

<h4 id="jdk-11">JDK 11</h4>

<p>Starting with this version and continuing the effort from previous releases, CAS requires and builds against JDK 11. <a href="https://travis-ci.org/apereo/cas/builds">Travis CI</a> has switched over to use OpenJDK 11 to build and publish CAS server <code class="highlighter-rouge">SNAPSHOT</code> releases, and the entire distribution has also been tested using Oracle JDK 11.</p>

<div class="alert alert-danger">
  <strong>Important changes in Oracle JDK 11 License</strong><br />With JDK 11 Oracle has updated the license terms on which Oracle JDK is offered. The new Oracle Technology Network License Agreement for Oracle Java SE is substantially different from the licenses under which previous versions of the JDK were offered. <b>Please review</b> the new terms carefully before downloading and using this product. Oracle also offers this software under the GPL License on jdk.java.net/11.</div>

<p>The key part of the license is as follows:</p>

<blockquote>
  <p>You may not: use the Programs for any data processing or any commercial, production, or internal business purposes 
other than developing, testing, prototyping, and demonstrating your Application.</p>
</blockquote>

<p>So, do NOT download or use the Oracle JDK unless you intend to pay for it. <strong>Use an OpenJDK build instead.</strong></p>

<h4 id="couchdb-support">CouchDb Support</h4>

<p>Extensive CouchDb support is now provided by CAS to handle storage concerns when it comes to <a href="https://apereo.github.io/cas/development/installation/CouchDB-Ticket-Registry.html">ticketing</a>, <a href="https://apereo.github.io/cas/development/installation/Couchbase-Authentication.html">authentication</a>, <a href="https://apereo.github.io/cas/development/installation/Audits.html#couchbase-audits">audit and throttling</a>, multifactor authentication, and more.</p>

<h4 id="saml2-idp-single-logout">SAML2 IdP Single Logout</h4>

<p>Basic functionality is now included to have CAS submit <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">SAML2 logout requests</a> to SAML2 service providers, who currently have a registered a session with CAS. This will continue to be a work-in-progress item, to be improved and finalized prior to the final GA release.</p>

<h4 id="delegated-authn-via-hiorg-server">Delegated AuthN via HiOrg-Server</h4>

<p><a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">Delegated authentication</a> is now able to support HiOrg-Server.</p>

<h4 id="saml2-encryptable-attributes">SAML2 Encryptable Attributes</h4>

<p>Configuration for <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">SAML2 registered services</a> can now specify attributes that should be optionally included in or excluded from encryption in the final SAML2 response.</p>

<h4 id="multifactor-authentication--duo-security">Multifactor Authentication &amp; Duo Security</h4>

<p>Significant changes in the multifactor authentication API and modules are incorporated in this release to better handle failure modes across all providers.
The integration with Duo Security is also greatly improved internally to reduce API noise when it comes to registering multiple Duo configurations with CAS.</p>

<h4 id="radius-multifactor-authentication">RADIUS Multifactor Authentication</h4>

<p>RADIUS authentication is now able to honor the <code class="highlighter-rouge">AccessChallenge</code> response from the radius server, and properly prompt for multifactor authentication. This capability was best tested against <a href="https://www.censornet.com/">CensorNet’s</a> RADIUS server functionality.</p>

<h4 id="spring-boot-administration-server">Spring Boot Administration Server</h4>

<p>The CAS integration with the <a href="https://apereo.github.io/cas/development/installation/Configuring-Monitoring-Administration.html">Spring Boot Administration Server</a> is now brought up to speed to be compatible with the latest Spring Boot release.</p>

<h4 id="saml2-idp-metadata-via-amazon-s3">SAML2 IdP Metadata via Amazon S3</h4>

<p>Metadata artifacts that belong to CAS as a SAML2 identity provider may also be managed and stored via <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-DynamicMetadata.html#amazon-s3">Amazon S3 buckets</a>.</p>

<h3 id="smaller-stuff">Smaller Stuff</h3>

<ul>
  <li>Additional settings to support <em>fallback</em> principal attributes when dealing with X.509 principal resolution.</li>
  <li>Delegated authentication is improved to execute the authentication step only once.</li>
  <li>SAML2 delegated authentication is now capable of virtually renaming SAML2 attributes.</li>
  <li>Service access strategy for SAML2 service providers and other service types can now handle the <code class="highlighter-rouge">unauthorizedRedirectUrl</code> setting.</li>
  <li>Radius authentication now attempts to also submit the client IP address to the radius server.</li>
  <li>Small fixes to the SAML2 callback url pattern construction.</li>
  <li>New attribute renderer components are introduced to enhance the CAS v1 validation response, if needed.</li>
  <li>CAS internal Gradle build should continue to work against IDEA <code class="highlighter-rouge">2018.3 EAP</code>.</li>
  <li>SAML2 responses can optionally include a <code class="highlighter-rouge">NameID</code> for <code class="highlighter-rouge">SubjectConfirmation</code> blocks, on a per-service basis.</li>
  <li>SAML2 responses can populate the <code class="highlighter-rouge">Destination</code> field.</li>
  <li>The background job responsible for cleaning trusted expired MFA records is now scheduled correctly on startup.</li>
  <li>Attribute resolution via external groovy scripts, handled by <a href="https://github.com/apereo/person-directory">PersonDirectory</a>, can now properly recognize the engine name.</li>
  <li>Hazelcast health monitoring imports its reporting of memory statistics.</li>
  <li>Registration of <code class="highlighter-rouge">PrincipalResolver</code> and <code class="highlighter-rouge">AuditPrincipalIdProvider</code> is now refactored to use <code class="highlighter-rouge">*Configurer</code> type of strategies as callbacks.</li>
  <li>Loading CAS configuration files is modified to better match Spring Boot behavior.</li>
  <li>Performance improvements to HTTP calls and caching of responses.</li>
  <li>Small number of dependency fixes that deal with auto configuration of Spring Cloud Config, Spring Cloud Config Bus and Spring Cloud Config Watch.</li>
  <li>Detection of the SAML2 SLO url location in metadata is now changed to locate the right binding (See SAML2 SLO support above).</li>
  <li>A new setting is now introduced to force CAS to restrict the authentication handler selection via source attached to the credential and provided via the login form.</li>
  <li>A new authentication policy is now included to force all authentication handlers to validate the given credential.</li>
  <li>The default RADIUS authentication strategy is switched to use the <em>send-and-receive</em> asynchronous model in anticipation of <code class="highlighter-rouge">AccessChallenge</code> RADIUS server responses.</li>
</ul>

<h3 id="library-upgrades">Library Upgrades</h3>

<ul>
  <li>Spring</li>
  <li>Spring Boot</li>
  <li>Spring Boot Admin</li>
  <li>Hazelcast</li>
  <li>OpenSAML</li>
  <li>Jackson</li>
  <li>Mockito</li>
  <li>Spotbugs</li>
  <li>Person Directory</li>
  <li>Pac4j</li>
  <li>Spring Data</li>
  <li>Spring Cloud</li>
  <li>Amazon SDK</li>
  <li>Micrometer</li>
  <li>UnboundID</li>
  <li>Twilio</li>
  <li>Nexmo</li>
  <li>Spring Security</li>
  <li>Google Maps</li>
  <li>Apache Groovy</li>
</ul>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://apereo.github.io/cas/development/">Documentation</a></li>
  <li><a href="https://github.com/apereo/cas/milestones">Release Schedule</a></li>
  <li><a href="https://apereo.github.io/cas/developer/Release-Policy.html">Release Policy</a></li>
</ul>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="credits">Credits</h2>

<p>Big thanks to all who participate in the development of this release to submit patches and contribute improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/10/26/600rc3-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 6.0.0 RC3 release.
                    
                </description>
                <pubDate>Fri, 26 Oct 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Why you should choose CAS as your SSO system</title>
                <link>https://apereo.github.io/2018/10/25/why-you-should-choose-cas-as-your-sso-system/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>Most of the customers for whom I work have already chosen the CAS server and its ecosystem when I come in to help them.</p>

<p>Yet, from time to time, I’m contacted earlier in the decision process when the client is still thinking about the products and protocols he wants to use. Advocating for the CAS server is an easy task for me, even if generally, technical reasons are just a small part of the game (politics and relationships really matter).</p>

<p>I especially want to disabuse people who believe that CAS software is just about the CAS protocol, it’s so much more.</p>

<p>Some may think that as a CAS committer and as an IAM freelance, I’m biased towards CAS. This is true, but certainly less than any salesman who will earn fees for each sold product.</p>

<p>Eventually, this is what I say:</p>

<h3 id="1-cas-is-open-source">1) CAS is Open Source</h3>

<p>Most customers primarily choose Open Source software because it’s free. While this is a good reason, they still need to pay consultants to help them.
To me, there are greater benefits, especially the fact that you can contribute to the project.
If you buy an SSO system from a big company, want a new feature and are the only one in the world, it’s too bad for you, there is little chance you will get your new feature.
With Open Source software, you can make it happen!</p>

<h3 id="2-cas-is-a-very-modern-software">2) CAS is a very modern software</h3>

<p>While the general code quality of the CAS server has always been good, I must admit that the whole architecture and design have strongly improved since version 5 where it has embraced the Spring Boot ecosystem. I was a bit reluctant on this huge change, but Misagh was definitely right as using Spring Boot was a big jump forward.
There are some glitches here and there, but overall, the code is easy to read and understand and things are really modular.</p>

<h3 id="3-cas-has-many-features">3) CAS has many features</h3>

<p>The CAS server offers many useful capabilities, from obvious ones to more advanced ones. It handles various authentication methods, multi-factor authentication (MFA), can remember the user, force or try authentication, offers a dashboard and monitoring, has logs and audits, manages passwords, etc.
Of course, you cannot only assess a software by the number of its features but having many options is generally a good thing.</p>

<h3 id="4-cas-is-very-popular">4) CAS is very popular</h3>

<p>The CAS server is one of the most popular software in IAM. With around five thousands stars on github.com, CAS is a well-known project.
Many higher-education schools and companies use it, so you can easily find help from the CAS community or paid consultants. The more the CAS server is installed, the more people read its source code and test it, the more security vulnerabilities are discovered and fixed. It makes it a safe choice for your SSO system.</p>

<h3 id="5-cas-fits-everywhere">5) CAS fits everywhere</h3>

<p>Your existing environment is the first most important criteria when choosing an SSO system. Most companies never start a new project from scratch: for example, they use Redis on CentOS, a bit of MongoDB also and their users’ storage is an old LDAP system. You must cope with all that constraints.
If your software only supports technologies A and B, you can only address clients willing to use A or B. The CAS server can:</p>
<ul>
  <li>use many authentication methods: LDAP, databases, X509, Cassandra, Radius, Spnego, JWT, AWS Cloud Directory and many more</li>
  <li>handle many storage systems: Memcached, Redis, Oracle, Hazelcast, CouchDB, Couchbase, etc.</li>
</ul>

<h3 id="6-cas-is-the-master-of-interoperability">6) CAS is the master of interoperability</h3>

<p>Your existing environment is also the second most important criteria when choosing an SSO system! Big bang projects almost always fail and it’s hard to deal with legacy. I don’t remember having a customer without an existing software to integrate with.
And this is the great strength of CAS:</p>
<ul>
  <li>the CAS server can act as a SAML IdP, an OAuth provider, an OpenID Connect provder or as a CAS server of course</li>
  <li>but it can also play the role of a client delegating the authentication to another CAS server, to a SAML IdP, to Facebook, Google, Twitter and many other identity providers.</li>
</ul>

<p>This is one of the main contributions I brought to CAS and I’m especially proud of this interoperability.</p>

<p>CAS clients used for integration in web applications exist in many technologies as well: Java, PHP, .Net, Ruby, Python, Node.js, Apache module, etc.</p>

<p>CAS is a great software, it is worth considering if you plan to choose an SSO system.</p>

<p><a href="https://github.com/leleuj">Jérôme LELEU</a></p>

<p>Originally posted on the <a href="http://www.pac4j.org/blog/why-you-choose-cas-as-your-sso-system.html">pac4j blog</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/10/25/why-you-should-choose-cas-as-your-sso-system/</guid>
                <description>
                    
                    Discover the true reasons to use CAS
                    
                </description>
                <pubDate>Thu, 25 Oct 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Integration with Spring Cloud Config Server</title>
                <link>https://apereo.github.io/2018/10/25/cas6-cloud-config-server/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>As your CAS deployment moves through the deployment pipeline from dev to test to production, you can manage the configuration between those environments and be certain that applications have everything they need to run when they migrate through the use of an external configuration server provided by the <a href="https://github.com/spring-cloud/spring-cloud-config">Spring Cloud project</a>. While most CAS deployments tend to fall into the simpler category of managing CAS configuration directly alongside the CAS server deployment, this tutorial focuses on allowing CAS to work with the Spring Cloud Config server for distributed configuration management.</p>

<p>The <a href="https://apereo.github.io/cas/development/configuration/Configuration-Server-Management.html">Spring Cloud Config server</a> is an external and central configuration server to keep state and settings for all sorts of applications, CAS included. It provides an abstract way for CAS (and all of its other clients) to obtain settings from a variety of sources such as file system, git or svn repositories, MongoDb databases, Vault, etc. The beauty of this solution is that to the CAS web application server, (or the clients of the Spring Cloud Config server in general), it matters not where settings come from since CAS has no knowledge of the underlying property sources. It simply talks to the configuration server to locate settings and move on.</p>

<p>In this walkthrough, we will focus on the following tasks:</p>

<ul>
  <li>Spring Cloud Config Server deployment
    <ul>
      <li>Property source configuration</li>
      <li>Endpoint and operational security</li>
      <li>Managing sensitive settings via encryption</li>
      <li>Distributed real-time updates to settings</li>
    </ul>
  </li>
  <li>CAS server integration with the Config server</li>
</ul>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">6.0.0-RC3</code></li>
  <li>Java 11</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a> (The <code class="highlighter-rouge">master</code> branch specifically)</li>
  <li><a href="https://github.com/apereo/cas-configserver-overlay">CAS Spring Cloud Config server overlay</a></li>
  <li><a href="https://stedolan.github.io/jq/">CLI JSON Processor <code class="highlighter-rouge">jq</code></a></li>
</ul>

<h2 id="spring-cloud-config-server-configuration">Spring Cloud Config Server Configuration</h2>

<h3 id="overlay-basics">Overlay Basics</h3>

<p>The Spring Cloud Config server runs a standalone Spring Boot application on its own with a setup that is very similar to the CAS server itself. There is a <a href="https://github.com/apereo/cas-configserver-overlay">WAR overlay</a> that can be used to configure and deploy the server. By default, the application runs on port <code class="highlighter-rouge">8888</code> and is available at <code class="highlighter-rouge">/casconfigserver</code> and does require SSL with a keystore that is expected at <code class="highlighter-rouge">file:/etc/cas/thekeystore</code>. The default settings should match the following:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">server.port</span><span class="p">=</span><span class="s">8444</span>

<span class="py">server.ssl.key-store</span><span class="p">=</span><span class="s">file:/etc/cas/thekeystore</span>
<span class="py">server.ssl.key-store-password</span><span class="p">=</span><span class="s">changeit</span>
<span class="py">server.ssl.key-password</span><span class="p">=</span><span class="s">changeit</span>
</code></pre></div></div>

<h3 id="security">Security</h3>

<p>In order to secure the Config server, we can create a <code class="highlighter-rouge">src/main/resources/application-security.properties</code> to contain the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.security.user.name</span><span class="p">=</span><span class="s">casuser</span>
<span class="py">spring.security.user.password</span><span class="p">=</span><span class="s">Mellon</span>

<span class="py">management.endpoints.web.base-path</span><span class="p">=</span><span class="s">/actuator</span>
<span class="py">management.endpoints.env.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">management.endpoints.web.exposure.include</span><span class="p">=</span><span class="s">env</span>
</code></pre></div></div>

<h3 id="run">Run</h3>

<p>We should also modify the <code class="highlighter-rouge">build.sh</code> file to auto-activate the <code class="highlighter-rouge">security</code> profile to allow our security-related settings to be loaded:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>run<span class="o">()</span> <span class="o">{</span>
    package <span class="o">&amp;&amp;</span> java <span class="nt">-jar</span> <span class="nt">-Dspring</span>.profiles.include<span class="o">=</span>security build/libs/casconfigserver.war
<span class="o">}</span>
</code></pre></div></div>

<p>Once you’re ready, execute the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh run
</code></pre></div></div>

<p>…at which point a successful startup attempt would demonstrate the following in the logs:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;The following profiles are active: security,native&gt;
...
&lt;Starting Servlet Engine: Apache Tomcat/9.0.12&gt;
...
&lt;Starting ProtocolHandler ["https-jsse-nio-8888"]&gt;
...
&lt;Started CasConfigurationServerWebApplication in 14.823 seconds (JVM running for 16.248)&gt;
</code></pre></div></div>

<p>…and the server should be available at <code class="highlighter-rouge">https://admin.example.org:8888/casconfigserver</code>.</p>

<h3 id="configuration-sources">Configuration Sources</h3>

<p>The Spring Cloud Config server by default runs under a <code class="highlighter-rouge">native</code> profile, which basically allows it to locate properties and settings under the <code class="highlighter-rouge">/etc/cas/config</code> folder, which is very similar to the default CAS server setup. We are going to take this one step further and allow it to also load settings from a git repository. To do this, we need a <code class="highlighter-rouge">src/main/resources/bootstrap.properties</code> file with the following:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">casconfigserver</span>
<span class="py">spring.profiles.active</span><span class="p">=</span><span class="s">native,default,security</span>
<span class="py">spring.cloud.config.server.native.searchLocations</span><span class="p">=</span><span class="s">file:///etc/cas/config</span>
<span class="py">spring.cloud.config.server.git.uri</span><span class="p">=</span><span class="s">file://path/to/config-server-repo</span>
<span class="c"># spring.cloud.config.server.bootstrap=true
</span></code></pre></div></div>

<p>Not only the Config server is loading properties from embedded resources on the classpath, but it is also configured to look at <code class="highlighter-rouge">/etc/cas/config</code> as well as our Git repository at <code class="highlighter-rouge">config-server-repo</code> which is expected to contain properties and settings. As an example, we can create and initialize the <code class="highlighter-rouge">config-server-repo</code> directory as a Git repository and then <strong>add and commit</strong> the following files to it:</p>

<h4 id="applicationyml"><code class="highlighter-rouge">application.yml</code></h4>

<p>Global settings regardless of the application:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">info</span><span class="pi">:</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">Spring Cloud Config Server</span>
</code></pre></div></div>

<h4 id="casproperties"><code class="highlighter-rouge">cas.properties</code></h4>

<p>Global settings for the <code class="highlighter-rouge">cas</code> application:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">server.port</span><span class="p">=</span><span class="s">8555</span>
</code></pre></div></div>

<h4 id="cas-devproperties"><code class="highlighter-rouge">cas-dev.properties</code></h4>

<p>Settings for the <code class="highlighter-rouge">cas</code> application under the <code class="highlighter-rouge">dev</code> profile:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.accept.users</span><span class="p">=</span><span class="s">casuser::Devel</span>
</code></pre></div></div>

<h4 id="cas-qaproperties"><code class="highlighter-rouge">cas-qa.properties</code>:</h4>

<p>Settings for the <code class="highlighter-rouge">cas</code> application under the <code class="highlighter-rouge">qa</code> profile:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.accept.users</span><span class="p">=</span><span class="s">casuser::QA</span>
</code></pre></div></div>

<p>Build and run as usual.</p>

<h3 id="query-configuration">Query Configuration</h3>

<p>Now that the Config server is connected to a number of property sources with a number of files organized in fancy ways, we can query the server and ask for application settings.</p>

<p>For example, ask the server to get all the configuration settings for <code class="highlighter-rouge">cas</code> under the <code class="highlighter-rouge">qa</code> profile:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> casuser:Mellon https://config.example.org:8888/casconfigserver/cas/qa | jq
</code></pre></div></div>

<p>…or the <code class="highlighter-rouge">dev</code> profile:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> casuser:Mellon https://config.example.org:8888/casconfigserver/cas/dev | jq
</code></pre></div></div>

<p>Notice how in each scenario, global settings, and common application settings and then profile-specific settings are returned back to you. As the caller, you don’t know where the settings come from or how they are controlled and by whom. All you need to know is: <em>Get me the right set of settings for my app at this profile</em>.</p>

<p>Let’s make a change. Navigate to the <code class="highlighter-rouge">cas-qa.properties</code> file and add the following, then commit the change to the repository:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.accept.users</span><span class="p">=</span><span class="s">casuser::QASomething</span>
</code></pre></div></div>

<p>…and the call the Config server again:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> casuser:Mellon https://config.example.org:8888/casconfigserver/cas/qa | jq
</code></pre></div></div>

<p>Notice how your change was picked up automatically. As a bonus exercise, push your git repository to a cloud provider such as Github or Bitbucket and modify the Config server with the URL of the new Git repository. Then make a change using the Github/BitBucket online editor to one of the settings and observe how the Config server recognizes changes automatically. Very cool!</p>

<h3 id="sensitive-configuration">Sensitive Configuration</h3>

<p>So far, we have been embedding values directly in configuration files. Let’s try to make our setup a bit more secure by encrypting values before they are added to our repository. In the <code class="highlighter-rouge">bootstrap.properties</code> file add the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">encrypt.key-store.location</span><span class="p">=</span><span class="s">file:///etc/cas/casconfigserver.jks</span>
<span class="py">encrypt.key-store.password</span><span class="p">=</span><span class="s">changeit</span>
<span class="py">encrypt.key-store.alias</span><span class="p">=</span><span class="s">cas</span>
<span class="py">encrypt.key-store.secret</span><span class="p">=</span><span class="s">changeit</span>
</code></pre></div></div>

<p>You will, of course, need to create the above keystore using <code class="highlighter-rouge">keytool</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>keytool <span class="nt">-genkeypair</span> <span class="nt">-alias</span> cas <span class="nt">-keyalg</span> RSA <span class="se">\</span>
  <span class="nt">-dname</span> <span class="s2">"CN=CAS,OU=Unit,O=Organization,L=City,S=State,C=US"</span> <span class="se">\</span>
  <span class="nt">-keypass</span> changeit <span class="nt">-keystore</span> /etc/cas/casconfigserver.jks <span class="nt">-storepass</span> changeit
</code></pre></div></div>

<p>The keystore above is what controls the semantics of encryption/decryption of settings. The encryption is done with the public key, and a private key is needed for decryption.</p>

<p>As a test, I am going to ask the Config server to encrypt the text <code class="highlighter-rouge">casuser::QASomething</code> for me:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> casuser:Mellon https://config.example.org:8888/casconfigserver/encrypt <span class="nt">-d</span> casuser::QASomething
</code></pre></div></div>

<p>If you take the encrypted value and simply try to decrypt it you should see the original:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> casuser:Mellon https://config.example.org:8888/casconfigserver/encrypt <span class="nt">-d</span> <span class="nv">$ENCRYPTED_VALUE</span>
</code></pre></div></div>

<p>Once the value is encrypted, it can be put back into the <code class="highlighter-rouge">cas-qa.properties</code> configuration file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.accept.users</span><span class="p">=</span><span class="s">{cipher}$ENCRYPTED_VALUE</span>
</code></pre></div></div>

<p>If you ask the Config server for the <code class="highlighter-rouge">qa</code> profile of the <code class="highlighter-rouge">cas</code> application, you should see the <em>decrypted value</em> in the results:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> casuser:Mellon https://config.example.org:8888/casconfigserver/cas/qa | jq
</code></pre></div></div>

<p>That’s it for now. Let’s move onto the CAS server configuration and let it fetch settings from the Config server.</p>

<h2 id="cas-server-configuration">CAS Server Configuration</h2>

<p>The task at hand is to describe the Spring Cloud Config server to the CAS server so it can begin to configure itself via provided settings. To do so, you want to start with the <a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a>, clone the project and then put the following settings into a <code class="highlighter-rouge">src/main/resources/bootstrap.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">cas</span>

<span class="py">spring.profiles.active</span><span class="p">=</span><span class="s">default</span>

<span class="py">spring.cloud.config.uri</span><span class="p">=</span><span class="s">https://casuser:Mellon@config.example.org.unicon.net:8888/casconfigserver</span>
<span class="py">spring.cloud.config.profile</span><span class="p">=</span><span class="s">qa</span>
<span class="py">spring.cloud.config.label</span><span class="p">=</span><span class="s">master</span>

<span class="py">spring.cloud.config.enabled</span><span class="p">=</span><span class="s">true</span>

<span class="py">spring.cloud.config.watch.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.cloud.config.watch.initialDelay</span><span class="p">=</span><span class="s">30000</span>
<span class="py">spring.cloud.config.watch.delay</span><span class="p">=</span><span class="s">1000</span>

<span class="py">spring.cloud.config.fail-fast</span><span class="p">=</span><span class="s">true</span>
<span class="py">health.config.enabled</span><span class="p">=</span><span class="s">true</span>
</code></pre></div></div>

<p>In summary, we have the Spring Cloud config enabled with a location to the Config server. Next, we teach CAS to activate the <code class="highlighter-rouge">qa</code> profile when it asks for configuration settings, and we switch the CAS server application profile to <code class="highlighter-rouge">default</code> to disable the standalone strategy of locating settings. As for the other settings, hold onto them right now and we’ll review them in just a bit.</p>

<p>The <code class="highlighter-rouge">label</code> setting is useful for rolling back to previous versions of configuration; with the default Config Server implementation it can be a git label, branch name or commit id. A label can also be provided as a comma-separated list, in which case the items in the list are tried one-by-one until one succeeds. This can be useful when working on a feature branch, for instance, when you might want to align the config label with your branch, but make it optional.</p>

<p>So at this point, our expectation is that CAS will load its own <code class="highlighter-rouge">application.properties</code> file by default which has a bunch of settings that for instance deal with SSL, keystores, ports, etc. Then we expect CAS to load any and all settings from the Spring Cloud config server that are associated with <code class="highlighter-rouge">cas</code> and <code class="highlighter-rouge">qa</code> where these settings should override anything that CAS by default handles and provides. This means that when it’s all said and done, our CAS server should be running on port <code class="highlighter-rouge">8555</code> (as opposed to the default <code class="highlighter-rouge">8443</code>) and the static credentials used to authenticate users should include the username/password <code class="highlighter-rouge">casuser</code> and <code class="highlighter-rouge">QASomething</code> (as opposed to the default <code class="highlighter-rouge">casuser</code> and <code class="highlighter-rouge">Mellon</code>).</p>

<p>Right?</p>

<p>If you have followed the story so far, crank up the your CAS server deployment and examine the above scenario. Works as advertised, doesn’t it?!</p>

<h3 id="refresh--reload">Refresh &amp; Reload</h3>

<p>The CAS spring cloud configuration server is constantly monitoring changes to the underlying property sources automatically but has no way to broadcast those changes to its own clients, such as the CAS server itself. Therefore, in order to broadcast such change events, CAS presents various endpoints that allow the user to <a href="https://apereo.github.io/cas/development/configuration/Configuration-Management-Reload.html">refresh the configuration</a> as needed. This means that an adopter would simply change a required CAS setting and then would submit a request to CAS to <em>refresh</em> its current state. At runtime! All CAS internal components that are affected by the external change are quietly reloaded and the setting takes immediate effect, completely removing the need for container restarts or CAS re-deployments.</p>

<p>In order to handle automatic updates to CAS settings from the Spring Cloud Config server, we can try the following:</p>

<p>First, we are going to switch the CAS server to activate the <code class="highlighter-rouge">dev</code> profile (instead of the current <code class="highlighter-rouge">qa</code>) when querying for settings in the <code class="highlighter-rouge">bootstrap.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.cloud.config.profile</span><span class="p">=</span><span class="s">dev</span>
</code></pre></div></div>

<p>Then, we are going to modify and commit the <code class="highlighter-rouge">cas-dev.properties</code> file of the Spring Cloud Config server in our Git repository to enable CAS actuator endpoints by default which will allow us to invoke the <code class="highlighter-rouge">actuator/refresh</code> endpoint provided by Spring Boot:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">management.endpoints.web.exposure.include</span><span class="p">=</span><span class="s">*</span>
<span class="py">management.endpoints.enabled-by-default</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.monitor.endpoints.endpoint.defaults.access</span><span class="p">=</span><span class="s">AUTHENTICATED</span>
<span class="py">spring.security.user.name</span><span class="p">=</span><span class="s">casuser</span>
<span class="py">spring.security.user.password</span><span class="p">=</span><span class="s">Mellon</span>
</code></pre></div></div>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />The above collection of settings <strong>MUST</strong> only be used for demo purposes and serve as an <strong>EXAMPLE</strong>. It is not wise to enable and expose all actuator endpoints to the web and certainly, the security of the exposed endpoints should be taken into account very seriously. None of the CAS or Spring Boot actuator endpoints are enabled by default. For production, you should carefully choose which endpoints to expose.
</div>

<p>Once the changes are committed, we can switch back to the CAS server and re-run it one more time for it to pick up the <code class="highlighter-rouge">dev</code> profile settings and give us access to the relevant endpoints. When the CAS server is up, try invoking the <code class="highlighter-rouge">refresh</code> endpoint of the CAS server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-k</span> <span class="nt">-u</span> casuser:Mellon https://sso.example.org:8555/cas/actuator/refresh <span class="nt">-d</span> <span class="o">{}</span> <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span>
</code></pre></div></div>

<p>Watch the CAS server logs where you see something like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO [...CasConfigurationEventListener] - &lt;Refreshing CAS configuration. Stand by...&gt;
</code></pre></div></div>

<p>Let’s change something then. Switch over to the <code class="highlighter-rouge">cas-dev.properties</code> file of the Spring Cloud Config server and change and commit the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.accept.users</span><span class="p">=</span><span class="s">casuser::Developers</span>
</code></pre></div></div>

<p>Once the change is committed, invoke the refresh endpoint again just as before and observe the output:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="s2">"config.client.version"</span><span class="p">,</span><span class="s2">"cas.authn.accept.users"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>At this point, we should be able to pull up the CAS server in the browser and log in using <code class="highlighter-rouge">casuser</code> and <code class="highlighter-rouge">Developers</code> as credentials. Right? Give it a shot. Works as advertised, doesn’t it?!</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />CAS components that qualify for the refresh operations need to have been marked with a special Java annotation that is <code>@RefreshScope</code>. If you find that the refresh operation does not actually do its job, chances are the components that are affected and controlled by the setting are not marked that way. A pull request should fix that right up!</div>

<p>This is very handy. You can make a change to a given application and profile in a centralized configuration server and simply invoke the client, that is the CAS server to refresh itself. Imagine the possibilities with distributed development and configuration management!</p>

<h3 id="what-about">What About…</h3>

<p>There a few things that we have yet to address that would be outside the scope of this document. Here they are:</p>

<h4 id="spring-cloud-config-bus">Spring Cloud Config Bus</h4>

<p>If we have more than one CAS server we need to invoke the <code class="highlighter-rouge">refresh</code> endpoint for each and every single server node for it to refresh itself and pick up changes. To solve this problem, we can use Spring Cloud Bus. The bus acts as the communication channel across all CAS server nodes and can be backed via RabbitMQ, Kafka, Redis, etc. Each CAS server will be connected to the bus and gains a special endpoint called <code class="highlighter-rouge">bus-refresh</code>. Calling this endpoint will cause the receiving node to:</p>

<ul>
  <li>Get the latest configuration from the config server and update its configuration annotated by <code class="highlighter-rouge">@RefreshScope</code></li>
  <li>Send a message to the bus informing about refresh event</li>
  <li>All subscribed CAS nodes will update their configuration as well</li>
</ul>

<h4 id="spring-cloud-config-monitor">Spring Cloud Config Monitor</h4>

<p>How does the Spring Cloud Config server detect changes from property sources? Could we make that process automatic, and have it broadcast a notification to CAS server nodes? This is where the Spring Cloud Config Monitor comes in handy. Similar to the above, the Config server can take advantage of this monitor that may be backed by a bus via AMQP. As changes are detected, they are broadcasted via events on the bus for the receiving CAS nodes to recognize and update themselves automatically, without manual refresh invocations.</p>

<h2 id="final-thoughts">Final Thoughts</h2>

<p>So, as you can observe there is quite a lot involved here to make for a cloud-ready distributed configuration management system. For many CAS deployments, this might seem overkill as most simply just rely on a standalone type of deployment where there is only a couple of CAS server nodes each feeding off of a simple <code class="highlighter-rouge">cas.properties</code> file adjacent to the node itself. It is true that the setting up CAS in the cloud using the described strategies in this post can take quite a bit of time and expertise. Thus, evaluate options carefully before jumping into coolness. If you have a strategic vision of managing configuration in distributed cloud-ready fashion, this is a good long-term investment. If you are thinking about centralizing application configuration across your entire institution and manage the configuration in a distributed and real-time fashion, it’s worth it to go through the setup. If you have use cases that require configuration changes in real-time without downtime and restarts in a distributed environment, it makes sense to explore such options. Otherwise, you may find the pain and the cons outweigh the pros.</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/10/25/cas6-cloud-config-server/</guid>
                <description>
                    
                    CAS distributed configuration management using Spring Cloud Server for fun and profit. Learn how to centralize and setup configuration and property sources as part of the Cloud Config server and how to connect your Apereo CAS deployment to the Cloud Config server to receive real-time configuration updates per environment and deployment tier.
                    
                </description>
                <pubDate>Thu, 25 Oct 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Spring Boot Admin Integration</title>
                <link>https://apereo.github.io/2018/10/22/cas6-springboot-admin-server/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p><a href="https://github.com/codecentric/spring-boot-admin">Spring Boot Admin</a> is a community project to manage and monitor Spring Boot applications such as Apereo CAS. The admin server presents an AngularJS-based UI that interacts with the <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">actuator endpoints</a> provided by Spring Boot in CAS. One CAS has registered itself with the admin server, either using the <em>Spring Admin Client</em> via HTTP or as part of discovery using technologies such as Eureka, Consul, etc, the admin server can begin to provide feature to monitor CAS for health status, JVM &amp; memory metrics, environment settings, thread dumps, audit data, logs, etc.</p>

<p>While the CAS integration with the Spring Boot Admin server has been available for some time (likely since CAS <code class="highlighter-rouge">5.1.x</code>), in this tutorial we will focus on how to get the latest version of <a href="https://apereo.github.io/cas/development/installation/Configuring-Monitoring-Administration.html">Apereo CAS integrated with the Admin server</a>. At a high-level, we need to accomplish the following:</p>

<ul>
  <li>Deploy and configure the Spring Boot Admin server</li>
  <li>Configure CAS to register with the Spring Boot Admin server</li>
</ul>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">6.0.0-RC3</code></li>
  <li>Java 11</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a> (The <code class="highlighter-rouge">master</code> branch specifically)</li>
  <li><a href="https://github.com/apereo/cas-bootadmin-overlay">Spring Boot Admin overlay</a></li>
  <li><a href="https://stedolan.github.io/jq/">CLI JSON Processor <code class="highlighter-rouge">jq</code></a></li>
</ul>

<h2 id="spring-boot-admin-server-configuration">Spring Boot Admin Server Configuration</h2>

<p>The Spring Boot Admin server runs a standalone Spring Boot application on its own with a setup that is very similar to the CAS server itself. There is a <a href="https://github.com/apereo/cas-bootadmin-overlay">WAR overlay</a> that can be used to configure and deploy the server. Once you clone the Admin overlay project, you may need to create a <code class="highlighter-rouge">src/main/resources/application.properties</code> to control the behavior of the Admin server. By default, the application runs on port <code class="highlighter-rouge">8444</code> and does require SSL with a keystore that is expected at <code class="highlighter-rouge">file:/etc/cas/thekeystore</code>. The default settings should match the following:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">server.port</span><span class="p">=</span><span class="s">8444</span>

<span class="py">server.ssl.key-store</span><span class="p">=</span><span class="s">file:/etc/cas/thekeystore</span>
<span class="py">server.ssl.key-store-password</span><span class="p">=</span><span class="s">changeit</span>
<span class="py">server.ssl.key-password</span><span class="p">=</span><span class="s">changeit</span>

<span class="c"># Protect the boot-admin endpoints for basic/form authn
</span><span class="py">spring.security.user.name</span><span class="p">=</span><span class="s">casuser</span>
<span class="py">spring.security.user.password</span><span class="p">=</span><span class="s">e3f98098-edb5-4217-9dcb-ad04999a8794</span>
</code></pre></div></div>

<p>Given the Admin server itself is based on top of Spring Boot, all relevant Spring Boot settings here do also apply to control the general behavior of the web application. There are also many other settings available to tweak the behavior of the Admin server functionality itself. For a more comprehensive list, please see the <a href="https://codecentric.github.io/spring-boot-admin/current">Spring Boot Admin documentation</a>.</p>

<p>Once you’re ready, execute the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh run
</code></pre></div></div>

<p>…at which point a successful startup attempt would demonstrate the following in the logs:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO [org.apereo.cas.CasSpringBootAdminServerWebApplication] - &lt;No active profile set, falling back to default profiles: default&gt;
...
INFO [org.springframework.boot.web.embedded.tomcat.TomcatWebServer] - &lt;Tomcat started on port(s): 8444 (https) with context path ''&gt;
...
INFO [org.apereo.cas.CasSpringBootAdminServerWebApplication] - &lt;Started CasSpringBootAdminServerWebApplication in 20.798
</code></pre></div></div>

<p>…which allows you to navigate to Admin server in your browser at <code class="highlighter-rouge">https://admin.example.org:8444</code>:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47254172-3b859700-d46b-11e8-8ea2-9d42cb7407d6.png" alt="image" /></p>

<p>There is nothing registered with the Admin server yet. As the next step, we will connect our CAS server to the Admin server.</p>

<h2 id="cas-server-configuration">CAS Server Configuration</h2>

<p>Each individual CAS server is given the ability to auto-register itself with the Admin server. This is done using the following module that should go into the CAS overlay:</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-support-bootadmin-client:${project.'cas.version'}"</span>
</code></pre></div></div>

<p>Of course, we need to teach CAS about our Admin server using the <code class="highlighter-rouge">cas.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.boot.admin.client.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.boot.admin.client.url</span><span class="p">=</span><span class="s">https://admin.example.org:8444</span>
<span class="py">spring.boot.admin.client.instance.management-base-url</span><span class="p">=</span><span class="s">https://sso.example.org/cas</span>
</code></pre></div></div>

<p>So, our CAS server is running on <code class="highlighter-rouge">https://sso.example.org/cas</code> which presents a number of <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">actuator endpoints</a> that are used by the Admin server to monitor status and report results. Therefore, we will need to enable the endpoints in CAS in <code class="highlighter-rouge">cas.properties</code> so they may be consumable by the Admin server:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">management.endpoints.enabled-by-default</span><span class="p">=</span><span class="s">true</span>
<span class="py">management.endpoints.web.exposure.include</span><span class="p">=</span><span class="s">*</span>

<span class="py">spring.security.user.name</span><span class="p">=</span><span class="s">casuser</span>
<span class="py">spring.security.user.password</span><span class="p">=</span><span class="s">Mellon</span>

<span class="py">cas.monitor.endpoints.endpoint.defaults.access</span><span class="p">=</span><span class="s">AUTHENTICATED</span>
</code></pre></div></div>

<p>These settings are primarily offered and controlled by Spring Boot and accomplish the following:</p>

<ul>
  <li>Enable all actuator endpoints by default.</li>
  <li>Expose all actuator endpoints over the web via http.</li>
  <li>Secure all actuator endpoints using basic authentication where the master credentials are <code class="highlighter-rouge">casuser</code> and <code class="highlighter-rouge">Mellon</code>.</li>
</ul>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />The above collection of settings <strong>MUST</strong> only be used for demo purposes and serve as an <strong>EXAMPLE</strong>. It is not wise to enable and expose all actuator endpoints to the web and certainly, the security of the exposed endpoints should be taken into account very seriously. None of the CAS or Spring Boot actuator endpoints are enabled by default. For production you should carefully choose which endpoints to expose.
</div>

<p>To verify, you can try to hit a few of the endpoints to see the behavior in action:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-u</span> casuser:Mellon <span class="nt">-k</span> https://sso.example.org/cas/actuator/status | jq
</code></pre></div></div>

<p>…where you get back:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"health"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"misaghmoayyed"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"server"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://sso.example.org/cas"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6.0.0-RC3 - ..."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>You can also try hitting <code class="highlighter-rouge">actuator/health</code>, <code class="highlighter-rouge">actuator/info</code> and <a href="(https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html)">many others</a>.</p>

<p>Now that are endpoints are enabled and secured, we need to configure CAS to use our security credentials when contacting the Admin server as well:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.boot.admin.client.instance.metadata.user.name</span><span class="p">=</span><span class="s">casuser</span>
<span class="py">spring.boot.admin.client.instance.metadata.user.password</span><span class="p">=</span><span class="s">Mellon</span>

<span class="c"># In case Spring Boot Admin endpoints are protected via basic authn
</span><span class="py">spring.boot.admin.client.username</span><span class="p">=</span><span class="s">casuser</span>
<span class="py">spring.boot.admin.client.password</span><span class="p">=</span><span class="s">e3f98098-edb5-4217-9dcb-ad04999a8794</span>
</code></pre></div></div>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />While the actuator endpoints in CAS are protected in some fashion, the endpoints of the Spring Boot Admin server that are responsible for handling registration requests and more are not by default protected using the existing overlay. This is an item that will likely get worked out before the final CAS release.&lt;/a&gt;.
</div>

<p>When you build and deploy CAS next, the Admin server should properly recognize the registration request and display something like this:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47254581-58bd6400-d471-11e8-9eb4-75709190355e.png" alt="image" /></p>

<p>…where you can drill into the app and look at various screens and monitoring activity. For example, check out the available http web mappings and URLs:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47254701-a6869c00-d472-11e8-9e54-2123ae63c414.png" alt="image" /></p>

<p>…or logging configuration:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47254710-ca49e200-d472-11e8-94e8-7cb5a711f5a7.png" alt="image" /></p>

<p>There is a lot more you can do with the Admin server to add security, custom notifications, etc. Please see the <a href="https://codecentric.github.io/spring-boot-admin/current">Spring Boot Admin documentation</a>.</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/10/22/cas6-springboot-admin-server/</guid>
                <description>
                    
                    Learn to manage and monitor your Apereo CAS deployment using the Spring Boot Admin server and Spring Boot Actuator endpoints.
                    
                </description>
                <pubDate>Mon, 22 Oct 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Fun with HashiCorp Consul</title>
                <link>https://apereo.github.io/2018/10/22/cas6-consul-discovery/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>Consul is a distributed, highly-available, and multi-datacenter aware tool for service discovery, configuration, and orchestration. Consul enables rapid deployment, configuration, and maintenance of service-oriented architectures at a massive scale. For more information, please see the <a href="https://www.consul.io/">consul documentation</a>.</p>

<p>The <a href="https://apereo.github.io/cas/development/installation/Service-Discovery-Guide-Consul.html">CAS integration with Consul</a> has been available for some time and comes in multiple flavors. First, the server can use Consul for service discovery which is one of the key tenets of a cloud-based HA architecture. As Josh Long puts it:</p>

<blockquote>
  <p>A service registry is a phone book for your microservices. Each service registers itself with the service registry and tells the registry where it lives (host, port, node name) and perhaps other service-specific metadata - things that other services can use to make informed decisions about it.</p>
</blockquote>

<p>In our case, we could have each CAS server instance in a cluster register itself with the discovery server automatically, (i.e. the CAS server is a client of the discovery server), and then have individual discovery-aware CAS clients query the discovery server to figure out the availability and location of each CAS server node. Throw in a software load-balancer like <a href="https://github.com/Netflix/ribbon">Netflix Ribbon</a> and things begin to get interesting.</p>

<div class="alert alert-success">
  <strong>Netflix Eureka</strong><br />A similiar integration with <a href="https://apereo.github.io/cas/development/installation/Service-Discovery-Guide-Eureka.html">Netflix Eureka Server</a> is also available and supported by CAS.
</div>

<p>The other available <a href="https://apereo.github.io/cas/development/installation/Service-Discovery-Guide-Consul.html">CAS integration with Consul</a> deals with managing distributed configuration using the Consul Key/Value store. Consul provides a Key/Value Store for storing configuration and other metadata. CAS takes advantage of the <a href="http://cloud.spring.io/spring-cloud-consul/single/spring-cloud-consul.html">Spring Cloud Consul Config integration library</a> to fetch such configuration and metadata as an alternative to the <a href="https://apereo.github.io/cas/development/configuration/Configuration-Server-Management.html">Config Server and Client</a>.</p>

<p>To learn more about the Consul Key/Value store, please <a href="https://www.consul.io/api/kv.html">see this page</a>.</p>

<p>In this tutorial, we will focus on a <em>simple walkthrough</em> of how to integrate Consul with CAS for both service discovery and configuration management. Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">6.0.0-RC3</code></li>
  <li>Java 11</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Overlay</a> (The <code class="highlighter-rouge">master</code> branch specifically)</li>
  <li><a href="https://stedolan.github.io/jq/">CLI JSON Processor <code class="highlighter-rouge">jq</code></a></li>
  <li><a href="https://www.docker.com/get-started">Docker</a></li>
</ul>

<h2 id="consul-configuration">Consul Configuration</h2>

<p>To configure a simple Consul server, we can use the <a href="https://hub.docker.com/_/consul/">available Docker image</a> which is perfectly good for demos and testing. Use the following command to run the Consul server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--name</span><span class="o">=</span>consul <span class="nt">-p8500</span>:8500 <span class="nt">-e</span> <span class="nv">CONSUL_BIND_INTERFACE</span><span class="o">=</span>eth0 consul
</code></pre></div></div>

<p>By default, Consul allows connections to these ports only from the loopback interface (<code class="highlighter-rouge">127.0.0.1</code>). When you run the Consul agent, it listens on 6 ports all of which serve different functions. The three ports essential to our discussion are:</p>

<ul>
  <li>HTTP API (default port: <code class="highlighter-rouge">8500</code>): handles HTTP API requests from clients</li>
  <li>CLI RPC (default port: <code class="highlighter-rouge">8400</code>): handles requests from CLI</li>
  <li>DNS (default port: <code class="highlighter-rouge">8600</code>): answers DNS queries</li>
</ul>

<p>Our Docker command runs a completely in-memory Consul server agent with default bridge networking and no services exposed on the host, which is useful for development but <strong>SHOULD NOT</strong> be used in production. Once you have the server running, you can point your browser to <code class="highlighter-rouge">http://localhost:8500/ui</code> where you will see something like this:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47265207-22471e00-d531-11e8-9291-3c2970b18c6e.png" alt="image" /></p>

<p>There is nothing registered with the server yet. As the next step, we will connect the CAS server to Consul.</p>

<h2 id="cas-server-configuration">CAS Server Configuration</h2>

<h3 id="service-discovery">Service Discovery</h3>

<h4 id="registration">Registration</h4>

<p>Each individual CAS server is given the ability to auto-register itself with the Consul server. This is done using the following module that should go into the CAS overlay:</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">compile</span> <span class="s2">"org.apereo.cas:cas-server-support-consul-client:${project.'cas.version'}"</span>
</code></pre></div></div>

<p>Of course, we need to teach CAS about our Consul server using the <code class="highlighter-rouge">cas.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.cloud.consul.port</span><span class="p">=</span><span class="s">8500</span>
<span class="py">spring.cloud.consul.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.cloud.consul.host</span><span class="p">=</span><span class="s">localhost</span>

<span class="py">spring.cloud.consul.discovery.heartbeat.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.cloud.consul.discovery.heartbeat.ttlValue</span><span class="p">=</span><span class="s">60</span>
<span class="py">spring.cloud.consul.discovery.heartbeat.ttlUnit</span><span class="p">=</span><span class="s">s</span>
</code></pre></div></div>

<p>These settings are primarily offered and controlled by Spring Cloud that teaches CAS the location of the Consul server and how it may register itself with that server as a Consul client.</p>

<p>When you build and deploy CAS next, the Consul server should properly recognize the registration request and display something like this:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47265240-b0230900-d531-11e8-9ed8-dc8a6ce30e63.png" alt="image" /></p>

<p>…where you can drill into the <code class="highlighter-rouge">cas</code> service and look at various screens:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47265243-ca5ce700-d531-11e8-95dd-5757264d00a6.png" alt="image" /></p>

<p>As extra proof, CAS logs would indicate the following too:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO [ConsulServiceRegistry] - &lt;Registering service with consul: NewService{id='cas-8443', name='cas'...
</code></pre></div></div>

<h4 id="discovery">Discovery</h4>

<p>So far, we have only been reviewing the service registration aspect. As the next step, you would want to build and configure clients that are able to contact the discovery server, asking about available <code class="highlighter-rouge">CAS</code> instances. Spring Cloud makes this rather easy. As an example your Java client would look something like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableDiscoveryClient</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleClientApplication</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">SampleClientApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@RestController</span>
<span class="kd">class</span> <span class="nc">ServiceInstanceRestController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">DiscoveryClient</span> <span class="n">discoveryClient</span><span class="o">;</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/service-instances/{applicationName}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ServiceInstance</span><span class="o">&gt;</span> <span class="nf">serviceInstances</span><span class="o">(</span>
            <span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">applicationName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">discoveryClient</span><span class="o">.</span><span class="na">getInstances</span><span class="o">(</span><span class="n">applicationName</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>…where you’d have:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.application.name</span><span class="p">=</span><span class="s">cas</span>
</code></pre></div></div>

<p>With the above code snippet, our sample CAS client defines a Spring MVC REST endpoint that returns an enumeration of all the <code class="highlighter-rouge">ServiceInstance</code> instances registered in the Consul registry. From then on, the client may proceed deal with each <code class="highlighter-rouge">ServiceInstance</code> that would be refreshed automatically as CAS servers come and go in the discovery server.</p>

<h3 id="configuration-management">Configuration Management</h3>

<p>Consul provides a Key/Value Store for storing configuration and other metadata. Configuration is loaded into the CAS environment during the special <em>bootstrap</em> phase at runtime. Configuration is stored in the <code class="highlighter-rouge">/config</code> folder by default. Multiple <code class="highlighter-rouge">PropertySource</code> instances are created based on the application’s name and the active profiles that mimic the Spring Cloud Config order of resolving properties.</p>

<p>For example, an application with the name <code class="highlighter-rouge">cas</code> and with the <code class="highlighter-rouge">dev</code> profile will have the following property sources created:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>config/cas,dev/
config/cas/
config/application,dev/
config/application/
</code></pre></div></div>

<p>The most specific property source is at the top, with the least specific at the bottom. Properties in the <code class="highlighter-rouge">config/application</code> folder are applicable to all applications using consul for configuration. Properties in the <code class="highlighter-rouge">config/cas/</code> folder are only available to the instances of the service named cas.</p>

<div class="alert alert-info">
  <strong>Configuration</strong><br />There is no other extra step required in CAS to make distributed configuration management work with Consul. If you have the discovery piece working, you will be able to automatically take advantage of the Key/Value store.
</div>

<p>So let’s create <code class="highlighter-rouge">config/cas/</code> folder in Consul and add a sample property <code class="highlighter-rouge">cas.authn.accept.users</code> which controls static authentication in CAS with a list of hardcoded credentials:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/47265712-195a4a80-d539-11e8-9124-b2421e53c7ed.png" alt="image" /></p>

<p>Once you save the setting, CAS logs should indicate the application context refreshing to recognize the change:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO [RefreshEventListener] - &lt;Refresh keys changed: [cas.authn.accept.users]&gt;
</code></pre></div></div>

<p>After the change is picked up, you should be able to log into CAS using <code class="highlighter-rouge">casuser</code> and <code class="highlighter-rouge">Misagh</code> as the credentials! Just as well, we can delete the setting from Consul, let CAS pick up the change and we should be able to fall back onto the default credentials for static authentication which are <code class="highlighter-rouge">casuser</code> and <code class="highlighter-rouge">Mellon</code>.</p>

<p>How is this possible? There is a thing called <em>Consul Config Watch</em> which in CAS takes advantage of the ability of consul to watch a key prefix. It makes a blocking Consul HTTP API call to determine if any relevant configuration data has changed for the current application. If there is new configuration data a <code class="highlighter-rouge">Refresh Event</code> is published and captured by CAS to refresh the status of the application context, as is demonstrated by the logs.</p>

<p>Pretty cool!</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/10/22/cas6-consul-discovery/</guid>
                <description>
                    
                    Integrate HashiCorp Consul with CAS for service discovery and distributed configuration management.
                    
                </description>
                <pubDate>Mon, 22 Oct 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Multifactor Authentication with RADIUS</title>
                <link>https://apereo.github.io/2018/10/18/cas5-radius-mfa-authn/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The ability to authenticate credentials using the RADIUS protocol and a compliant RADIUS server has been <a href="https://apereo.github.io/cas/development/mfa/RADIUS-Authentication.html">available in CAS</a> for some time. In more recent CAS versions, this capability has been improved to support multifactor authentication scenarios by allowing CAS to recognize the <code class="highlighter-rouge">Access-Challenge</code> response type. This is a special signal sent by the RADIUS server requesting more information in order to allow access. The authentication flow is typically composed of the following steps:</p>

<ul>
  <li>Primary authentication via RADIUS typically using username+password credentials.</li>
  <li>Capturing the <code class="highlighter-rouge">Access-Challenge</code> and the session <code class="highlighter-rouge">State</code> passed back from the RADIUS server.</li>
  <li>RADIUS server provides the end-user with a one-time code, typically via SMS, email or mobile app.</li>
  <li>Reroute the next step in the authentication flow, allowing the end-user to enter the code.</li>
  <li>Submit the code and the previous <code class="highlighter-rouge">State</code> to the RADIUS server.</li>
  <li>Validate the final response which should be an <code class="highlighter-rouge">Access-Accept</code> type, if all goes well.</li>
</ul>

<p>A patch <a href="https://github.com/apereo/cas/pull/3201/files">was submitted</a> to the CAS project a while back to handle this exact scenario. This brief tutorial incorporates this patch into the CAS software and outlines the necessary configuration steps required to deliver multifactor authentication via RADIUS as noted above.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.6</code></li>
  <li>Java <code class="highlighter-rouge">8</code></li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h2 id="configuration">Configuration</h2>

<h3 id="radius-setup">RADIUS Setup</h3>

<p>The setup is fairly simple, given CAS does all of the heavy-lifting. First, we need to prepare the CAS overlay with the right set of dependencies to enable RADIUS functionality:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cas-server-support-radius<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cas-server-support-radius-mfa<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>…and next, we need to teach CAS about our RADIUS setup:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Handle primary authentication via RADIUS (i.e. username+password)
</span><span class="py">cas.authn.radius.server.protocol</span><span class="p">=</span><span class="s">MSCHAPv2</span>
<span class="py">cas.authn.radius.client.sharedSecret</span><span class="p">=</span><span class="s">xyz</span>
<span class="py">cas.authn.radius.client.inetAddress</span><span class="p">=</span><span class="s">1.2.3.4</span>

<span class="c"># Handle MFA via RADIUS (i.e. one-time code)
</span><span class="py">cas.authn.mfa.radius.server.protocol</span><span class="p">=</span><span class="s">MSCHAPv2</span>
<span class="py">cas.authn.mfa.radius.client.sharedSecret</span><span class="p">=</span><span class="s">xyz</span>
<span class="py">cas.authn.mfa.radius.client.inetAddress</span><span class="p">=</span><span class="s">1.2.3.4</span>

<span class="c"># Signal webflow to handle MFA via RADIUS
</span><span class="py">cas.authn.mfa.radius.id</span><span class="p">=</span><span class="s">mfa-radius</span>

<span class="py">cas.authn.mfa.radius.allowedAuthenticationAttempts</span><span class="p">=</span><span class="s">1</span>
</code></pre></div></div>

<p>That should do it. When credentials are validated via RADIUS as part of primary authentication, the user is routed to the next screen to enter the code provided by the RADIUS server via SMS, etc. Once entered, CAS will submit the code as well as any previous session state back to the RADIUS server which would have it validate the request and produce a successful response that allows CAS to collect attributes and establish a single sign-on session.</p>

<p>Note that we are also configuring CAS to limit the number of authentication attempts to <code class="highlighter-rouge">1</code>, meaning after the first failed attempt at providing a valid token CAS would reject MFA and should route back to the login screen to restart the flow.</p>

<h3 id="test-radius">Test RADIUS</h3>

<p>To test the basic tenants of this scenario using CAS APIs, the following code snippet may be used as an example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">RadiusClientFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RadiusClientFactory</span><span class="o">(</span><span class="mi">1813</span><span class="o">,</span> <span class="mi">1812</span><span class="o">,</span> <span class="mi">2000</span><span class="o">,</span> <span class="s">"1.2.3.4"</span><span class="o">,</span> <span class="s">"xyz"</span><span class="o">);</span>
<span class="n">JRadiusServerImpl</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JRadiusServerImpl</span><span class="o">(</span><span class="n">RadiusProtocol</span><span class="o">.</span><span class="na">MSCHAPv2</span><span class="o">,</span> <span class="n">factory</span><span class="o">);</span>
<span class="n">RadiusResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">authenticate</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="s">"password"</span><span class="o">,</span> <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Enter code: "</span><span class="o">);</span>
<span class="n">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>
<span class="n">String</span> <span class="n">code</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">nextLine</span><span class="o">();</span>

<span class="n">Optional</span><span class="o">&lt;</span><span class="n">Serializable</span><span class="o">&gt;</span> <span class="n">state</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">()</span>
    <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
    <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="o">.</span><span class="na">getAttributeName</span><span class="o">().</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"State"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">findFirst</span><span class="o">()</span>
    <span class="o">.</span><span class="na">get</span><span class="o">()</span>
    <span class="o">.</span><span class="na">getValue</span><span class="o">()</span>
    <span class="o">.</span><span class="na">getValueObject</span><span class="o">());</span>
<span class="n">RadiusResponse</span> <span class="n">mfaResponse</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">authenticate</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="n">code</span><span class="o">,</span> <span class="n">state</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">mfaResponse</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="ldap-attributes">LDAP Attributes</h3>

<p>Since RADIUS is used to handle primary authentication, we are going to try to switch to LDAP in order to fetch for user attributes. The following configuration should do the job:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cas.authn.attributeRepository.ldap[0].attributes.uid=uid
cas.authn.attributeRepository.ldap[0].attributes.displayName=displayName
cas.authn.attributeRepository.ldap[0].attributes.cn=commonName
cas.authn.attributeRepository.ldap[0].attributes.memberOf=memberOf

cas.authn.attributeRepository.ldap[0].ldapUrl=ldap://...
cas.authn.attributeRepository.ldap[0].useSsl=false
cas.authn.attributeRepository.ldap[0].useStartTls=false
cas.authn.attributeRepository.ldap[0].baseDn=dc=example,dc=edu
cas.authn.attributeRepository.ldap[0].searchFilter=uid={0}
cas.authn.attributeRepository.ldap[0].bindDn=...
cas.authn.attributeRepository.ldap[0].bindCredential=...

cas.personDirectory.principalAttribute=uid
</code></pre></div></div>

<p>We are instructing CAS to build the final authenticated Principal identified by the <code class="highlighter-rouge">uid</code> attribute (instead of whatever the user types into the login form as the credential id). We have some settings for the LDAP attribute repository that describe the LDAP server, and of course we have a section of settings for attribute mapping where we fetch <code class="highlighter-rouge">uid</code> and virtually rename/remap it to <code class="highlighter-rouge">uid</code> or we fetch <code class="highlighter-rouge">cn</code> and remap it to <code class="highlighter-rouge">commonName</code>, etc.</p>

<p>After the primary authentication event, the attribute repository kicks in to determine the needed attributes for the user by running the query <code class="highlighter-rouge">uid={0}</code> against the LDAP server  where <code class="highlighter-rouge">{0}</code> is replaced with the authenticated user id (typically the credential id). Once the user entry is located, attributes are fetched and mapped and the authenticated <code class="highlighter-rouge">Principal</code> from the CAS perspective has an identifier determined by the <code class="highlighter-rouge">uid</code> attribute as well as at most four extra <em>person</em> attributes attached to it, which can then be used for attribute release.</p>

<h2 id="credits">Credits</h2>

<p>Huge thanks to <a href="https://github.com/dodok1">Jozef Kotlar</a>, <a href="https://github.com/bosim">Bo Simonsen</a>, Jesper Grøndahl and many others who contributed guidance, code, and working examples to see this feature to completion.</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/10/18/cas5-radius-mfa-authn/</guid>
                <description>
                    
                    Learn how Apereo CAS may be configured to trigger multifactor authentication using a RADIUS server and its support for the Access-Challenge response type.
                    
                </description>
                <pubDate>Thu, 18 Oct 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS Vulnerability Disclosure</title>
                <link>https://apereo.github.io/2018/09/26/mfavulndisc/</link>
                <content:encoded>
                    <![CDATA[
                    <h1 id="overview">Overview</h1>

<p>This is the public version of an <a href="https://groups.google.com/a/apereo.org/forum/#!topic/cas-appsec-public/zXqxDN9rB8A">Apereo CAS project vulnerability disclosure</a>, describing an issue in CAS
where an adversary may be able to bypass the second factor (token) although MFA is requested during the login process.</p>

<p>This issue applies to all MFA providers <strong>except the Duo provider</strong> (which is therefore NOT vulnerable).</p>

<h1 id="affected-deployments">Affected Deployments</h1>

<p>The attack vector applies to all deployments of the CAS server for the versions:</p>

<ul>
  <li>5.3.0, 5.3.1 and 5.3.2</li>
  <li>lower or equal to 5.2.6.</li>
</ul>

<p>If you have deployed the version 5.3.0, 5.3.1 or 5.3.2, you <strong>MUST</strong> upgrade to the version 5.3.3.</p>

<p>If you have deployed a version lower or equal to version 5.2.6, you <strong>MUST</strong> upgrade to the version 5.2.7.</p>

<h1 id="severity">Severity</h1>

<p>This is a serious issue where successfully exercising this vulnerability allows the adversary
to bypass the second factor (token) required by the MFA policy.
This makes any MFA configuration to re-inforce security completely useless.</p>

<h1 id="patching">Patching</h1>

<p>Patch releases are available to address CAS vulnerable deployments.
Upgrades to the next patch version for each release should be a drop-in replacement.
The patch simply ensures that the MFA factor (token) is effectively required when MFA is requested.</p>

<h2 id="timeline">Timeline</h2>

<p>The issue was originally reported to the CAS application security team on August, 2018 and upon confirmation, CAS was patched.</p>

<h2 id="procedure">Procedure</h2>

<p>Modify your CAS overlay to point to the version <code class="highlighter-rouge">5.2.7</code> or <code class="highlighter-rouge">5.3.3</code>. A snippet of a <code class="highlighter-rouge">pom.xml</code> for a CAS overlay follows:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cas-server-webapp<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>war<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;cas.version&gt;</span>5.3.3<span class="nt">&lt;/cas.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre></div></div>

<h1 id="support">Support</h1>

<p>If you have questions on the details of this vulnerability and how it might be reproduced,
please contact <code class="highlighter-rouge">security@apereo.org</code> or <code class="highlighter-rouge">cas-appsec-public@apereo.org</code>.</p>

<h1 id="resources">Resources</h1>

<ul>
  <li><a href="https://groups.google.com/a/apereo.org/forum/#!topic/cas-appsec-public/zXqxDN9rB8A">Original Announcement</a></li>
  <li><a href="https://apereo.github.io/cas/developer/Sec-Vuln-Response.html">CAS Security Vulnerability Response Model</a></li>
</ul>

<p><a href="https://github.com/leleuj">Jérôme LELEU</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/09/26/mfavulndisc/</guid>
                <description>
                    
                    Disclosure of a security issue with the MFA features.
                    
                </description>
                <pubDate>Wed, 26 Sep 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 6.0.0 RC2 Feature Release</title>
                <link>https://apereo.github.io/2018/09/14/600rc2-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.3.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.3.0">June 29th, 2018</a>. Since then, the project has been moving forward with development of the next feature release that is tagged as <code class="highlighter-rouge">6.0.0</code>. Note that this is a <strong>major release</strong> of the CAS software which <em>may</em> present significant changes in architecture, configuration or behavior. Please review the <a href="https://apereo.github.io/cas/developer/Release-Policy.html">release policy</a> to learn more about the scope of the release.</p>

<p>This post intends to highlight some of the improvements and enhancements packed into the <strong>second</strong> release candidate in the <code class="highlighter-rouge">6.0.0</code> series.</p>

<p>You can read about the previous release candidate <a href="https://apereo.github.io/2018/08/03/600rc1-release/">here</a>.</p>

<h2 class="no_toc" id="shake-well-before-use">Shake Well Before Use</h2>

<p>We strongly recommend that you take advantage of the release candidates as they come out. Waiting for a <code class="highlighter-rouge">GA</code> release is only going to set you up for unpleasant surprises. A <code class="highlighter-rouge">GA</code> is simply <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">a tag and nothing more</a>. Note that CAS releases are <em>strictly</em> time-based releases; they are not scheduled or based on specific benchmarks, statistics or completion of features. To gain confidence in a particular release, it is strongly recommended that you start early by experimenting with release candidates and/or follow-up snapshots.</p>

<p>In order to start experimenting with release candidates, at any given time, you should be able to append <code class="highlighter-rouge">-SNAPSHOT</code> to the CAS version specified in order to take advantage of snapshot builds as changes are made and published.</p>

<h3 class="no_toc" id="overlay">Overlay</h3>

<p>In the <code class="highlighter-rouge">gradle.properties</code> of <a href="https://github.com/apereo/cas-overlay-template">the overlay</a>, adjust the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">casVersion</span><span class="p">=</span><span class="s">6.0.0-RC2</span>
</code></pre></div></div>

<h2 class="no_toc" id="changes">Changes</h2>

<ul id="markdown-toc">
  <li><a href="#new--noteworthy" id="markdown-toc-new--noteworthy">New &amp; Noteworthy</a>    <ul>
      <li><a href="#jdk-10" id="markdown-toc-jdk-10">JDK 10</a></li>
      <li><a href="#war-overlay" id="markdown-toc-war-overlay">WAR Overlay</a></li>
      <li><a href="#oauth2-uma" id="markdown-toc-oauth2-uma">OAuth2 UMA</a></li>
      <li><a href="#authentication-source-selection" id="markdown-toc-authentication-source-selection">Authentication Source Selection</a></li>
      <li><a href="#forgot-username" id="markdown-toc-forgot-username">Forgot Username</a></li>
      <li><a href="#oauth2-token-management" id="markdown-toc-oauth2-token-management">OAuth2 Token Management</a></li>
      <li><a href="#hazelcast-discovery-strategies" id="markdown-toc-hazelcast-discovery-strategies">Hazelcast Discovery Strategies</a></li>
    </ul>
  </li>
  <li><a href="#small-stuff" id="markdown-toc-small-stuff">Small Stuff</a></li>
  <li><a href="#library-upgrades" id="markdown-toc-library-upgrades">Library Upgrades</a></li>
  <li><a href="#resources" id="markdown-toc-resources">Resources</a></li>
  <li><a href="#get-involved" id="markdown-toc-get-involved">Get Involved</a></li>
  <li><a href="#credits" id="markdown-toc-credits">Credits</a></li>
</ul>

<h3 id="new--noteworthy">New &amp; Noteworthy</h3>

<h4 id="jdk-10">JDK 10</h4>

<p>Work continues to ensure CAS can support and build on top of JDK 11. At this time, a number of supporting libraries that handle code generation, test coverage
and static analysis are not quite ready for JDK 11, and a few more foundational frameworks such as Spring and Spring Boot have yet to be upgraded to a release friendly 
to JDK 11. In this release, the JDK requirement continues to stay at <code class="highlighter-rouge">10</code> with the <em>hopes</em> that said core components would be ready for JDK 11 around the time of 
the next release candidate.</p>

<p>Note that this release candidate builds on top of Spring framework <code class="highlighter-rouge">5.1</code> and Spring Boot <code class="highlighter-rouge">2.1</code>. The upgrade should provide improvements for CAS startup time and be ready in anticipation of the upcoming JDK <code class="highlighter-rouge">11</code> release.</p>

<h4 id="war-overlay">WAR Overlay</h4>

<p>The Maven WAR overlay template is now deprecated and moved aside. The reference overlay project simply resides <a href="https://github.com/apereo/cas-overlay-template">here</a> and is transformed to use the Gradle build tool instead. This is done to reduce maintenance overhead and simplify the deployment strategy while allowing future attempts to make auto-generation of the overlay as comfortable as possible.</p>

<h4 id="oauth2-uma">OAuth2 UMA</h4>

<p>A first pass at OAuth2 User-Managed Access is <a href="https://apereo.github.io/cas/development/protocol/OAuth-UMA-Protocol.html">now available</a>. This is very much a rough take
and will require some fine-tuning and tweaking in future iterations to fully make it spec-compliant and functional.</p>

<h4 id="authentication-source-selection">Authentication Source Selection</h4>

<p>In the event that there is more than one (primary) authentication source defined, CAS is given the ability to present the user with a choice in the login screen
to select the appropriate credential source before authenticating. This capability can also be automated using credential predicates if a pattern can formulated and linked
to a specific authentication source. This variation here is the less-automated way of selecting an authentication source, taking into account user input directly.</p>

<h4 id="forgot-username">Forgot Username</h4>

<p>The <em>Forgot your username?</em> scenario is now supported by the CAS password management facility.</p>

<h4 id="oauth2-token-management">OAuth2 Token Management</h4>

<p>Specific endpoints are provided as part of <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">CAS monitoring toolkit</a> 
to manage and revoke OAuth2 access and refresh tokens.</p>

<h4 id="hazelcast-discovery-strategies">Hazelcast Discovery Strategies</h4>

<p>CAS is now able to take advantage of Kubernetes for <a href="https://apereo.github.io/cas/development/installation/Hazelcast-Ticket-Registry.html">Hazelcast auto discovery of nodes</a>. Support for discovery strategies based on Docker Swarm is also included and available.</p>

<h3 id="small-stuff">Small Stuff</h3>

<ul>
  <li>Expired registered service definitions are now blocked by CAS as always, but are not strictly modified in the service registry as disabled services.</li>
  <li>A ton of improvements to the Travis CI integration tests to ensure performance and compliance. This area continues to improve.</li>
  <li>Release of authentication-level attributes, typically those related to protocols or those captured by metadata populators is now controlled via a central policy.</li>
  <li>Generation of <a href="https://apereo.github.io/cas/development/installation/Configuration-Metadata-Repository.html">CAS configuration metadata</a> is massaged to take into account enumerations and nested inner classes.</li>
  <li><a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">Delegated authentication</a> now attempts to check for SSO status before handing off the request to a provider.</li>
  <li>REST API authentication using X509 is now capable of TLS client authentication.</li>
  <li><a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">Delegated authentication</a> gains the ability to use path variables for client names instead of query parameters, for identity providers such as Azure.</li>
  <li>CAS documentation integrates with Angolia for its search capabilities.</li>
  <li><a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">SAML2 support in CAS</a> begins to support encrypted attributes as well as name ids.</li>
  <li>Minor bug fixes to database schema handling, log messages, MFA context validation, ticket serialization, and OATH validations.</li>
  <li>CAS <a href="https://apereo.github.io/cas/development/protocol/OIDC-Protocol.html">OpenID Connect support</a> gains a better handle on logout and session management.</li>
  <li>OAuth2 grant type selection is now enforced for relying parties, etc.</li>
  <li><a href="https://apereo.github.io/cas/development/installation/Memcached-Ticket-Registry.html">Kryo for memcached</a> continues to auto-register a few more components, specially with CAS has turned on MFA or delegated authentication.</li>
  <li><a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-Sessions.html#jdbc-session-replication">Session replication</a> can now be done using a JDBC backend.</li>
  <li><a href="https://apereo.github.io/cas/development/installation/YAML-Service-Management.html">Yaml Service Registry</a> is able to recognize both <code class="highlighter-rouge">.yml</code> and <code class="highlighter-rouge">.yaml</code> files.</li>
  <li><a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">Delegated authentication</a> to SAML identity providers gains a few bug fixes when resolving SP or IdP metadata over URLs. The service provider metadata generated by CAS can now optionally be signed using metadata signing keys.</li>
</ul>

<h3 id="library-upgrades">Library Upgrades</h3>

<ul>
  <li>Inspektr</li>
  <li>Pac4j</li>
  <li>Spring</li>
  <li>Spring Boot</li>
  <li>Spring Security</li>
  <li>Spring Security RSA</li>
  <li>Spring Data</li>
  <li>Spring Session</li>
  <li>Spring Cloud</li>
  <li>Oshi</li>
  <li>ActiveMQ</li>
  <li>jClouds</li>
  <li>JavaParser</li>
  <li>Commons Lang</li>
  <li>Commons Configuration</li>
  <li>Amazon AWS</li>
  <li>Google Maps</li>
  <li>UnboundID LDAP</li>
  <li>Twilio</li>
  <li>Nexmo</li>
  <li>Gradle</li>
  <li>Nimbus</li>
  <li>Apache Tomcat</li>
  <li>Hibernate</li>
</ul>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://apereo.github.io/cas/development/">Documentation</a></li>
  <li><a href="https://github.com/apereo/cas/milestones">Release Schedule</a></li>
  <li><a href="https://apereo.github.io/cas/developer/Release-Policy.html">Release Policy</a></li>
</ul>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="credits">Credits</h2>

<p>Big thanks to all who participate in the development of this release to submit patches and contribute improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/09/14/600rc2-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 6.0.0 RC2 release.
                    
                </description>
                <pubDate>Fri, 14 Sep 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - dotCMS SAML2 Integration</title>
                <link>https://apereo.github.io/2018/09/06/cas53-dotcms-saml2-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<div class="alert alert-info">
  <strong>Contributed Content</strong><br />Keith Conger of Colorado College, an active member of the CAS community, was kind enough to contribute this guide.
</div>

<p>dotCMS is an open source content management system (CMS) written in Java for managing content and content-driven sites and applications. As a SAML2 service provider, dotCMS can be integrated with CAS running as a SAML identity provider and this blog post provides a quick walkthrough of how to make that integration possible.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h1 id="configuration">Configuration</h1>

<p>First, ensure that your CAS deployment is equipped to act as a <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-SAML2-Authentication.html">SAML2 identity provider</a>. Next, you may also use the <a href="https://apereo.github.io/cas/5.3.x/installation/JSON-Service-Management.html">JSON Service Registry</a> to keep track of the dotCMS relying-party registration record in JSON definition files.</p>

<p>The JSON file to contain the dotCMS registration record would be as follows:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">org.apereo.cas.support.saml.services.SamlRegisteredService</span><span class="w">
  </span><span class="err">serviceId</span><span class="p">:</span><span class="w"> </span><span class="err">your-dotcms-entity-id</span><span class="w">
  </span><span class="err">name</span><span class="p">:</span><span class="w"> </span><span class="err">dotCMS</span><span class="w">
  </span><span class="err">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="err">description</span><span class="p">:</span><span class="w"> </span><span class="err">dotCMS</span><span class="w"> </span><span class="err">Content</span><span class="w"> </span><span class="err">Mangement</span><span class="w"> </span><span class="err">System</span><span class="w">
  </span><span class="err">attributeReleasePolicy</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">org.apereo.cas.services.ReturnAllowedAttributeReleasePolicy</span><span class="w">
    </span><span class="err">attributeFilter</span><span class="p">:</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">org.apereo.cas.services.support.RegisteredServiceMutantRegexAttributeFilter</span><span class="w">
      </span><span class="err">patterns</span><span class="p">:</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">java.util.LinkedHashMap</span><span class="w">
        </span><span class="err">memberOf</span><span class="p">:</span><span class="w"> </span><span class="err">(?&lt;=CN=)(</span><span class="p">[</span><span class="err">^</span><span class="p">,]</span><span class="err">+)-&gt;$</span><span class="mi">1</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="err">allowedAttributes</span><span class="p">:</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="err">java.util.ArrayList</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="err">mail</span><span class="w">
        </span><span class="err">givenName</span><span class="w">
        </span><span class="err">memberOf</span><span class="w">
        </span><span class="err">sn</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="err">metadataLocation</span><span class="p">:</span><span class="w"> </span><span class="err">https</span><span class="p">:</span><span class="err">//path.to.your.dotcmscloud.com/dotsaml/metadata/</span><span class="mi">3</span><span class="err">dd</span><span class="mi">4</span><span class="err">ad</span><span class="mi">1</span><span class="err">e-e</span><span class="mi">2</span><span class="err">ab</span><span class="mi">-492</span><span class="err">e-a</span><span class="mi">428-87</span><span class="err">af</span><span class="mi">35</span><span class="err">d</span><span class="mi">341</span><span class="err">fd</span><span class="w">
  </span><span class="err">signAssertions</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="err">skipGeneratingSubjectConfirmationNotBefore</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="err">signResponses</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A few things to point out:</p>

<ul>
  <li>You will of course need to adjust the <code class="highlighter-rouge">serviceId</code> and <code class="highlighter-rouge">metadataLocation</code> to match your data and dotCMS instance.</li>
  <li>Make sure the <code class="highlighter-rouge">AssertionConsumerService</code> endpoint in the dotCMS metadata contains the <code class="highlighter-rouge">urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect</code> binding.</li>
  <li>Make sure CAS has retrieved the allowed attributes (i.e. <code class="highlighter-rouge">mail</code>, <code class="highlighter-rouge">givenName</code>, etc) listed in the JSON definition file.</li>
  <li>Regarding the <code class="highlighter-rouge">memberOf</code> attribute, the values fetched from the directory are typically in the format of <code class="highlighter-rouge">CN=WebAdmin,OU=something,OU=something,DC=somewhere,DC=edu</code>. The service provider requires only the <code class="highlighter-rouge">CN</code> portion of the attribute value where CAS would need to produce <code class="highlighter-rouge">&lt;saml2:AttributeValue&gt;WebAdmin&lt;/saml2:AttributeValue&gt;</code> instead of <code class="highlighter-rouge">&lt;saml2:AttributeValue&gt;CN=WebAdmin,OU=something,OU=something,DC=somewhere,DC=edu&lt;/saml2:AttributeValue&gt;</code>. This bit is handled via the <code class="highlighter-rouge">RegisteredServiceMutantRegexAttributeFilter</code> element in the JSON file.</li>
</ul>

<h1 id="finale">Finale</h1>

<p>Thanks to Keith Conger of Colorado College who was kind enough to share the above integration notes. If you too have an integration with a well-known SAML2 service provider, please consider sharing that guide in form of a blog post here as well.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/09/06/cas53-dotcms-saml2-integration/</guid>
                <description>
                    
                    Learn how to integrate dotCMS, a Content Management System and Headless CMS, with Apereo CAS running as a SAML2 identity provider.
                    
                </description>
                <pubDate>Thu, 06 Sep 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Effective Software Troubleshooting Tactics</title>
                <link>https://apereo.github.io/2018/09/05/effective-diagnostics/</link>
                <content:encoded>
                    <![CDATA[
                    <p>As an <a href="https://unicon.net/solutions/identity-and-access-management">IAM consultant</a>, a good portion of my time throughout the day is spent troubleshooting issues, analyzing logs, helping client and colleagues figure out how to make sense of a seemingly impossible situation when it comes to production system failures, behavioral weirdness or just simply getting something to work per a piece of documentation. I have found that having a documented set of steps and methods proves helpful at a high level as you set out a strategy to solve <em>almost any</em> issue dealing with software.</p>

<p>In this blog post, I am sharing a few tactics I have learned and gathered over the years to help boost up my problem-solving foo and I hope that these continue to serve as helpful reminders for you as you troubleshoot software issues or diagnose deployment failures. Please note that these techniques are not listed in any particular order and all weigh more or less equally in terms of importance and priority. <em>Use what works best for you, in the order that works best for you</em>.</p>

<h1 id="component-break-down">Component Break-down</h1>

<p>As you set to configure and deploy a piece of software, one of the very first things you should do is to identify the <em>key actors</em> and their role in your particular deployment. For instance, if you are deploying a Java-based web application somewhere, your component break-down would include:</p>

<ul>
  <li>The application itself</li>
  <li>Server deployment environment</li>
  <li>Dependent libraries/tooling</li>
  <li>Operating system</li>
  <li>Network</li>
  <li>Underlying programming language/framework</li>
  <li>…</li>
</ul>

<p>As you enumerate the components, it is important that you get to know each player to a reasonable degree. Be suspicious of everything. Once you have identified the key suspects, start working down the list and question everything.</p>

<h1 id="start-simple">Start Simple</h1>

<p>The weirdness you are trying to diagnose may, in fact, be a consequence of a rather complicated use case that involves many players, ugly preconditions and a decent weather forecast. It is generally rather difficult and sometimes impossible to get every aspect of that difficult use case configured and developed in one initial attempt, specifically if you are not too familiar with the technical solution or even the use case at hand. So, start simple and break down the use case into logical, concrete, bounded chunks. Shoot for best case scenarios small enough to be manageable in your starting attempts. Once successful, tweak one aspect of the configuration in oh-so-small ways, introduce a variable and observe how the behavior changes. Repeat this process until you get home.</p>

<p>Not too long ago, a colleague and I were trying to figure out how to let Apache Tomcat handle <a href="https://tomcat.apache.org/tomcat-8.5-doc/config/http.html"><code class="highlighter-rouge">clientAuth</code></a>. After a component break-down, we had the following <em>key</em> actors:</p>

<ul>
  <li>Apache Tomcat</li>
  <li>Application Realm Configuration</li>
  <li>SSL Certificate Setup</li>
  <li>Browser Setup</li>
  <li>…</li>
</ul>

<p>Then we broke the use case down:</p>

<ol>
  <li>Visit URL in application</li>
  <li>Browser presents certificate choice</li>
  <li>Apache Tomcat processes that choice</li>
  <li>Application accepts certificate</li>
  <li>Other stuff happens…</li>
</ol>

<p>So, we started to work down the list: <em>Can the URL be accessed without Tomcat’s interference? What browser version/type is used? Is our test certificate sane and valid?</em>, etc. Our very best initial outcome simply was the success of getting to a particular URL. We did not necessarily care what the URL looked like, whether it could or should be changed or rewritten, how one could end up at that URL, web access vs non-web access, etc. All those details were entirely irrelevant and we would get to them later.</p>

<p>Things must be simple before they are complicated.</p>

<h1 id="thou-shall-log">Thou Shall Log</h1>

<p>Application logs are <strong>THE BEST RESOURCE</strong> for determining the root cause of a problem, provided you have configured the appropriate log levels. Specifically, you want to make sure <code class="highlighter-rouge">DEBUG</code> or <code class="highlighter-rouge">TRACE</code> levels are turned on for the relevant packages and components in your logging configuration. Know where the logging configuration is, become familiar with its syntax when changes are due and know where the output data is saved.</p>

<p>Also:</p>

<ul>
  <li>
    <p>When changes are applied, you may need to restart the server environment and observe the log files to get a better understanding of behavior.</p>
  </li>
  <li>
    <p>Remember that you may not always be dealing with a <em>single</em> log file. Various events may get logged to different files at different locations on the system and you will need to be mindful of all locations where diagnostic data may be. For example, Apache Tomcat has a <code class="highlighter-rouge">catalina.out</code> log file, then some kind of a <code class="highlighter-rouge">localhost-xyz</code> file, then some sort of a <code class="highlighter-rouge">accesslog</code> file, then you have the application log files which may or may not choose to use the same the log files as target destinations for data, etc. <em>Know your toolset</em>. Remember to look at everything.</p>
  </li>
  <li>
    <p>Nuke all logs before you start the next test attempt. <strong>ALWAYS</strong> start clean. When you or anyone else analyzes diagnostics data, there should never be a question of <em>Wait. Is this recent? Is this actually my attempt at doing X? It says there is an error, but the date goes back to 2 years ago. How?</em>. Put a stop to all that. Stop wasting time. Save lives.</p>
  </li>
</ul>

<p>If there is one take away in this section for you, dear reader, and one that you should take to heart, internalize, build statues for in tribute and pray to in the morning when you wake up, is this: <strong>REVIEW LOGS</strong>.</p>

<p>Put another way:</p>

<ul>
  <li>Are you troubleshooting software? Please review logs.</li>
  <li>Cannot get some vendor integration working? Please review logs.</li>
  <li>Neighbor’s loud music keeping you up at night? Please review logs.</li>
  <li>Ran out of milk? Please review logs.</li>
  <li>Dog shedding on the carpet? Cat doesn’t approve of your life choices? Sure. Please review logs.</li>
</ul>

<p>In summary, the answer is almost always in the logs.</p>

<h1 id="compare-solutions">Compare Solutions</h1>

<p>If you can afford it, another helpful technique is to find environments and/or solutions that actually deliver the use case you need so that you can begin to compare differences. Your objective here is to try to eliminate variables that make the job unnecessarily unique and bothersome and remove those. Identification of these gotchas is the first step, but perhaps more importantly, understanding them and their effect is more ideal. For example, when we were trying to figure out Apache Tomcat’s way of handling <code class="highlighter-rouge">clientAuth</code>, we started asking the following questions:</p>

<ul>
  <li><em>This is Apache Tomcat 8. Does it work with 7? Does it work with 6?</em></li>
  <li><em>Do we have a certificate that actually does work? How is that different from ours?</em></li>
  <li><em>Docs say we need file <code class="highlighter-rouge">X</code> at THIS location, but we have <code class="highlighter-rouge">X</code> at THAT location. Is that important?</em></li>
  <li><em>Logs say we cannot connect to our new LDAP. Can we connect to our old LDAP? What’s changed?</em></li>
</ul>

<p>Again, you want to find a solution that works and start comparing to identify differences and variables. Find working examples. Try different versions of software components with the same configuration you have today.</p>

<p>Once you have spotted the difference, it’s important that you establish a baseline first <em>and then</em> start tweaking that baseline one small step at a time in configuration and elsewhere to find the missing element or changing behavior. If you thought option <code class="highlighter-rouge">X</code> in the configuration does blah, it’s important to figure out why it does or does not do as advertised. Identify what works and what doesn’t. Getting something to work is important and is one best case scenario sure, but you should not have to stop there, as there will come a time where you would have to go above and beyond option X and getting something to work might bring about other (usually security-related) consequences of which you should be mindful.</p>

<h1 id="code-speaks-truth">Code Speaks Truth</h1>

<p>So, thus far you have identified the key components, broke down the use case, examined logs, and played around with alternative solutions. <code class="highlighter-rouge">X</code> works but <code class="highlighter-rouge">X+1</code> does not. You know that. Your logs know that. Your previous working examples and legacy environments and your cat know that. What’s next?</p>

<p><em>Truth can only be found in one place: the code</em>, and surely, you must handle the truth.</p>

<p>In my earlier anecdote of dealing with Apache Tomcat and <code class="highlighter-rouge">clientAuth</code>, all the steps led us to a suspicious <a href="https://github.com/Unicon/x509authentication-bypassing-tomcat-realm">realm</a> configuration that was not activated quite correctly. We knew the realm worked and we know it was recognized by Apache Tomcat, yet it was never invoked at the right moment. So we started out by configuring Apache Tomcat for <a href="https://blog.trifork.com/2014/07/14/how-to-remotely-debug-application-running-on-tomcat-from-within-intellij-idea/">remote debugging</a>, got the source code, compiled it and connected it via IntelliJ IDEA to a live running Tomcat instance so we could step through each statement. This method allowed us to debug the application, the realm, specific portion of Apache Tomcat code dealing with the realm…and surely, the cat.</p>

<p>What I am trying to say here is that, (if you have access and a permitting license), you must be prepared for stepping down into the code to either trace the flow and logic statically by simply reading (between) the lines or begin a remote debugging session as we did to figure out how it is actually executing. Logs, comparable solutions and such can only take you so far. In the end, code speaks the truth.</p>

<h1 id="share-pain-responsibly">Share Pain, Responsibly</h1>

<p>With enough collected data, you should, of course, ask for help and guidance as time and opportunity allows. Sharing data and problem reports requires a degree of discipline to make it easy for others to understand the request easily and respond to it quickly. While there would always be room for follow-up questions and clarifications, it is best to produce and collect as much data as possible and share them using well-understood conventional formats and channels for the best outcome.</p>

<p>A very good discipline is to use a starting template for sharing such reports. A template is basically a stubbed out application, categorized with a series of questions relevant for diagnostics where you fill in the gaps and state the problem description. Again, whether or not the project or community asks this of you, try to provide the following data points:</p>

<ul>
  <li><em>Problem Statement</em></li>
</ul>

<p>State the problem description. <em>What</em> are you trying to do? <em>Why</em> are you doing it at all? This is where you begin to explain the use case at hand, and circumstances that led you to it.</p>

<p>Be brief but precise:</p>

<ol>
  <li>Avoid statements such as <em>We have X and it doesn’t work</em>. That statement simply doesn’t work.</li>
  <li>Reformulate statements such as <em>Is it possible to do X?</em> to explain the why, the what and the how.</li>
</ol>

<ul>
  <li><em>Expected Outcome</em></li>
</ul>

<p>As the title suggests, what do you expect to happen? What should be the end result in your view?</p>

<ul>
  <li><em>Current Outcome</em></li>
</ul>

<p>As the title suggests, what do you see happening today?</p>

<ul>
  <li><em>Reproduce</em></li>
</ul>

<p>How exactly should one go about reproducing the current outcome? Do you have a series of test cases that demonstrate some faulty behavior? Do you have a sample, a test application to exhibit the issue at hand?</p>

<ul>
  <li><em>Diagnostics</em></li>
</ul>

<p>What steps have you taken to identify and diagnose what you consider to be an issue? How far down the rabbit hole have you traveled to debug the code, analyze the logs, find comparable solutions and track breaking change and incompatibility across software releases?</p>

<ul>
  <li><em>Workarounds</em></li>
</ul>

<p>Do you have a solution at hand today that does the job? Have you experimented with code and configuration to determine the root cause and come up with a suggestion on how X may be improved, fixed, etc?</p>

<ul>
  <li><em>Logs</em></li>
</ul>

<p>It is important that you provide the full story given to you by log data. You may either attach a clean log file that shows the faulty sequence of operations from start to finish, or (and you should avoid this where you can) you may decide to paste relevant sections of the log although this option is usually risky since the portions you think are relevant may not, in fact, be the entire story. If you do decide to share snippets of logs, remember to <em>not</em> paste the entire log output into a forum or description field, and learn to format and organize the data so it can be easily and readily understood by others quickly.</p>

<ul>
  <li><em>Environment</em></li>
</ul>

<p>Describe the environment you have today. What are the key components at play here? What precise version of the software do you run? Where did you download it? How old is it and have you considered upgrading? How did you install it? What changes have been applied to the software or its surrounding ecosystem, etc?</p>

<p>Stick to a template. Less guesswork leads to quicker responses and better outcomes. Practice.</p>

<h1 id="eat-sleep-think">Eat, Sleep, Think</h1>

<p>This particular item may not be all too relevant when it comes to troubleshooting software, as issue resolution is usually time-sensitive and a task with a fair amount of pressure and stress, but I personally find this to be very valuable during design or coding sessions. At times, where you are stumped for a solution and have been staring at the screen and logs for a long time, unsure of how to connect certain pieces together and pigeonholed into a particular line of thinking, it is very useful to leave it all behind for a period of time and switch to a more <em>physical activity</em>. Go for a walk around the neighborhood’s park, take a nap, shoot a few free throws, etc and allow your brain to reset itself and subconsciously work on the problem in the background. Once you come back, you would have the equivalent of a second pair of eyes and a fresh perspective on how to attack the problem.</p>

<p>In the same category, I find that re-iterating the problem and insofar solutions using a whiteboard, pen/pencil, chatting with a colleague or just about any other type of physical activity outside the use of electronics has the same effect. This effectively tickles your brain to get moving on a solution without you actively realizing it, and of course, a short break every once in a while can do a lot of good. My personal best is around 40-minute mark where I get up, walk around and try to do something totally different and silly, like attempting to train the pigeons outside to dubstep.</p>

<p>Believe me, it works. (The technique, not the dubstep).</p>

<h1 id="start-early">Start Early</h1>

<p><img src="https://user-images.githubusercontent.com/1205228/45082890-9b202100-b10f-11e8-9e28-c02251d3271a.png" alt="image" /></p>

<p><a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">This</a>.</p>

<h1 id="so">So…</h1>

<p>I hope this review was of some help to you. This is by no means a comprehensive list; a lot of it is subjective and could be entirely inapplicable to you, your personality and work etiquette. Either way, if you have other tactics and strategies to share please feel free to edit this post as best you can.</p>

<p>Also, many thanks to <a href="https://github.com/jtgasper3">@jtgasper3</a> for reviewing this post and providing feedback.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/09/05/effective-diagnostics/</guid>
                <description>
                    
                    A collection of what hopefully are obvious troubleshooting tactics when it comes to diagnosing software deployment issues and configuration problems.
                    
                </description>
                <pubDate>Wed, 05 Sep 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - MaxMind Geo2IP ISP Integration</title>
                <link>https://apereo.github.io/2018/08/27/cas5-maxmind-isp-interrupt-integration/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>I have been consulting on a CAS project with the main requirement of doing an integration with <a href="https://www.maxmind.com/">MaxMind</a> GeoIP2 services.</p>

<p>According to the MaxMind website:</p>

<blockquote>
  <p>MaxMind GeoIP2 offerings identify the location and other characteristics of Internet users for a wide range of applications including content personalization, fraud detection, ad targeting, traffic analysis, compliance, geo-targeting, geo-fencing and digital rights management.</p>
</blockquote>

<p>There certainly is an <a href="https://apereo.github.io/cas/5.3.x/installation/GeoTracking-Authentication-Requests.html">existing integration</a> already with MaxMind and CAS, which is primarily giving CAS the ability to cross-check a browser-provided IP address against the MaxMind database to geolocate the request and perform additional processing later on, such as auditing the event with richer information or executing <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-Adaptive-Authentication.html">risk-based authentication decisions</a>.</p>

<p>Our particular use case here was a bit different. We were presented with a MaxMind database file that contained a list of IP addresses known to be linked to VPN services and anonymous service providers. Our objective was to examine the request for the provided IP address, cross-check against the MaxMind database and ultimately present a warning to the user if a match is found. Our initial assumption was that such a warning is presented to the after the <em>primary authentication</em> event inclusive of any and all multifactor authentication flows such as <a href="https://apereo.github.io/cas/5.3.x/installation/DuoSecurity-Authentication.html">Duo Security</a>.</p>

<p>This sort of use case can easily be done in form of <a href="https://apereo.github.io/cas/5.3.x/installation/Webflow-Customization-Interrupt.html">webflow interrupts</a>.</p>

<blockquote>
  <p>CAS has the ability to pause and interrupt the authentication flow to reach out to external services and resources, querying for status and settings that would then dictate how CAS should manage and control the SSO session. Interrupt services are able to present notification messages to the user, provide options for redirects to external services, etc.</p>
</blockquote>

<p>This sounds exactly like what we could use. We just need to provide our own particular interrupt services that handle the cross-examination of the IP address with MaxMind and we should be good to go. Let’s do it.</p>

<div class="alert alert-info">
  <strong>Collaborate</strong><br />If you want to learn more about webflow interrupts, please see <a href="https://apereo.github.io/2017/08/30/cas-loginflow-interrupt/">this post</a>.
</div>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h2 id="configuration">Configuration</h2>

<p>First, we need to prepare the CAS overlay with the right set of dependencies to enable interrupt functionality and get access to the <a href="http://maxmind.github.io/GeoIP2-java/">MaxMind APIs</a>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cas-server-support-interrupt-webflow<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.maxmind.geoip2<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>geoip2<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.12.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>Next, we can create our own <a href="https://apereo.github.io/cas/5.3.x/installation/Configuration-Management-Extensions.html">configuration component</a> and design the declaration of our interrupt service, tasked to talk to MaxMind APIs:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span><span class="o">(</span><span class="s">"SomeConfiguration"</span><span class="o">)</span>
<span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="n">CasConfigurationProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeConfiguration</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${our.maxmind.isp-file:file:/etc/cas/config/maxmind/GeoIP2-ISP.mmdb}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Resource</span> <span class="n">ispDatabase</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">InterruptInquirer</span> <span class="nf">interruptInquirer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MaxmindInterruptInquirer</span><span class="o">(</span><span class="n">ispDatabase</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note that out particular <code class="highlighter-rouge">MaxmindInterruptInquirer</code> gains access to the MaxMind ISP database file to be used for cross-examination of IP addresses. Obviously, we need to design the <code class="highlighter-rouge">MaxmindInterruptInquirer</code> itself:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MaxmindInterruptInquirer</span> <span class="kd">implements</span> <span class="n">InterruptInquirer</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">DatabaseReader</span> <span class="n">ispDatabaseReader</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MaxmindInterruptInquirer</span><span class="o">(</span><span class="kd">final</span> <span class="n">Resource</span> <span class="n">ispResource</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">File</span> <span class="n">ispFile</span> <span class="o">=</span> <span class="n">ispResource</span><span class="o">.</span><span class="na">getFile</span><span class="o">();</span>
            <span class="n">ispDatabaseReader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseReader</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">ispFile</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">InterruptResponse</span> <span class="nf">inquire</span><span class="o">(</span><span class="n">Authentication</span> <span class="n">authentication</span><span class="o">,</span>
                                     <span class="n">RegisteredService</span> <span class="n">registeredService</span><span class="o">,</span>
                                     <span class="n">Service</span> <span class="n">service</span><span class="o">,</span>
                                     <span class="n">Credential</span> <span class="n">credential</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">WebUtils</span><span class="o">.</span><span class="na">getHttpServletRequestFromExternalWebflowContext</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
        <span class="cm">/*
            Check the address in Maxmind database and return back the proper response
        */</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Here is what happens:</p>

<p>After all authentication flows have completed, the interrupt webflow kicks in and picks up our <code class="highlighter-rouge">MaxmindInterruptInquirer</code> component. It begins to examine the IP address linked to this request and does a look-up to find a match in the MaxMind database. If and when found, it will pass a response back up which would then get translated and stuff into the webflow available to the warning page for your user’s pleasure.</p>

<p>That’s it.</p>

<p><em>I should note that our requirement later on changed to present the same sort of warning <strong>before</strong> any of the authentication flows have commenced. An interesting nuance indeed, as the user must face the warning page before CAS presents the login screen and family in the browser, and one we might cover in a separate blog post.</em></p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/08/27/cas5-maxmind-isp-interrupt-integration/</guid>
                <description>
                    
                    Learn how you may determine the Internet Service Provider, organization name, and autonomous system organization and number associated with the user's IP address in CAS using MaxMind services and present warnings in the authentication flow for the end-user if an IP address is matched.
                    
                </description>
                <pubDate>Mon, 27 Aug 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Notes from Better by Design 2018</title>
                <link>https://apereo.github.io/2018/08/24/better-by-design-2018/</link>
                <content:encoded>
                    <![CDATA[
                    <h1 id="notes-from-a-design-conference-in-madison-wi">Notes from a design conference in Madison, WI</h1>

<p>Things I encountered at this conference that challenged me to grow:</p>

<ul>
  <li>Celeste Headlee’s articulating the importance of conversations.</li>
  <li>Jorel Dray’s reminder to provide the feedback that others need to grow.</li>
  <li>Lou Downe’s call to enable scaling good design by extending more broadly the
privilege of the opportunity to practice better service design.</li>
</ul>

<h2 id="have-better-conversations">Have (better) conversations</h2>

<p>I found a lot to challenge me <a href="https://twitter.com/CelesteHeadlee">Celeste Headlee</a>’s morning keynote
(<a href="https://betterbydesignconference.com/events/keynote-10-ways-to-have-better-conversations/">10 ways to have better conversations</a>) and in the
<a href="https://betterbydesignconference.com/events/practicing-better-conversations/">conversations practice workshop</a> that
immediately followed.</p>

<p>See also:</p>

<ul>
  <li><a href="https://www.ted.com/talks/celeste_headlee_10_ways_to_have_a_better_conversation?language=en">11 minute TedX talk by this speaker</a></li>
  <li>Book by this author: <a href="https://www.goodreads.com/book/show/33385019-we-need-to-talk">We need to talk: how to have conversations that matter</a></li>
</ul>

<p>Our conversations are under-intentional, under-designed. There’s opportunities
to have better conversations, by design.</p>

<p>Bad news: you cannot fix others’ conversational behavior. (In general, you can’t
fix other people).</p>

<p>Good news: You can improve your own conversational skills.</p>

<p>Online and in email: you are the worst version of yourself.</p>

<p>To have better conversations:</p>

<ol>
  <li>Single-task. Be present.</li>
  <li>Don’t lecture. Don’t try to change minds. Instead, go into conversation
intending to learn from others.</li>
  <li>Ask open-ended questions. Who, what, when, where, why, how. Not yes-no
questions.</li>
  <li>Go with the flow of the conversation. Don’t get caught up by some bit or by
whatever your mind is teling you relates – let it go and keep up with the
conversation as it flows past this.</li>
  <li>Say you don’t know when you don’t know.</li>
  <li>Never say “I know how you feel.” You don’t know how the other person feels.
Even if you experienced something very similar, you still don’t know how
even that experience felt, since with time and distance your mind has dulled
that memory. Avoid conversational narcissism.</li>
  <li>Do not repeat yourself. Say it exactly once, and thereby become the kind of
person who’s known to say things exactly once. If people have the impression
you repeat yourself, they don’t listen, since their mind assumes they
needn’t bother listening because the information will be available from the
environment again in the future. If you’re known to say things only once,
then people will listen to you the first and only time you say things.</li>
  <li>Stay out of the weeds. Most details don’t matter most of the time. Most
people most of the time do not have the capacity to presently engage with
those details. So just drop them.</li>
  <li>Listen. Really listen to people. Be interested in other people.</li>
  <li>Keep it brief. Online: you have 8 seconds. In face-to-face conversation, you
have 30-60 seconds. It’s not a lot.</li>
</ol>

<p>New research: the liking gap. We under-estimate how much other people like us
and enjoy our company. Your inner critic is more critical than others are and
hold you to higher standards. Others don’t notice or remember your
conversational failures so much as you think.</p>

<p>Audience question: What about a culture of “healthy debate”? Answer: Rule for knowing when to engage in “debate”: Any time you want to accomplish
anything, don’t “debate”.</p>

<p>Audience question: Conversations as ephemeral. What about written communication,
email as a way to have a record of conversations? Answer: that record is worth
a lot less than you think it is. There’s a huge gap between what the email
author thinks the email said and what the email recipient thinks it said.</p>

<p>Email is good for:</p>

<ol>
  <li>Lists, agendas, and summaries. Send an email listing or agendaing things that
you need to have a conversation about. Have the conversation. Then send an
email summarizing the conversation.</li>
  <li>Conveying attachments.</li>
  <li>Letters. The kind of thing that would have been a longhand real letter in a
pre-email era.</li>
  <li>Praise. It turns out, straight up praise works as well over email as it does
in conversation, maybe because looking at it afterward actually works for
recipients of praise emails.</li>
</ol>

<p>Remote work: modern teleconferencing tools work great. Phone almost as good as
f2f, and solutions with cameras close this gap further.</p>

<p>How to get others to behave better in conversation: you can’t. The best you can
do is model good behavior.</p>

<p>Think of conversation as a game of catch. Both the turn taking, and the setting
the other person up for success (catch is only fun if they successfully catch
the ball.)</p>

<p>Do not offer unsolicited advice.</p>

<p>Shift responses vs support responses. Some conversational responses attempt to
shift focus to oneself, whereas other conversational responses support the other
person.</p>

<p>Interesting to think about how this relates to the <a href="https://apetro.ghost.io/fixed-async-manifesto/">Async Manifesto</a> and to
more generally the advantages in making information available asynchronously, on
demand, when people are ready to consume it rather than just when you’re ready
to say it.</p>

<h2 id="how-to-discover-what-your-users-really-need">How to discover what your users really need</h2>

<p><a href="https://twitter.com/paigenomadgirl">Paige Bennett</a>’s talk <a href="https://betterbydesignconference.com/events/peeling-back-the-layers-how-to-discover-what-your-users-really-need/">How to discover what your users really need</a>.</p>

<p>We won’t uncover user needs by looking at the data alone.</p>

<h3 id="ways-to-discover-user-needs">Ways to discover user needs</h3>

<p>Do workshops with users.</p>

<p>Actively involve stakeholders – in working roles, photography, facilitation,
greeters. Presence of stakeholders improves buy-in through their direct
observation. This is more powerful than your reporting results.</p>

<h4 id="field-visits">Field visits</h4>

<p>Observe users in their natural environment.</p>

<h4 id="metaphors">Metaphors</h4>

<p>Helps people to be more expressive and more heard.</p>

<h4 id="reframing-the-question">Reframing the question</h4>

<p>We are not great at imagining what we may do.</p>

<p>“Would you use this” –&gt; “Have you used something like this before?”</p>

<p>Flip a request for a promise (what would you do) to an observation of current
action (what do you currently do).</p>

<p>“What would have gotten you to stay?” –&gt;
“What did you hope this product would have done for you?”</p>

<h3 id="sharing-findings-with-stakeholders">Sharing findings with stakeholders</h3>

<p>Your findings must live on without you.</p>

<ul>
  <li>Workshops</li>
  <li>Exhibit pop-ups. Mini museum.</li>
  <li>Collateral</li>
  <li>Brown bags</li>
</ul>

<p>Audience question: what about remote users? Answer: consider a diary study.</p>

<h2 id="art-of-feedback">Art of feedback</h2>

<p>Jorel Dray’s <a href="https://betterbydesignconference.com/events/afternoon-mini-workshop-1-design-critique/">The art of feedback</a>.</p>

<p>Feedback is a process, not an event.</p>

<p>Getting feedback (in context of feedback about design work):</p>

<ul>
  <li>Seek out more feedback.</li>
  <li>Set the tone.</li>
  <li>Handling feedback you don’t agree with: try it before you discredit it. Do
what’s right, and also do what was asked for. Show both.</li>
  <li>Handling amorphous “I don’t like it” feedback. Gently remind that
“it ain’t about you and what you like”, it’s about the design being effective
for whatever its goal is. Circle back to the goal and try to get feedback on
how the design fares against its goals.</li>
  <li>Fight hard, but know when to let it go.</li>
</ul>

<p>Giving feedback:</p>

<ul>
  <li>Respect before anything else. There’s no point in giving feedback to anyone or
about anything you don’t respect.</li>
  <li>Build a process. What’s working well? What needs to change to meet our
objectives? (We do have identified objectives, right?) What would make the
work more awesome? Recap. Take notes. Feedback becomes standard and routine,
not a punishment.</li>
  <li>What, how, when of feedback matters.
“You made it too busy” –&gt; “It’s too busy” –&gt; “Try to simplify” –&gt;
“Try a version that’s simplified” –&gt;
“Try simplifying so that people can focus on that really cool thing you made.”</li>
  <li>If time is tight, be specific.</li>
  <li>Talk in person when possible. Email is always brutal.</li>
  <li>Be timely.</li>
  <li>Ask for feedback. If you’re the kind of person who asks for feedback it’s more
natural for you to be giving feedback. Demonstrate a state of constant
improvement. Demonstrate accepting feedback effectively.</li>
  <li>Balance. Affirming and corrective. Standard 3 Mr Rogers to 1 Gorden Ramsay
ratio, but sometimes much more Rogers.</li>
  <li>It’s not about you. Be what <em>they</em> need you to be to grow.</li>
</ul>

<p>In conclusion:</p>

<ul>
  <li>Work is never bad, it’s just not there yet.</li>
  <li>Positive feedback keeps us going. Great feedback improves the world.</li>
  <li>Try to find happiness and put energy into growth, not outcome.</li>
</ul>

<h2 id="keynote-the-future-of-public-service-design">Keynote: the future of (public) service design</h2>

<p><a href="https://twitter.com/LouiseDowne">Lou Downe</a> ‘s <a href="https://betterbydesignconference.com/events/closing-keynote-title-tba/">The future of (public) service design</a>.</p>

<p>Just hearing Lou Downe speak in person was inspirational in itself. They’re one
of those leaders where you hear them speak and have that feeling of “Yes! Your
heart is in the right place. You’re brave. You’re doing the right thing and
doing the right things in the right ways. I’d follow you.”</p>

<p>The vision they laid out was also compelling. Cenrtalization brought a
significant initial increment of experience improvement for people interacting
with the UK government, but the UK will achieve the next increment of
improvement through empowering decentralized attentions to user experience
throughout the UK government.</p>

<p>Transformation is the ability of an organization to deliver and maintain a
service over time.</p>

<p>delivery –&gt; scale and sustainability</p>

<p>Successfully delivering services at all is good, better than not. But the long
term wins will come from scaling and sustaining service delivery.</p>

<p>“Digital” is just a means to an end.</p>

<p>Most of government is service design most of the time.</p>

<p>Digital Service Standard –&gt; Government Service Standards</p>

<p>Design your infrastructure, or your infrastructure will design you.</p>

<p>Corralary: designing and offering infrastructure is high leverage.</p>

<p>Don’t try to design the future. Design something the future can design.</p>

<p>Be strong.
Be kind.
Carry on.</p>

<h3 id="privilege-and-sharing-privilege-privilege-as-lens-for-service-design">Privilege and sharing privilege; privilege as lens for service design</h3>

<p>Give people the skills and opportunities to help themselves.</p>

<p>Collaboration is a privilege. Barriers include money, time, and access to data.</p>

<p>Having the space, the slack, the empowerment to improve service design and
delivery is a tremendous privilege. Public servants often want to do a better
job, to do the right thing, to better serve the public. To deliver experiences
that are reasonable, that are in the proudest traditions of thoughtfully and
kindly treating others. And often public servants have very little room,
empowerment, expertise, support for doing this. In extrema, sticking your neck
out to criticize an existing experience, that’s a way to jeopardize a job you
may not be able to afford to lose.</p>

<p>Making things better is a privilege.</p>

<p>The next increment of improvements will be achieved through sharing that
privilege.</p>

<h3 id="unpublished-ranty-blog-posts-for-the-win">(Unpublished) ranty blog posts for the win</h3>

<p>Anecdote that resonated: Lou’s proudest achievement so far has been spinning up
the 5M Pound / year initiative around service delivery manual, style guidance,
etc. This originated in a ranty blog post Lou had drafted and been asked not to
actually publish, and instead to do something about the issues articulated.</p>

<p>There is power in writing. It clarifies thinking and it shares vision,
persuades. There are also necessary steps that come after the ranty blog post
to take strides forward. Not all ranty blog posts should actually be published
(but perhaps really should nonetheless be written).</p>

<h3 id="on-how-to-approach-accessibility-and-usability">On how to approach accessibility and usability</h3>

<p>Mobile-first, accessibility-first.</p>

<p>Extreme testing first. Testing with screen readers. User testing with users
with physical and cognitive disabilities. If it works for some of the most
difficult user contexts, then it’s more likely to work in other contexts too.
This testing teaches you more sooner.</p>

<p>Making services accessible is like making a muffin be a blueberry muffin. It’s
really hard to get the blueberries in later if you don’t bake them in from the
beginning.</p>

<p>Extreme testing first is time and resource consuming and expensive and always
needs justified.</p>

<p>It’s also the most effective way to design highly usable, accessible services.
And when it comes right down to it, the law probably requires you to do this. So
if you’re taking compliance with that law seriously, well, this is what it
really takes to do it.</p>

<h2 id="conclusions">Conclusions</h2>

<p>Be interested in humans.</p>

<ul>
  <li>Interested in learning from conversation with humans,</li>
  <li>interested in discovering what humans really need,</li>
  <li>interested in growing from feedback from humans, and in provding humans the
feedback <em>they</em> need to grow,</li>
  <li>interested in empowering humans to design and deliver better services at
government scale</li>
</ul>

<p><a href="https://apetro.ghost.io">Andrew Petro</a></p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/08/24/better-by-design-2018/</guid>
                <description>
                    
                    Be interested in humans and human success.
                    
                </description>
                <pubDate>Fri, 24 Aug 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Authentication Lifecycle Phases</title>
                <link>https://apereo.github.io/2018/08/23/cas5-authn-lifecycle-extensions/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>There may come a time in your CAS deployment where you realize that simple username/password type of authentication strategy is no longer sufficient and you need to introduce additional policies that sanitize the credentials before submission, check for account status, reach out to external systems and more before you can vouch for a valid authentication request to proceed.</p>

<p>The authentication engine in Apereo CAS is most flexible, where there are specific phases throughout the lifecycle of a given in-process request that can be extended and massaged for prosperity and fancy use cases. In this tutorial, we’ll quickly tap into a few of these phases, where our objectives are as follows:</p>

<ol>
  <li>Before credentials are validated, we shall reach out to an external system (such as a REST API) to check for user account status. Depending on the response, we may decide to entirely block the request and prevent the user from actually authenticating.</li>
  <li>After a successful authentication attempt though before a single sign-on session is established, we would want to check the authentication result and reach out to an external API/system to determine whether we need to inform the user about any particular messages or warnings. Whatever the result, we do not intend to block the request and it would be great if the end-user is still given the ability to proceed, despite the forewarned dangers.</li>
</ol>

<p>Cool, eh?</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h2 id="configuration">Configuration</h2>

<p>As the first step, we need to figure out an authentication strategy. For this tutorial, I taught CAS to use <a href="https://apereo.github.io/cas/5.3.x/installation/JAAS-Authentication.html">JAAS for authentication</a> in my  <code class="highlighter-rouge">cas.properties</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.jaas[0]</span><span class="py">.realm</span><span class="p">=</span><span class="s">CAS</span>
<span class="err">cas.authn.jaas[0]</span><span class="py">.loginConfigType</span><span class="p">=</span><span class="s">JavaLoginConfig</span>
<span class="err">cas.authn.jaas[0]</span><span class="py">.loginConfigurationFile</span><span class="p">=</span><span class="s">/etc/cas/config/jaas.conf</span>
</code></pre></div></div>

<p>Of course, my <code class="highlighter-rouge">/etc/cas/config/jaas.conf</code> file is fairly simple:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CAS <span class="o">{</span>
    org.apereo.cas.authentication.handler.support.jaas.AccountsPreDefinedLoginModule required
        <span class="nv">accounts</span><span class="o">=</span><span class="s2">"casuser::Mellon"</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</code></pre></div></div>

<p>This basically means that I can authenticate using the static credentials <code class="highlighter-rouge">casuser</code> and <code class="highlighter-rouge">Mellon</code>. Not too impressive yet, I suppose, but let’s kick this into gear and address our first objective, which is pre-validation of authentication attempts. There are many ways of doing this and as an option, we are going to examine the use case with <em>Authentication PreProcessor</em> components.</p>

<h2 id="pre-processing-authentications">Pre-Processing Authentications</h2>

<p>The authentication engine in CAS is in fact quite elaborate. It is composed of my distinct steps, sort of like a factory production line, where some piece of data whether input by the user or from the browser, etc comes in from the outside and is transformed into a form of credential whereby a series of actions and surgeries take place to operate on the credential. One of these steps early on in the process is a component referred to as <em>Authentication PreProcessor</em>, which does exactly what its name suggests. This component registers itself with the engine and is tasked with any pre-vetting the credential before any particular authentication strategy kicks into action.</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />Note that this sort of thing may be considered overkill if your user account store is capable of detecting user account status and blocking the authentication attempt. Using <code>Authentication PreProcessor</code> is generally only required if you have a rather fancy use case with unusual requirements and workflows, and dependencies on outside systems. If you do not, close your eyes and head into the next section.
</div>

<p>So in order to create our own <em>Authentication PreProcessor</em>, we’ll need to design our own <a href="https://apereo.github.io/cas/5.3.x/installation/Configuration-Management-Extensions.html">configuration class</a> and register the pre-processor as such:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span><span class="o">(</span><span class="s">"FancyCasConfiguration"</span><span class="o">)</span>
<span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="n">CasConfigurationProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FancyCasConfiguration</span> <span class="kd">implements</span> <span class="n">AuthenticationEventExecutionPlanConfigurer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureAuthenticationExecutionPlan</span><span class="o">(</span><span class="kd">final</span> <span class="n">AuthenticationEventExecutionPlan</span> <span class="n">plan</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">plan</span><span class="o">.</span><span class="na">registerAuthenticationPreProcessor</span><span class="o">(</span><span class="n">accountStatusRetrievalPreProcessor</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@RefreshScope</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">AuthenticationPreProcessor</span> <span class="nf">fancyPreProcessor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">FancyPreProcessor</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Our <code class="highlighter-rouge">FancyPreProcessor</code> then could look like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FancyPreProcessor</span> <span class="kd">implements</span> <span class="n">AuthenticationPreProcessor</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">process</span><span class="o">(</span><span class="kd">final</span> <span class="n">AuthenticationTransaction</span> <span class="n">transaction</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">AuthenticationException</span> <span class="o">{</span>
        <span class="n">transaction</span><span class="o">.</span><span class="na">getPrimaryCredential</span><span class="o">().</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">c</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="cm">/*
              Replace with your own condition...
            */</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">checkExternalSystemOrApiAndFail</span><span class="o">())</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Throwable</span><span class="o">&gt;</span> <span class="n">errors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
                <span class="n">errors</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">AccountPasswordMustChangeException</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">(),</span> 
                  <span class="k">new</span> <span class="nf">AccountPasswordMustChangeException</span><span class="o">(</span><span class="s">"Expired account"</span><span class="o">));</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">AuthenticationException</span><span class="o">(</span><span class="n">errors</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="alert alert-info">
  <strong>Remember</strong><br />You will need to include a number of CAS module dependencies in your build process for the above snippets to properly compile.
</div>

<p>All that is happening here is that the authentication engine keeps track of this pre-processor and invokes before it does anything else. Our <code class="highlighter-rouge">FancyPreProcessor</code> when invoked, simply goes in to contact needed systems and check for conditions as needed and finally proper errors are thrown back to CAS that halt the authentication flow and get translated by the upper layers into reasonable messages for the end-user.</p>

<h2 id="post-processing-authentications">Post-Processing Authentications</h2>

<p>Our second objective can in fact be done in form of a normal password policy for JAAS, implemented in your favorite toolkit ever that is Groovy. As you might guess, we need to teach CAS to activate the policy when JAAS completes:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.jaas[0]</span><span class="py">.passwordPolicy.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="err">cas.authn.jaas[0]</span><span class="py">.passwordPolicy.strategy</span><span class="p">=</span><span class="s">GROOVY</span>
<span class="err">cas.authn.jaas[0]</span><span class="py">.passwordPolicy.groovy.location</span><span class="p">=</span><span class="s">/etc/cas/config/SomePasswordPolicyStrategy.groovy</span>
</code></pre></div></div>

<p>…and of course, we need to write the <code class="highlighter-rouge">SomePasswordPolicyStrategy.groovy</code> script:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.apereo.cas.*</span>
<span class="kn">import</span> <span class="nn">java.util.*</span>
<span class="kn">import</span> <span class="nn">org.apereo.cas.authentication.*</span>

<span class="kt">def</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">MessageDescriptor</span><span class="o">&gt;</span> <span class="n">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">response</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">configuration</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>

    <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s2">"Things are happening for [{}]"</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">thereBeDragonsAhead</span><span class="o">())</span>
      <span class="k">return</span> <span class="o">[</span><span class="k">new</span> <span class="n">DefaultMessageDescriptor</span><span class="o">(</span><span class="s2">"be.afraid.message.code"</span><span class="o">)]</span>

    <span class="k">return</span> <span class="o">[]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>If the policy sees the need, it will collect messages and warnings that would be passed up to the login flow which tries to navigate and switch to a screen where such messages are pulled from language bundles using their code and displayed back for the end-user to examine.</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/08/23/cas5-authn-lifecycle-extensions/</guid>
                <description>
                    
                    Tap into the Apereo CAS authentication engine from outside, and design extensions that prevent an unsuccessful authentication attempt or warn the user after-the-fact based on specific policies of your choosing.
                    
                </description>
                <pubDate>Thu, 23 Aug 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 6.0.0 RC1 Feature Release</title>
                <link>https://apereo.github.io/2018/08/03/600rc1-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.3.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.3.0">June 29th, 2018</a>. Since then, the project has been moving forward with development of the next feature release that is tagged as <code class="highlighter-rouge">6.0.0</code>. Note that this is a <strong>major release</strong> of the CAS software which <em>may</em> present significant changes in architecture, configuration or behavior. Please review the <a href="https://apereo.github.io/cas/developer/Release-Policy.html">release policy</a> to learn more about the scope of the release.</p>

<p>This post intends to highlight some of the improvements and enhancements packed into the <strong>first</strong> release candidate in the <code class="highlighter-rouge">6.0.0</code> series.</p>

<!--
You can read about the previous release candidate [here](https://apereo.github.io/2018/03/30/530rc3-release/).
-->

<h2 class="no_toc" id="shake-well-before-use">Shake Well Before Use</h2>

<p>We strongly recommend that you take advantage of the release candidates as they come out. Waiting for a <code class="highlighter-rouge">GA</code> release is only going to set you up for unpleasant surprises. A <code class="highlighter-rouge">GA</code> is simply <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">a tag and nothing more</a>. Note that CAS releases are <em>strictly</em> time-based releases; they are not scheduled or based on specific benchmarks, statistics or completion of features. To gain confidence in a particular release, it is strongly recommended that you start early by experimenting with release candidates and/or follow-up snapshots.</p>

<p>In order to start experimenting with release candidates, at any given time, you should be able to append <code class="highlighter-rouge">-SNAPSHOT</code> to the CAS version specified in order to take advantage of snapshot builds as changes are made and published.</p>

<h3 class="no_toc" id="overlay">Overlay</h3>

<p>In the <code class="highlighter-rouge">build.properties</code> of <a href="https://github.com/apereo/cas-overlay-template/tree/6.0">the overlay</a>, adjust the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">casVersion</span><span class="p">=</span><span class="s">6.0.0-RC1</span>
</code></pre></div></div>

<p>The template overlays are getting reorganized to some degree before they can be fully functional with CAS 6. Be sure to double check the branch and the overlay structure as you navigate though CAS versions and release candidates.</p>

<h2 class="no_toc" id="changes">Changes</h2>

<ul id="markdown-toc">
  <li><a href="#new--noteworthy" id="markdown-toc-new--noteworthy">New &amp; Noteworthy</a>    <ul>
      <li><a href="#java-10" id="markdown-toc-java-10">Java 10</a></li>
      <li><a href="#servlet-specification-v4" id="markdown-toc-servlet-specification-v4">Servlet Specification v4</a></li>
      <li><a href="#spring-v5" id="markdown-toc-spring-v5">Spring v5</a></li>
      <li><a href="#spring-boot-v2" id="markdown-toc-spring-boot-v2">Spring Boot v2</a></li>
      <li><a href="#metrics" id="markdown-toc-metrics">Metrics</a></li>
      <li><a href="#endpoints" id="markdown-toc-endpoints">Endpoints</a>        <ul>
          <li><a href="#endpoint-security" id="markdown-toc-endpoint-security">Endpoint Security</a></li>
        </ul>
      </li>
      <li><a href="#cas-command-line-shell" id="markdown-toc-cas-command-line-shell">CAS Command-line Shell</a></li>
      <li><a href="#dynamic-saml2-metadata" id="markdown-toc-dynamic-saml2-metadata">Dynamic SAML2 Metadata</a></li>
      <li><a href="#webflow-decorations" id="markdown-toc-webflow-decorations">Webflow Decorations</a></li>
      <li><a href="#adaptive-authentication-ip-intelligence" id="markdown-toc-adaptive-authentication-ip-intelligence">Adaptive Authentication IP Intelligence</a></li>
      <li><a href="#azure-mfa-integration" id="markdown-toc-azure-mfa-integration">Azure MFA Integration</a></li>
      <li><a href="#google-authenticator-account-management" id="markdown-toc-google-authenticator-account-management">Google Authenticator Account Management</a></li>
      <li><a href="#oauth--openid-connect-json-output" id="markdown-toc-oauth--openid-connect-json-output">OAuth &amp; OpenID Connect JSON Output</a></li>
      <li><a href="#oauth-device-flow" id="markdown-toc-oauth-device-flow">OAuth Device Flow</a></li>
      <li><a href="#oauth-proof-key-code-exchange-pkce" id="markdown-toc-oauth-proof-key-code-exchange-pkce">OAuth Proof Key Code Exchange (PKCE)</a></li>
      <li><a href="#cas-as-multifactor-authentication-provider" id="markdown-toc-cas-as-multifactor-authentication-provider">CAS as Multifactor Authentication Provider</a></li>
      <li><a href="#couchbase-audits" id="markdown-toc-couchbase-audits">Couchbase Audits</a></li>
      <li><a href="#saml2-metadata-health-status" id="markdown-toc-saml2-metadata-health-status">SAML2 Metadata Health Status</a></li>
      <li><a href="#oauth-token-introspection" id="markdown-toc-oauth-token-introspection">OAuth Token Introspection</a></li>
      <li><a href="#yubikey-account-management" id="markdown-toc-yubikey-account-management">YubiKey Account Management</a></li>
      <li><a href="#nexmo-sms-integration" id="markdown-toc-nexmo-sms-integration">Nexmo SMS Integration</a></li>
    </ul>
  </li>
  <li><a href="#small-stuff" id="markdown-toc-small-stuff">Small Stuff</a></li>
  <li><a href="#library-upgrades" id="markdown-toc-library-upgrades">Library Upgrades</a></li>
  <li><a href="#resources" id="markdown-toc-resources">Resources</a></li>
  <li><a href="#get-involved" id="markdown-toc-get-involved">Get Involved</a></li>
  <li><a href="#credits" id="markdown-toc-credits">Credits</a></li>
</ul>

<h3 id="new--noteworthy">New &amp; Noteworthy</h3>

<h4 id="java-10">Java 10</h4>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />This is a breaking change. You will need to make sure the deployment platform is prepped with the correct Java version before moving forward.
</div>

<p>Oracle recently announced that they intend to move Java to a release every six months. Under the new release schedule, Oracle proposes strict time-based releases, known as feature releases. These will appear every year in March and September. The new release schedule is intended to begin immediately after the release of Java 9 (which is long-gone at this point), with the next release of Java to come in early 2018.</p>

<p>The release schedule of the CAS software quite happily lends itself to the Java release schedule as well. There has been a feature release once every 6 months or so for the past couple of years and such releases have exclusively been time-based releases with a number of candidates in between them for adopters to experiment. That being said, in order to keep up with the Java release schedule, stay on a supported platform and keep the progress ball moving forward, the minimum required Java version is set to be <code class="highlighter-rouge">11</code> starting with CAS 6.</p>

<p>This has not been an easy effort; the CAS 6 development has been in progress since February 2018 with early testing of snapshots and release candidates of Java as well as all other software packages and libraries to ensure a successful build and deployment model. For the most part, all functionality continues to remain the same as it was and the change in platform requirements should remain completely invisible to the deployment.</p>

<p>Note that this particular release candidate will be based on top of Java 10, having passed 9 already. As other libraries begin to catch up with Java 11 and provider better support, CAS will ultimately  switch to Java 11 before the final GA release.</p>

<p>While there are no specific plans as of this writing, there will likely be follow-up feature releases after CAS <code class="highlighter-rouge">6</code> in form of <code class="highlighter-rouge">6.1</code>, <code class="highlighter-rouge">6.2</code>, etc each of which may require and depend on future Java releases such as <code class="highlighter-rouge">12</code>, <code class="highlighter-rouge">13</code>, etc.</p>

<h4 id="servlet-specification-v4">Servlet Specification v4</h4>

<div class="alert alert-info">
  <strong>Attention</strong><br />This might be a breaking change. While there isn't anything in CAS (yet) that would take advantage of the new specification features, we obviously reserve the right to do. You are better off switching to the required version as time and energy allows.
</div>

<p>The <a href="https://apereo.github.io/cas/development/installation/Configuring-Servlet-Container.html">embedded server containers</a> provided by CAS (Apache Tomcat, Jetty, etc) have been and will be upgraded to include support for the new specification version. This will most notably include required support for Apache Tomcat 9+ and Undertow 2+.</p>

<h4 id="spring-v5">Spring v5</h4>

<p>Given changes in the platform requirements, the Spring framework that is very heavily used internally by CAS has been updated to its most recent version that is version <code class="highlighter-rouge">5.0.x</code>. You can read all about Spring 5 <a href="https://springframework.guru/what-is-new-with-spring-framework-5/">here</a>.</p>

<p>While for the most part, the upgrade is rather invisible to the CAS developer and adopter, one area that is negatively impacted by the change is the <a href="https://apereo.github.io/cas/development/protocol/SAML-Protocol.html">SAML2 functionality in CAS</a> that uses the Velocity templating engine needed by the <a href="https://wiki.shibboleth.net/confluence/display/OS30/Home">OpenSAML library</a> to submit SAML responses, etc. Velocity support is <a href="https://jira.spring.io/browse/spr-13795">no longer available in Spring 5</a> and additional measures are taken in CAS to ensure OpenSAML and friends and continue to do the job without relying on Velocity support assumed to be available with the Spring framework.</p>

<p>It is quite likely that CAS would ultimately switch to Spring <code class="highlighter-rouge">5.1.x</code> to take full advantage of Java 11 support.</p>

<h4 id="spring-boot-v2">Spring Boot v2</h4>

<p>CAS is entirely based on the <a href="https://spring.io/projects/spring-boot">Spring Boot framework</a> at heart, which controls the orchestration and management of CAS settings, configuration modules, and many other things. Moving to the newer version of the Java platform as well as the Spring framework requires CAS to switch to the latest iteration of the Spring Boot framework, namely the <code class="highlighter-rouge">2.x</code> series. You can read all about Spring Boot 2 <a href="https://spring.io/blog/2018/03/01/spring-boot-2-0-goes-ga">here</a>.</p>

<div class="alert alert-success">
  <strong>JDK Compatibility</strong><br />Full support for Java 11 will be provided by Spring Boot <code>2.1.x</code>, expected to be released in September 2018.
</div>

<p>Given the impact and utility of the framework in the CAS codebase, a rather large number of changes have had to be introduced in order to achieve a successful upgrade and keep as much of the current functionality as possible. However, a number of areas in CAS are negatively impacted by this upgrade some of which are more visible than others and sometimes for the better. These areas include are but not limited to <a href="https://apereo.github.io/cas/development/installation/Configuring-Metrics.html">CAS metrics</a>, <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">actuator/admin endpoints</a> as well as their security and protection strategy.</p>

<p>It is quite likely that CAS would ultimately switch to Spring Boot <code class="highlighter-rouge">2.1.x</code> to take full advantage of Java 11 support.</p>

<h4 id="metrics">Metrics</h4>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />This is a breaking change. Consult the CAS documentation and adjust accordingly.
</div>

<p>As part of the Spring Boot v2 upgrade, <a href="https://apereo.github.io/cas/development/installation/Configuring-Metrics.html">CAS metrics</a> are cleaned up as much as possible to delegate the entire task of capturing and recording metrics to Spring Boot, which internally delegates that functionality by auto-configuring components from the <a href="https://github.com/micrometer-metrics/micrometer">micrometer project</a>. This is an application metrics facade for the most popular monitoring tools whose connection information is entirely controlled by specific properties and settings provided by Spring Boot. In this area, CAS only begins to prepare the deployment environment with the right set of dependencies and libraries and then gets out of the way, allowing micrometer and native Spring Boot functionality to take over.</p>

<p>While <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-metrics.html">a large set of options</a> are supported by micrometer and auto-configured by Spring Boot to capture and store metrics, as a result of this change support for services such as MongoDb, Redis and such are removed from CAS given support for the equivalent components in Spring Boot is removed. However, note that micrometer continues to add support for newer services and target systems and by simply keeping the dependencies up-to-date and relevant, those options would automatically become available to CAS.</p>

<h4 id="endpoints">Endpoints</h4>

<p>Actuator endpoints, known in CAS as <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">admin endpoints</a>, let you monitor and interact with your application. Spring Boot includes a number of built-in endpoints and lets you add your own. For example, the <code class="highlighter-rouge">health</code> endpoint provides basic application health information. Spring Boot 2 brings a brand new endpoint infrastructure that allows you to define one or several operations in a technology independent fashion with support for Spring MVC, Spring WebFlux and more.</p>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />This is a breaking change. Consult the CAS documentation and adjust accordingly.
</div>

<p>This means while the endpoints provided by Spring Boot will transition quite nicely over to CAS 6, those that are provided by CAS needed to be redesigned again to lend themselves to the new technology-agnostic strategy. In this new model, endpoints exhibit the following traits:</p>

<ul>
  <li>Each endpoint can be individually enabled or disabled and a global default is available to control this behavior en mass.</li>
  <li>The security of each endpoint is entirely controlled by Spring Security, once and if found in the application bundle on the <em>classpath</em>. More on this later in the following section.</li>
  <li>Each endpoint may be individually chosen for exposure over the web.</li>
  <li>By default, endpoints are exposed over HTTP under the <code class="highlighter-rouge">/actuator</code> path by using the ID of the endpoint. However, endpoints can be remapped. For example, the following settings remap <code class="highlighter-rouge">/actuator/health</code> to <code class="highlighter-rouge">/healthcheck</code>:</li>
</ul>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">management.endpoints.web.base-path</span><span class="p">=</span><span class="s">/</span>
<span class="py">management.endpoints.web.path-mapping.health</span><span class="p">=</span><span class="s">healthcheck</span>
</code></pre></div></div>

<div class="alert alert-success">
  <strong>Dashboards</strong><br />Note that all UI functionality and dashboards are removed from the CAS where the server is only tasked to fetch and produce data using the available endpoints in RESTful and secure ways. The ultimate end goal is to introduce relevant UI components and screens into the CAS management web application that would consume data from such endpoints, making the management web application truly a <i>management</i> web application.
</div>

<p>To learn more about endpoints, monitors and health indicators from the Spring Boot perspective, please <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html">review this document</a>.</p>

<h5 id="endpoint-security">Endpoint Security</h5>

<p>Endpoint security in Spring Boot v2 and by extension CAS receives a complete overhaul. All endpoints are considered disabled and sensitive by default, protected by a pair of pre-defined master credentials in CAS properties. Spring Boot 2.0 does not provide separate auto-configuration for user-defined endpoints and actuator endpoints with a rather overloaded <code class="highlighter-rouge">sensitive</code> property. All that functionality is handed off to Spring Security.</p>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />This is a breaking change. Consult the CAS documentation and adjust accordingly.
</div>

<p>When Spring Security is on the classpath, the auto-configuration secures all endpoints by default. CAS relies on Spring Security’s content-negotiation strategy to determine whether to use <code class="highlighter-rouge">httpBasic</code> or <code class="highlighter-rouge">formLogin</code>, and security of endpoints is extended by CAS configuration to determine the access level and permissions of each endpoint. There will be follow-up guides and posts about how to get endpoints secured and available for proper access but for now, <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html#security">this document</a> should be a decent starting point.</p>

<h4 id="cas-command-line-shell">CAS Command-line Shell</h4>

<p>The <a href="https://apereo.github.io/cas/development/installation/Configuring-Commandline-Shell.html">CAS command-line shell</a>, as a result of upgrading to the latest Spring Shell version, is impacted such that basic command-line options available in the non-interactive version of the shell are now removed. This means that you may still log into the shell and work with available CAS commands as you did interactively, taking advantage of features such as command history, tab completion, etc.</p>

<h4 id="dynamic-saml2-metadata">Dynamic SAML2 Metadata</h4>

<p><a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-DynamicMetadata.html">Dynamic SAML2 metadata management</a> via JPA and MongoDb
is now able to support and store SAML2 identity provider metadata artifacts. Support for additional storage options may be added in future on demand.</p>

<h4 id="webflow-decorations">Webflow Decorations</h4>

<p>Learn how to fetch and display data dynamically from external data sources and endpoints and pass those along to the webflow by <a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-Decorators.html">reviewing this guide</a>.</p>

<h4 id="adaptive-authentication-ip-intelligence">Adaptive Authentication IP Intelligence</h4>

<p><a href="https://apereo.github.io/cas/development/installation/Configuring-Adaptive-Authentication.html">Adaptive Authentication</a> gains support to examine client IP addresses
using a variety of strategies to determine whether requests should be allowed or rejected.</p>

<h4 id="azure-mfa-integration">Azure MFA Integration</h4>

<p>The integration with <a href="https://apereo.github.io/cas/5.3.x/installation/MicrosoftAzure-Authentication.html">Microsoft’s Azure multifactor authentication</a>, previously marked as deprecated functionality, is now removed from CAS.</p>

<h4 id="google-authenticator-account-management">Google Authenticator Account Management</h4>

<p>Accounts registered with <a href="https://apereo.github.io/cas/development/installation/GoogleAuthenticator-Authentication.html">Google Authenticator</a> can now be monitored
and managed administratively via <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">CAS monitoring capabilities</a>.</p>

<h4 id="oauth--openid-connect-json-output">OAuth &amp; OpenID Connect JSON Output</h4>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />This is a breaking change. Service definitions and/or schemas need to be updated accordingly.
</div>

<p>The <code class="highlighter-rouge">jsonFormat</code> property assigned to each OAuth or OpenID Connect services is now removed and JSON is now made the default output syntax.</p>

<h4 id="oauth-device-flow">OAuth Device Flow</h4>

<p>OAuth device flow is <a href="https://apereo.github.io/cas/development/installation/OAuth-OpenId-Authentication.html">now supported</a>.</p>

<h4 id="oauth-proof-key-code-exchange-pkce">OAuth Proof Key Code Exchange (PKCE)</h4>

<p>OAuth PKCE flow is <a href="https://apereo.github.io/cas/development/installation/OAuth-OpenId-Authentication.html">now supported</a>.</p>

<h4 id="cas-as-multifactor-authentication-provider">CAS as Multifactor Authentication Provider</h4>

<p>CAS gains the ability to act as a <a href="https://apereo.github.io/cas/development/installation/Simple-Multifactor-Authentication.html">simple multifactor authentication provider</a>,
issuing tokens on its own and sharing them with the end-user via email and/or text messages.</p>

<h4 id="couchbase-audits">Couchbase Audits</h4>

<p>Couchbase is now supported for <a href="https://apereo.github.io/cas/development/installation/Audits.html">CAS audit logs</a>.</p>

<h4 id="saml2-metadata-health-status">SAML2 Metadata Health Status</h4>

<p>Status of SAML metadata assigned to a SAML service can now be reported back as part of the <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">CAS health monitoring</a>.</p>

<h4 id="oauth-token-introspection">OAuth Token Introspection</h4>

<p>CAS OAuth support can now lend itself to <a href="https://apereo.github.io/cas/development/installation/OAuth-OpenId-Authentication.html#endpoints">token introspection</a>. The semantics of this functionality are identical to that of OpenID Connect.</p>

<h4 id="yubikey-account-management">YubiKey Account Management</h4>

<p>Accounts registered with <a href="https://apereo.github.io/cas/development/installation/YubiKey-Authentication.html">YubiKey Authentication</a> can now be monitored
and managed administratively via <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">CAS monitoring capabilities</a>.</p>

<h4 id="nexmo-sms-integration">Nexmo SMS Integration</h4>

<p>CAS can now integrate with the <a href="https://apereo.github.io/cas/development/installation/SMS-Messaging-Configuration.html">Nexmo platform</a> for sending text messages.</p>

<h3 id="small-stuff">Small Stuff</h3>

<ul>
  <li>Delegated to the OpenID Connect provider for authentication now supports a new <code class="highlighter-rouge">tenant</code> option.</li>
  <li>Aspects of OpenID Connect discovery profile, such as supported claim types, signing algorithms, etc can now be customized via CAS settings.</li>
  <li>While generating JWTs, a <code class="highlighter-rouge">typ</code>  header parameter is now specified.</li>
  <li>The signing algorithm of <a href="https://apereo.github.io/cas/development/installation/OIDC-Authentication.html#register-clients">OpenID Connect services</a> can now be defined for each RP.</li>
  <li>Delegated authentication should correctly take advantage of the <code class="highlighter-rouge">unauthorizedUrl</code> field assigned to a service definition.</li>
  <li>Delegated authentication should hide aspects of the CAS user interface while auto-redirecting to a provider.</li>
  <li>Additional audit points are now provided for OAuth functionality to capture access token requests and responses as well as device codes.</li>
  <li>The <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">multifactor trusted devices endpoint</a> can now fetch registered devices linked to a user name.</li>
  <li>Internal APIs used to manage Google Authenticator tokens and accounts are improved to support additional removal and counting ops.</li>
  <li>Consistent package import order rules are now applied across the codebase and enforced by Checkstyle.</li>
  <li>CAS is now using <a href="https://sonarcloud.io/dashboard?id=org.apereo.cas%3Acas-server">SonarQube</a> for static analysis and extra code quality measures.</li>
  <li>A ton of improvements to the Travis CI test harness to ensure CAS builds can execute as efficiently as possible while running integration tests.</li>
  <li>Binary attribute values should now be properly encoded in CAS validation payload.</li>
  <li><a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-AUP.html">Acceptable Usage Policy</a> and <a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-Interrupt.html">Interrupt Notification</a> features of CAS are now wired up to play nice with <a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">delegated authentication flow</a>.</li>
  <li>SPNEGO authentication properties are now split into two sections were one deals with system-level settings and the other controls a collection of SPNEGO authntication attempts with support for multiple service principals, etc.</li>
  <li>Small number of adjustments to ensure CAS cookie management can optionally control cookie session-pinning.</li>
</ul>

<h3 id="library-upgrades">Library Upgrades</h3>

<ul>
  <li>Java</li>
  <li>Spring</li>
  <li>Spring Boot</li>
  <li>Apache Tomcat</li>
  <li>Spring Boot Admin</li>
  <li>JUnit</li>
  <li>Kryo</li>
  <li>JAXB</li>
  <li>Swagger</li>
  <li>Eureka</li>
  <li>InfluxDb</li>
  <li>Apache Ignite</li>
  <li>MongoDb Driver</li>
  <li>MariaDb Driver</li>
  <li>PostgreSQL Driver</li>
  <li>Couchbase</li>
  <li>Hazelcast</li>
  <li>MySQL</li>
  <li>Guava</li>
  <li>Amazon SDK</li>
  <li>Twilio</li>
  <li>Pac4j</li>
  <li>Nimbus JWT</li>
  <li>Cassandra Driver</li>
  <li>Font Awesome</li>
  <li>Bootstrap</li>
</ul>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://apereo.github.io/cas/development/">Documentation</a></li>
  <li><a href="https://github.com/apereo/cas/milestones">Release Schedule</a></li>
  <li><a href="https://apereo.github.io/cas/developer/Release-Policy.html">Release Policy</a></li>
</ul>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="credits">Credits</h2>

<p>Big thanks to all who participate in the development of this release to submit patches and contribute improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/08/03/600rc1-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 6.0.0 RC1 release.
                    
                </description>
                <pubDate>Fri, 03 Aug 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS Delegated Authentication with ADFS</title>
                <link>https://apereo.github.io/2018/07/31/cas6-delegated-authn-adfs/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>Apereo CAS has had support to <a href="https://apereo.github.io/cas/development/integration/ADFS-Integration.html">delegated authentication to Microsoft ADFS</a> for quite some time now. This functionality, if memory serves me correctly, started around CAS <code class="highlighter-rouge">3.x</code> in form of an <a href="https://github.com/Unicon/cas-adfs-integration">extension</a> which then later found its way into the CAS codebase as a first class feature. Since then, the functionality more or less has evolved to allow the adopter less configuration overhead and fancier ways to automated workflows.</p>

<p>The story is actually quite simply: The integration between the CAS Server and ADFS delegates user authentication from CAS Server to ADFS, making CAS Server an ADFS client. <em>Delegation</em> of course is just a fancy word that ultimately means, whether automatically or at the click of a button, the browser is expected to redirect the user to the appropriate ADFS endpoint and on the return trip back, CAS is tasked to parse the response and extract claims, etc in order to establish an authentication session, issue tickets, etc. In other words, in delegated scenarios, the main identity provider is an external system such as ADFS in this case and CAS simply begins to act as a client or <em>proxy</em> in between.</p>

<p>In the most common use case, CAS is made entirely invisible to the end-user such that the redirect simply happens automatically and as far as the audience is concerned, there is only the external identity provider (i.e. ADFS) and the target application that is, of course, prepped to speak the CAS protocol. This is <strong>important note</strong> to consider: target applications are CASified applications. While the end-user just interacts with ADFS and the application, the application itself only interacts with CAS since of course, CAS is proxying the workflow in between. The application should not have to care about the source of the identity information and the intricacies of data extraction from various identity providers. It cannot. Its sole concern is to speak the CAS protocol and exchange a service ticket with the CAS server for the <em>right stuff</em> that CAS may have gathered from any number of sources.</p>

<p>Of course, you and I know that source could very well be ADFS; but that’s just between you and me…and let’s keep it that way!</p>

<div class="alert alert-success">
  <strong>Usage Warning</strong><br />If you are trying to figure how you may log into ADFS while CAS plays the role of a SAML2 identity provider, you are in the wrong place. Please <a href="https://apereo.github.io/2017/11/22/cas-saml-integration-adfs/">read this post</a> instead.
</div>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">6.0.x</code></li>
  <li>Java 11</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a> (The <code class="highlighter-rouge">6.0</code> branch specifically)</li>
</ul>

<div class="alert alert-info">
  <strong>The Cutting Edge</strong><br />Note that as of this writing today, CAS <code>6</code> is very much in development and is not officially released. While the functionality and instructions noted here, more or less remain the same for CAS <code>5</code>, you may want to take steps described here with a pinch of salt, and of course as always, <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">shake well before use</a>.
</div>

<h2 id="configuration">Configuration</h2>

<p>The initial setup is in fact super simple; as the <a href="https://apereo.github.io/cas/development/integration/ADFS-Integration.html">documentation describes</a> you simply need to add the required dependency in your overlay:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cas-server-support-wsfederation-webflow<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>…and then in your <code class="highlighter-rouge">cas.properties</code>, instruct CAS to hand off authentication to ADFS:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.authn.wsfed[0].identityProviderUrl=https://sample.adfs.org/adfs/ls/
# cas.authn.wsfed[0].identityProviderIdentifier=http://sample.adfs.org/adfs/services/trust
# cas.authn.wsfed[0].relyingPartyIdentifier=urn:cas:sample
# cas.authn.wsfed[0].name=ADFS Server
# cas.authn.wsfed[0].identityAttribute=upn
# cas.authn.wsfed[0].signingCertificateResources=file:/etc/cas/adfs-signing.cer
# cas.authn.wsfed[0].autoRedirect=false
</span></code></pre></div></div>

<p>A few tips for the enlightened:</p>

<ul>
  <li>Surely, swap out <code class="highlighter-rouge">sample.adfs.org</code> with your ADFS domain as appropriate.</li>
  <li>Remember to register CAS as a client of ADFS by setting up a relying party trust under the id <code class="highlighter-rouge">urn:cas:sample</code>. You can choose any identifier you prefer, so long as CAS and ADFS both agree to use the same value. If you make changes, please be generous and share the value with both systems.</li>
  <li>ADFS tends to sign responses using a signing certificate. The certificate will need to be obtained and shared with the CAS server with you physically defining its home and sharing that path with CAS, as is done in my example above with <code class="highlighter-rouge">adfs-signing.cer</code>.</li>
  <li>Of course, CAS somehow needs to figure out the authenticated username from the ADFS-produced response. To do this, it tends to look at a specific claim within that response typically released as <code class="highlighter-rouge">upn</code>. That is to say, you need to ensure ADFS is releasing this attribute (or anything else you prefer) to CAS and then ensure CAS is using the same claim name when it begins to do its extraction magic.</li>
</ul>

<p>If you are interested to learn more about the settings, I recommend checking out the <a href="https://apereo.github.io/2017/10/30/intro-cas-cli-shell/">CAS commandline shell</a> or better yet, use the <a href="https://apereo.github.io/2018/06/15/cas53-admin-endpoints-security/">CAS administrator dashboards</a> to look up documentation and <em>configuration metadata</em> by querying for settings.</p>

<h2 id="mutating-attributes">Mutating Attributes</h2>

<p>I wish this section was more about how certain ADFS claims begin to start a revolution, rise up against the X-Men and transform into evil giant XML blobs on demand to wreak havoc but sadly, the topic here is much more boring than that.</p>

<p>As ADFS claims are released to CAS, you are here given the opportunity to transform and <em>mutate</em> those claims and attributes before they are packed into the
 CAS-enveloped authenticated subject. You can add or remove attributes or more commonly change and sanitize values for certain claims. To do so, CAS provides you with a brand-new option to implement said transformation rules as a Groovy script whose path may be taught to CAS as such:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.authn.wsfed[0].attributeMutatorScript.location=file:/etc/cas/config/wsfed-attr.groovy
</span></code></pre></div></div>

<p>…and of course, the script may look like this:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.apereo.cas.*</span>
<span class="kn">import</span> <span class="nn">java.util.*</span>
<span class="kn">import</span> <span class="nn">org.apereo.cas.authentication.*</span>

<span class="kt">def</span> <span class="n">Map</span> <span class="nf">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">attributes</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s2">"Mutating attributes {}"</span><span class="o">,</span> <span class="n">attributes</span><span class="o">)</span>
    <span class="k">return</span> <span class="o">[</span><span class="nl">upn:</span> <span class="s2">"Wolverine"</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>So, we are getting a bunch of claims or attributes from ADFS and are tasked to simply return a map of keys and values. In my example above and regardless of what ADFS delivers to CAS, I decided to only stuff the <code class="highlighter-rouge">upn</code> attribute into that final map with a single value that is <code class="highlighter-rouge">Wolverine</code>. Of course, since <code class="highlighter-rouge">upn</code> is designated to act the username claim, the ultimate CAS principal will be established under the username <code class="highlighter-rouge">Wolverine</code>.</p>

<p>…without the claws, certainly, though <a href="https://apereo.github.io/2017/02/18/onthe-theoryof-possibility/">that is possible too</a>.</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/07/31/cas6-delegated-authn-adfs/</guid>
                <description>
                    
                    Learn how your Apereo CAS deployment may be configured to delegate authentication to Microsoft ADFS.
                    
                </description>
                <pubDate>Tue, 31 Jul 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS Swag with Swagger</title>
                <link>https://apereo.github.io/2018/07/24/cas-apis-swagger/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>For some time now, CAS has had the ability to take advantages of Swagger natively to produce API documentation automatically. The generated documentation supports all CAS endpoints and REST APIs provided they are made available to the runtime application context. This means that any and all modules that declare API endpoints will automatically
be recognized by the CAS Swagger integration, provided of course the module is activated and included in your CAS configuration.</p>

<p>If you wish to learn more about Swagger, please <a href="https://swagger.io/">visit this link</a> and the reference documentation for CAS <code class="highlighter-rouge">5.3.x</code> as of this writing is available <a href="https://apereo.github.io/cas/5.3.x/integration/Swagger-Integration.html">here</a>.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven Overlay</a></li>
</ul>

<h2 id="configuration">Configuration</h2>

<p>The setup is in fact super simple; as the documentation describes you simply need to add the required dependency in your overlay:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cas-server-documentation-swagger<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>…and just to keep things more interesting, I also chose to include support for <a href="https://apereo.github.io/cas/5.3.x/protocol/REST-Protocol.html">CAS REST Protocol</a>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-support-rest<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>That’s it. Package and run the overlay as usual. Once the server is up and running, simply navigate to <code class="highlighter-rouge">https://&lt;your-cas-server-address&gt;/cas/swagger-ui.html</code> and examine the APIs presented to you via Swagger. For instance, this is what I see:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/43123901-d4321800-8f3a-11e8-81ac-57d8a472d427.png" alt="image" /></p>

<p>Notice how certain entries are surrounded in a blue square. This is not a Swagger feature; rather this is me trying to outline that the endpoints and APIs
that are presented as part of the CAS protocol are also automatically picked up by Swagger and presented to you beautifully via this user interface. This behavior, as a reminder,
applies to any module that presents APIs.</p>

<h2 id="finale">Finale</h2>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/07/24/cas-apis-swagger/</guid>
                <description>
                    
                    Enable Swagger integration with your Apereo CAS APIs.
                    
                </description>
                <pubDate>Tue, 24 Jul 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Get Productive with Shell Aliases</title>
                <link>https://apereo.github.io/2018/07/14/shell-aliases-collection/</link>
                <content:encoded>
                    <![CDATA[
                    <p>Over the years, I have collected a number of shell aliases from various blog posts and websites that have tremendously helped me navigate and automate confusing workflows and remember complicated terminal commands. This post, for what it’s worth, is about giving back to the developer community with me sharing aliases I find to be extremely useful in hopes that you, dear reader, also find them useable and productive.</p>

<p>There may be better options for housing such aliases, but for better or worse, all commands are to be put inside <code class="highlighter-rouge">~/.profile</code>, all of which have been exercised on <strong>macOS</strong>.</p>

<h2 id="activate-profile">Activate Profile</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">editp</span><span class="o">=</span><span class="s1">'edit ~/.profile'</span>
<span class="nb">alias </span><span class="nv">actp</span><span class="o">=</span><span class="s1">'source ~/.profile'</span>
</code></pre></div></div>

<h2 id="change-directory">Change Directory</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span>cd..<span class="o">=</span><span class="s1">'cd ../'</span>                         <span class="c"># Go back 1 directory level (for fast typers)</span>
<span class="nb">alias</span> ..<span class="o">=</span><span class="s1">'cd ../'</span>                           <span class="c"># Go back 1 directory level</span>
<span class="nb">alias</span> ...<span class="o">=</span><span class="s1">'cd ../../'</span>                       <span class="c"># Go back 2 directory levels</span>
<span class="nb">alias</span> .3<span class="o">=</span><span class="s1">'cd ../../../'</span>                     <span class="c"># Go back 3 directory levels</span>
<span class="nb">alias</span> .4<span class="o">=</span><span class="s1">'cd ../../../../'</span>                  <span class="c"># Go back 4 directory levels</span>
<span class="nb">alias</span> .5<span class="o">=</span><span class="s1">'cd ../../../../../'</span>               <span class="c"># Go back 5 directory levels</span>
<span class="nb">alias</span> .6<span class="o">=</span><span class="s1">'cd ../../../../../../'</span>            <span class="c"># Go back 6 directory levels</span>
</code></pre></div></div>

<h2 id="editors">Editors</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">edit</span><span class="o">=</span><span class="s2">"code"</span> <span class="c"># Visual Studio Code</span>
<span class="nb">alias </span><span class="nv">this</span><span class="o">=</span><span class="s2">"edit ."</span>
<span class="nb">alias </span><span class="nv">subl</span><span class="o">=</span><span class="s2">"/Applications/Sublime</span><span class="se">\ </span><span class="s2">Text.app/Contents/SharedSupport/bin/subl </span><span class="nv">$@</span><span class="s2">"</span>
<span class="nb">alias </span><span class="nv">this</span><span class="o">=</span><span class="s2">"edit ."</span>
</code></pre></div></div>

<h2 id="variables-for-colorful-output">Variables for Colorful Output</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">BOLD</span><span class="o">=</span><span class="k">$(</span>tput bold<span class="k">)</span>
<span class="nv">BLACK</span><span class="o">=</span><span class="k">$(</span>tput setaf 0<span class="k">)</span>
<span class="nv">WHITE</span><span class="o">=</span><span class="k">$(</span>tput setaf 7<span class="k">)</span>
<span class="nv">BLUE</span><span class="o">=</span><span class="k">$(</span>tput setaf 4<span class="k">)</span>
<span class="nv">GREEN</span><span class="o">=</span><span class="k">$(</span>tput setaf 2<span class="k">)</span>
<span class="nv">NORMAL</span><span class="o">=</span><span class="k">$(</span>tput sgr0<span class="k">)</span>
</code></pre></div></div>

<h2 id="mastering-the-ssh-agent">Mastering the SSH Agent</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">env</span><span class="o">=</span><span class="nv">$HOME</span>/.ssh/environment

<span class="k">function </span>agent_is_running<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$SSH_AUTH_SOCK</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c"># ssh-add returns:</span>
    <span class="c">#   0 = agent running, has keys</span>
    <span class="c">#   1 = agent running, no keys</span>
    <span class="c">#   2 = agent not running</span>
    ssh-add <span class="nt">-l</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1 <span class="o">||</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 1 <span class="o">]</span>
  <span class="k">else
    </span><span class="nb">false
  </span><span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>agent_has_keys<span class="o">()</span> <span class="o">{</span>
  ssh-add <span class="nt">-l</span> <span class="o">&gt;</span>/dev/null 2&gt;&amp;1
<span class="o">}</span>

<span class="k">function </span>agent_load_env<span class="o">()</span> <span class="o">{</span>
  <span class="nb">.</span> <span class="s2">"</span><span class="nv">$env</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null
<span class="o">}</span>

<span class="k">function </span>agent_start<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Starting SSH agent..."</span>
  <span class="o">(</span><span class="nb">umask </span>077<span class="p">;</span> ssh-agent <span class="o">&gt;</span><span class="s2">"</span><span class="nv">$env</span><span class="s2">"</span><span class="o">)</span>
  <span class="nb">.</span> <span class="s2">"</span><span class="nv">$env</span><span class="s2">"</span> <span class="o">&gt;</span>/dev/null
<span class="o">}</span>

<span class="k">function </span>add_all_keys<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Adding SSH keys..."</span>
  <span class="nb">ls</span> ~/.ssh | <span class="nb">grep</span> ^id_rsa.<span class="k">*</span><span class="nv">$ </span>| sed <span class="s2">"s:^:</span><span class="sb">`</span><span class="nb">echo</span> ~<span class="sb">`</span><span class="s2">/.ssh/:"</span> | xargs <span class="nt">-n</span> 1 ssh-add
<span class="o">}</span>

<span class="k">if</span> <span class="o">!</span> agent_is_running<span class="p">;</span> <span class="k">then
  </span>agent_load_env
<span class="k">fi</span>

<span class="c"># if your keys are not stored in ~/.ssh/id_rsa.pub or ~/.ssh/id_dsa.pub, you'll need</span>
<span class="c"># to paste the proper path after ssh-add</span>
<span class="k">if</span> <span class="o">!</span> agent_is_running<span class="p">;</span> <span class="k">then
  </span>agent_start
  add_all_keys
<span class="k">elif</span> <span class="o">!</span> agent_has_keys<span class="p">;</span> <span class="k">then
  </span>add_all_keys
<span class="k">fi

</span><span class="nb">echo</span> <span class="sb">`</span>ssh-add <span class="nt">-l</span> | wc <span class="nt">-l</span><span class="sb">`</span> SSH keys registered.

<span class="nb">unset </span>env
</code></pre></div></div>

<h2 id="fancy-git-prompt">Fancy Git Prompt</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="k">$(</span>brew <span class="nt">--prefix</span> bash-git-prompt<span class="k">)</span><span class="s2">/share/gitprompt.sh"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nv">GIT_PROMPT_THEME</span><span class="o">=</span>Default
    <span class="nb">source</span> <span class="s2">"</span><span class="k">$(</span>brew <span class="nt">--prefix</span> bash-git-prompt<span class="k">)</span><span class="s2">/share/gitprompt.sh"</span>
<span class="k">fi</span>
</code></pre></div></div>

<h2 id="switch-jdk-versions">Switch JDK Versions</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>setjdk<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span><span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
   </span>removeFromPath <span class="s1">'/System/Library/Frameworks/JavaVM.framework/Home/bin'</span>
   <span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="k">${</span><span class="nv">JAVA_HOME</span><span class="p">+x</span><span class="k">}</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>removeFromPath <span class="s2">"</span><span class="nv">$JAVA_HOME</span><span class="s2">/bin"</span>
   <span class="k">fi
   </span><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span><span class="sb">`</span>/usr/libexec/java_home <span class="nt">-v</span> <span class="nv">$@</span><span class="sb">`</span>
   <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$JAVA_HOME</span>/bin:<span class="nv">$PATH</span>
   <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"JAVA_HOME to </span><span class="nv">$@</span><span class="s2">"</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function </span>removeFromPath<span class="o">()</span> <span class="o">{</span>
  <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$PATH</span> | sed <span class="nt">-E</span> <span class="nt">-e</span> <span class="s2">"s;:</span><span class="nv">$1</span><span class="s2">;;"</span> <span class="nt">-e</span> <span class="s2">"s;</span><span class="nv">$1</span><span class="s2">:?;;"</span><span class="k">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>…where you can do:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setjdk 1.8
</code></pre></div></div>

<p>or:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setjdk 11
</code></pre></div></div>

<h2 id="spawn-databases-via-docker">Spawn Databases via Docker</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>mysql<span class="o">()</span> <span class="o">{</span>
    docker run <span class="nt">--name</span> mysql <span class="nt">-p3306</span>:3306 <span class="nt">--env</span><span class="o">=</span><span class="s2">"MYSQL_ROOT_PASSWORD=password"</span> <span class="nt">--env</span><span class="o">=</span><span class="s2">"MYSQL_DATABASE=test"</span> <span class="nt">-d</span> mysql
<span class="o">}</span>

<span class="k">function </span>sqlserver<span class="o">()</span> <span class="o">{</span>
    docker run <span class="nt">-e</span> <span class="s1">'ACCEPT_EULA=Y'</span> <span class="nt">-e</span> <span class="s1">'SA_PASSWORD=p@ssw0rd'</span> <span class="nt">-p</span> 1433:1433 microsoft/mssql-server-linux:2017-CU7
<span class="o">}</span>
</code></pre></div></div>

<h2 id="gradle">Gradle</h2>

<h3 id="dependency-insight">Dependency Insight</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>gdep<span class="o">()</span> <span class="o">{</span>
  ./gradlew dependencyInsight <span class="nt">--configuration</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="nt">--dependency</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
<span class="o">}</span>
</code></pre></div></div>

<p>…where you can do:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdep compileClasspath jackson
</code></pre></div></div>

<h3 id="properties">Properties</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">gprop</span><span class="o">=</span><span class="s2">"edit ~/.gradle/gradle.properties"</span>
</code></pre></div></div>

<h2 id="helpers">Helpers</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">openPorts</span><span class="o">=</span><span class="s1">'sudo lsof -i | grep LISTEN'</span>

<span class="nb">alias </span><span class="nv">cls</span><span class="o">=</span><span class="s2">"clear"</span>
<span class="nb">alias </span><span class="nv">del</span><span class="o">=</span><span class="s1">'rm'</span>
<span class="nb">alias </span><span class="nv">path</span><span class="o">=</span><span class="s1">'echo -e ${PATH//:/\\n}'</span>

<span class="nb">alias </span><span class="nv">hostfile</span><span class="o">=</span><span class="s2">"sudo atom /etc/hosts"</span> <span class="c"># Requires Atom</span>

<span class="k">function </span>mcd<span class="o">()</span> <span class="o">{</span>
  mkdir <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span><span class="p">;</span>
<span class="o">}</span>

<span class="nb">alias </span><span class="nv">dir</span><span class="o">=</span><span class="s2">"ls -a -l"</span>
<span class="nb">alias </span><span class="nv">myip</span><span class="o">=</span><span class="s2">"curl ifconfig.co/json"</span>
</code></pre></div></div>

<h2 id="docker">Docker</h2>

<h3 id="search--destroy">Search &amp; Destroy</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">dkc</span><span class="o">=</span><span class="s2">"docker stop </span><span class="k">$(</span>docker ps <span class="nt">-aq</span><span class="k">)</span><span class="s2">; docker rm </span><span class="k">$(</span>docker ps <span class="nt">-aq</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="ssh-into-container">SSH Into Container</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>dockerssh<span class="o">()</span> <span class="o">{</span>
    <span class="nb">export </span><span class="nv">CID</span><span class="o">=</span><span class="k">$(</span>docker ps <span class="nt">-aqf</span> <span class="s2">"name=</span><span class="nv">$1</span><span class="s2">"</span><span class="k">)</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$CID</span> /bin/bash
<span class="o">}</span>
</code></pre></div></div>

<h2 id="git">Git</h2>

<h3 id="commit-changes">Commit Changes</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>gc<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="k">${</span><span class="nv">GREEN</span><span class="k">}</span><span class="s2">Commit message:</span><span class="se">\n</span><span class="k">${</span><span class="nv">WHITE</span><span class="k">}</span><span class="se">\t</span><span class="nv">$1</span><span class="se">\n</span><span class="k">${</span><span class="nv">NORMAL</span><span class="k">}</span><span class="s2">"</span>

  <span class="nb">echo</span> <span class="s2">"Adding all changes..."</span>
  git add <span class="nt">--all</span>
  <span class="nb">echo</span> <span class="s2">"Committing changes..."</span>
  git commit <span class="nt">-S</span> <span class="nt">-am</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>

  <span class="nb">echo</span> <span class="s2">"Fetching all submodules..."</span>
  <span class="nv">modules</span><span class="o">=(</span><span class="k">$(</span>git submodule | awk <span class="s1">'{print $2}'</span><span class="k">)</span><span class="o">)</span>

  <span class="k">for </span>module <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">modules</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">Switching to module </span><span class="k">${</span><span class="nv">WHITE</span><span class="k">}${</span><span class="nv">module</span><span class="k">}${</span><span class="nv">NORMAL</span><span class="k">}</span><span class="s2">"</span>
    <span class="nb">pushd</span> <span class="nv">$module</span> <span class="o">&gt;</span> /dev/null
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">Fetching status for module </span><span class="k">${</span><span class="nv">WHITE</span><span class="k">}${</span><span class="nv">module</span><span class="k">}${</span><span class="nv">NORMAL</span><span class="k">}</span><span class="s2">"</span>
    <span class="nv">modulestatus</span><span class="o">=</span><span class="k">$(</span>git status <span class="nt">--porcelain</span> | wc <span class="nt">-l</span><span class="k">)</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$modulestatus</span> <span class="nt">-ne</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then
      </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="k">${</span><span class="nv">GREEN</span><span class="k">}</span><span class="s2">Updating module: </span><span class="k">${</span><span class="nv">WHITE</span><span class="k">}${</span><span class="nv">module</span><span class="k">}${</span><span class="nv">NORMAL</span><span class="k">}</span><span class="s2">"</span>

      <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">Adding changes for module </span><span class="k">${</span><span class="nv">WHITE</span><span class="k">}${</span><span class="nv">module</span><span class="k">}${</span><span class="nv">NORMAL</span><span class="k">}</span><span class="s2">"</span>
      git add <span class="nt">--all</span>
      <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">Committing changes for module </span><span class="k">${</span><span class="nv">WHITE</span><span class="k">}${</span><span class="nv">module</span><span class="k">}${</span><span class="nv">NORMAL</span><span class="k">}</span><span class="s2">"</span>
      git commit <span class="nt">-S</span> <span class="nt">-am</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
      git status <span class="nt">--short</span>
    <span class="k">else
      </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">No changes found to commit for module </span><span class="k">${</span><span class="nv">WHITE</span><span class="k">}${</span><span class="nv">module</span><span class="k">}${</span><span class="nv">NORMAL</span><span class="k">}</span><span class="s2">"</span>
    <span class="k">fi
    </span><span class="nb">popd</span> <span class="o">&gt;</span> /dev/null
  <span class="k">done
  </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="k">${</span><span class="nv">GREEN</span><span class="k">}</span><span class="s2">Done!</span><span class="se">\n</span><span class="s2">Status:</span><span class="k">${</span><span class="nv">NORMAL</span><span class="k">}</span><span class="s2">"</span>
  git status
<span class="o">}</span>
</code></pre></div></div>

<h3 id="misc">Misc</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">delmerged</span><span class="o">=</span><span class="s2">"git branch --merged | grep -v "</span><span class="se">\*</span><span class="s2">" | grep -v master | grep -v dev | xargs -n 1 git branch -d"</span>
<span class="nb">alias </span><span class="nv">gco</span><span class="o">=</span><span class="s2">"git checkout </span><span class="nv">$1</span><span class="s2">"</span>
<span class="nb">alias </span><span class="nv">gbo</span><span class="o">=</span><span class="s2">"git checkout -b </span><span class="nv">$1</span><span class="s2">"</span>
<span class="nb">alias </span><span class="nv">gp</span><span class="o">=</span><span class="s2">"git push --set-upstream </span><span class="nv">$1</span><span class="s2"> </span><span class="nv">$2</span><span class="s2">"</span>
<span class="nb">alias </span><span class="nv">gl</span><span class="o">=</span><span class="s2">"git pull </span><span class="nv">$1</span><span class="s2"> </span><span class="nv">$2</span><span class="s2">"</span>
<span class="nb">alias </span><span class="nv">grs</span><span class="o">=</span><span class="s2">"git reset --hard &amp;&amp; git clean -fd"</span>
<span class="nb">alias </span><span class="nv">gba</span><span class="o">=</span><span class="s2">"git branch -a"</span>
<span class="nb">alias </span><span class="nv">gbr</span><span class="o">=</span><span class="s2">"git branch -r"</span>
<span class="nb">alias </span><span class="nv">gs</span><span class="o">=</span><span class="s2">"git status -s -b"</span>
<span class="nb">alias </span><span class="nv">gpl</span><span class="o">=</span><span class="s2">"git pull origin master --no-edit --allow-unrelated-histories"</span>
<span class="nb">alias </span><span class="nv">gps</span><span class="o">=</span><span class="s2">"git push origin master --recurse-submodules=on-demand "</span>
<span class="nb">alias </span><span class="nv">gst</span><span class="o">=</span><span class="s2">"git status"</span>
<span class="nb">alias </span><span class="nv">ggc</span><span class="o">=</span><span class="s2">"git gc --aggressive --prune=now"</span>
</code></pre></div></div>

<h2 id="processes">Processes</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>pidit<span class="o">()</span> <span class="o">{</span>
    ps <span class="nt">-ef</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="nb">grep</span> |  awk <span class="s1">'{print $2}'</span>
<span class="o">}</span>

<span class="k">function </span>proc<span class="o">()</span> <span class="o">{</span>
    ps <span class="nt">-ef</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="nb">grep</span>
<span class="o">}</span>

<span class="k">function </span>kp<span class="o">()</span> <span class="o">{</span>
    ps <span class="nt">-ef</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="nb">grep</span> | awk <span class="s1">'{print $2}'</span> | xargs <span class="nb">kill</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="search-aliases">Search Aliases</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>cm<span class="o">()</span> <span class="o">{</span>
    <span class="nb">alias</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> | head <span class="nt">-n</span> 1
<span class="o">}</span>
</code></pre></div></div>

<h2 id="contribute-to-apereo-blog">Contribute to Apereo Blog</h2>

<p>Once you have cloned the Apereo Blog repository:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">blog</span><span class="o">=</span><span class="s2">"cd /path/to/apereo.github.io"</span>
<span class="nb">alias </span><span class="nv">blogthis</span><span class="o">=</span><span class="s2">"blog; this"</span>
</code></pre></div></div>

<p>That’s it. I hope you find these useful.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/07/14/shell-aliases-collection/</guid>
                <description>
                    
                    A collection of useful shell aliases, gathered over the years to help increase one's productivity and developer happiness.
                    
                </description>
                <pubDate>Sat, 14 Jul 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>feat(conventional_commits): signal breaking changes in commit titles</title>
                <link>https://apereo.github.io/2018/07/07/indicate-breaks-in-conventional-commit-titles/</link>
                <content:encoded>
                    <![CDATA[
                    <h2 id="short-version">Short version</h2>

<ul>
  <li>I like <a href="https://conventionalcommits.org/">Conventional Commits</a>.</li>
  <li>Conventional Commits miss an important opportunity to signal the breakingness
of change in the <em>title</em> rather than just the <em>body</em> of a commit message.</li>
  <li>Introducing a <a href="https://github.com/conventional-changelog/conventionalcommits.org/pull/64">“BREAK: “ prefix</a> might be a good way to do
this. There are other ideas.</li>
  <li>Call to action: help make Conventional Commits better in this and other
respects</li>
</ul>

<p>Status quo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>feat: split `ROLE_VIEW_ABSENCE_HISTORIES`
</code></pre></div></div>

<p>(Is this a breaking change? You’ll have to read the exciting commit message body
and footer to find out…)</p>

<p>Better:</p>

<p><a href="https://github.com/conventional-changelog/conventionalcommits.org/pull/64"><code class="highlighter-rouge">BREAK: feat: split ROLE_VIEW_ABSENCE_HISTORIES</code></a></p>

<p>or</p>

<p><a href="https://github.com/conventional-changelog/conventionalcommits.org/issues/43"><code class="highlighter-rouge">!feat: split ROLE_VIEW_ABSENCE_HISTORIES</code></a></p>

<p>or</p>

<p><a href="https://github.com/conventional-changelog/conventionalcommits.org/pull/63"><code class="highlighter-rouge">FEAT: split ROLE_VIEW_ABSENCE_HISTORIES</code></a></p>

<h2 id="conventional-commits">Conventional Commits</h2>

<p>I like <a href="https://conventionalcommits.org/">Conventional Commits</a>.</p>

<p>Conventional Commits are a commit message format specification. Much of the
value of Conventional Commits is in encouraging <em>semantic commits</em> that thoughtfully express carefully crafted units of meaning.</p>

<p><a href="https://seesparkbox.com/foundry/semantic_commit_messages">Like Jeremy Mack</a>, I think that taking
care to compose single-thought semantic commits makes me a better programmer.</p>

<p>Conventional Commits look like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>feat: turbocharge the whatsit
</code></pre></div></div>

<p>That token at the front is the <em>type</em>, followed on the line by a super-brief
<em>description</em>. This first line altogether is the <em>title</em> of the
commit message.</p>

<p>Conventional Commit messages have an optional body</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fix: correct the twinkle

The twinkle was not previously astronomically correct;
this fix corrects to a precision of six decimal places.

Fixes #14
</code></pre></div></div>

<p>Conventional Commits thinks of the last part of the body as an optional
<em>footer</em>.</p>

<p>Conventional Commits can also express a <em>scope</em>, an area of the project where
the change type is being applied.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docs(song): note that carbon stars are sort-of diamonds in the sky
</code></pre></div></div>

<h3 id="characterizing-breaking-changes-in-the-body-or-footer">Characterizing breaking changes in the body or footer</h3>

<p>Conventional Commits are meant to help with [Semantic Versioning][]. A
release containing only backwards-compatible fixes like</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fix: tighten the goober
</code></pre></div></div>

<p>would be a <em>patch</em> release (like 2.4.1).</p>

<p>A <em>minor</em> release (like 2.5) introducing new features would include commits like</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>feat: expose HRS URLs in the JSON API at /api/urls
</code></pre></div></div>

<p>One is meant to be able to take a look at the commit log and thereby figure out
what sort of Semantic Versioning bump is in order. An adopter faced with a major
release is meant to be able to look at the commit history to inspect the
breaking changes.</p>

<p>Conventional commits of any type can be API-breaking changes. These changes
occasion a <em>major</em> version change (5 to 6, say) in Semantic Versioning. An
author notes the breakingness of a change (and advice for how clients of the
library might adapt to the breaking change) in the <em>body</em> or <em>footer</em> of a
Conventional Commit.</p>

<p>So,</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fix: correct spelling of referrer in header

BREAKING CHANGE: Rather than using misspelled "Referer" as name of header,
instead use correct spelling "Referrer". Clients expecting "Referer" will no
longer receive that header  and will presumably not honor the new "Referrer"
until updated to support this new name for this header.
</code></pre></div></div>

<h2 id="improving-conventional-commits-signal-the-breakingness-in-the-commit-title">Improving Conventional Commits: signal the breakingness in the commit title</h2>

<p>There are contexts in which only the <em>title</em> and not the <em>body</em> of commit
messages display, e.g. in GitHub’s presentation of a branch’s history or in
some Git command line tooling.</p>

<p>Which of these are breaking changes?</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fix: correct spelling of referrer in header
fix: correct spelling of referrer in label
fix: tighten the wingnut
feat: bolt on the blender
</code></pre></div></div>

<p>You can’t tell from the commit title. You’d have to look at the body of the
message for each one to realize that e.g. the header spelling fix is a breaking
change.</p>

<p>I think Conventional Commits should be improved to reliably reflect the
breakingness of change in the <em>title</em> of the commit rather than just in the
<em>body</em>. There are a few ideas on how to do this:</p>

<h3 id="the-sigil-idea">The <a href="https://github.com/conventional-changelog/conventionalcommits.org/issues/43">sigil idea</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>!fix: correct spelling of referrer in header
</code></pre></div></div>

<p>A sigil is delightfully succinct. However, it might not be immediately apparent
to a naive reader what meaning that <code class="highlighter-rouge">!</code> is trying to convey.</p>

<p>Question: how would a screen reader or other accessibility tool treat that
sigil?</p>

<h3 id="the-all-caps-idea">The <a href="https://github.com/conventional-changelog/conventionalcommits.org/pull/63">ALL-CAPS idea</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FIX: correct spelling of referrer in header
</code></pre></div></div>

<p>This solution consumes zero characters. It’s also relatable in that ALL-CAPS ON
THE INTERNET IS SHOUTING and that’s just the idea, to shout out the most
important changes so that adopters can more readily identify the changes that
are breaking their usages. I think it’s likely as readable and self-evident as
a sigil, and it’s elegant that it consumes zero characters.</p>

<p>However, Conventional Commits has not to date specified the capitalization of
<em>type</em>. Some have argued for specifying the capitalization, or specifying that
the capitalization is unspecified. In any case it’s the kind of thing developers
might be inconsistent about. Any inadvertent ALL-CAPS commit messages will be
false positives for this signal.</p>

<p>Question: how well would a screen reader or other accessibility tool present the
fact that the <em>type</em> is ALL-CAPS rather than lowercase?</p>

<h3 id="the-prefix-idea">The <a href="https://github.com/conventional-changelog/conventionalcommits.org/pull/64">prefix idea</a></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BREAK: fix: correct spelling of referrer in header
</code></pre></div></div>

<p>I like this solution best. It consumes 7 characters, but it’s also more
self-documenting, more readily apparent even to someone unfamiliar with
Conventional Commits what it’s trying to say. Which commits are the breaking
changes? Oh yeah, the ones that are shouting at me “BREAK”.</p>

<h2 id="call-to-action">Call to action</h2>

<p>I think that some (required!) way of indicating the breakingness
of change in Conventional Commit titles should be specified. What is often the
most important thing to say about a breaking-change commit shouldn’t be only in
the body of the message.</p>

<p>Maybe you have other ideas for how to convey breakingness in Conventional Commit
commit titles. Maybe you have some expertise to offer about how screen readers
and other accessibility tools would present the title under the different
options under consideration. Maybe you like one of these ideas. Maybe you too
don’t know which solution should be adopted but really wish Conventional Commits
would go ahead and accept <em>some solution</em> so that identifying breaking changes
in repositories using Conventional Commits will get easier sooner. Maybe you
like the status quo just fine and don’t want to see Conventional Commit titles
change for this.</p>

<p>However you think this ought to play out, engage
<a href="https://github.com/conventional-changelog/conventionalcommits.org">in GitHub</a> to help make it happen.</p>

<h2 id="references-and-learn-more">References and learn more</h2>

<ul>
  <li><a href="https://pinboard.in/u:microcline/t:conventional_commits/">Bookmarks about Conventional Commits</a></li>
</ul>

<p>Author: <a href="https://twitter.com/awpetro">Andrew Petro</a></p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/07/07/indicate-breaks-in-conventional-commit-titles/</guid>
                <description>
                    
                    In which I suggest Conventional Commits should be enhanced to reflect the breakingness of commits in their commit message titles.
                    
                </description>
                <pubDate>Sat, 07 Jul 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>uPortal annual report, June 2018 edition</title>
                <link>https://apereo.github.io/2018/06/25/up-annual-report/</link>
                <content:encoded>
                    <![CDATA[
                    <p><a href="https://www.apereo.org/sites/default/files/content/pdfs/Annual%20Report%203June18.pdf">Apereo’s 2017-2018 annual report</a>
includes a section on uPortal, based on
<a href="https://docs.google.com/document/d/1hkn9E-Ke9hROSOlCe957p0Z5BRBlykmw7vKvtzA5ClA/edit?usp=sharing">some notes</a>
the uPortal community
<a href="https://groups.google.com/a/apereo.org/d/topic/uportal-user/6bSRQjvpY8I/discussion">put together</a>.</p>

<p>This post works from that content, evolving towards a more free-standing yet
hyperlinked read.</p>

<p>uPortal continues to lead as an open source enterprise portal solution by
and for higher education.</p>

<h2 id="calls-to-action">Calls to action</h2>

<ul>
  <li>Join <a href="https://www.apereo.org/projects/uportal/uportal-supporting-subscription-model">uPortal’s Supporting Subscription program</a>.</li>
  <li>Propose projects into the new <a href="https://uportal-contrib.github.io/intake-process.html">uPortal Ecosystem Intake Process</a>.</li>
  <li>Directly participate in uPortal.</li>
  <li>Engage in Apereo.</li>
  <li>Become an <a href="https://www.apereo.org/friends">individual Apereo member</a>.</li>
</ul>

<p>(These calls to action are re-stated with supporting detail in the conclusion.)</p>

<h2 id="summary">Summary</h2>

<p>(The year described herein is 2017-05-01 through 2018-04-30).</p>

<ul>
  <li>Growth: Growth of the uPortal-as-ecosystem idiom, with the
<a href="https://github.com/uPortal-Project/uportal-home"><code class="highlighter-rouge">uPortal-home</code></a>
software product successfully graduating from Apereo Incubation,
and 4 new software products entering the ecosystem via a clarified
<a href="https://uportal-contrib.github.io/intake-process.html">Intake Process</a>.</li>
  <li>Life: Almost 100 versioned releases of uPortal ecosystem software products.</li>
  <li>Participation: 7 new core contributors, 1 new core committer, calls, meetups,
presentations, and list discussions, oh my.</li>
  <li>Financial responsibility: $26,000 recurring revenue with a $51,000 fund
balance.</li>
  <li>Hope: to increase recurring revenue to sustainably fund effort
transforming individual and institutional return-on-investment on uPortal
participation and thereby encouraging a virtuous cycle towards more
investment with better ROI encouraging more investment yielding better returns
encouraging more investment yielding…</li>
</ul>

<h2 id="ecosystem">Ecosystem</h2>

<p>A variety of software products complement the core platform to make up the
greater uPortal ecosystem. uPortal further developed the ecosystem idiom this
year, introducing a more formal <a href="https://uportal-contrib.github.io/intake-process.html">uPortal Ecosystem Intake Process</a> clarifying
how to recognize projects as part of the ecosystem, ideally starting
collaboration and openness at a very early stage in these ancillary software
product initiatives.</p>

<p>The ecosystem grew with 1 project successfully exiting Apereo Incubation
(<a href="https://github.com/uPortal-Project/uportal-home"><code class="highlighter-rouge">uPortal-home</code></a>) and 4 new projects entering the ecosystem via
the new <a href="https://uportal-contrib.github.io/intake-process.html">Intake Process</a>:</p>

<ul>
  <li><code class="highlighter-rouge">ESUP-filemanager</code></li>
  <li><code class="highlighter-rouge">Soffit-kotlin-example</code></li>
  <li><code class="highlighter-rouge">uPortal-setup-scripts</code></li>
  <li><code class="highlighter-rouge">uPortal-web-components</code></li>
</ul>

<p>A new <code class="highlighter-rouge">uPortal-contrib</code> Github organization hosts projects upon intake.</p>

<h2 id="releases">Releases</h2>

<p>The project continues to show healthy activity, with almost 100 versioned
releases of software products within the ecosystem.</p>

<p>Counting core, intook, and incubating software products (“software products in
the uPortal ecosystem”), and <em>not</em> counting open source software products in the
neighborhood but not formally part of the ecosystem: <strong>97 total releases</strong>.</p>

<h3 id="uportal-core-releases">uPortal core releases</h3>

<ul>
  <li>22 releases</li>
  <li>(1 major, 7 patch, 1 release candidate, and 13 milestones)</li>
</ul>

<h3 id="alternative-user-interfaces">Alternative user interfaces</h3>

<ul>
  <li><a href="https://github.com/uPortal-Project/uportal-home"><code class="highlighter-rouge">uPortal-home</code></a>: 13 releases (2 major, 6 minor, 5 patch)</li>
  <li><code class="highlighter-rouge">uPortal-app-framework</code>: 16 releases (5 major, 5 minor, 6 patch)</li>
</ul>

<h3 id="portlet-releases">Portlet releases</h3>

<p>9 Portlet software products saw at least one release, with 36 total releases.</p>

<ul>
  <li><code class="highlighter-rouge">AnnouncementsPortlet</code>: 10 releases. (1 minor, 9 patch)</li>
  <li><code class="highlighter-rouge">CalendarPortlet</code>: 4 releases. (1 minor, 3 patch)</li>
  <li><code class="highlighter-rouge">FeedbackPortlet</code>: 3 releases (1 minor, 2 patch)</li>
  <li><code class="highlighter-rouge">JasigWidgetPortlets</code>: 1 minor release.</li>
  <li><code class="highlighter-rouge">NewsReaderPortlet</code>: 7 releases. (1 major, 1 minor, 5 patch)</li>
  <li><code class="highlighter-rouge">NotificationPortlet</code>: 6 releases. (2 minor, 4 patch)</li>
  <li><code class="highlighter-rouge">SimpleContentPortlet</code>: 6 releases. (1 major, 3 minor, 2 patch)</li>
  <li><code class="highlighter-rouge">WeatherPortlet</code>: 2 patch releases.</li>
  <li><code class="highlighter-rouge">WebProxyPortlet</code>: 2 patch releases.</li>
</ul>

<h3 id="supporting-software-products">Supporting software products</h3>

<ul>
  <li>Resource-server: 5 releases (2 minor, 3 patch)</li>
</ul>

<h2 id="participation">Participation</h2>

<p>The core uPortal platform project added 1 new committer (Jim Helwig 2017-07-19)
and 7 new contributors,
with 18 total contributors. This year saw an increase in direct participation by
commmunity members in France, through submissions to the new
<a href="https://uportal-contrib.github.io/intake-process.html">Intake Process</a> and
translations of documentation.</p>

<p>Contributors this year to core uPortal, new in bold:</p>

<ul>
  <li>Ludovic Auxepaules</li>
  <li><strong>Chris Beach</strong></li>
  <li><strong>Josh Brudnak</strong></li>
  <li><strong>Colin Campbell</strong></li>
  <li>Christian Cousquer</li>
  <li><strong>Nisith Dash</strong></li>
  <li><strong>Mairi Fraser</strong></li>
  <li>Benito Gonzalez</li>
  <li><strong>Allan Jackson</strong></li>
  <li><strong>KaJuan Johnson</strong></li>
  <li>Christian Murphy</li>
  <li>Gary Roybal</li>
  <li>Andrew Petro</li>
  <li>Brandon Powell</li>
  <li>Corey Rowe</li>
  <li>Jonathan Tran</li>
  <li>Timothy Vertein</li>
  <li>Drew Wills</li>
</ul>

<p>(Note that this is counting committers and contributors in
<em>the core uPortal platform itself</em> and does not account for contributors and
committers in the other ecosystem projects.)</p>

<p>Public engagement opportunities included 5 calls or webinars, 2 in-person
meetups, 16 conference presentations, and over 1,000 discussion list posts.</p>

<p>Newly introduced shared Google Team Drives welcome collaboration and
sharing of artifacts in less source-code-centric ways. This tooling has already
proven conducive to sharing local user research findings from uPortal adopters.</p>

<p>uPortal handled one security vulnerability this year:</p>

<ul>
  <li>2017-09-26: Feedback portlet injectable fixed in Feedback Portlet <code class="highlighter-rouge">1.2.1</code>.
Aaron Grant, Drew Wills, and Christian Murphy filled roles in the security
incident handling process.</li>
</ul>

<h2 id="financials">Financials</h2>

<p>Institutions can sustain the project through the
<a href="https://www.apereo.org/projects/uportal/uportal-supporting-subscription-model">uPortal Supporting Subscription program</a>,
a rider to the
<a href="https://www.apereo.org/content/apereo-member-organizations">institutional Apereo membership</a>.</p>

<p>uPortal added 1 subscriber to a total of 3 with annual revenue of $26,000 and a
fund balance of $51,000.</p>

<p>Current uPortal Supporting Subscribers:</p>

<ul>
  <li>University of Wisconsin-Madison (uPortal Champion)</li>
  <li>Oakland University (uPortal Booster)</li>
  <li>Brigham Young University (uPortal Friend)</li>
</ul>

<p>Thusfar the project has avoided spending these funds in ad-hoc
ways, preferring to accumulate a stabilizing asset balance and work towards a
level of recurring revenue that will enable a sustainable application of funds.</p>

<p>In the year to come, the project hopes to reach a threshold of
recurring revenue to afford funding a full-time Foundation position charged with</p>

<ul>
  <li>driving down barriers to adoption and participation</li>
  <li>improving the institutional and individual return-on-investment in that
participation.</li>
</ul>

<p>Improving the return-on-investment on adoption and participation will make
adoption and participation more rewarding which will encourage more of it. More investment will create more opportunities to improve the return-on-investment. A
virtuous cycle ensues.</p>

<h2 id="challenges-and-opportunities">Challenges and opportunities</h2>

<h3 id="apereo-as-cve-numbering-authority">Apereo as CVE numbering authority</h3>

<p>Formal vulnerability identifiers (CVE IDs) are prohibitively difficult to
acquire. This limits effectiveness of communication about security.
<a href="https://groups.google.com/a/apereo.org/d/topic/open/WBTjhIaoJj8/discussion">Apereo becoming a CVE Numbering Authority</a> could
reduce friction in and increase effectiveness of communication about security
vulnerabilities.</p>

<h3 id="measuring-and-recruiting-adopters">Measuring and recruiting adopters</h3>

<p>We do not have an effective way to measure adopters. There are doubtless
unrealized opportunities to draw in adopters as
<a href="https://www.apereo.org/content/apereo-member-organizations">Apereo institutional members</a>,
<a href="https://www.apereo.org/projects/uportal/uportal-supporting-subscription-model">uPortal supporting subscription subscribers</a>,
and most importantly as collaborators in the uPortal ecosystem.</p>

<h3 id="growing-the-uportal-ecosystem">Growing the uPortal ecosystem</h3>

<p>The growth of the intake, contrib, ecosystem, and attic concepts and processes
sets the stage to more clearly welcome, characterize, collaborate within, and
communicate about projects in the uPortal ecosystem.</p>

<h3 id="sustainably-converting-uportal-supporting-subscription-revenue-to-forward-progress">Sustainably converting uPortal Supporting Subscription revenue to forward progress</h3>

<p>Hitting recurring revenue thresholds would unlock converting revenue to forward
progress yielding a return-on-investment for subscribers which might encourage
additional investment, a virtuous and sustainable cycle ensuing.</p>

<h3 id="discourse-as-superior-discussion-forums-solution"><a href="https://www.discourse.org/">Discourse</a> as superior discussion forums solution</h3>

<p><a href="https://www.discourse.org/">Discourse</a> has been adopted
<a href="https://community.unizin.org/">elsewhere</a> to positive effect and might do a lot of
good in Apereo as a next step beyond
<a href="https://groups.google.com/a/apereo.org/forum/#!search/uportal">the exising Google Groups forums solution</a>.</p>

<h3 id="collaborate-with-other-apereo-projects">Collaborate with other Apereo projects</h3>

<p>uPortal and other Apereo projects might collaborate more on shared concerns like</p>

<ul>
  <li>project lifecycle process</li>
  <li>security incident handling</li>
  <li>communications</li>
  <li>release engineering</li>
</ul>

<p>doing these and other things better in collaboration than they can be done in
isolated project siloes.</p>

<h2 id="calls-to-action-reprise">Calls to action, reprise</h2>

<ul>
  <li>uPortal adopting institutions,
<strong>join <a href="https://www.apereo.org/projects/uportal/uportal-supporting-subscription-model">uPortal’s Supporting Subscription program</a></strong>.
This rider to an institutional Apereo membership builds
essential recurring revenue for resourcing the uPortal project for confident
sustainability. Begin this as modestly as your institution may need;
every little bit will help this program hit the transformative threshold
of potentially adding a full time staffer focused on carrying uPortal qua open
source project forward. If your institution is already subscribing,
increase your commitment.
<strong>The opportunities for a more confident uPortal future are real.</strong></li>
  <li><strong>Propose ancillary projects</strong> (software products) into
<a href="https://uportal-contrib.github.io/intake-process.html">uPortal’s new Ecosystem Intake Process</a>. It
has never been easier to approach
developing a plug-in for use with uPortal (whether user-facing content,
back-end service, or otherwise). The best time to share code and welcome
involvement of the wider community is the moment you start. If you locally see
a need, it’s very likely that another adopter could learn from this, could
collaborate upon it, or could adopt the add-on and likewise has
locally developed add-ons that you could be adopting too.
<strong>The opportunities for more and better collaboration are real.</strong></li>
  <li><strong>Directly participate in uPortal.</strong> It has never been easier to collaborate
on uPortal, its documentation, and its ancillary projects.
Suggesting an edit to even this “marketing-flavored” post is feasible via
GitHub’s tooling, without leaving your Web browser.
<strong>The opportunities for collaboration are real, and are beyond code.</strong></li>
  <li><strong>Engage in Apereo.</strong> Ensure your institution is a
<a href="https://www.apereo.org/content/apereo-member-organizations">member of Apereo</a>. Maintain an active
relationship with your institutional representative. Engage directly on the
<a href="https://groups.google.com/a/apereo.org/forum/#!forum/open">open@</a> list and ensure you’re subscribed to the
<a href="https://groups.google.com/a/apereo.org/forum/#!forum/announcements">announcements@</a> list.
<strong>The opportunities for participation in all things Apereo are real.</strong></li>
  <li><strong>Become an <a href="https://www.apereo.org/friends">individual Apereo member</a>.</strong>
Apereo’s membership model is no longer
solely that of higher education institutions as members – you as an
individual human being can join, gaining a vote for a Foundation
Board seat.
<strong>The opportunities to engage in more interesting ways are real.</strong></li>
</ul>

<p>- Andrew Petro</p>

<p>wearing individual contributor <a href="https://www.apache.org/foundation/how-it-works.html#hats">hat</a>.</p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/06/25/up-annual-report/</guid>
                <description>
                    
                    Ecoysystem. Releases.  Community. Fiscal responsibility.
                    
                </description>
                <pubDate>Mon, 25 Jun 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>One Can Only Hope in Buchistan</title>
                <link>https://apereo.github.io/2018/06/22/united-nations-buchistan/</link>
                <content:encoded>
                    <![CDATA[
                    <blockquote>
  <p><em>A true story inspired by real events. Seriously. Bryan Cranston has been approached for the role of “Some”.</em></p>
</blockquote>

<ul>
  <li>United Nations Strategic Alliance Hotline. How may I help you?</li>
  <li>Hi there. This is Some Person and I am calling to share some valuable suggestions about the desperate state of Buchistan with you. Is this the right line?</li>
  <li>Certainly. What seems to be your concern?</li>
  <li>I don’t know if you are keeping tabs on this, but Buchistan is in complete disarray. Crime is rampant and deadly infectious diseases are widespread. People…</li>
  <li>If you would allow me a quick mome…</li>
  <li>…are starving and wildlife habitat is miserably endangered. Natural resources are at an all-time low. <em>Sigh</em>…I am really not sure how I am supposed to…</li>
  <li>If I could ask for your…</li>
  <li>…take my enterprise family to production…I mean…vacation next month with all this misery. The entire state of affairs in Buchistan is like one horror show after another; the very real combination of all <a href="https://www.imdb.com/title/tt2085059/">Black Mirror</a> episodes combined into one giant pile of despondent torturous anguish looping through for all eternity. What is being done about this?</li>
  <li>We are pulling all our resources into resolving issues. In fact, there is a great website with instructions on how you can get invo…</li>
  <li>My apologies; I simply have no time or energy to spare here. Just wanted to share notes and let you know that I will not be considering Buchistan for any joyous excursions unless and until such issues are handled.</li>
  <li>Understood; thank you Some. I can assure you that all concerns are being reviewed. We will have more news on this later.</li>
  <li>Ah, that is so wonderful to hear. When?</li>
  <li>Some time.</li>
</ul>

<p>#HappyFriday</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/06/22/united-nations-buchistan/</guid>
                <description>
                    
                    A true story inspired by real events. Seriously. Bryan Cranston has been approached for the role of &quot;Some&quot;.
                    
                </description>
                <pubDate>Fri, 22 Jun 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Extending Webflows</title>
                <link>https://apereo.github.io/2018/06/19/cas53webflow-extensions/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>Unlike previous versions, CAS 5 attempts to automate all required Spring Webflow changes on a per-module basis. In this new model, all one should have to do is to declare the appropriate module in the build script…and viola! CAS will take care of the rest.</p>

<p>If you wish to learn how that is done internally and furthermore, how you may take advantage of the same approach to extend CAS webflows and introduce your own, this is the right post for you.</p>

<p>This tutorial specifically requires and focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://apereo.github.io/cas/development/installation/Maven-Overlay-Installation.html">Maven WAR Overlay</a></li>
</ul>

<p>This post <em>might</em> equally apply to CAS <code class="highlighter-rouge">5.2.x</code>. YMMV. To learn the same answers with CAS <code class="highlighter-rouge">5.0.x</code>, please <a href="https://apereo.github.io/2016/10/07/webflow-extcfg/">see this post</a>.</p>

<h1 id="webflow-configurers">Webflow Configurers</h1>

<p>Every CAS module that needs to dynamically augment the Spring Webflow routes simply takes on the following form:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">cas</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomethingWebflowConfigurer</span> <span class="kd">extends</span> <span class="n">AbstractCasWebflowConfigurer</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">SomethingWebflowConfigurer</span><span class="o">(</span><span class="kd">final</span> <span class="n">FlowBuilderServices</span> <span class="n">flowBuilderServices</span><span class="o">,</span>
                                    <span class="kd">final</span> <span class="n">FlowDefinitionRegistry</span> <span class="n">loginFlowDefinitionRegistry</span><span class="o">,</span>
                                    <span class="kd">final</span> <span class="n">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">,</span>
                                    <span class="kd">final</span> <span class="n">CasConfigurationProperties</span> <span class="n">casProperties</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">flowBuilderServices</span><span class="o">,</span> <span class="n">loginFlowDefinitionRegistry</span><span class="o">,</span> <span class="n">applicationContext</span><span class="o">,</span> <span class="n">casProperties</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInitialize</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">Flow</span> <span class="n">flow</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getLoginFlow</span><span class="o">();</span>
        <span class="c1">// Magic happens; Call 'super' to see what you have access to...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>CAS modules register their <code class="highlighter-rouge">WebflowConfigurer</code> instances in <code class="highlighter-rouge">@Configuration</code> classes:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">cas</span><span class="o">;</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="s">"SomethingConfiguration"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomethingConfiguration</span> <span class="kd">implements</span> <span class="n">CasWebflowExecutionPlanConfigurer</span>  <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"loginFlowRegistry"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">FlowDefinitionRegistry</span> <span class="n">loginFlowDefinitionRegistry</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">FlowBuilderServices</span> <span class="n">flowBuilderServices</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CasConfigurationProperties</span> <span class="n">casProperties</span><span class="o">;</span>

    <span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"somethingWebflowConfigurer"</span><span class="o">)</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">CasWebflowConfigurer</span> <span class="nf">somethingWebflowConfigurer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">SomethingWebflowConfigurer</span><span class="o">(</span><span class="n">flowBuilderServices</span><span class="o">,</span> <span class="n">loginFlowDefinitionRegistry</span><span class="o">,</span>
            <span class="n">applicationContext</span><span class="o">,</span> <span class="n">casProperties</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureWebflowExecutionPlan</span><span class="o">(</span><span class="kd">final</span> <span class="n">CasWebflowExecutionPlan</span> <span class="n">plan</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">plan</span><span class="o">.</span><span class="na">registerWebflowConfigurer</span><span class="o">(</span><span class="n">somethingWebflowConfigurer</span><span class="o">());</span>
    <span class="o">}</span>
    
<span class="o">}</span>
</code></pre></div></div>

<p>Note that each <code class="highlighter-rouge">CasWebflowConfigurer</code> implementation may be assigned a specific <em>order</em> which is a numeric weight that determines its execution position once webflow auto-configuration kicks into action.</p>

<div class="alert alert-warning">
  <strong>Remember</strong><br />If you are looking for XML flow definitions to extend CAS, you are simply holding it wrong. While you may be creative enough to find a solution and make that approach work, it is pretty much guaranteed that your design will break quite quickly in the next upgrade.
</div>

<p>Next, we just need to ensure that CAS is able to pick up our special configuration. To do so, create a <code class="highlighter-rouge">src/main/resources/META-INF/spring.factories</code> file and reference the configuration class in it as such:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span><span class="p">=</span><span class="s">com.example.cas.SomethingConfiguration</span>
</code></pre></div></div>

<p>…and that should be it.</p>

<h1 id="so">So…</h1>

<p>CAS itself handles Spring Webflow changes related to its first-class features by default automatically. That strategy equally applies, should you need to write your own configurers if you absolutely need to. Be sure to take extra as accidents may happen. What if you have two <code class="highlighter-rouge">WebflowConfigurer</code>s who all decide to inject actions and state into the same Spring Webflow areas? What if multiple <code class="highlighter-rouge">WebflowConfigurer</code>s are competing to set themselves up as starting points of the CAS webflow? Who wins, who mourns?</p>

<p>Indeed, these are questions you ought to be thinking about as a <em>developer</em>. With power comes responsibility.</p>

<h1 id="remember">Remember</h1>

<ul>
  <li>Changes are all scoped to one technology, that is Java.</li>
  <li>You have the full power of Java to dynamically augment the Spring Webflow as you see fit.</li>
  <li>Your changes are all self-contained.</li>
  <li>Unlike XML, your changes are now part of the CAS APIs. If you upgrade and something breaks, you will be notified immediately at build time.</li>
</ul>

<p>That’s all.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/06/19/cas53webflow-extensions/</guid>
                <description>
                    
                    Learn and master extending CAS 5 Spring Webflow definitions.
                    
                </description>
                <pubDate>Tue, 19 Jun 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Administrative Endpoints &amp; Monitoring</title>
                <link>https://apereo.github.io/2018/06/15/cas53-admin-endpoints-security/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>CAS, being a Spring-Boot application at heart, includes a number of additional features to help you monitor and manage the server when it’s pushed to production. You can choose to manage and monitor the deployment using HTTP endpoints, referred to as <em>actuators</em>. This tutorial provides a basic overview of the endpoints provided by both Spring Boot and CAS and also provides instructions on how such endpoints can be secured for access and win.</p>

<p>This tutorial specifically requires and focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://stedolan.github.io/jq/">CLI JSON Processor <code class="highlighter-rouge">jq</code></a></li>
  <li><a href="https://apereo.github.io/cas/development/installation/Maven-Overlay-Installation.html">Maven WAR Overlay</a></li>
</ul>

<h1 id="actuawhat">Actua…What?</h1>

<p>In essence, actuator endpoints bring production-ready features to CAS. Monitoring a running CAS instance, gathering metrics, understanding traffic or the state of our database becomes trivial with such endpoints. The main benefit of these endpoints is that we can get production grade tools without having to actually implement these features ourselves. Actuators are mainly used to expose operational information about the running application – health, metrics, info, dump, env, etc. These are HTTP endpoints or JMX beans to enable us to interact with it.</p>

<div class="alert alert-info">
<strong>Definition</strong><br />An actuator is a manufacturing term, referring to a mechanical device for moving or controlling something. Actuators can generate a large amount of motion from a small change.</div>

<p>The full list of endpoints provided to your CAS deployment <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">is posted here</a>. Note that you do not need to do anything extra special to get these endpoints added to your deployment; these are all available by default and just need to be turned on and secured for access.</p>

<h1 id="endpoints">Endpoints</h1>

<p>Each endpoint, whether provided by CAS or Spring Boot, is generally given two special properties:</p>

<ul>
  <li><code class="highlighter-rouge">enabled</code>: Turn on the endpoint and make it available for access by outsiders.</li>
  <li><code class="highlighter-rouge">sensitive</code>: Determines whether endpoint security should be controlled via the likes of <a href="https://spring.io/projects/spring-security">Spring Security</a> with extra configuration.</li>
</ul>

<p>So as an example, if you wish to turn on the <code class="highlighter-rouge">status</code> endpoint in CAS you need to simply turn on the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.monitor.endpoints.status.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.monitor.endpoints.status.sensitive</span><span class="p">=</span><span class="s">false</span>
</code></pre></div></div>

<p>What the above settings indicate is that the <code class="highlighter-rouge">status</code> endpoint should be turned on at runtime and it’s one whose security is <em>NOT</em> controlled by the Spring Security library.</p>

<div class="alert alert-info">
<strong>Sensitivity</strong><br />The <code>sensitive</code> flag is a rather loaded and confusing term presented by the Spring Boot library that has since been revamped and redesigned, starting with Spring Boot v2. It's quite possible that once and if CAS switches Spring Boot v2, the above property pair get cleaned up too.
</div>

<p>So in summary, access to our <code class="highlighter-rouge">status</code> endpoint above is purely dictated by CAS itself which by default is controlled by an IP pattern. So here’s a rule that allows access to all CAS endpoints from everywhere:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.adminPagesSecurity.ip</span><span class="p">=</span><span class="s">.+</span>
</code></pre></div></div>

<p>Once you have the above in place, simply open up a command prompt and execute:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># You might need the -k flag if the server's certificate is untrusted...</span>
<span class="nv">$ </span>curl https://login.example.org/cas/status

Health: UP

Host:       misaghmoayyed
Server:     https://login.example.org
Version:    5.3.0
</code></pre></div></div>

<h1 id="troubleshooting">Troubleshooting</h1>

<p>For easier diagnostics, you need to turn on the following logging configuration in your <code class="highlighter-rouge">log4j2.xml</code> file:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.pac4j"</span> <span class="na">level=</span><span class="s">"debug"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"console"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/AsyncLogger&gt;</span>
<span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">"org.springframework.security"</span> <span class="na">level=</span><span class="s">"debug"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"console"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/AsyncLogger&gt;</span>
</code></pre></div></div>

<p>…which then help you diagnose issues if access to an endpoint is blocked with:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.adminPagesSecurity.ip</span><span class="p">=</span><span class="s">192</span><span class="se">\.</span><span class="s">168</span><span class="se">\.</span><span class="s">3</span><span class="se">\.</span><span class="s">1</span>
</code></pre></div></div>

<p>…and then when you run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl https://login.example.org/cas/status | jq
</code></pre></div></div>

<p>…you might get:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1529124120075</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">401</span><span class="p">,</span><span class="w">
  </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Unauthorized"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No message available"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/cas/status"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>…where the logs would indicate:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO <span class="o">[</span>IpClient] - &lt;Failed to retrieve or validate credentials: Unauthorized IP address: 0:0:0:0:0:0:0:1&gt;
DEBUG <span class="o">[</span>IpClient] - &lt;Failed to retrieve or validate credentials&gt;
org.pac4j.core.exception.CredentialsException: Unauthorized IP address: 0:0:0:0:0:0:0:1
    at org.pac4j.http.credentials.authenticator.IpRegexpAuthenticator.validate...
</code></pre></div></div>

<h1 id="endpoint-security">Endpoint Security</h1>

<p>CAS endpoints prior to the adoption of Spring Boot and family (i.e. CAS v4 and priors) were always protected by an IP pattern which more or less was a regular expression pattern. Today and by default, this same protection mechanism is kept as well where all CAS endpoints are considered disabled whose security is exclusively controlled by the IP pattern noted above. In other words, in the event that access to an endpoint is allowed, (i.e endpoint is enabled and is not marked as sensitive), CAS will attempt to control access by enforcing rules via IP address matching, delegating to itself, etc.</p>

<p>Note that while almost all CAS endpoints can be secured via other means (such as a CAS server), the <code class="highlighter-rouge">/status</code> endpoint is always protected by an IP pattern allowing monitoring and CLI tools to easily query the endpoint from a protected recognized IP address.</p>

<h1 id="lets-boot">Let’s Boot</h1>

<p>As an exercise, let us enable the Spring Boot’s <code class="highlighter-rouge">health</code> &amp; <code class="highlighter-rouge">info</code> endpoints and compare them with CAS’ own <code class="highlighter-rouge">status</code> endpoint. We are also going to secure the <code class="highlighter-rouge">health</code> endpoint using the <a href="https://spring.io/projects/spring-security">Spring Security library</a> by taking advantage of the basic authentication scheme.</p>

<p>So, the first order of business is to simply enable the endpoints:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.adminPagesSecurity.ip</span><span class="p">=</span><span class="s">192</span><span class="se">\.</span><span class="s">168</span><span class="se">\.</span><span class="s">3</span><span class="se">\.</span><span class="s">1</span>

<span class="py">endpoints.health.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">endpoints.health.sensitive</span><span class="p">=</span><span class="s">false</span>

<span class="py">endpoints.info.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">endpoints.info.sensitive</span><span class="p">=</span><span class="s">false</span>
</code></pre></div></div>

<p>…and with executing a request from a trusted IP address that would match the above pattern:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl https://login.example.org/cas/status/health | jq
</code></pre></div></div>

<p>…we shall receive:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>…or we can try the <code class="highlighter-rouge">info</code> endpoint too:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl https://login.example.org/cas/status/info | jq
</code></pre></div></div>

<p>…which results in a lot of information, summarized here for sanity:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="s2">"cas"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5.3.0"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"java"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"home"</span><span class="p">:</span><span class="w"> </span><span class="s2">"../jdk1.8.0_171.jdk/Contents/Home/jre"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.8.0_171"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"vendor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Oracle Corporation"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CAS"</span><span class="p">,</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>Nice. Two questions:</p>

<ul>
  <li>How could we get more information from the <code class="highlighter-rouge">health</code> endpoint?</li>
  <li>Weren’t we going to enable basic authentication for some of these endpoints? What happened there?</li>
</ul>

<h1 id="lets-health">Let’s Health</h1>

<p>According to the documentation, the <code class="highlighter-rouge">health</code> endpoint shows application health information (when the application is secure, a simple “status” when accessed over an unauthenticated connection or full message details when authenticated). That has been the case since our requests are not exactly authenticated. We have simply honored the IP rules when submitting requests but we need to take this one step further and ask for credentials. Fancier modes of authenticating requests to such endpoints are provided by Spring Security (a library Spring Boot depends upon to auto-configure the access rules for endpoints marked as <code class="highlighter-rouge">sensitive</code>). So, let’s get that configured.</p>

<div class="alert alert-info">
<strong>Remember</strong><br />Regardless of your method of authentication, the IP access rules are always in effect and do not back off once you turn on Spring Security and family. If you need the IP access restrictions to go away, simply open up the pattern to allow <code>.+</code> where that would allow you to exclusively rely upon the protection offered by Spring Boot and its authentication strategy.
</div>

<p>The first task is to configure our CAS overlay to include the relevant dependency:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cas-server-webapp-config-security<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>…and then, mark the endpoint as <code class="highlighter-rouge">sensitive</code> in our CAS properties:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">endpoints.health.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">endpoints.health.sensitive</span><span class="p">=</span><span class="s">true</span>
</code></pre></div></div>

<p>Next order of business is to define our <em>master</em> credentials that would be asked of all requests. Note that if the password is left blank, a random password will be generated/printed in the logs by default. We can define our own using the following:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">security.user.name</span><span class="p">=</span><span class="s">wade</span>
<span class="py">security.user.password</span><span class="p">=</span><span class="s">de@dp00L</span>
</code></pre></div></div>

<p>With the above settings, if you try the same request as before:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl https://login.example.org/cas/status/health | jq
</code></pre></div></div>

<p>…you might see the following:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1529126720131</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">401</span><span class="p">,</span><span class="w">
  </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Unauthorized"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Full authentication is required to access this resource"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/cas/status/health"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>So we need to be fully authenticated. Let’s present credentials:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-u</span> wade:de@dp00L https://login.example.org/cas/status/health | jq
</code></pre></div></div>

<p>…and the full output shall then be something as follows where CAS presents some additional health information regarding <code class="highlighter-rouge">session</code> and <code class="highlighter-rouge">memory</code> which correspond to its own health indicators monitoring the runtime memory status as well as the ticket registry repository:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"memory"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"freeMemory"</span><span class="p">:</span><span class="w"> </span><span class="mi">3006834288</span><span class="p">,</span><span class="w">
    </span><span class="s2">"totalMemory"</span><span class="p">:</span><span class="w"> </span><span class="mi">3817865216</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"session"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"sessionCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="s2">"ticketCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"diskSpace"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">500068036608</span><span class="p">,</span><span class="w">
    </span><span class="s2">"free"</span><span class="p">:</span><span class="w"> </span><span class="mi">115889942528</span><span class="p">,</span><span class="w">
    </span><span class="s2">"threshold"</span><span class="p">:</span><span class="w"> </span><span class="mi">10485760</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"refreshScope"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>…and if you happen to submit an incorrect authentication request with bad credentials, you might be presented with:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1529127019737</span><span class="p">,</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">401</span><span class="p">,</span><span class="w">
  </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Unauthorized"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bad credentials"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/cas/status/health"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Of course, this is just basic authentication with a pre-defined pair of credentials. You can get the endpoints secured with a CAS server as well, or you can try basic authentication with an underlying account store backed by LDAP or JDBC…or as always, you can take full advantage of Spring Security in all its glory and design your authentication scheme for the win.</p>

<h1 id="looking-ahead">Looking Ahead</h1>

<p>As an FYI, as of this writing, the CAS version at hand depends on Spring Boot <code class="highlighter-rouge">1.5.x</code> to deliver endpoints and get them secured. Starting with Spring Boot v2, there is no separate auto-configuration for user-defined endpoints and actuator endpoints. Security is strictly controlled and provided by Spring Security if the library is included in CAS and found on the classpath whereby the auto-configuration secures all endpoints by default. Spring Boot then relies on Spring Security’s content-negotiation strategy to determine whether to use a basic authentication mode or form-based login and just like before, a user with a default username and generated password is added, which can be used to log in.</p>

<p>All of that is to say, endpoint security is one area that might get heavily refactored and redesigned in the future once CAS upgrades to Spring Boot v2. This would basically affect CAS configuration in the way that <code class="highlighter-rouge">enabled</code> or <code class="highlighter-rouge">sensitive</code> properties are defined; they might get removed or renamed, etc. There will be follow-up announcements and notes on the subject once the upgrade is available in due time and for now.</p>

<h1 id="monitors">Monitors</h1>

<p>CAS monitors may be defined to report back the health status of the ticket registry and other underlying connections to systems that are in use by CAS. Spring Boot offers a number of monitors known as <code class="highlighter-rouge">HealthIndicator</code>s that are activated given the presence of specific settings (i.e. <code class="highlighter-rouge">spring.mail.*</code>). CAS itself provides a number of other monitors based on the same component whose action may require a combination of a particular dependency module and its relevant settings.</p>

<p>As you saw in the output of the <code class="highlighter-rouge">health</code> endpoint, the default monitors report back brief memory and ticket stats. As an exercise, we shall configure CAS to monitor and report health information on the status of a mail server (the monitor is provided by Spring Boot natively) and we may also let CAS monitor the status of an LDAP server provided where the monitor is this time brought to you by CAS.</p>

<h2 id="mail-server-monitor">Mail Server Monitor</h2>

<p>First, let’s get the mail server configured in CAS:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.mail.host</span><span class="p">=</span><span class="s">localhost</span>
<span class="py">spring.mail.port</span><span class="p">=</span><span class="s">25000</span>
<span class="py">spring.mail.testConnection</span><span class="p">=</span><span class="s">true</span>
</code></pre></div></div>

<p>With the above settings, at runtime CAS begins to create and bootstrap components that need to deal with a mail server and just as well, a special health monitor will get auto-configured to watch the server status and report back results via the <code class="highlighter-rouge">health</code> endpoint.</p>

<div class="alert alert-info">
<strong>Saving Lives</strong><br />This is the power of auto-configuration, saving you time and energy and abstracting you away from all the confusing internal details. Talk about improving productivity and saving lives, the entire configuration of a mail server connector as well as its relevant monitor is done using just a few simple settings!</div>

<p>So, let’s get us a health report:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-u</span> wade:de@dp00L https://login.example.org/cas/status/health | jq
</code></pre></div></div>

<p>…and we shall receive the same sort of report except for this time we have a small blob for <code class="highlighter-rouge">mail</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span><span class="w">
</span><span class="s2">"mail"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"localhost:25000"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>…and if you shut the server down, you might receive:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span><span class="w">
</span><span class="s2">"mail"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOWN"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"localhost:25000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"com.sun.mail.util.MailConnectException: Couldn't connect to host, port: localhost, 25000; timeout -1"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<h2 id="ldap-monitor">LDAP Monitor</h2>

<p>First, let’s add the following dependency to ensure CAS can connect to an LDAP server:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-support-ldap-monitor<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>…and let’s teach CAS where our LDAP server lives:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.monitor.ldap.ldapUrl</span><span class="p">=</span><span class="s">ldap://localhost:389</span>
<span class="py">cas.monitor.ldap.useSsl</span><span class="p">=</span><span class="s">false</span>
</code></pre></div></div>

<div class="alert alert-info">
<strong>Use What You Need</strong><br />Do <b>NOT</b> copy/paste the entire collection of LDAP settings, etc into your CAS configuration; rather pick only the properties that you need. If you do not know what a setting does or means, it's generally safe to ignore it and trust the defaults. This is similar to ordering food; if you have never tried jellyfish, it would be fairly adventurous or dangerous to put that in your burger! Go with what you know and adjust as necessary.</div>

<p>So, once again let’s get us a health report:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-u</span> wade:de@dp00L https://login.example.org/cas/status/health | jq
</code></pre></div></div>

<p>…and we shall receive the same sort of report except for this time we have a small blob for <code class="highlighter-rouge">pooledLdapConnectionFactory</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span><span class="w">
</span><span class="s2">"pooledLdapConnectionFactory"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UP"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"activeCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"idleCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>Additional monitors and health indicators may get added in future CAS versions. Consult the CAS documentation for more info.</p>

<h1 id="what-about">What About…?</h1>

<ul>
  <li><a href="https://apereo.github.io/2018/06/09/cas53-gettingstarted-overlay/">CAS WAR Overlays</a></li>
  <li><a href="https://apereo.github.io/2018/01/08/cas-mfa-duosecurity/">CAS Multifactor Authentication with Duo Security</a></li>
  <li><a href="https://apereo.github.io/2017/03/24/cas51-ldapauthnjasypt-tutorial/">CAS 5 LDAP AuthN and Jasypt Configuration</a></li>
  <li><a href="https://apereo.github.io/2017/03/22/cas51-delauthn-tutorial/">CAS 5 SAML2 Delegated AuthN Tutorial</a></li>
  <li><a href="http://localhost:4000/2018/06/10/cas-userinterface-customizations/">CAS User Interface Customizations</a></li>
  <li><a href="https://apereo.github.io/2018/06/10/cas-mfa-google-authenticator/">CAS Multifactor Authentication with Google Authenticator</a></li>
</ul>

<h1 id="so">So…</h1>

<p>It’s important that you start off simple and make changes one step at a time. Once you have a functional environment, you can gradually and slowly add customizations to move files around.</p>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/06/15/cas53-admin-endpoints-security/</guid>
                <description>
                    
                    Gain insight into your running Apereo CAS deployment in production. Learn how to monitor and manage the server by using HTTP endpoints and gather metrics to diagnose issues and improve performance.
                    
                </description>
                <pubDate>Fri, 15 Jun 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Custom Authentication &amp; Attribute Sources</title>
                <link>https://apereo.github.io/2018/06/12/cas53-authn-handlers/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>While <a href="https://apereo.github.io/cas/development/installation/Configuring-Authentication-Components.html">authentication support</a>
in CAS for a variety of systems is somewhat comprehensive and complex, a common deployment use case
is the task of designing custom authentication schemes.</p>

<p>This post:</p>

<ul>
  <li>Describes the necessary steps needed to design and register a custom authentication strategy (i.e. <code class="highlighter-rouge">AuthenticationHandler</code>).</li>
  <li>Provides an implementation overview of designing customized attribute repository sources (i.e. <code class="highlighter-rouge">IPersonAttributeDao</code>) to fetch user claims.</li>
</ul>

<h1 id="audience">Audience</h1>

<p>This post is intended for Java developers with a basic-to-medium familiarity with Spring, Spring Boot, and Spring Webflow. This is <strong>NOT</strong> a tutorial to be used verbatim via copy/paste. It is instead a recipe for developers to extend CAS based on specialized requirements.</p>

<p>This tutorial specifically requires and focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
  <li><a href="https://apereo.github.io/cas/development/installation/Maven-Overlay-Installation.html">Maven WAR Overlay</a></li>
</ul>

<h1 id="customized-authentication">Customized Authentication</h1>

<p>The overall tasks may be categorized as such:</p>

<ol>
  <li>Design the authentication handler</li>
  <li>Register the authentication handler with the CAS authentication engine.</li>
  <li>Tell CAS to recognize the registration record and authentication configuration.</li>
</ol>

<div class="alert alert-success">
<strong>Collaborate</strong><br />Before stepping into a development mode, consider whether your choice of authentication handler or attribute repository implementation may be contributed back to CAS as a first-class feature, specially if the system with which you are interfacing is somewhat mainstream, robust and in reasonable demand.</div>

<h2 id="design-authentication-handlers">Design Authentication Handlers</h2>

<p>The first step is to define the skeleton for the authentication handler itself. This is the core principal component whose job is to declare support for a given type of credential only to then attempt to validate it and produce a successful result. The core parent component from which all handlers extend is the <code class="highlighter-rouge">AuthenticationHandler</code> interface.</p>

<p>With the assumption that the type of credentials used here deal with the traditional username and password, noted by the infamous <code class="highlighter-rouge">UsernamePasswordCredential</code> below, a more appropriate skeleton to define for a custom authentication handler may seem like the following:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAuthenticationHandler</span> <span class="kd">extends</span> <span class="n">AbstractUsernamePasswordAuthenticationHandler</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="kd">protected</span> <span class="n">HandlerResult</span> <span class="nf">authenticateUsernamePasswordInternal</span><span class="o">(</span><span class="kd">final</span> <span class="n">UsernamePasswordCredential</span> <span class="n">credential</span><span class="o">,</span>
                                                                 <span class="kd">final</span> <span class="n">String</span> <span class="n">originalPassword</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">everythingLooksGood</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">createHandlerResult</span><span class="o">(</span><span class="n">credential</span><span class="o">,</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">principalFactory</span><span class="o">.</span><span class="na">createPrincipal</span><span class="o">(</span><span class="n">username</span><span class="o">),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;());</span>
        <span class="o">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">FailedLoginException</span><span class="o">(</span><span class="s">"Sorry, you have failed!"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note that:</p>

<ul>
  <li>
    <p>Authentication handlers have the ability to produce a fully resolved principal along with attributes. If you have the ability to retrieve attributes
from the same place as the original user/principal account store, the final <code class="highlighter-rouge">Principal</code> object that is resolved here must then be able to carry all
those attributes and claims inside it at construction time.</p>
  </li>
  <li>
    <p>The last parameter, <code class="highlighter-rouge">new ArrayList&lt;&gt;()</code>, is effectively a collection of warnings that are eventually worked into the authentication chain and conditionally shown to the user. Examples of such warnings include password status nearing an expiration date, etc.</p>
  </li>
  <li>
    <p>Authentication handlers also have the ability to block authentication by throwing a number of specific exceptions. A more common exception to throw
back is <code class="highlighter-rouge">FailedLoginException</code> to note authentication failure. Other specific exceptions may be thrown to indicate abnormalities with the account status
itself, such as <code class="highlighter-rouge">AccountDisabledException</code>.</p>
  </li>
  <li>
    <p>Various other components such as <code class="highlighter-rouge">PrincipalNameTransformer</code>s, <code class="highlighter-rouge">PasswordEncoder</code>s and such may also be injected into our handler if need be, though these are skipped for now in this post for simplicity.</p>
  </li>
</ul>

<h2 id="register-authentication-handlers">Register Authentication Handlers</h2>

<p>Once the handler is designed, it needs to be registered with CAS and put into the authentication engine.
This is done via the magic of <code class="highlighter-rouge">@Configuration</code> classes that are picked up automatically at runtime, per your approval,
whose job is to understand how to dynamically modify the application context.</p>

<p>So let’s design our own <code class="highlighter-rouge">@Configuration</code> class:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">cas</span><span class="o">;</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="s">"MyAuthenticationEventExecutionPlanConfiguration"</span><span class="o">)</span>
<span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="n">CasConfigurationProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAuthenticationEventExecutionPlanConfiguration</span>
                    <span class="kd">implements</span> <span class="n">AuthenticationEventExecutionPlanConfigurer</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CasConfigurationProperties</span> <span class="n">casProperties</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">AuthenticationHandler</span> <span class="nf">myAuthenticationHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">MyAuthenticationHandler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyAuthenticationHandler</span><span class="o">();</span>
        <span class="cm">/*
            Configure the handler by invoking various setter methods.
            Note that you also have full access to the collection of resolved CAS settings.
            Note that each authentication handler may optionally qualify for an 'order`
            as well as a unique name.
        */</span>
        <span class="k">return</span> <span class="n">h</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureAuthenticationExecutionPlan</span><span class="o">(</span><span class="kd">final</span> <span class="n">AuthenticationEventExecutionPlan</span> <span class="n">plan</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">feelingGoodOnASundayMorning</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">plan</span><span class="o">.</span><span class="na">registerAuthenticationHandler</span><span class="o">(</span><span class="n">myAuthenticationHandler</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="register-configuration">Register Configuration</h2>

<p>Now that we have properly created and registered our handler with the CAS authentication machinery, we just need to ensure that CAS is able to pick up our special configuration. To do so, create a <code class="highlighter-rouge">src/main/resources/META-INF/spring.factories</code> file and reference the configuration class in it as such:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span><span class="p">=</span><span class="s">com.example.cas.MyAuthenticationEventExecutionPlanConfiguration</span>
</code></pre></div></div>

<p>Note that the configuration registration step is not of CAS doing. It’s a mechanism provided to CAS via <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html">Spring Boot</a>
and it’s an efficient way to pick up and register components into the runtime application context without the additional overhead of component-scanning and such.</p>

<p>At runtime, CAS will try to automatically detect all components and beans that advertise themselves as <code class="highlighter-rouge">AuthenticationEventExecutionPlanConfigurer</code>s. Each detected <code class="highlighter-rouge">AuthenticationEventExecutionPlanConfigurer</code> is then invoked to register its own authentication execution plan. The result of this operation at the end will produce a ready-made collection of authentication handlers that are ready to be invoked by CAS in the given order defined if any.</p>

<h1 id="customized-attribute-repository">Customized Attribute Repository</h1>

<p>Sometimes the method of authentication at hand is unable to produce user attributes, or perhaps you may want to fetch user claims and attributes from a variety of other sources and combine them with the what’s fetched from the authentication source. In either scenario, CAS provides a separate component called <em>Attribute Repository</em> whose task to establish a link between CAS and the <em>real</em> attribute source and its execution is simply tied to the authentication flow somewhat invisibly. There are a lot of attribute repository options supported in CAS by default, and if support for your particular attribute source is absent in CAS, you can certainly build support for that system using the following instructions.</p>

<h2 id="design-attribute-repository">Design Attribute Repository</h2>

<p>Attribute repository implementations need to be based on top of the <a href="https://github.com/apereo/person-directory">Person Directory</a> project, which is a toolkit for resolving persons and attributes from a variety of underlying sources. It consists of a collection of <code class="highlighter-rouge">IPersonAttributeDao</code>s that retrieve, cache, resolve, aggregate and merge person attributes.</p>

<p>The following represents a simple outline of a given attribute repository implementation:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">cas</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FancyPersonAttributeDao</span> <span class="kd">extends</span> <span class="n">BasePersonAttributeDao</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">IUsernameAttributeProvider</span> <span class="n">usernameAttributeProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleUsernameAttributeProvider</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="nd">@SneakyThrows</span>
    <span class="kd">public</span> <span class="n">IPersonAttributes</span> <span class="nf">getPerson</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">uid</span><span class="o">)</span> <span class="o">{</span>
        <span class="cm">/*
            Stuff happens to contact the downstream system and fetch attributes for [uid]...
        */</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">CaseInsensitiveNamedPersonImpl</span><span class="o">(</span><span class="n">uid</span><span class="o">,</span> <span class="n">attributes</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">IPersonAttributes</span><span class="o">&gt;</span> <span class="nf">getPeople</span><span class="o">(</span><span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">getPeopleWithMultivaluedAttributes</span><span class="o">(</span><span class="n">stuffAttributesIntoList</span><span class="o">(</span><span class="n">map</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">IPersonAttributes</span><span class="o">&gt;</span> <span class="nf">getPeopleWithMultivaluedAttributes</span><span class="o">(</span><span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">map</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">IPersonAttributes</span><span class="o">&gt;</span> <span class="n">people</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashSet</span><span class="o">();</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">usernameAttributeProvider</span><span class="o">.</span><span class="na">getUsernameFromQuery</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">IPersonAttributes</span> <span class="n">person</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getPerson</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">person</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">people</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">people</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getPossibleUserAttributeNames</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getAvailableQueryAttributes</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="register-attribute-repository">Register Attribute Repository</h2>

<p>Once the repository is designed, it needs to be registered with CAS and put into the runtime engine. This is done via the magic of <code class="highlighter-rouge">@Configuration</code> classes that are picked up automatically at runtime, per your approval, whose job is to understand how to dynamically modify the application context. To do this, we can reuse the configuration class as above to declare our <code class="highlighter-rouge">IPersonAttributeDao</code> bean:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"fancyPersonAttributeDao"</span><span class="o">)</span>
<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">IPersonAttributeDao</span> <span class="nf">fancyPersonAttributeDao</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">FancyPersonAttributeDao</span><span class="o">(...);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note that each attribute repository implementation may be assigned a specific <em>order</em> which is a numeric weight that determines its execution position once attribute resolution kicks into action. This is a bit you can usually ignore, but it becomes rather important if you decide to design multiple repository implementations whose execution depends on one another’s results. (i.e one repository might need an attribute value from another before it can run its own query).</p>

<p>So, once defined we can register it with CAS inside the same configuration class:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"fancyAttributeRepositoryPlanConfigurer"</span><span class="o">)</span>
<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">PersonDirectoryAttributeRepositoryPlanConfigurer</span> <span class="nf">fancyAttributeRepositoryPlanConfigurer</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">PersonDirectoryAttributeRepositoryPlanConfigurer</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureAttributeRepositoryPlan</span><span class="o">(</span><span class="kd">final</span> <span class="n">PersonDirectoryAttributeRepositoryPlan</span> <span class="n">plan</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">mustRegisterAttributeRepositoryForTheWin</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">plan</span><span class="o">.</span><span class="na">registerAttributeRepository</span><span class="o">(</span><span class="n">fancyPersonAttributeDao</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Of course, if you decide to move the definition and registration steps into a separate <code class="highlighter-rouge">@Configuration</code> class, then the location of that component will need to be taught to the runtime using the same <code class="highlighter-rouge">src/main/resources/META-INF/spring.factories</code> file noted above.</p>

<h1 id="what-about">What About…?</h1>

<ul>
  <li><a href="https://apereo.github.io/2018/01/08/cas-mfa-duosecurity/">CAS Multifactor Authentication with Duo Security</a></li>
  <li><a href="https://apereo.github.io/2017/03/24/cas51-ldapauthnjasypt-tutorial/">CAS 5 LDAP AuthN and Jasypt Configuration</a></li>
  <li><a href="https://apereo.github.io/2017/03/22/cas51-delauthn-tutorial/">CAS 5 SAML2 Delegated AuthN Tutorial</a></li>
  <li><a href="https://apereo.github.io/2018/04/20/cas-delegated-authn-account-linking/">CAS 5 Linking Accounts with Delegated AuthN</a></li>
  <li><a href="https://apereo.github.io/2018/06/10/cas-mfa-google-authenticator/">CAS Multifactor Authentication with Google Authenticator</a></li>
</ul>

<h1 id="so">So…</h1>

<p>It’s important that you start off simple and make changes one step at a time. Once you have a functional environment, you can gradually and slowly add customizations to move files around.</p>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/06/12/cas53-authn-handlers/</guid>
                <description>
                    
                    Master writing custom authentication handlers/schemes in CAS and learn how to design custom data sources that can produce user claims and attributes.
                    
                </description>
                <pubDate>Tue, 12 Jun 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - User Interface Customizations</title>
                <link>https://apereo.github.io/2018/06/10/cas-userinterface-customizations/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<h1 id="overview">Overview</h1>

<p>When it comes to implementing CAS user interface customizations, there are many options and strategies one can use to deliver a unique user experience. There are ways one can customize the default views to overlay changes top of provided HTML files. These views may then be customized and loaded from a variety of locations, and just as well, could be themed using both static and dynamic strategies either globally or on a per-application basis. In this post, we shall review such customization strategies at a high-level, and also touch upon developer tools and methods that allow the changes to quickly go into effect and get deployed.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.0</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven</a></li>
</ul>

<h1 id="overlay-setup">Overlay Setup</h1>

<p>Let’s assume that application registration records are going to be managed as <a href="https://apereo.github.io/cas/development/installation/JSON-Service-Management.html">flat JSON files</a>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>cas-server-support-json-service-registry<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>Next, you must teach CAS how to load JSON registration records from disk. This is done in the <code class="highlighter-rouge">cas.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.serviceRegistry.initFromJson</span><span class="p">=</span><span class="s">false</span>
<span class="py">cas.serviceRegistry.json.location</span><span class="p">=</span><span class="s">file:/etc/cas/services</span>
</code></pre></div></div>

<p>…where a sample <code class="highlighter-rouge">ApplicationName-1001.json</code> would then be placed inside <code class="highlighter-rouge">/etc/cas/services</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ApplicationName"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Fairly simple, thus far. Now, let’s customize the user interface.</p>

<h1 id="overlaying-views">Overlaying Views</h1>

<p>CAS application views are found at <code class="highlighter-rouge">src/main/resources/templates</code> which is a location within the CAS web application itself. In order to modify the CAS HTML views, each view file first needs to be brought over into the overlay. You can use the <code class="highlighter-rouge">build.sh listviews</code> command to see what HTML views are available for customizations. Note that CAS views are broken up into smaller fragments, allowing you to customize and change specific portions of a particular page if needed. At any rate, once the file is chosen simply use <code class="highlighter-rouge">build.sh getview $NAME</code> to bring the <code class="highlighter-rouge">$NAME</code> view into your overlay:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>build.sh getview footer.html

Exploded the CAS web application file.
Searching <span class="k">for </span>view name footer.html...
Found view<span class="o">(</span>s<span class="o">)</span>:
/cas-overlay-template/target/cas/WEB-INF/classes/templates/fragments/footer.html
Created view at /cas-overlay-template/src/main/resources/templates/fragments/footer.html
/cas-overlay-template/src/main/resources/templates/fragments/footer.html
</code></pre></div></div>

<p>Now that you have the <code class="highlighter-rouge">footer.html</code> brought into the overlay, you can simply modify the file at <code class="highlighter-rouge">cas-overlay-template/src/main/resources/templates/fragments/footer.html</code> to introduce your own footer-related changes, and then get the CAS web application deployed to finesse.</p>

<h1 id="deploying-views">Deploying Views</h1>

<p>The quickest way to test such changes is by using the <code class="highlighter-rouge">bootrun</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>build.sh bootrun
</code></pre></div></div>

<p>This command simply runs the CAS web application in an isolated sandboxed mode where local resources such as HTML, CSS, Javascript and other components are <em>watched</em> and <em>reloaded</em> dynamically when changes are detected. In our above example, you can continue to make changes to the <code class="highlighter-rouge">footer.html</code> file and keep refreshing the browser to see the change in action.</p>

<div class="alert alert-success">
<strong>The CAS Watch</strong><br />Files must exist in the overlay before they can be watched. If you add a new local resource into the overlay, you may need to run the <code>bootrun</code> command again so the file becomes watchable.
</div>

<p>Note that view definitions and files are by default cached where the file content is processed and rendered once and then cached for maximum performance. If you wish for changes to be picked up automatically, you do need to disable the cache via the following setting in your <code class="highlighter-rouge">cas.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.thymeleaf.cache</span><span class="p">=</span><span class="s">false</span>
</code></pre></div></div>

<h1 id="externalized-views">Externalized Views</h1>

<h2 id="spring-boot">Spring Boot</h2>

<p>The location of CAS views is by default expected to be found at <code class="highlighter-rouge">src/main/resources/templates</code> which is the sort of behavior controlled and provided by Spring Boot. This location can be controlled using the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.thymeleaf.prefix</span><span class="p">=</span><span class="s">classpath:/templates/</span>
</code></pre></div></div>

<p>This instructs CAS to locate views at the specified location. This location can be externalized to a directory outside the cas web application. Via this option, <em>all CAS views</em> are expected to be found at the specified location and there is no fallback strategy. (Note that multiple prefixes may be specified in comma-separated syntax).</p>

<h2 id="cas">CAS</h2>

<p>As a native CAS feature, Views and HTML files also may be externalized outside the web application conditionally and individually, provided the external path via CAS settings is defined. If a view template file is not found at the externalized path, the default one that ships with CAS will be used as the fallback.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.view.templatePrefixes[0]=</span><span class="py">file</span><span class="p">:</span><span class="s">///etc/cas/templates</span>
</code></pre></div></div>

<p>With the above setting, I can try the following command to let CAS pick up the <code class="highlighter-rouge">footer.html</code> file from the above location:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">mv</span> <span class="err">src/main/resources/templates/fragments</span> <span class="err">/etc/cas/templates</span>
</code></pre></div></div>

<p>Of course, changes should continue to get picked up and deployed dynamically just like before!</p>

<h2 id="restful-views">RESTful Views</h2>

<p>CAS views may also be 100% externalized using a REST API of your own implementation. You will be tasked to design an API endpoint which CAS may contact in order to resolve a particular view specified using a request header. Upon a successful <code class="highlighter-rouge">200</code> status result, the response body of the endpoint is expected to contain the HTML view that will be rendered by CAS in the browser.</p>

<p>To activate RESTful resolution of views, specify the URL endpoint in your CAS properties:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.view.rest.url</span><span class="p">=</span><span class="s">https://rest.somewhere.org/userinterface</span>
</code></pre></div></div>

<h1 id="default-service-url">Default Service URL</h1>

<p>In the event that no <code class="highlighter-rouge">service</code> is submitted to CAS, you may specify a default service URL to which CAS will redirect. Note that this default service, much like all other services, MUST be authorized and registered with CAS and is taught to CAS using the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.view.defaultRedirectUrl</span><span class="p">=</span><span class="s">https://www.github.com</span>
</code></pre></div></div>

<p>Of course, you can also the opposite of this behavior which is to disallow CAS to accept authentication requests if no <code class="highlighter-rouge">service</code> parameter is provided:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.sso.allowMissingServiceParameter</span><span class="p">=</span><span class="s">false</span>
</code></pre></div></div>

<h1 id="localization">Localization</h1>

<p>The CAS Web application includes a number of localized message files for a variety of languages. While the user interface reacts dynamically as <code class="highlighter-rouge">locale</code> is detected automatically, you may forcefully switch the locale and localize the contents of the page using the <code class="highlighter-rouge">locale</code> parameter.</p>

<p>For example, the following URL:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://cas.server.edu/login?locale<span class="o">=</span>it
</code></pre></div></div>

<p>…allows CAS to render the page using the Italian language.</p>

<div class="alert alert-success">
<strong>Remember</strong><br />Note that not all languages are complete and accurate across CAS server releases as translations are entirely dependent upon community contributions. For an accurate and complete list of localized messages, always refer to the English language bundle.
</div>

<p>The default language bundle is for the English language and is thus called <code class="highlighter-rouge">messages.properties</code> found at <code class="highlighter-rouge">src/main/resources</code> which you may need to pull into your own overlay but there may be an easier option. If there are any custom messages that need to be presented into views, they may also be formatted under <code class="highlighter-rouge">custom_messages.properties</code> files which allow you to both defined custom messages as well as those by CAS that need to be overwritten.</p>

<p>So this means I can simply create the language bundle for custom changes:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>touch src/main/resources/custom_messages.properties
</code></pre></div></div>

<p>…and then add the following messages:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># CAS provided message
</span><span class="py">cas.login.resources.contribguide</span><span class="p">=</span><span class="s">Contribute &amp; Engage</span>

<span class="c"># Custom message
</span><span class="py">my.custom.messaage</span><span class="p">=</span><span class="s">Hello, World!</span>
</code></pre></div></div>

<p>The first key is picked and used by CAS automatically since it’s referenced in the main login view. The second key, however, is a custom one specific to the deployment at hand that needs to be pulled into the CAS overlay and relevant views. For simplicity, let’s modify the same <code class="highlighter-rouge">footer.html</code> file we externalized to display this text:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="nt">&lt;footer</span> <span class="na">th:fragment=</span><span class="s">"footer"</span> <span class="na">class=</span><span class="s">"footer"</span> <span class="na">role=</span><span class="s">"contentinfo"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"copyright"</span> <span class="na">th:utext=</span><span class="s">"#{copyright}"</span><span class="nt">&gt;&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">th:utext=</span><span class="s">"#{my.custom.messaage}"</span><span class="nt">&gt;</span>This is the text<span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
...
</code></pre></div></div>

<p>Now, if CAS is actively rendering the <code class="highlighter-rouge">footer.html</code> view then the text linked to the <code class="highlighter-rouge">my.custom.message</code> is displayed. But surely, you can view the HTML page directly inside a browser window without running CAS in which case you get the sample dummy text <em>This is the text</em>.</p>

<p>By default, message bundles are expected to be found at <code class="highlighter-rouge">src/main/resources</code> and are cached just like the views. Let’s make sure the cache is disabled so that our changes to the message bundle can be picked up automatically:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.messageBundle.cacheSeconds</span><span class="p">=</span><span class="s">0</span>
</code></pre></div></div>

<h1 id="themes">Themes</h1>

<p>CAS deployers are now able to switch the themes based on different services. For example, you may want to have different login screens (different styles) for staff applications and student applications. Or, you want to show two layouts for daytime and night time. This document could help you go through the basic settings to achieve this. Themes are generally defined statically either embedded with the CAS web application or externalized outside, and there are a number of strategies one can use to activate, trigger and switch to a theme.</p>

<h2 id="static-themes">Static Themes</h2>

<p>CAS is configured to decorate views based on the <code class="highlighter-rouge">theme</code> property of a given registered service in the Service Registry. The theme that is activated via this method will still preserve the default views for CAS but will simply apply decorations such as CSS and Javascript to the views. The physical structure of views cannot be modified via this method.</p>

<p>To achieve this, add a <code class="highlighter-rouge">dracula.properties</code> placed to the root of <code class="highlighter-rouge">src/main/resources</code> folder. Contents of this file should match the following:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.standard.css.file</span><span class="p">=</span><span class="s">/themes/dracula/css/cas.css</span>
<span class="py">cas.javascript.file</span><span class="p">=</span><span class="s">/themes/dracula/js/cas.js</span>
<span class="py">cas.admin.css.file</span><span class="p">=</span><span class="s">/themes/dracula/css/admin.css</span>
</code></pre></div></div>

<p>Once you have created the above <code class="highlighter-rouge">/themes/dracula</code> directory structure with your own CSS and Javascript files, activate the theme for a relevant application in the registry:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ApplicationName"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="s2">"theme"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dracula"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>To see the theme in action, navigate to <code class="highlighter-rouge">https://sso.example.edu/cas/login?service=https://app.example.org</code>.</p>

<h2 id="themed-views">Themed Views</h2>

<p>CAS can also utilize a service’s associated <code class="highlighter-rouge">theme</code> property to selectively choose which set of UI views will be used to generate the standard views (i.e. <code class="highlighter-rouge">casLoginView.html</code>, etc). This is especially useful in cases where the set of pages for a theme that is targeted for a different type of audience are entirely different structurally, such that simply using a simple theme is not practical. So far, we have only seen basic CSS and Javascript files associated with a theme but what if you wanted the <code class="highlighter-rouge">dracula</code> theme activated for a service to present a different footer? Surely, the capabilities of a theme must go beyond CSS and Javascript, right? <a href="https://apereo.github.io/2017/02/18/onthe-theoryof-possibility/">Is that possible?</a></p>

<p>Yes. Views associated with a particular theme by default are expected to be found at <code class="highlighter-rouge">src/main/resources/templates/&lt;theme-id&gt;</code>. For example, in addition, the CSS and Javascript files for the <code class="highlighter-rouge">dracula</code> theme, you can clone the default set of CAS views into a new directory at <code class="highlighter-rouge">src/main/resources/templates/dracula</code>. When CAS begins to render the UI for <code class="highlighter-rouge">https://app.example.org</code>, it would then look inside <code class="highlighter-rouge">src/main/resources/templates/dracula</code> to find the requested view (i.e. <code class="highlighter-rouge">casLoginView.html</code>) allowing you to control the HTML view on a per-application basis. A themed view will only be used if and once found; otherwise, the defaults will continue to run as expected.</p>

<div class="alert alert-success">
<strong>View vs Fragment</strong><br />Note that from a CAS and/or Thymeleaf perspective, there is a difference between a full view and a fragment. A view generally contains the full outline of a CAS page and may be composed of several smaller reusable fragments, typically found inside the <code>fragments</code> directory. When working with themes, you are tasked with theming the actual view such as <code>casLoginView.html</code> by pulling that file into the right location in the overlay. Attempting to only theme a fragment such as <code>footer.html</code> will not be successful.
</div>

<p>Note that CAS views and theme-based views may both be externalized out of the web application context. When externalized, themed views are expected to be found at the specified path via CAS properties under a directory named after the theme name. For instance, if the external path for CAS views is <code class="highlighter-rouge">/etc/cas/templates</code>, view template files for theme <code class="highlighter-rouge">dracula</code> may be located at <code class="highlighter-rouge">/etc/cas/templates/dracula/</code>.</p>

<h2 id="dynamic-theme-selection">Dynamic Theme Selection</h2>

<p>So far, we have been assigning themes to CAS services rather statically using the <code class="highlighter-rouge">theme</code> property but we can certainly take this to the next step and attempt to trigger themes based on a variety of conditions picked at runtime. Options for dynamic theme triggers are available based on Groovy scripts and/or REST endpoints. Let’s try one with a Groovy script as the trigger.</p>

<p>First, let’s widen the definition of our service to be a slightly more forgiving and assign the groovy script as the <code class="highlighter-rouge">theme</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://.+.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ApplicationName"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="s2">"theme"</span><span class="p">:</span><span class="w"> </span><span class="s2">"file:///etc/cas/config/themes.groovy"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The groovy script is tasked with the responsibility of figuring out the theme name. Of course, whatever the end result, it goes without saying that the theme must itself have been defined elsewhere since we are only controlling the switch here. The script more or less would match the following:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.*</span>

<span class="kt">def</span> <span class="n">String</span> <span class="nf">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">service</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">registeredService</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">queryStrings</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span>

    <span class="cm">/*
      Stuff happens...
    */</span>

    <span class="k">return</span> <span class="s2">"dracula"</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In the above script, you have access to the <code class="highlighter-rouge">service</code> object that represents the requesting application (i.e. <code class="highlighter-rouge">service.id</code> would get you the service URL) as well as the current request query strings and headers and of course, a pointer to the entire body of the registered service definition just in case you need to run some additional checks or control the behavior even more dynamically via <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Custom-Properties.html">CAS custom properties</a>.</p>

<h1 id="so">So…</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p>Happy Coding,</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/06/10/cas-userinterface-customizations/</guid>
                <description>
                    
                    A short tutorial on Apereo CAS user interface customizations, including themes, localization and dynamic views for all those who enjoy front-end development and suffer from instant gratification.
                    
                </description>
                <pubDate>Sun, 10 Jun 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS Multifactor Authentication with Google Authenticator</title>
                <link>https://apereo.github.io/2018/06/10/cas-mfa-google-authenticator/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>A number of CAS deployments that intend to turn on multifactor authentication support tend to do so via Google Authenticator. This is a quick and <em>simplified</em> guide to demonstrate an approach to that use case along with some additional explanations regarding specific multifactor triggers and bypass options supported in CAS today.</p>

<p>Our task list is rather short:</p>

<ol>
  <li>Configure LDAP authentication with CAS</li>
  <li>Trigger Google Authenticator for users who belong to the <code class="highlighter-rouge">mfa-eligible</code> group, indicated by the <code class="highlighter-rouge">memberOf</code> attribute on the LDAP user account.</li>
  <li>Design and explore bypass options that would override the above trigger where needed.</li>
</ol>

<h1 id="environment">Environment</h1>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Maven WAR Overlay</a> (The <code class="highlighter-rouge">5.3</code> branch specifically)</li>
</ul>

<h1 id="configuring-authentication">Configuring Authentication</h1>

<p>Prior to configuring <em>multiple</em> factors of authentication, we need to first establish a primary mode of validating credentials. To kill two birds with one stone [1], we are going to o address yet another common use case and keep things simple by sticking with <a href="https://apereo.github.io/cas/development/installation/LDAP-Authentication.html">LDAP authentication</a>. The strategy here, as indicated by the CAS documentation, is to declare the intention/module in the build script and then configure the relevant <code class="highlighter-rouge">cas.authn.ldap[x]</code> settings for the directory server in use. Most commonly, that would translate into the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.ldap[0]</span><span class="py">.type</span><span class="p">=</span><span class="s">AUTHENTICATED</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.ldapUrl</span><span class="p">=</span><span class="s">ldaps://ldap1.example.org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.baseDn</span><span class="p">=</span><span class="s">dc=example,dc=org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.searchFilter</span><span class="p">=</span><span class="s">cn={user}</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindDn</span><span class="p">=</span><span class="s">cn=Directory Manager,dc=example,dc=org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindCredential</span><span class="p">=</span><span class="s">...</span>
</code></pre></div></div>

<p>Note that the method of authentication, whether on its own or using separate attribute repositories and queries must have the ability to resolve the needed attribute which will be used later by CAS to trigger multifactor authentication. For this context, the simplest way would be to let LDAP authentication retrieve the attribute directly from the directory server.  The following setting allows us to do just that:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.ldap[0]</span><span class="py">.principalAttributeList</span><span class="p">=</span><span class="s">memberOf</span>
</code></pre></div></div>

<p>At this point in the authentication flow, we have established an authenticated subject that would be populated with fetched attribute <code class="highlighter-rouge">memberOf</code>.</p>

<h1 id="configuring-google-authenticator">Configuring Google Authenticator</h1>

<p>Here, our task is to enable <a href="https://apereo.github.io/cas/development/installation/GoogleAuthenticator-Authentication.html">Google Authenticator</a> in CAS. Practically, similar to the LDAP authentication configuration, this involves declaring the right module in the build and then providing specific Google Authenticator settings to CAS properties. Things such as the issuer, label, etc.</p>

<p>Most commonly, the required settings would translate into the following:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.mfa.gauth.issuer</span><span class="p">=</span><span class="s">CAS</span>
<span class="py">cas.authn.mfa.gauth.label</span><span class="p">=</span><span class="s">CASLabel</span>
</code></pre></div></div>

<p>At this point, we have enabled Google Authenticator and we just need to find a way to instruct CAS to route the authentication flow over to Google Authenticator in the appropriate condition. This is where triggers come into place.</p>

<h1 id="configuring-multifactor-authentication-triggers">Configuring Multifactor Authentication Triggers</h1>

<p>The entire purpose of a trigger here is to detect a condition by which the authentication flow should be rerouted. There are a large number of <a href="https://apereo.github.io/cas/development/installation/Configuring-Multifactor-Authentication-Triggers.html">triggers supported by CAS</a>, all of which kick into action and behave all the same regardless of the multifactor authentication provider. Our task here is to build a special condition that activates multifactor authentication if any of the values assigned to the attribute <code class="highlighter-rouge">memberOf</code> contain the value <code class="highlighter-rouge">mfa-eligible</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.mfa.globalPrincipalAttributeNameTriggers</span><span class="p">=</span><span class="s">memberOf</span>
<span class="py">cas.authn.mfa.globalPrincipalAttributeValueRegex</span><span class="p">=</span><span class="s">mfa-eligible</span>
</code></pre></div></div>

<p>Notice that the conditions above do not indicate anything about Google Authenticator. If the above condition holds true, how does CAS know that the authentication flow should be routed to <em>Google Authenticator</em>?</p>

<p>Per the CAS documentation:</p>

<blockquote>
  <p>Trigger MFA based on a principal attribute(s) whose value(s) matches a regex pattern. Note that this behavior is only applicable if there is only a single MFA provider configured since that would allow CAS to know what provider to next activate.</p>
</blockquote>

<p>In other words, if the above condition holds true and CAS is to route to <em>a</em> multifactor authentication flow, that would obviously be one supported and provided by Google Authenticator since that’s the only provider that is currently configured to CAS. Of course, if there are multiple providers available at runtime (i.e. U2F FIDO, YubiKey, etc) then we would need massage the condition since the automatic detection of the multifactor provider would not be immediately obvious…and that sort of thing would be outside the scope of this tutorial.</p>

<h1 id="google-authenticator-device-registration">Google Authenticator Device Registration</h1>

<p>Per the CAS documentation, you need to decide the type of registry that would hold onto devices registered with CAS, authorized to use Google Authenticator. A more common use case here would be to use a relational database to manage issued tokens and devices. There is very little for you to do here, since the device registration flow is built into CAS by default, allowing new devices to register themselves with the system by scanning a QR code and holding on the scratch codes that are produced by CAS.</p>

<h1 id="multifactor-authentication-bypass">Multifactor Authentication Bypass</h1>

<p>Once the above conditions determine that Google Authenticator may be activated as the next step in the authentication flow, CAS presents bypass rules are then consulted to calculate whether the provider should ignore the request and skip MFA conditionally. There are a variety of strategies you may choose to bypass multifactor authentication, one of which is a more static strategy of defining the ignore rule at the service policy level:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"^(https|imaps)://.*"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
  </span><span class="s2">"multifactorPolicy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceMultifactorPolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"bypassEnabled"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>A more dynamic strategy, of course, would be to calculate the end result via a Groovy script. The outcome of the script, if <code class="highlighter-rouge">true</code> indicates that multifactor authentication for the requested provider should proceed. Otherwise <code class="highlighter-rouge">false</code> indicates that multifactor authentication for this provider should be skipped and bypassed.</p>

<p>The path to the groovy script must surely be taught to CAS as a setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.mfa.gauth.bypass.type</span><span class="p">=</span><span class="s">GROOVY</span>
<span class="py">cas.authn.mfa.gauth.bypass.groovy.location</span><span class="p">=</span><span class="s">file:/etc/cas/config/MultifactorBypass.groovy</span>
</code></pre></div></div>

<p>…and a <code class="highlighter-rouge">MultifactorBypass.groovy</code> script would be:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.*</span>

<span class="kt">def</span> <span class="kt">boolean</span> <span class="nf">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">principal</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">registeredService</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">provider</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">httpRequest</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span>

    <span class="c1">// Ignore MFA for everyone, except casuser</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s2">"Evaluating multifactor authn bypass rules for {}"</span><span class="o">,</span> <span class="n">principal</span><span class="o">)</span>
    <span class="k">return</span> <span class="n">principal</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s2">"casuser"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="summary">Summary</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

<p>[1] No birds were harmed during the production of this blog post.</p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/06/10/cas-mfa-google-authenticator/</guid>
                <description>
                    
                    A short walkthrough to demonstrate how one might turn on multifactor authentication with CAS using Google Authenticator, leveraging a variety of triggers.
                    
                </description>
                <pubDate>Sun, 10 Jun 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.3.x Deployment - WAR Overlays</title>
                <link>https://apereo.github.io/2018/06/09/cas53-gettingstarted-overlay/</link>
                <content:encoded>
                    <![CDATA[
                    <p>This is a short and sweet tutorial on how to deploy CAS via <a href="https://apereo.github.io/cas/5.3.x/installation/Maven-Overlay-Installation.html">the WAR Overlay method</a>.</p>

<p>This tutorial specifically requires and focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.x</code></li>
  <li>Java 8</li>
</ul>

<div class="alert alert-info">
  <strong>Need Help?</strong><br />If you ever get stuck and are in need of additional assistance, start by reviewing the suggestions <a href="https://apereo.github.io/cas/5.3.x/installation/Troubleshooting-Guide.html">provided here</a>. You may also look at available support options <a href="https://apereo.github.io/cas/Support.html">provided here</a>.
</div>

<!--
Furthermore, this tutorial assumes that you are running CAS in its `standalone` mode, [described here](https://apereo.github.io/cas/5.3.x/installation/Configuration-Server-Management.html).
-->

<h1 id="overlaywhat">Overlay…What?</h1>

<p>Overlays are a strategy to combat repetitive code and/or resources. Rather than downloading the CAS codebase and building it from source, overlays allow you to download a pre-built vanilla CAS web application server provided by the project itself, override/insert specific behavior into it and then merge it all back together to produce the final (web application) artifact. You can find a lot more about how overlays work <a href="https://apereo.github.io/cas/5.3.x/installation/Maven-Overlay-Installation.html">here</a>.</p>

<p>The concept of the WAR Overlay is NOT a CAS invention. It’s specifically an Apache Maven feature and of course, there are techniques and plugins available to apply the same concept to Gradle-based builds as well.You are free to choose between Maven or Gradle. For this tutorial, I opted into the <a href="https://github.com/apereo/cas-overlay-template">Maven WAR overlay</a>.</p>

<p>Once you have forked and cloned the repository locally, you’re ready to begin.</p>

<div class="alert alert-info">
  <strong>Note</strong><br />Remember to switch to the appropriate branch. Today, the <code>master</code> branch of the repository applies to CAS <code>5.2.x</code> deployments. That may not necessarily remain true when you start your own deployment. So examine the branches and make sure you <code>checkout</code> the one matching your intended CAS version.
</div>

<h1 id="overlays-anatomy">Overlay’s Anatomy</h1>

<p>Similar to Grey’s, a <em>Maven</em> WAR overlay is composed of several facets the most important of which is the <code class="highlighter-rouge">pom.xml</code> file. This is a build descriptor file whose job is to teach Apache Maven how to obtain, build, configure (and in certain cases deploy) artifacts.</p>

<div class="alert alert-info">
  <strong>KISS</strong><br />You do not need to download Apache Maven separately. The project provides one for you automatically with the embedded Maven Wrapper.
</div>

<p>The <code class="highlighter-rouge">pom.xml</code> is composed of several sections. The ones you need to worry about are the following.</p>

<h2 id="properties">Properties</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;cas.version&gt;</span>5.3.5<span class="nt">&lt;/cas.version&gt;</span>
    <span class="nt">&lt;springboot.version&gt;</span>1.5.16.RELEASE<span class="nt">&lt;/springboot.version&gt;</span>
    <span class="nt">&lt;maven.compiler.source&gt;</span>1.8<span class="nt">&lt;/maven.compiler.source&gt;</span>
    <span class="nt">&lt;maven.compiler.target&gt;</span>1.8<span class="nt">&lt;/maven.compiler.target&gt;</span>
    <span class="nt">&lt;app.server&gt;</span>-tomcat<span class="nt">&lt;/app.server&gt;</span>
    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre></div></div>

<p>This is the bit that describes build settings, and specifically, here, what versions of CAS, Spring Boot, and Java are required for the deployment. You are in practice mostly concerned with the <code class="highlighter-rouge">&lt;cas.version&gt;</code> setting and as new (maintenance) releases come out, it would be sufficient to simply update that version and re-run the build.</p>

<p>This might be a good time to review the CAS project’s <a href="https://apereo.github.io/cas/developer/Release-Policy.html">Release Policy</a> as well as <a href="https://apereo.github.io/cas/developer/Maintenance-Policy.html">Maintenance Policy</a>.</p>

<h2 id="dependencies">Dependencies</h2>

<p>The next piece describes the <em>dependencies</em> of the overlay build. These are the set of components almost always provided by the CAS project that will be packaged up and put into the final web application artifact. At a minimum, you need to have the <code class="highlighter-rouge">cas-server-webapp-${app.server}</code> module available because that is the web application into which you intend to inject your settings and customizations if any. Also, note that the module declarations are typically configured to download the CAS version instructed by the property <code class="highlighter-rouge">${cas.version}</code>.</p>

<p>Here is an example:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cas-server-webapp${app.server}<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>war<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<p>Including a CAS module/dependency in the <code class="highlighter-rouge">pom.xml</code> simply advertises to CAS <em>your intention</em> of turning on a new feature or a variation of a current behavior. Do NOT include something in your build just because it looks and sounds cool. Remember that the point of an overlay is to only keep track of things you actually need and care about, and no more.</p>

<div class="alert alert-warning">
  <strong>Remember</strong><br />Keep your build clean and tidy. A messy build often leads to a messy deployment, complicates your upgrade path and is a documented cause of early hair loss. Keep changes down to the absolute essentials and document their need for your deployment. If you review the configuration a year from now, you should have an idea of why things are the way they are.
</div>

<h2 id="and-what-about">And What About…?</h2>

<p>There are many other pieces in the <code class="highlighter-rouge">pom.xml</code>, such as repositories, profiles, plugins, etc that I skipped. For everything else, there is MasterCard…and of course the official <a href="http://maven.apache.org/guides/">Apache Maven guides</a>. Enjoy!</p>

<h1 id="the-build">The Build</h1>

<p>Now that you have a basic understanding of the build descriptor, it’s time to actually run the build. An Apache Maven build is often executed by passing specific goals/commands to Apache Maven itself, aka <code class="highlighter-rouge">mvn</code>. So for instance in the terminal and once inside the project directory you could execute things like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
mvn clean
</code></pre></div></div>

<p>…which may be a problem if you don’t have already have Apache Maven downloaded and installed. While you can do that separate install, the WAR Overlay project provides you with an embedded Apache Maven instance whose job is to first determine whether you have Maven installed and if not, download and configure one for you based on the project’s needs. So you can replace that command above with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
mvnw clean
</code></pre></div></div>

<p>…which may be a problem because, how are you supposed to know what commands/goals can be passed to the build? You can <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">study them</a> for sure, but the project provides you with a shell script that wraps itself around the Maven wrapper and provides an easy facade for you to remember commands and their use. This is the <code class="highlighter-rouge">build.sh</code> file, which you can run as such:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
./build.sh <span class="nb">help
</span>Usage: build.sh <span class="o">[</span>copy|clean|package|run|debug|bootrun]
</code></pre></div></div>

<p>What do these commands do?</p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">copy</code></td>
      <td>Copies the configuration from the local <code class="highlighter-rouge">etc/cas/config</code> directory to <code class="highlighter-rouge">/etc/cas/config</code>. <a href="https://apereo.github.io/cas/5.3.x/installation/Configuration-Server-Management.html">See this guide</a> to learn more.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">clean</code></td>
      <td>Deletes any previously-built and leftover artifacts from the <code class="highlighter-rouge">target</code> directory.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">package</code></td>
      <td>Runs <code class="highlighter-rouge">clean</code> and <code class="highlighter-rouge">copy</code>. Then packages the CAS web application artifact and run through the overlay to inject local customizations. The outcome is a <code class="highlighter-rouge">target/cas.war</code> file which is ready to be deployed.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">run</code></td>
      <td>Involves <code class="highlighter-rouge">package</code> and then deploys and runs the CAS web application via its own embedded server container.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">debug</code></td>
      <td>Same thing as <code class="highlighter-rouge">run</code>, except that you can remote-debug the CAS web application over port <code class="highlighter-rouge">5000</code>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">help</code></td>
      <td>Display available commands.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">listviews</code></td>
      <td>List the current CAS UI views that are available to the overlay and can be customized.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">getview</code></td>
      <td>Download a CAS view into the overlay and prepare it for customizations.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cli</code></td>
      <td>Step into the command-line shell and interact with CAS.</td>
    </tr>
  </tbody>
</table>

<div class="alert alert-info">
  <strong>Remember</strong><br />Docs grow old. Always consult the overlay project's <code>README</code> file to keep to date.
</div>

<p>As an example, here’s what I see if I were to run the <code class="highlighter-rouge">package</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh copy package

Creating configuration directory under /etc/cas
Copying configuration files from etc/cas to /etc/cas/config
etc/cas/config/application.yml -&gt; /etc/cas/config/application.yml
etc/cas/config/cas.properties -&gt; /etc/cas/config/cas.properties
etc/cas/config/log4j2.xml -&gt; /etc/cas/config/log4j2.xml

<span class="o">[</span>INFO] Scanning <span class="k">for </span>projects...
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] Using the MultiThreadedBuilder implementation with a thread count of 5
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Building cas-overlay 1.0
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-clean-plugin:2.5:clean <span class="o">(</span>default-clean<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:resources <span class="o">(</span>default-resources<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Using <span class="s1">'UTF-8'</span> encoding to copy filtered resources.
<span class="o">[</span>INFO] skip non existing resourceDirectory /cas-overlay-template/src/main/resources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.3:compile <span class="o">(</span>default-compile<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] No sources to compile
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:testResources <span class="o">(</span>default-testResources<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Using <span class="s1">'UTF-8'</span> encoding to copy filtered resources.
<span class="o">[</span>INFO] skip non existing resourceDirectory /cas-overlay-template/src/test/resources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.3:testCompile <span class="o">(</span>default-testCompile<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] No sources to compile
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-surefire-plugin:2.12.4:test <span class="o">(</span>default-test<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] No tests to run.
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-war-plugin:2.6:war <span class="o">(</span>default-war<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Packaging webapp
<span class="o">[</span>INFO] Assembling webapp <span class="o">[</span>cas-overlay] <span class="k">in</span> <span class="o">[</span>/cas-overlay-template/target/cas]
<span class="o">[</span>info] Copying manifest...
<span class="o">[</span>INFO] Processing war project
<span class="o">[</span>INFO] Processing overlay <span class="o">[</span> id org.apereo.cas:cas-server-webapp-tomcat]
<span class="o">[</span>INFO] Webapp assembled <span class="k">in</span> <span class="o">[</span>786 msecs]
<span class="o">[</span>INFO] Building war: /cas-overlay-template/target/cas.war
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
...
</code></pre></div></div>

<p>You can see that the build attempts to download, clean, compile and package all artifacts, and finally, it produces a <code class="highlighter-rouge">/cas-overlay-template/target/cas.war</code> which you can then use for actual deployments.</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />You are allowed to pass any of Maven's native command-line arguments to the <code>build.sh</code> file. Things like <code>-U</code> or <code>-X</code> might be useful to have handy.
</div>

<h1 id="configuration">Configuration</h1>

<p>I am going to skip over the configuration of <code class="highlighter-rouge">/etc/cas/config</code> and all that it deals with. If you need the reference, you may always <a href="https://apereo.github.io/cas/5.3.x/installation/Configuration-Management.html">use this guide</a> to study various aspects of CAS configuration.</p>

<p>Suffice it to say that, quite simply, CAS deployment expects <em>the main</em> configuration file to be found under <code class="highlighter-rouge">/etc/cas/config/cas.properties</code>. This is a key-value store that is able to dictate and alter the behavior of the running CAS software.</p>

<p>As an example, you might encounter something like:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.server.name</span><span class="p">=</span><span class="s">https://cas.example.org:8443</span>
<span class="py">cas.server.prefix</span><span class="p">=</span><span class="s">https://cas.example.org:8443/cas</span>
<span class="py">logging.config</span><span class="p">=</span><span class="s">file:/etc/cas/config/log4j2.xml</span>
</code></pre></div></div>

<p>…which at a minimum, identifies the CAS server’s URL and prefix and instructs the running server to locate the logging configuration at <code class="highlighter-rouge">file:/etc/cas/config/log4j2.xml</code>. The overlay by default ships with a <code class="highlighter-rouge">log4j2.xml</code> that you can use to customize logging locations, levels, etc. Note that the presence of all that is contained inside <code class="highlighter-rouge">/etc/cas/config/</code> is optional. CAS will continue to fall back onto defaults if the directory and the files within are not found.</p>

<h2 id="keep-track">Keep Track</h2>

<p>It is <strong>VERY IMPORTANT</strong> that you contain and commit the entire overlay directory (save the obvious exclusions such as the <code class="highlighter-rouge">target</code> directory) into some sort of source control system, such as <code class="highlighter-rouge">git</code>. Treat your deployment just like any other project with tags, releases, and functional baselines.</p>

<h1 id="ldap-authentication">LDAP Authentication</h1>

<p>We need to first establish a primary mode of validating credentials by sticking with <a href="https://apereo.github.io/cas/5.3.x/installation/LDAP-Authentication.html">LDAP authentication</a>. The strategy here, as indicated by the CAS documentation, is to declare the intention/module in the build script:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
     <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
     <span class="nt">&lt;artifactId&gt;</span>cas-server-support-ldap<span class="nt">&lt;/artifactId&gt;</span>
     <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>…and then configure the relevant <code class="highlighter-rouge">cas.authn.ldap[x]</code> settings for the directory server in use. Most commonly, that would translate into the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.ldap[0]</span><span class="py">.type</span><span class="p">=</span><span class="s">AUTHENTICATED</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.ldapUrl</span><span class="p">=</span><span class="s">ldaps://ldap1.example.org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.baseDn</span><span class="p">=</span><span class="s">dc=example,dc=org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.searchFilter</span><span class="p">=</span><span class="s">cn={user}</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindDn</span><span class="p">=</span><span class="s">cn=Directory Manager,dc=example,dc=org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindCredential</span><span class="p">=</span><span class="s">...</span>
</code></pre></div></div>

<p>To resolve and fetch the needed attributes which will be used later by CAS for release, the simplest way would be to let LDAP authentication retrieve the attributes directly from the directory server.  The following setting allows us to do just that:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.ldap[0]</span><span class="py">.principalAttributeList</span><span class="p">=</span><span class="s">memberOf,cn,givenName,mail</span>
</code></pre></div></div>

<h1 id="registering-applications">Registering Applications</h1>

<p>Client applications that wish to use the CAS server for authentication must be registered with the server a-priori. CAS provides a number of <a href="https://apereo.github.io/cas/5.3.x/installation/Service-Management.html#storage">facilities to keep track of the registration records</a> and you may choose any that fits your needs best. In more technical terms, CAS deals with service management using two specific components: Individual implementations that support a form of a database are referred to as <em>Service Registry</em> components and they are many. There is also a parent component that sits on top of the configured service registry as more of an orchestrator that provides a generic facade and entry point for the rest of CAS without entangling all other operations and subsystems with the specifics and particulars of a storage technology.</p>

<p>In this tutorial, we are going to try to configure CAS with <a href="https://apereo.github.io/cas/5.3.x/installation/JSON-Service-Management.html">the JSON service registry</a>.</p>

<h2 id="configuration-1">Configuration</h2>

<p>First, ensure you have declared the appropriate module/intention in the build:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>cas-server-support-json-service-registry<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>Next, you must teach CAS how to look up JSON files to read and write registration records. This is done in the <code class="highlighter-rouge">cas.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.serviceRegistry.initFromJson</span><span class="p">=</span><span class="s">false</span>
<span class="py">cas.serviceRegistry.json.location</span><span class="p">=</span><span class="s">file:/etc/cas/services</span>
</code></pre></div></div>

<p>…where a sample <code class="highlighter-rouge">ApplicationName-1001.json</code> would then be placed inside <code class="highlighter-rouge">/etc/cas/services</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ApplicationName"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h1 id="ticketing">Ticketing</h1>

<p>A robust CAS deployment requires the presence and configuration of an <em>internal</em> database that is responsible for <a href="https://apereo.github.io/cas/5.3.x/installation/Configuring-Ticketing-Components.html">keeping track of tickets</a> issued by CAS. CAS itself comes by default with a memory-based node-specific cache that is often more than sufficient for smaller deployments or certain variations of a <a href="https://apereo.github.io/cas/5.3.x/planning/High-Availability-Guide.html">clustered deployment</a>. Just like the service management facility, large variety of databases and storage options are supposed by CAS under the facade of a <em>Ticket Registry</em>.</p>

<p>In this tutorial, we are going to configure CAS to use a <a href="https://apereo.github.io/cas/5.3.x/installation/Hazelcast-Ticket-Registry.html">Hazelcast Ticket Registry</a> with the assumption that our deployment is going to be deployed in an AWS-sponsored environment. Hazelcast Ticket Registry is often a decent choice when deploying CAS in a cluster and can take advantage of AWS’s native support for Hazelcast in order to read node metadata properly and locate other CAS nodes in the same cluster in order to present a common, global and shared ticket registry. This is an ideal choice that requires very little manual work and/or troubleshoot, comparing to using options such as Multicast or manually noting down the address and location of each CAS server in the cluster.</p>

<h2 id="configuration-2">Configuration</h2>

<p>First, ensure you have declared the appropriate module/intention in the build:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>cas-server-support-hazelcast-ticket-registry<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>Next, the AWS-specific configuration of Hazelcast would go into our <code class="highlighter-rouge">cas.properties</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.ticket.registry.hazelcast.cluster.discovery.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.accessKey</span><span class="p">=</span><span class="s">...</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.secretKey</span><span class="p">=</span><span class="s">...</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.region</span><span class="p">=</span><span class="s">us-east-1</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.securityGroupName</span><span class="p">=</span><span class="s">...</span>
<span class="c"># cas.ticket.registry.hazelcast.cluster.discovery.aws.tagKey=
# cas.ticket.registry.hazelcast.cluster.discovery.aws.tagValue=
</span></code></pre></div></div>

<p>That should do it.</p>

<p>Of course, if you are working on a more modest CAS deployment in an environment that is more or less owned by you and you prefer more explicit control over CAS node registrations in your cluster, the following settings would be more ideal:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.ticket.registry.hazelcast.cluster.instanceName=localhost
# cas.ticket.registry.hazelcast.cluster.port=5701
# cas.ticket.registry.hazelcast.cluster.portAutoIncrement=true
</span><span class="py">cas.ticket.registry.hazelcast.cluster.members</span><span class="p">=</span><span class="s">123.321.123.321,223.621.123.521,...</span>
</code></pre></div></div>

<h1 id="overlay-customization">Overlay Customization</h1>

<p>If I <code class="highlighter-rouge">cd</code> into the <code class="highlighter-rouge">target/cas</code> directory, I can see an <em>exploded</em> version of the <code class="highlighter-rouge">cas.war</code> file. This is the directory that contains the results of the overlay process. Since I have not actually customized and overlaid anything yet, all configuration files simply match their default and are packaged as such. So as an example, let’s change something.</p>

<p>Digging further down, I notice there exists a <code class="highlighter-rouge">/target/cas/WEB-INF/classes/messages.properties</code> file, which is <a href="https://apereo.github.io/cas/5.3.x/installation/User-Interface-Customization-Localization.html">the default message bundle</a>. I decided that I am going to change the text associated with <code class="highlighter-rouge">screen.welcome.instructions</code>.</p>

<div class="alert alert-warning">
  <strong>Remember</strong><br />Do NOT ever make changes in the <code>target</code> directory. The changesets will be cleaned out and set back to defaults every time you do a build. Follow the overlay process to avoid surprises.
</div>

<p>First, I will need to move the file to my project directory so that Apache Maven during the overlay process can use that instead of what is provided by default.</p>

<p>Here we go:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
mkdir <span class="nt">-p</span> src/main/resources
cp target/cas/WEB-INF/classes/messages.properties src/main/resources/
</code></pre></div></div>

<p>Then I’ll leave everything in that file alone, except the line I want to change.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="py">screen.welcome.instructions</span><span class="p">=</span><span class="s">Speak Friend and you shall enter.</span>
<span class="err">...</span>
</code></pre></div></div>

<p>Then I’ll package things up as usual.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh package

...
<span class="o">[</span>INFO] <span class="nt">---</span> maven-war-plugin:2.6:war <span class="o">(</span>default-war<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Packaging webapp
<span class="o">[</span>INFO] Assembling webapp <span class="o">[</span>cas-overlay] <span class="k">in</span> <span class="o">[</span>/cas-overlay-template/target/cas]
<span class="o">[</span>info] Copying manifest...
<span class="o">[</span>INFO] Processing war project
<span class="o">[</span>INFO] Processing overlay <span class="o">[</span> id org.apereo.cas:cas-server-webapp-tomcat]
<span class="o">[</span>INFO] Webapp assembled <span class="k">in</span> <span class="o">[</span>1005 msecs]
<span class="o">[</span>INFO] Building war: /cas-overlay-template/target/cas.war
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
...

</code></pre></div></div>

<p>If I look at <code class="highlighter-rouge">target/cas/WEB-INF/classes/messages.properties</code> after the build, I should see that the overlay process has picked and overlaid onto the default <em>my version</em> of the file.</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />Only overlay and modify files you actually need and try to use externalized resources and configuration as much as possible. Just because you CAN override something in the default package, it doesn't mean that you should.
</div>

<h1 id="user-interface-customizations">User Interface Customizations</h1>

<p>In order to modify the CAS HTML views, each file first needs to be brought over into the overlay. You can use the <code class="highlighter-rouge">build.sh listviews</code> command to see what HTML views are available for customizations. Once chosen, simply use <code class="highlighter-rouge">build.sh getview footer.html</code> to bring the view into your overlay.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Exploded the CAS web application file.
Searching <span class="k">for </span>view name footer.html...
Found view<span class="o">(</span>s<span class="o">)</span>:
/cas-overlay-template/target/cas/WEB-INF/classes/templates/fragments/footer.html
Created view at /cas-overlay-template/src/main/resources/templates/fragments/footer.html
/cas-overlay-template/src/main/resources/templates/fragments/footer.html
</code></pre></div></div>

<p>Now that you have the <code class="highlighter-rouge">footer.html</code> brought into the overlay, you can simply modify the file at <code class="highlighter-rouge">cas-overlay-template/src/main/resources/templates/fragments/footer.html</code>, and then repackage and run the build as usual.</p>

<h1 id="deploy">Deploy</h1>

<p>You have a number of options when it comes to deploying the final <code class="highlighter-rouge">cas.war</code> file. <a href="https://apereo.github.io/2016/10/04/casbootoverlay/">This post</a> should help. The easiest approach would be to simply use the <code class="highlighter-rouge">build.sh run</code> command and have the overlay be deployed inside an embedded container.</p>

<h1 id="what-about">What About…?</h1>

<ul>
  <li><a href="https://apereo.github.io/2018/01/08/cas-mfa-duosecurity/">CAS Multifactor Authentication with Duo Security</a></li>
  <li><a href="https://apereo.github.io/2017/03/24/cas51-ldapauthnjasypt-tutorial/">CAS 5 LDAP AuthN and Jasypt Configuration</a></li>
  <li><a href="https://apereo.github.io/2017/03/22/cas51-delauthn-tutorial/">CAS 5 SAML2 Delegated AuthN Tutorial</a></li>
</ul>

<p>For more content, <a href="https://apereo.github.io/tags/#CAS">please see this link</a>.</p>

<h1 id="so">So…</h1>

<p>It’s important that you start off simple and make changes one step at a time. Once you have a functional environment, you can gradually and slowly add customizations to move files around.</p>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/06/09/cas53-gettingstarted-overlay/</guid>
                <description>
                    
                    Learn how to configure and build your own CAS deployment via the WAR overlay method, get rich quickly, stay healthy indefinitely and respect family and friends in a few very easy steps.
                    
                </description>
                <pubDate>Sat, 09 Jun 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.3.0 RC4 Feature Release</title>
                <link>https://apereo.github.io/2018/05/25/530rc4-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.2.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.2.0">November 27th, 2017</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.3.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the <strong>fourth</strong> release candidate in the <code class="highlighter-rouge">5.3.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.3.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<p>You can read about the previous release candidate <a href="https://apereo.github.io/2018/03/30/530rc3-release/">here</a>.</p>

<!-- TOC -->

<ul>
  <li><a href="#shake-well-before-use">Shake Well Before Use</a>
    <ul>
      <li><a href="#apache-maven">Apache Maven</a></li>
      <li><a href="#gradle">Gradle</a></li>
    </ul>
  </li>
  <li><a href="#minors">Minors</a></li>
  <li><a href="#delegated-authentication-&amp;-mfa">Delegated Authentication &amp; MFA</a></li>
  <li><a href="#password-management-email-notifications">Password Management Email Notifications</a></li>
  <li><a href="#interrupt-notifications">Interrupt Notifications</a></li>
  <li><a href="#saml2-service-providers">SAML2 Service Providers</a></li>
  <li><a href="#multifactor-authentication-trusted-devices">Multifactor Authentication Trusted Devices</a></li>
  <li><a href="#passwordless-authentication">Passwordless Authentication</a></li>
  <li><a href="#custom-cas-settings">Custom CAS Settings</a></li>
  <li><a href="#aws-elasticache-for-memcached">AWS ElastiCache for Memcached</a></li>
  <li><a href="#aws-simple-notification-service-for-sms">AWS Simple Notification Service for SMS</a></li>
  <li><a href="#jwt-service-tickets">JWT Service Tickets</a></li>
  <li><a href="#aws-secrets-manager">AWS Secrets Manager</a></li>
  <li><a href="#restful-view-resolution">RESTful View Resolution</a></li>
  <li><a href="#aws-s3-buckets">AWS S3 Buckets</a></li>
  <li><a href="#command-line-shell-commands">Command-line Shell Commands</a></li>
  <li><a href="#saml-11-validations">SAML 1.1 Validations</a></li>
  <li><a href="#library-upgrades">Library Upgrades</a></li>
  <li><a href="#get-involved">Get Involved</a></li>
  <li><a href="#credits">Credits</a></li>
</ul>

<!-- /TOC -->

<h2 id="shake-well-before-use">Shake Well Before Use</h2>

<p>We strongly recommend that you take advantage of the release candidates as they come out. Waiting for a <code class="highlighter-rouge">GA</code> release is only going to set you up for unpleasant surprises. A <code class="highlighter-rouge">GA</code> is simply <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">a tag and nothing more</a>. Note that CAS releases are <em>strictly</em> time-based releases; they are not scheduled or based on specific benchmarks, statistics or completion of features. To gain confidence in a particular release, it is strongly recommended that you start early by experimenting with release candidates and/or follow-up snapshots.</p>

<p>In order to start experimenting with release candidates, at any given time, you should be able to append <code class="highlighter-rouge">-SNAPSHOT</code> to the CAS version specified in order to take advantage of snapshot builds as changes are made and published.</p>

<h3 id="apache-maven">Apache Maven</h3>

<p>In the <code class="highlighter-rouge">pom.xml</code> of <a href="https://github.com/apereo/cas-overlay-template">the overlay</a>, adjust the following tag to match below:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;cas.version&gt;</span>5.3.0-RC4<span class="nt">&lt;/cas.version&gt;</span>
</code></pre></div></div>

<h3 id="gradle">Gradle</h3>

<p>In the <code class="highlighter-rouge">gradle.properties</code> of <a href="https://github.com/apereo/cas-gradle-overlay-template">the overlay</a>, adjust the following setting to match below:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.version</span><span class="p">=</span><span class="s">5.3.0-RC4</span>
</code></pre></div></div>

<h2 id="minors">Minors</h2>

<ul>
  <li>Thanks to <a href="https://github.com/leleuj">@leleuj</a>, validation of OAuth and OpenID Connect requests gain improvements in terms of protocol compatibility.</li>
  <li>The rendering syntax of CAS attributes in the validation response can now be controlled using CAS settings to enable inline rendering. (i.e. <code class="highlighter-rouge">&lt;cas:attribute name="givenName" value="John"&gt;&lt;/cas:attribute&gt;</code>)</li>
  <li>Thanks to <a href="https://github.com/frett">@frett</a>, the initialization of the login webflow is fixed to only execute once.</li>
  <li>Refreshing CAS configuration should allow for re-initialization of the service registry, if CAS is configured to populate the service registry database from JSON service files.</li>
  <li>Thanks to <a href="https://github.com/NgSekLong">@NgSekLong</a>, the validation of the OAuth <code class="highlighter-rouge">client_secret</code> parameter is made optional if it’s left undefined for the OAuth service.</li>
  <li>CAS test coverage has improved slightly with a number of additional tests where now coverage is at <code class="highlighter-rouge">67%</code> and growing.</li>
  <li>Auditing a <em>password change</em> operation using the <a href="https://apereo.github.io/cas/development/installation/Password-Management.html">CAS password management</a> features is fixed to correctly catalog failures.</li>
  <li>Static analysis is now turned on <a href="https://travis-ci.org/apereo/cas/builds">CAS CI builds</a> using FindBugs by default as well as Checkstyle. The builds are also taking advantage of the OWASP Dependency Check plugin for Gradle to auto-scan libraries used by CAS and fail the build in case a relevant CVE is found in the CAS distribution.</li>
  <li>Thanks to <a href="https://github.com/williame-uah">@williame-uah</a>, the <code class="highlighter-rouge">encryptionSecretSize</code> parameter is fixed in CAS command-line shell to remove the duplicate name.</li>
  <li>Handling LDAP account states to process warnings, etc can now be separately turned on via CAS configuration, as part of the password policy settings.</li>
  <li>Thanks to <a href="https://github.com/tsschmidt">@tsschmidt</a>, the strategy for calculating service registry file names can now be customized in a pluggable way. This in particular has a benefit of allowing the management web application to provide customized naming strategies for resources as they are tracked in source control and Git, etc.</li>
  <li>A number of internal changes to SAML2 metadata resolution in order to improve performance and memory use.</li>
  <li>Annotation processing behavior has been restored to account for CAS extensions of Log4j, as well as correctly generating configuration metadata.</li>
  <li>Thanks to <a href="https://github.com/sbearcsiro">@sbearcsiro</a>, a number of bugs that affect Twitter’s OAuth1 requests and responses when dealing with delegated authentication in CAS are now fixed.</li>
  <li>Logout management in CAS is modified to be able to internally handle submitting logout notifications to multiple URLs associated with a single application.</li>
  <li>A Groovy implementation is now made available for <code class="highlighter-rouge">PrincipalFactory</code> objects that may be used inside custom configuration classes in areas where principal resolution needs unusual changes.</li>
  <li>Thanks to <a href="https://github.com/tduehr">@tduehr</a>, various number of improvements are applied to the CAS internal Gradle build to ensure tests can be run in categories.</li>
  <li>Thanks to <a href="https://github.com/tsschmidt">@tsschmidt</a>, the pattern to recognize domains in registered services is now improved.</li>
  <li>Thanks to <a href="https://github.com/ringmaster217">@ringmaster217</a>, the <code class="highlighter-rouge">iat</code> field in JWTs generated for OpenID Connect when tokens are introspected is fixed to be based on seconds instead of milliseconds.</li>
  <li>A series of minor improvements to the <a href="https://apereo.github.io/cas/development/installation/Surrogate-Authentication.html">Surrogate authentication</a> functionality when surrogate accounts are looked up from LDAP.</li>
  <li><a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html#dynamic-metadata">SAML2 metadata resolution</a> caching strategies are better improved in this release to improve performance and reduce memory use.</li>
  <li>Thanks to <a href="https://github.com/fcrespel">@fcrespel</a>, token revocation features of CAS running in OpenID Connect mode are made more compliant with the specification.</li>
  <li>Delegated authentication can now directly build the final authenticated principal using an attribute from the provided user profile.</li>
  <li>JAAS authentication is given the ability in settings to handle password policy enforcements. Furthermore, both JAAS and <a href="https://apereo.github.io/cas/development/installation/Surrogate-Authentication.html">Surrogate authentication</a> are given dedicated settings to control how a CAS authenticated principal should be constructed. This behavior was typically controlled more globally before via Person Directory settings.</li>
  <li>Thanks to <a href="https://github.com/sbearcsiro">@sbearcsiro</a>, delegated authentication is able to properly reconstruct the service authentication request, once the flow has returned from the provider and CAS is getting ready to produce a response.</li>
  <li>Special <code class="highlighter-rouge">CipherExecutor</code> components are added to handle signing and encryption decoding/encoding operations using RSA key-pairs.</li>
  <li>Thanks to <a href="https://github.com/fcrespel">@fcrespel</a>, french translations of the CAS message bundles are now made up-to-date.</li>
  <li>The configuration file for JAAS-based authentications may now be loaded directly from CAS settings.</li>
  <li>When preparing SAML2 responses, the subject locality field is fixed to include the address of the CAS server instead of the service provider.</li>
  <li>Anonymous username identifiers are now set to correctly encode and digest values that may be used for persistent identifiers.</li>
  <li>Thanks to <a href="https://github.com/sbearcsiro">@sbearcsiro</a>, delegated authentication to Twitter gains support to retrieve and process the profile email address.</li>
  <li>Database authentication in <a href="https://apereo.github.io/cas/development/installation/Database-Authentication.html">query mode</a> can now process and accept named sql parameters in the SQL query.</li>
  <li>Thanks to <a href="https://github.com/bdavids1">@bdavids1</a>, the Duo Security iframe is improved to display properly specially on mobile devices per the recommendations available <a href="https://duo.com/docs/duoweb">here</a>.</li>
</ul>

<h2 id="delegated-authentication--mfa">Delegated Authentication &amp; MFA</h2>

<p><a href="https://apereo.github.io/cas/development/integration/ADFS-Integration.html">Delegating authentication events to ADFS</a> as well as <a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">all other external identity providers</a> are now revisited to handle multifactor authentication flows better, once the flow travels back from the identity provider to CAS after authentication.</p>

<h2 id="password-management-email-notifications">Password Management Email Notifications</h2>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />This is a breaking change. Review your settings and be sure to adjust.
</div>

<p>Settings that control email notifications for password reset operations are placed under a <code class="highlighter-rouge">mail</code> setting to be consistent with all other properties. As a result, the email notification operations of password reset gain small improvements to honor CC and BCC flags defined in configuration.</p>

<h2 id="interrupt-notifications">Interrupt Notifications</h2>

<p><a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-Interrupt.html#regex-attribute">CAS Interrupt Notifications</a> can now be triggered using authentication/principal attributes using regular expression patterns. Furthermore, notifications may now be skipped on a per-service basis by assigning tags and properties to the service definition.</p>

<h2 id="saml2-service-providers">SAML2 Service Providers</h2>

<p>The following new <a href="https://apereo.github.io/cas/development/integration/Configuring-SAML-SP-Integrations.html">SAML2 service providers</a> are now supported by CAS out of the box:</p>

<ul>
  <li>WarpWire</li>
  <li>BlackBaud</li>
  <li>GiveCampus</li>
  <li>RocketChat</li>
</ul>

<h2 id="multifactor-authentication-trusted-devices">Multifactor Authentication Trusted Devices</h2>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />You may need to adjust the underlying schema used to store trusted device records to handle the new date type. The change affects all storage options that support keeping track of trusted device records.
</div>

<p>Handling <a href="https://apereo.github.io/cas/development/installation/Multifactor-TrustedDevice-Authentication.html">trusted devices</a> for multifactor authentication receives a number of fixed to handle device expiration time units better. As a result of this change, the trusted device record date is switched from <code class="highlighter-rouge">LocalDate</code> to <code class="highlighter-rouge">LocalDateTime</code> in order to support hours, minutes and seconds.</p>

<h2 id="passwordless-authentication">Passwordless Authentication</h2>

<p>An initial draft of <a href="https://apereo.github.io/cas/development/installation/Passwordless-Authentication.html">Passwordless Authentication</a> is now available. This is a form of authentication in CAS where passwords take the form of tokens that expire after a configurable period of time, and are sent to users using email, text messages, etc.</p>

<h2 id="custom-cas-settings">Custom CAS Settings</h2>

<p>In order to extend the collection of CAS settings, most adopters might have had to introduce a new configuration namespace into CAS and have it be recognized using a custom <code class="highlighter-rouge">@ConfigurationProperties</code> type of component. In this release candidate, a <code class="highlighter-rouge">custom</code> category is introduced as a <code class="highlighter-rouge">Map</code> that can house all arbitrary settings. Furthermore, the entire collection of CAS settings including the <code class="highlighter-rouge">custom</code> category of course is made available to all components, <a href="https://apereo.github.io/cas/development/installation/Webflow-Customization.html#custom-settings">webflow states and CAS views</a> in particular, so that views can be customized or altered using any of the defined CAS configuration properties.</p>

<h2 id="aws-elasticache-for-memcached">AWS ElastiCache for Memcached</h2>

<p>For <a href="https://apereo.github.io/cas/development/installation/Memcached-Ticket-Registry.html">memcached integrations</a>, CAS is now able to provide a native module that is able to seamlessly integrate with AWS ElastiCache. This is mostly a drop-in replacement for the spymemcached.</p>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />The memcached support modules in CAS no longer take the opinionated approach of presenting a memcached client library. The choices are now presented as separated modules that you are to choose and then stuff into your overlay. If you are unsure what to choose, choose spymemcached.
</div>

<h2 id="aws-simple-notification-service-for-sms">AWS Simple Notification Service for SMS</h2>

<p>Support is now included to take advantage of <a href="https://apereo.github.io/cas/development/installation/SMS-Messaging-Configuration.html">AWS SNS</a> for sending SMS messages.</p>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />As par of this change, the configuration of various SMS providers is now moved into a parent <code>cas.smsProviders</code> category. Please review your settings and adjust.
</div>

<h2 id="jwt-service-tickets">JWT Service Tickets</h2>

<p>Encryption and signing keys use to allow CAS to encode a <a href="https://apereo.github.io/cas/development/installation/Configure-ServiceTicket-JWT.html">JWT as a service ticket</a> may now be defined on a per-service basis. Furthermore, extra test cases are added to ensure the generated JWT is not doubly encoded in base64 syntax.</p>

<h2 id="aws-secrets-manager">AWS Secrets Manager</h2>

<p>CAS configuration settings may now be managed and located using <a href="https://apereo.github.io/cas/development/installation/Configuration-Server-Management.html#spring-cloud">AWS Secrets Manager</a>.</p>

<h2 id="restful-view-resolution">RESTful View Resolution</h2>

<p>CAS views can now be resolved using an external URL in <a href="https://apereo.github.io/cas/development/installation/User-Interface-Customization-Views.html">RESTful ways</a>.</p>

<h2 id="aws-s3-buckets">AWS S3 Buckets</h2>

<p>CAS configuration properties can now also be fetched from <a href="https://apereo.github.io/cas/development/installation/Configuration-Server-Management.html#amazon-s3">AWS S3 buckets</a>. Similarly, SAML metadata documents for various service providers may also be managed using <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-DynamicMetadata.html">AWS S3 buckets</a>.</p>

<h2 id="command-line-shell-commands">Command-line Shell Commands</h2>

<p>CAS <a href="https://apereo.github.io/cas/development/installation/Configuring-Commandline-Shell.html">command-line shell</a> receives a few additional commands in order to verify connectivity to LDAP servers and to test connections to endpoints useful for verifying SSL configuration, etc. The endpoint validation is further enhanced by <a href="https://github.com/jtgasper3">@jtgasper3</a> to include details that can be used to troubleshoot failed https client connection.</p>

<h2 id="saml-11-validations">SAML 1.1 Validations</h2>

<p>SAML1.1 ticket validation is cleaned up to parse and extract the validation payload from the request body more accurately, relying less on manual parsing of input. The extraction logic also includes a small bit of caching of the request body in order to allow upstream components to process a given http request’s body for other types of functionality, essentially making the request body reusable and re-parseable for the entire transaction.</p>

<h2 id="library-upgrades">Library Upgrades</h2>

<ul>
  <li>Amazon SDK</li>
  <li>Commons Text</li>
  <li>Mockito</li>
  <li>AspectJ</li>
  <li>JavaParser</li>
  <li>Jool</li>
  <li>CosmosDb</li>
  <li>Jackson</li>
  <li>Spring</li>
  <li>HikariCP</li>
  <li>Spring Boot</li>
  <li>Apache Tomcat</li>
  <li>Hibernate</li>
  <li>Caffeine</li>
  <li>Guava</li>
  <li>Kryo</li>
  <li>Pac4j</li>
  <li>Apache Ignite</li>
  <li>Log4j</li>
</ul>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="credits">Credits</h2>

<p>Big thanks to all who participate in the development of this release to submit patches and contribute improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/05/25/530rc4-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.3.0 RC4 release.
                    
                </description>
                <pubDate>Fri, 25 May 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Identity Impersonation</title>
                <link>https://apereo.github.io/2018/05/07/cas-impersonation-authn/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<h1 id="overview">Overview</h1>

<p>The Apereo CAS server has had support for impersonation for a quite a while now, starting with CAS <code class="highlighter-rouge">5.1.x</code>. This feature usually referred to as <a href="https://apereo.github.io/cas/development/installation/Surrogate-Authentication.html"><em>Surrogate Authentication</em></a> or <em>sudo for the web</em> long existed before the CAS 5 series in form of an extension and gradually and eventually found its way into the mainline distribution through community contributions, having been tested and tried in production battlegrounds.</p>

<p>The idea behind this feature is fairly simple; sometimes you want to be someone else perhaps for the purposes of duplicating a troublesome scenario or troubleshooting a bad user experience, etc. In such scenarios, your own identity and credentials are first verified and assuming you have the authorization to impersonate someone else, you proceed to adopt that person’s identity in order to duplicate their user experience and workflow.</p>

<p>This is a short tutorial on how to achieve said functionality.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.0-RC4</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven</a> Or <a href="https://github.com/apereo/cas-gradle-overlay-template">Gradle</a> WAR Overlays</li>
</ul>

<p>Our primary source for authentication is abstracted away with <a href="https://apereo.github.io/cas/development/installation/JAAS-Authentication.html">JAAS</a>, and the principal store for fetching user attributes is <a href="https://apereo.github.io/cas/development/integration/Attribute-Resolution.html#person-directory">LDAP</a>.</p>

<h1 id="overlay-setup">Overlay Setup</h1>

<p>Once you have a <a href="https://github.com/apereo/cas-overlay-template">functional overlay</a> build, the first step would be to prep the right number of configuration settings in order to handle authentication and attribute resolution. The following settings, summarily, should do the job:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.jaas[0]</span><span class="py">.realm</span><span class="p">=</span><span class="s">CAS</span>

<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.attributes.uid</span><span class="p">=</span><span class="s">uid</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.attributes.displayName</span><span class="p">=</span><span class="s">displayName</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.attributes.cn</span><span class="p">=</span><span class="s">commonName</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.attributes.memberOf</span><span class="p">=</span><span class="s">memberOf</span>

<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.ldapUrl</span><span class="p">=</span><span class="s">ldap://...</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.useSsl</span><span class="p">=</span><span class="s">false</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.useStartTls</span><span class="p">=</span><span class="s">false</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.baseDn</span><span class="p">=</span><span class="s">dc=example,dc=edu</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.searchFilter</span><span class="p">=</span><span class="s">uid={0}</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.bindDn</span><span class="p">=</span><span class="s">...</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.bindCredential</span><span class="p">=</span><span class="s">...</span>

<span class="py">cas.personDirectory.principalAttribute</span><span class="p">=</span><span class="s">uid</span>
</code></pre></div></div>

<p>At this point, we should be able to authenticate via JAAS and subsequently fetch attributes from LDAP. We are also instructing CAS to build the final authenticated <code class="highlighter-rouge">Principal</code> identified by the <code class="highlighter-rouge">uid</code> attribute (instead of whatever the user types into the login form as the credential id).</p>

<p>So far, so good.</p>

<h1 id="impersonation-scenario">Impersonation Scenario</h1>

<p>Our handling of <a href="https://apereo.github.io/cas/development/installation/Surrogate-Authentication.html">impersonated authentication attempts</a> scenarios is rather unique. Sometimes, we know beforehand the identity of the user whom we plan to impersonate. Other times, it would be nice to be presented with a menu to choose our target impersonatee. Of course, a mere successful authentication attempt is not enough; not only do we need to be authorized to start impersonation attempts, but also we need special permissions for each impersonated user account. For the purposes of this tutorial, we shall attempt to kill both such birds with one stone; LDAP.</p>

<p>Furthermore, we will need to establish a special sort of syntax instructing CAS to display a list of potential impersonatee accounts authorized for our use as well as one that simply bypasses that menu list and executes the requested impersonation attempt. Per CAS, we may be able to use the <em>plus syntax</em> which sort of goes like this:</p>

<ul>
  <li><code class="highlighter-rouge">jsmith+casuser</code> would mean: <em>Authenticate myself, the primary user as <code class="highlighter-rouge">casuser</code>, using my own credentials. Then switch my identity and adopt that of <code class="highlighter-rouge">jsmith</code></em>.</li>
  <li><code class="highlighter-rouge">+casuser</code> would mean: <em>Authenticate myself, the primary user as <code class="highlighter-rouge">casuser</code>, using my own credentials. Then present a list of accounts authorized for impersonation attempts by me</em>.</li>
</ul>

<h1 id="the-setup">The Setup</h1>

<p>First, let’s ensure that CAS is prepped with the baseline impersonation functionality by adding the following module:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-support-surrogate-webflow<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>…and since impersonated accounts and authorization rules are going to be fetched from LDAP, let’s get CAS prepped for that too:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-support-surrogate-authentication-ldap<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>Surely, we need to instruct CAS on how to connect to LDAP for impersonation attempts:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.surrogate.ldap.ldapUrl</span><span class="p">=</span><span class="s">ldap://...</span>
<span class="py">cas.authn.surrogate.ldap.baseDn</span><span class="p">=</span><span class="s">dc=example,dc=edu</span>
<span class="py">cas.authn.surrogate.ldap.searchFilter</span><span class="p">=</span><span class="s">uid={0}</span>
<span class="py">cas.authn.surrogate.ldap.bindDn</span><span class="p">=</span><span class="s">...</span>
<span class="py">cas.authn.surrogate.ldap.bindCredential</span><span class="p">=</span><span class="s">...</span>
<span class="py">cas.authn.surrogate.ldap.useSsl</span><span class="p">=</span><span class="s">false</span>
<span class="py">cas.authn.surrogate.ldap.useStartTls</span><span class="p">=</span><span class="s">false</span>
</code></pre></div></div>

<h1 id="impersonation-configuration">Impersonation Configuration</h1>

<p>We have to teach CAS to hit LDAP and fetch a list of accounts authorized for impersonation, if and when instructed by the above special syntax. This can be done using the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.surrogate.ldap.surrogateSearchFilter</span><span class="p">=</span><span class="s">(&amp;(uid={user})(memberOf=cn=edu:example:app:{surrogate}))</span>

<span class="py">cas.authn.surrogate.ldap.memberAttributeName</span><span class="p">=</span><span class="s">memberOf</span>
<span class="py">cas.authn.surrogate.ldap.memberAttributeValueRegex</span><span class="p">=</span><span class="s">cn=edu:example:app:([^,]+)</span>
</code></pre></div></div>

<h2 id="authorize-impersonation">Authorize Impersonation</h2>

<p>These basically tell CAS to execute an LDAP search query where <code class="highlighter-rouge">uid</code> attribute equals the identity of the primary user (i.e. <code class="highlighter-rouge">casuser</code>) and the <code class="highlighter-rouge">memberOf</code> attribute matches a value of <code class="highlighter-rouge">cn=edu:example:app:{surrogate}</code> where <code class="highlighter-rouge">{surrogate}</code> is the identity of the impersonatee provided using the special plus syntax. If a match is found, authorization is granted and CAS picks up the identity of <code class="highlighter-rouge">surrogate</code> under legitimate pretenses. In other words, if <code class="highlighter-rouge">casuser</code> is found in LDAP with a <code class="highlighter-rouge">uid</code> of <code class="highlighter-rouge">casuser</code> and a <code class="highlighter-rouge">memberOf</code> of <code class="highlighter-rouge">cn=edu:example:app:jsmith</code>, then <code class="highlighter-rouge">jsmith+casuser</code> should allow CAS to switch the primary user from <code class="highlighter-rouge">casuser</code> to <code class="highlighter-rouge">jsmith</code>.</p>

<h2 id="impersonation-user-menu">Impersonation User Menu</h2>

<p>What about the <code class="highlighter-rouge">+casuser</code> syntax? That’s where the two other settings come in. Once CAS finds the primary user (i.e. <code class="highlighter-rouge">casuser</code>) in LDAP via the specified search query <code class="highlighter-rouge">uid={0}</code>, it then begins to look at all values of the <code class="highlighter-rouge">memberOf</code> attribute and will pick out those that match the attribute value specified. Note that the value is a regular expression pattern and once matched, CAS will attempt to extract the first group in the pattern for display purposes in the final menu where <code class="highlighter-rouge">casuser</code> will get to choose an impersonate account and proceed.</p>

<h1 id="but-our-ldap">But, Our LDAP…</h1>

<p>If the above scenario does not exactly match your environment word for word, do not worry. You can always <a href="https://apereo.github.io/cas/development/installation/Configuration-Management-Extensions.html">extend the CAS configuration</a> and define the scaffolding of your own business logic inside the following bean:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">SurrogateAuthenticationService</span> <span class="nf">surrogateAuthenticationService</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>If you find that there is value in others sharing the same set of business rules as you have for impersonation, I strongly recommend that you open up a pull request and send your changeset in. With reasonable options to activate and tweak, it would be great to support the most common impersonation authorization rules, be it from LDAP or anywhere else.</p>

<h1 id="so">So…</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p>Happy Coding,</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/05/07/cas-impersonation-authn/</guid>
                <description>
                    
                    You do not always have to be you. Allow the Apereo CAS server to allow you to pretend to be another person for fun and profit.
                    
                </description>
                <pubDate>Mon, 07 May 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Customized Settings</title>
                <link>https://apereo.github.io/2018/05/04/cas-custom-properties/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<h1 id="overview">Overview</h1>

<p>Starting with version <code class="highlighter-rouge">5.3.x</code>, CAS begins to own its own configuration namespace rather more seriously, rejecting any settings that are no longer supported or recognized. While this works quite well for configuration settings that tend to get deprecated and moved about from release to release, it also has a side-effect of not allowing any custom settings to be defined by the adopter. In practice, adding custom settings to a <code class="highlighter-rouge">cas</code> namespace is likely less than ideal, as it would be best to denote localized changes using their own specific namespaces and settings. So, in this tutorial, a short overview of extending CAS to use customized properties is presented as well as an alternative simplified strategy to introduce configuration options into the runtime without dabbling into much code.</p>

<p>Our starting position is based on the following:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.0-RC4</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven</a> Or <a href="https://github.com/apereo/cas-gradle-overlay-template">Gradle</a> WAR Overlays</li>
</ul>

<h1 id="custom-properties-take-1">Custom Properties: Take #1</h1>

<p>This strategy more or less applies to any CAS <code class="highlighter-rouge">5.x</code> deployment as more of a heavyweight approach most useful when you are about to extend the CAS configuration to alter its workings by overriding conditional beans or introducing new components and behavior into the runtime engine.</p>

<p>You will need to start by defining your collection of settings first:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"custom"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomConfigurationProperties</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">settingName</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getSettingName</span><span class="o">()</span> <span class="o">{</span>
 <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">return</span> <span class="n">settingName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSettingName</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">settingName</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Or, if you can afford a bit of syntactic sugar with Lombok:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"custom"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomConfigurationProperties</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">settingName</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Next, you need to <a href="https://apereo.github.io/cas/development/installation/Configuration-Management-Extensions.html">extend the CAS configuration</a> to have your configuration settings be recognized by the runtime:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span><span class="o">(</span><span class="s">"SomethingConfiguration"</span><span class="o">)</span>
<span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="n">CustomConfigurationProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomethingConfiguration</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CustomConfigurationProperties</span> <span class="n">customProperties</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>…and then, you should be able to define settings in your <code class="highlighter-rouge">cas.properties</code> file such as:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">custom.settingName</span><span class="p">=</span><span class="s">some-value</span>
</code></pre></div></div>

<p>…and have them be recognized by <code class="highlighter-rouge">SomethingConfiguration</code> in all of its inner beans that you shall design and build.</p>

<p>Of course, this is a fair amount of work to get something so seemingly simple done. Let’s try to simplify this a bit.</p>

<h1 id="custom-properties-take-2">Custom Properties: Take #2</h1>

<p>Starting with CAS <code class="highlighter-rouge">5.3.x</code>, a new <code class="highlighter-rouge">cas.custom.properties</code> namespace is introduced that is able to own all arbitrary settings. An example for this new syntax would be:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.custom.properties.customPropertyName1</span><span class="p">=</span><span class="s">customPropertyValue1</span>
<span class="py">cas.custom.properties.customPropertyName2</span><span class="p">=</span><span class="s">customPropertyValue2</span>
<span class="py">cas.custom.properties.customPropertyName3</span><span class="p">=</span><span class="s">customPropertyValue3</span>
</code></pre></div></div>

<p>…that is to say, you can substitute anything you prefer for the customized property name and values.</p>

<p>Additionally, all CAS-owned properties including the <code class="highlighter-rouge">custom</code> namespace of course are now accessible in CAS views and templates such that one is able to do:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p</span> <span class="na">th:text=</span><span class="s">"${casProperties.custom.properties.customPropertyName1}"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>…or:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p</span> <span class="na">th:text=</span><span class="s">"${casProperties.server.name`}"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>Of course, note that the above syntax only works for settings that are provided by CAS. If you need access anything that is provided by Spring Boot, such as <code class="highlighter-rouge">server.port</code> or anything that pretty much does not have the <code class="highlighter-rouge">cas.</code> prefix, then you need to fall back onto fancier strategies of working with Thymeleaf to access application beans and pull up those settings where needed. Needless to say, that likely is a futile endeavor.</p>

<h1 id="so">So…</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p>Happy Coding,</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/05/04/cas-custom-properties/</guid>
                <description>
                    
                    Extend the Apereo CAS server to allow custom configuration properties and settings.
                    
                </description>
                <pubDate>Fri, 04 May 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Handling Multiple Logout URLs</title>
                <link>https://apereo.github.io/2018/04/24/cas-multiple-logout-urls/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<h1 id="overview">Overview</h1>

<p>CAS has had <a href="https://apereo.github.io/cas/development/installation/Logout-Single-Signout.html">support for single logout</a> for quite a while. This feature basically means that CAS is able to invalidate client application sessions in addition to its own SSO session, assuming client applications are ready to honor and accept logout requests with special configuration. When a CAS session ends, it notifies each of the services that the SSO session is no longer valid, and that relying parties need to invalidate their own session by processing a special logout request. Remember that the callback submitted to each CAS-protected application is simply <em>a notification</em>; nothing more. It is the <em>responsibility of the application</em> to intercept that notification and properly destroy the user authentication session, either manually, via a specific endpoint or more commonly via a CAS client library that supports SLO.</p>

<p>By default, applications are contacted by CAS using their <em>original URL</em> to receive the logout notification; which is simply the purified service URL used when an authentication request on behalf of the application is submitted to CAS. This tutorial focuses on ways one can customize the logout URL in more dynamic ways.</p>

<p>This tutorial deals with:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.0-RC4</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven</a> Or <a href="https://github.com/apereo/cas-gradle-overlay-template">Gradle</a> WAR Overlays</li>
  <li><a href="https://apereo.github.io/cas/development/installation/Logout-Single-Signout.html">Single Logout</a></li>
</ul>

<h1 id="single-logout-url">Single Logout URL</h1>

<p>In dealing with single logout operations, the URL endpoint to receive the logout notification can be customized on a per-application basis:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://</span><span class="se">\\</span><span class="s2">w+.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Our Example Domain"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"The example domain provides examples in examplish ways"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"logoutUrl"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://logout.example.org"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This is, of course, the simplest option and means that if CAS has established sessions with one or more applications that qualify for the above definition, those applications will receive logout notifications at the specified URL above when the logout engine in CAS begins to process records.</p>

<h1 id="many-logout-urls">Many Logout URLs</h1>

<p>One should note that the <code class="highlighter-rouge">logoutUrl</code> above not only static but also singular. With configuration only, there is not a way for one to specify more than one URL in cases where that might be needed. While the service configuration above presents a rather simplified version of the feature, CAS itself provides the internal mechanics to recognize and handle a collection of logout URLs for a given application. Our task here would be to extend the configuration slightly to implement this scenario and inject the behavior into the runtime.</p>

<p>We can start by preparing CAS with a <a href="https://apereo.github.io/cas/development/installation/Configuration-Management-Extensions.html">customized configuration component</a> that would house our customizations for this use case. Once that is done, take note of the following bean definition posted in <code class="highlighter-rouge">CasCoreLogoutConfiguration.java</code> today:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"singleLogoutServiceLogoutUrlBuilder"</span><span class="o">)</span>
<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">SingleLogoutServiceLogoutUrlBuilder</span> <span class="nf">singleLogoutServiceLogoutUrlBuilder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">DefaultSingleLogoutServiceLogoutUrlBuilder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">urlValidator</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note how the bean is marked as conditional, meaning it will only be used by CAS if an alternative definition by the same is <em>not</em> found. So, in order for CAS to pick up our own alternative implementation, we are going to provide that bean definition in our own configuration class as such:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">SingleLogoutServiceLogoutUrlBuilder</span> <span class="nf">singleLogoutServiceLogoutUrlBuilder</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">CustomSingleLogoutServiceLogoutUrlBuilder</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">urlValidator</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="alert alert-info">
<strong>Compile Dependencies</strong><br />Note that in order for the CAS overlay build to compile our changes and put them to good use, the overlay must be prepared with the required module used during the compilation phase. Otherwise, there will be errors complaining about missing symbols, etc.</div>

<p>Now, it’s time to actually design our very own <code class="highlighter-rouge">CustomSingleLogoutServiceLogoutUrlBuilder</code>. Here is a modest example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomSingleLogoutServiceLogoutUrlBuilder</span> <span class="kd">extends</span> <span class="n">DefaultSingleLogoutServiceLogoutUrlBuilder</span> <span class="o">{</span>

    <span class="o">...</span>
    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">URL</span><span class="o">&gt;</span> <span class="nf">determineLogoutUrl</span><span class="o">(</span><span class="n">RegisteredService</span> <span class="n">registeredService</span><span class="o">,</span> <span class="n">WebApplicationService</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>

        <span class="cm">/*
            Stuff happens to determine the collection of the logout URLs
            given the provided service and its registered definition in the registry.
        */</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>That should do it. The very next time you build and deploy the changes, CAS should pick up our own bean definition and accompanying implementation class. It should be obvious that inside the class above, you have options to calculate the logout URLs as you wish since the builder object is expected to return a collection of URLs. To fully make this behavior dynamic, you may want to invest time researching <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Custom-Properties.html">service custom properties</a> and externalize the logout function with special tags designed as properties that would then be consumed and processed in the above component.</p>

<h1 id="so">So…</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p>Happy Coding,</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/04/24/cas-multiple-logout-urls/</guid>
                <description>
                    
                    Extend the Apereo CAS server to allow for multiple logout URLs during SLO operations.
                    
                </description>
                <pubDate>Tue, 24 Apr 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Access Strategy External URL Redirects</title>
                <link>https://apereo.github.io/2018/04/23/cas-access-strategy-url-redirects/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<h1 id="overview">Overview</h1>

<p>CAS has long had support for centralized authorization and <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Access-Strategy.html">access control policies</a> on a per-application basis, I believe starting from CAS <code class="highlighter-rouge">4.2.x</code>. These policies come in a variety of strategies with a number of options to control application access, SSO participation, the presence of a certain number of required claims before access can be granted and so on. In the event that the policy denies user access, it may often be desirable to redirect the authentication flow to a URL that would have instructions for the end-user and it might even be ideal if the construction of that URL could be customized in dynamic ways for better user experience.</p>

<p>This tutorial specifically focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.0-RC4</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven</a> Or <a href="https://github.com/apereo/cas-gradle-overlay-template">Gradle</a> WAR Overlays</li>
  <li><a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">Delegated Authentication</a></li>
</ul>

<p>You may also be interested in this related blog post, detailing <a href="https://apereo.github.io/2018/02/20/cas-service-rbac-attributeresolution/">attribute-based access control</a> in CAS.</p>

<h1 id="use-case">Use Case</h1>

<p>Given our starting position of defining a customized unauthorized redirect URL in situations where access to a CAS-enabled service is denied, you should take note of the following service definition that may be recognized as part of CAS using a <a href="https://apereo.github.io/cas/development/installation/JSON-Service-Management.html">JSON service registry</a>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Awesome Example App"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"The example application is an application that provides examples"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
  </span><span class="s2">"accessStrategy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceAccessStrategy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"enabled"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"unauthorizedRedirectUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://billboard.example.org"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>It should be obvious that the <code class="highlighter-rouge">unauthorizedRedirectUrl</code> field of the configured access strategy allows one to define a URL to which CAS might redirect once service access is denied. Of course, we have not defined any particular rules that would prevent one from accessing this application via CAS so let’s do just that with a few modifications:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Awesome Example App"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"The example application is an application that provides examples"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
  </span><span class="s2">"accessStrategy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceAccessStrategy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"enabled"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"unauthorizedRedirectUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://billboard.example.org"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"requiredAttributes"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.HashMap"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"userAccessLevel"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"system"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>With the above changes, CAS will prevent access to our example application if the authenticated user does <em>not</em> have a claim <code class="highlighter-rouge">userAccessLevel</code> with a possible value of <code class="highlighter-rouge">system</code>. If access is rejected, CAS should try to redirect the flow back to <code class="highlighter-rouge">https://billboard.example.org</code>. Fairly simple.</p>

<p>However, one issue remains which is the ability to customize the redirect URL in more dynamic ways, depending on the properties of the service definition, etc. The URL might need special query parameters, or different encoding semantics, etc. How could that be done?</p>

<h1 id="dynamic-unauthorized-urls">Dynamic Unauthorized URLs</h1>

<p>We can start by preparing CAS with a <a href="https://apereo.github.io/cas/development/installation/Configuration-Management-Extensions.html">customized configuration component</a> that would house our customizations for this use case. Once that is done, take note of the following bean definition posted in <code class="highlighter-rouge">CasSupportActionsConfiguration.java</code> today:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RefreshScope</span>
<span class="nd">@Bean</span>
<span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"redirectUnauthorizedServiceUrlAction"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">Action</span> <span class="nf">redirectUnauthorizedServiceUrlAction</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">RedirectUnauthorizedServiceUrlAction</span><span class="o">(</span><span class="n">servicesManager</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note how the bean is marked as conditional, meaning it will only be used by CAS if an alternative definition by the same is <em>not</em> found. So, in order for CAS to pick up our own alternative implementation, we are going to provide that bean definition in our own configuration class as such:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">Action</span> <span class="nf">redirectUnauthorizedServiceUrlAction</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">MyRedirectUnauthorizedServiceUrlAction</span><span class="o">(</span><span class="n">servicesManager</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="alert alert-info">
<strong>Compile Dependencies</strong><br />Note that in order for the CAS overlay build to compile our changes and put them to good use, the overlay must be prepared with the required module used during the compilation phase. Otherwise, there will be errors complaining about missing symbols, etc.</div>

<p>Now, it’s time to actually design our very own <code class="highlighter-rouge">DynamicRedirectUnauthorizedServiceUrlAction</code>. Here is a modest example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyRedirectUnauthorizedServiceUrlAction</span> <span class="kd">extends</span> <span class="n">RedirectUnauthorizedServiceUrlAction</span> <span class="o">{</span>
    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">URI</span> <span class="nf">determineUnauthorizedServiceRedirectUrl</span><span class="o">(</span><span class="n">RequestContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">URI</span> <span class="n">redirectUrl</span> <span class="o">=</span> <span class="n">WebUtils</span><span class="o">.</span><span class="na">getUnauthorizedRedirectUrlIntoFlowScope</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">Event</span> <span class="n">currentEvent</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getCurrentEvent</span><span class="o">();</span>
        <span class="kd">final</span> <span class="n">AttributeMap</span> <span class="n">eventAttributes</span> <span class="o">=</span> <span class="n">currentEvent</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">();</span>

        <span class="kd">final</span> <span class="n">PrincipalException</span> <span class="n">error</span> <span class="o">=</span> <span class="o">(</span><span class="n">PrincipalException</span><span class="o">)</span>
            <span class="n">eventAttributes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"error"</span><span class="o">,</span> <span class="n">PrincipalException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">UnauthorizedServiceForPrincipalException</span> <span class="n">serviceError</span> <span class="o">=</span>
            <span class="o">(</span><span class="n">UnauthorizedServiceForPrincipalException</span><span class="o">)</span>
            <span class="n">error</span><span class="o">.</span><span class="na">getHandlerErrors</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">UnauthorizedServiceForPrincipalException</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">());</span>

        <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Calculating URL for service {} &amp; principal {} with attributes {}"</span><span class="o">,</span>
            <span class="n">serviceError</span><span class="o">.</span><span class="na">getRegisteredService</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span>
            <span class="n">serviceError</span><span class="o">.</span><span class="na">getPrincipalId</span><span class="o">(),</span>
            <span class="n">serviceError</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">());</span>

        <span class="cm">/*
           Calculate the required URI, or simply return the default...
        */</span>
        <span class="k">return</span> <span class="n">redirectUrl</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>That should do it. The very next time you build and deploy the changes, CAS should pick up our own bean definition and accompanying implementation class. It should be obvious that inside the class above, you have options to calculate the unauthorized redirect URL as you wish while having access to the underlying service definition object, the authenticated principal, and any retrieved attributes.</p>

<h1 id="so">So…</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p>Happy Coding,</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/04/23/cas-access-strategy-url-redirects/</guid>
                <description>
                    
                    A quick use case walkthrough where the authentication flow in CAS is to be redirected to a customized external URL if service access is denied.
                    
                </description>
                <pubDate>Mon, 23 Apr 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Linking Accounts with Delegated Authentication</title>
                <link>https://apereo.github.io/2018/04/20/cas-delegated-authn-account-linking/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<h1 id="overview">Overview</h1>

<p>In the event that CAS is configured to <a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">delegate authentication</a> to an external identity provider, it may be necessary to link the received profile from the identity provider to an internal account found in LDAP, SQL databases or any other systems. In this tutorial, we will  focus on how to establish the authenticated subject based on this secondary lookup, using an identifier that is provided by the identity provider.</p>

<p>This tutorial specifically focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.3.0-RC4</code></li>
  <li>Java 8</li>
  <li><a href="https://github.com/apereo/cas-overlay-template">Maven WAR Overlay</a></li>
  <li><a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">Delegated Authentication</a></li>
</ul>

<h1 id="use-case">Use Case</h1>

<p>Our starting position is a CAS server that is configured to hand off the authentication flow to an external identity provider <a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">described here</a>. Once the response from the identity provider is validated and a profile response has been collected, CAS will get access to a profile identifier plus a number of attributes that may have been released by the provider depending on the semantics of the protocol in question. In building the authenticated subject and linking that to the SSO session, CAS by default has options to either use what is called a <em>typed id</em> which is translated as <code class="highlighter-rouge">[InternalProviderName]+[Separator]+[ProfileId]</code> or simply the profile id itself. This means that when the SSO session is established, the CAS authenticated subject will be communicated to all integrated applications using one of those two options.</p>

<p>Of course, you may run into scenarios where neither id would actually make that much sense. For example, the internal identity may be a seemly pseudorandom integer that would not be all that practical for other applications. The better scenario as an option would be for CAS to simply look up the <em>real record</em> associated with that internal id, (assuming linking between the two records is made available already), and build the principal identifier and attributes according to the data store internal to CAS.</p>

<p>This is tutorial on how to do just that.</p>

<h1 id="setup">Setup</h1>

<p>Assuming <a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">delegated authentication</a> is configured in CAS using any of the supported identity providers, our job here is put together code that massages the principal construction in CAS once the flow travels back from the identity provider over to CAS. To do this, we are going to take advantage of CAS <code class="highlighter-rouge">PrincipalFactory</code> components whose job is to build authenticated subjects, or <code class="highlighter-rouge">Principal</code>s. Most if not all of authentication strategies in CAS are preconfigured with their own instance of a <code class="highlighter-rouge">PrincipalFactory</code> that would know how to translate a authenticated successful response into a <code class="highlighter-rouge">Principal</code> object CAS can understand.</p>

<p>So start to prepare CAS with a <a href="https://apereo.github.io/cas/development/installation/Configuration-Management-Extensions.html">customized configuration component</a> that would house our specific choice of the <code class="highlighter-rouge">PrincipalFactory</code> used in delegation scenarios. Once that is done, take note of the following bean definition posted in <code class="highlighter-rouge">Pac4jAuthenticationEventExecutionPlanConfiguration</code> today:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"clientPrincipalFactory"</span><span class="o">)</span>
<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">PrincipalFactory</span> <span class="nf">clientPrincipalFactory</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">PrincipalFactoryUtils</span><span class="o">.</span><span class="na">newPrincipalFactory</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note how the bean is marked as conditional, meaning it will only be used by CAS if an alternative definition by the same is <em>not</em> found. So, in order for CAS to pick up our own alternative implementation, we are going to provide that bean definition in our own configuration class as such:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">PrincipalFactory</span> <span class="nf">clientPrincipalFactory</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">PrincipalFactoryUtils</span><span class="o">.</span><span class="na">newPrincipalFactory</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="alert alert-info">
<strong>Compile Dependencies</strong><br />Note that in order for the CAS overlay build to compile our changes and put them to good use, the overlay must be prepared with the required module used during the compilation phase. Otherwise, there will be errors complaining about missing symbols, etc.</div>

<p>Once you have the build compiling correctly, our next task would be to alter the body of our own <code class="highlighter-rouge">clientPrincipalFactory</code> bean definition to do what it needs, which is the establishment of the CAS principal based on provided ids, attributes, etc. You can certainly provide your own implementation of <code class="highlighter-rouge">PrincipalFactory</code>. What might be easier is if you were given the ability to change the implementation dynamically without having to rebuild CAS every time minor changes are required. To do this, aside from the default implementation of <code class="highlighter-rouge">PrincipalFactory</code>, CAS provides a built-in option to externalize all that logic to a Groovy script. The construction of that option would more or less look like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Autowired</span>
<span class="kd">private</span> <span class="n">ResourceLoader</span> <span class="n">resourceLoader</span><span class="o">;</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">PrincipalFactory</span> <span class="nf">clientPrincipalFactory</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Resource</span> <span class="n">script</span> <span class="o">=</span> <span class="n">resourceLoader</span><span class="o">.</span><span class="na">getResource</span><span class="o">(</span><span class="s">"file:/etc/cas/config/CustomPrincipalFactory.groovy"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">PrincipalFactoryUtils</span><span class="o">.</span><span class="na">newGroovyPrincipalFactory</span><span class="o">(</span><span class="n">script</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>…and of course, our Groovy script found at <code class="highlighter-rouge">/etc/cas/config/CustomPrincipalFactory.groovy</code> would have the following structure:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.apereo.cas.authentication.principal.*</span>
<span class="kn">import</span> <span class="nn">org.apereo.cas.authentication.*</span>
<span class="kn">import</span> <span class="nn">org.apereo.cas.util.*</span>

<span class="kt">def</span> <span class="nf">run</span><span class="o">(</span><span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">id</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">attributes</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nf">SimplePrincipal</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">attributes</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now when CAS begins to construct the final authenticated principal, this Groovy script will be invoked to receive the identifier of the received response from the identity provider, any attributes that were submitted and extracted by CAS as a <code class="highlighter-rouge">Map</code> as well as a convenient logger object. Next, you can code in additional logic to contact the necessary systems and execute queries based on the id to collect the <em>real</em> record linked to that id or any of the provided attributes and ultimately, return an object of type <code class="highlighter-rouge">SimplePrincipal</code> that would carry the authenticated subject and its claims.</p>

<h1 id="so">So…</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p>Happy Coding,</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/04/20/cas-delegated-authn-account-linking/</guid>
                <description>
                    
                    A quick use case walkthrough where profiles provided by external identity providers to CAS need to be looked up by an identifier in internal databases before CAS can successfully establish an authenticated subject.
                    
                </description>
                <pubDate>Fri, 20 Apr 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Nominate awesome fits for the Apereo board</title>
                <link>https://apereo.github.io/2018/04/20/nominate-to-board/</link>
                <content:encoded>
                    <![CDATA[
                    <p>Are you a
<a href="https://www.apereo.org/content/bylaws#article-5">representative of a Member Organization in good standing</a>
contemplating whom to nominate for the
<a href="https://groups.google.com/a/apereo.org/d/topic/announcements/rCtIZGF2eos/discussion">available Apereo board of directors seats</a>?</p>

<p>Here are some ideas. Until 1700 Eastern on April 20th 2018, it’s not too late to
widen the pool.</p>

<p>(I haven’t checked with most people listed here to see if they’d actually be
willing to serve - the point of this post is to provoke thought on who <em>you</em>
would like to see serving on this board and <em>why</em>, thoughts on what
characteristics would make for excellent board leadership and round out the
perspectives available in Apereo.)</p>

<p>(As often I speak here only wearing my individual contributor hat.)</p>

<h2 id="vicky-brasseur">Vicky Brasseur</h2>

<p>With experience serving on the Open Source Initiative board, as an author and
moderator on opensource.com, and as a professional software engineer, Vicky
would be a valuable voice on the Apereo Board.</p>

<p>Vicky has literally written the
<a href="https://pragprog.com/book/vbopens/forge-your-future-with-open-source">book on contributing to open source software</a>.</p>

<p>If Apereo can’t draw in Vicky’s attentions gratis through board service, I
advocate Apereo hiring Vicky’s significant expertise through her
<a href="https://www.vmbrasseur.com/services/">consulting services</a>.</p>

<h2 id="audrey-watters">Audrey Watters</h2>

<p><a href="http://audreywatters.com/">Audrey</a> is a very important voice of EdTech skepticism. It would
be helpful to have her at the table.</p>

<h2 id="karen-sandler">Karen Sandler</h2>

<p><a href="https://sfconservancy.org/about/staff/#karen">Karen</a> is executive director of
the Software Freedom Conservancy.</p>

<p>Karen would bring</p>

<ul>
  <li>legal experience, including with the <a href="https://sfconservancy.org/blog/2014/jun/09/do-not-need-cla/">Conservancy’s perspective</a> on
the necessity of ICLAs</li>
  <li>experience directing a non-profit foundation with an annual budget on the same
order of magnitude as Apereo</li>
  <li>experience in diversity and inclusion especially through her Outreachy work</li>
</ul>

<p>Apereo might learn much from Conservancy perspective.</p>

<h2 id="tim-vertein">Tim Vertein</h2>

<p>My colleague Tim is a thoughtful, productive, effective professional
with a proven commitment to the university and to serving university
participants well. He’d make a great Apereo Board director for many of the same
reasons <a href="https://git.doit.wisc.edu/andrew-petro/2018-vertein-apereo-fellow-nomination/blob/master/README.md">he’d make a great Apereo fellow</a>.</p>

<h2 id="misagh-moayyed">Misagh Moayyed</h2>

<p>Misagh is the Apereo CAS project PMC chair.</p>

<p>I think Apereo at the Board level has unrealized opportunity to better consider
the perspective and experiences of the people working in Apereo projects. The
disconnect between (relatively closed) Board governance and “100% open” projects
might be alleviated through bringing those perspectives closer to the
governance.</p>

<p>Misagh has distinguished himself through thoughtful
stewardship of the Apereo CAS project, one of the more successful Apereo
projects in breadth of adoption, quantity of contributors, and in engineering
attention to enabling divergent local configuration of a shared open source
software product.</p>

<h2 id="shane-curcuru">Shane Curcuru</h2>

<p>Apereo sometimes tries to take Apache’s lead and presumably could do so even
better informed by a board director who has experience and achievement
in the Apache Software Foundation context, evident from Apache committership,
Apache PMC membership, Apache Board Director experience, and Apache Foundation
Membership.</p>

<p>(<a href="https://apache.org/foundation/members.html">Membership in the Apache Software Foundation</a> is a big deal.
You can’t buy it.)</p>

<blockquote>
  <p>Membership in The Apache Software Foundation is a privilege and is by
invitation only.</p>
</blockquote>

<p>Shane specifically has experience with Apache incubation and community
development, both especially relevant to Apereo’s challenges.</p>

<p>If Apereo can’t draw in Shane’s attentions gratis through Board service, I
advocate Apereo hiring Shane’s significant expertise under the auspices of his
open source community engagement consultancy, <a href="http://punderthings.com/">Punderthings Consulting</a>.</p>

<h2 id="pat-masson">Pat Masson</h2>

<p><a href="https://opensource.org/docs/board-annotated#PatrickMasson">Pat</a> is General
Manager of the Open Source Initiative.</p>

<p>Pat has experience with higher education and particularly with Apereo.</p>

<p>The OSI’s experience is also relevant in that it has a successful individual
membership program. As Apereo bootstraps its own individual membership program
OSI’s experience might help catapault this to sustainability.</p>

<h2 id="ben-balter">Ben Balter</h2>

<p>Ben is a lawyer with an important perspective on
<a href="https://ben.balter.com/2018/01/02/why-you-probably-shouldnt-add-a-cla-to-your-open-source-project/">tradeoffs in contributor license agreement rigor</a>. Also,
Ben’s experience in federal government service might be a helpful public service
perspective on the board.</p>

<h2 id="tim-carroll">Tim Carroll</h2>

<p>Tim is a current Apereo board member whose term is ending and who is available
for re-nomination.</p>

<p>It might be a fine thing to re-nominate Tim. He seems a voice of pragmatism on
the board.</p>

<p>On the public record, Tim</p>

<ul>
  <li>shared <a href="https://groups.google.com/a/apereo.org/d/topic/open/Xtdt2I8VMQQ/discussion">an article on the open@ list</a></li>
  <li><a href="https://groups.google.com/a/apereo.org/d/msg/licensing-discuss/c1puG3RKZcA/nPDMUCU6EAAJ">engaged</a>
regarding the failed 2016 attempt to unburden Apereo ICLA policy. (I wish that
had succeeded, but engagement was still better than not engaging with the
issue).</li>
  <li><a href="https://groups.google.com/a/apereo.org/d/msg/open/GNtB1MGvZK4/rebkAZPSBwAJ">engaged</a>
regarding a proposal to create an open parallel to the closed <code class="highlighter-rouge">projects@</code>
email list (advocating using existing <code class="highlighter-rouge">open@</code> for this purpose)</li>
  <li><a href="https://groups.google.com/a/apereo.org/d/msg/incubation/86VDDg_ADZI/IvFNEKSZBQAJ">voiced a way to un-stick a potential incubation</a></li>
</ul>

<p>Of the 8 Apereo board meetings in the past year for which <a href="https://www.apereo.org/content/board-meeting-minutes">minutes</a>
are available, 6 show Tim as attending (75%).</p>

<h2 id="charles-severance">Charles Severance</h2>

<p>Dr. Chuck is the Apereo Sakai project PMC chair. He also has experience serving
as an Executive Director of an open source foundation and as a board member.
This combination of executive, governance, and
working-in-the-open-source-project perspectives could be highly valuable on the
board.</p>

<h2 id="bryan-ollendyke">Bryan Ollendyke</h2>

<p><a href="https://www.drupal.org/u/btopro">Bryan</a> is tremendously passionate about
Apereo-incubating ELMS:LN, about openness and about improving higher education
and about the quality of community interactions. Bryan’s work is well-regarded.</p>

<p>The energy, passion, sense of urgency, and bias for action he brings might in
itself make his board term very worthwhile.</p>

<h2 id="a-registrar">A registrar</h2>

<p>Apereo ought to be adding tremendous value to the work of university registrars.
What are the not-yet-realized opportunities in this space and would bringing a
registrar’s perspective closer to the governance help?</p>

<h2 id="another-cio">Another CIO</h2>

<p>Apereo ought to be adding tremendous value and leverage to the work of
university CIOs, broadening the viable tactical and strategic options and having
the side effect of pressuring proprietary and SaaS vendors to better serve
education (out of a healthy concern about the alternatives available to
universities). What are the not-yet-realized opportunities in this space and
would bringing another CIO’s perspective closer to the governance help to
realize those opportunties?</p>

<h2 id="apereo-fellows">Apereo Fellows</h2>

<p>I’d expect any of the <a href="https://www.apereo.org/communities/apereo-fellows">Apereo Fellows</a> would bring an informed perspective to
the board.</p>

<h2 id="others">Others</h2>

<p>What experiences and perspectives would you like to see more of on the Apereo
board? Who might bring those to bear? Is there an opportunity for that to
happen?</p>

<p>/Andrew Petro</p>

<p>as individual contributor</p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/04/20/nominate-to-board/</guid>
                <description>
                    
                    Provoking thoughts about who might serve well on Apereo board.
                    
                </description>
                <pubDate>Fri, 20 Apr 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Test-Driving Feature Modules</title>
                <link>https://apereo.github.io/2018/04/05/cas-codebase-feature-build/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<h1 id="overview">Overview</h1>

<p>Following up on my previous blog post on <a href="https://apereo.github.io/2018/04/01/cas-overlays-supercharged/">changing CAS source code in an overlay</a>, in this exercise we are going to more or less repeat the same experience except that this time, we will be addressing the changes and workload from the perspective of the CAS codebase. This quick walkthrough effectively aims for the following objectives:</p>

<ul>
  <li>A quick development environment setup using IntelliJ IDEA.</li>
  <li>Building and running the CAS web application using Gradle.</li>
  <li>Changing feature modules and testing out behavior.</li>
  <li>Stepping into the code using a debugger.</li>
</ul>

<h1 id="development-environment">Development Environment</h1>

<p>Follow the <a href="https://apereo.github.io/cas/developer/Build-Process-5X.html">instructions posted here</a> to obtain the CAS source code. Remember to indicate the relevant <code class="highlighter-rouge">branch</code> in the commands indicated to obtain the right source code for the CAS version at hand. In this tutorial and just like before, the branch to use would be <code class="highlighter-rouge">5.2.x</code>.</p>

<p>To understand what branches are available, <a href="https://github.com/apereo/cas/branches">see this link</a>. Your CAS version is closely tied to the branches listed in the codebase. For example, if you are deploying CAS <code class="highlighter-rouge">5.1.8</code>, then the relevant branch to check out would be <code class="highlighter-rouge">5.1.x</code>. Remember that branches always contain the most recent changeset and version of the release line. You might be deploying <code class="highlighter-rouge">5.1.8</code> while the <code class="highlighter-rouge">5.1.x</code> might be marching towards <code class="highlighter-rouge">5.1.10</code>. This requires that you first upgrade to the latest available patch release for the CAS version at hand and if the problem or use case continues to manifest, you can then check out the appropriate source branch and get fancy <sub>[1]</sub>.</p>

<div class="alert alert-info">
<strong>Keep Up</strong><br />It is <b>STRONGLY</b> recommended that you keep up with the patch releases as they come out. Test early and have the environment on hand for when the time comes to dabble into the source. Postponing patch upgrades in the interest of time will eventually depreciate your lifespan.</div>

<p>To set up the project in IntelliJ IDEA, it might be preferable to run <code class="highlighter-rouge">./gradlew idea</code> at the root of the project. This will attempt to generate the needed project files beforehand, allowing the development environment setup to proceed without many delays. Note that similar tasks are available for eclipse, etc.</p>

<h1 id="running-cas">Running CAS</h1>

<p>The CAS web application itself can be started from the command-prompt using an embedded Apache Tomcat container. In fact, this process is no different than deploying CAS using the same embedded Apache Tomcat container which means you will need to follow the <a href="https://apereo.github.io/cas/developer/Build-Process-5X.html">instructions posted here</a> in the way that certificates and other configurations are needed in <code class="highlighter-rouge">/etc/cas/config</code>, etc to ensure CAS can function as you need it. All features modules and behavior that would be stuffed into the web application artifact continue to read settings from the same location, as they would be when activated from an overlay. The process is exactly the same.</p>

<p>I use the following alias in my bash profile to spin up CAS using an embedded Apache Tomcat container. You might want to do the same thing, or create the equivalent script for other operating systems to reduce time and keystrokes:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">bc</span><span class="o">=</span><span class="s1">'clear; cd ~/Workspace/cas/webapp/cas-server-webapp-tomcat; \
    ../../gradlew build install bootRun --configure-on-demand --build-cache --parallel \
    -x test -x javadoc -x check -DenableRemoteDebugging=true --stacktrace \
    -DskipNestedConfigMetadataGen=true -DskipGradleLint=true -DskipSass=true \
    -DskipNodeModulesCleanUp=true -DskipNpmCache=true -DskipNpmLint=true'</span>
</code></pre></div></div>

<p>Then, I simply execute the following in the terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> bc
</code></pre></div></div>

<p>To understand the meaning and function behind various command-line arguments, please see <a href="https://apereo.github.io/cas/developer/Build-Process-5X.html">instructions posted here</a>. You may optionally decide to tweak each setting if you are interested in a particular build variant, such as generating javadocs, running tests, etc. One particular flag of interest is the addition of <code class="highlighter-rouge">enableRemoteDebugging</code>, which allows you, later on, to connect a remote debugger to CAS on a specific port (i.e. <code class="highlighter-rouge">5000</code>) and step into the code.</p>

<div class="alert alert-info">
<strong>Bootiful CAS</strong><br />At this time, the availability of the <code>bootRun</code> task running from inside IntelliJ IDEA is not possible.</div>

<h1 id="testing-modules">Testing Modules</h1>

<p>Per <a href="https://apereo.github.io/cas/developer/Build-Process-5X.html">instructions posted here</a>, the inclusion of a particular build module in the <code class="highlighter-rouge">build.gradle</code> of the CAS web application should allow the build process to automatically allow the module to be packaged and become available. Since the CAS web application we are running is supported by Apache Tomcat, the reference to the CAS reCAPTCHA module can be included <a href="https://github.com/apereo/cas/blob/5.2.x/webapp/cas-server-webapp-tomcat/build.gradle">right there</a>.</p>

<p>Alternatively, you may also include the reference in the <a href="https://github.com/apereo/cas/blob/5.2.x/webapp/gradle/webapp.gradle#L109"><code class="highlighter-rouge">webapp.gradle</code></a> file, which is the common parent to build descriptors that do stuff with the CAS web application. Making changes in this file will ensure it to be included <em>by default</em> in the generic CAS web application, regardless of how it is configured to run, which means you need to be extra careful about the sort of changes you make, what is kept and what is checked in here.</p>

<p>That said, the <code class="highlighter-rouge">webapp.gradle</code> is usually where I myself put the module references in and I try to be extra careful to not keep them in the same file when I check changes in for review, etc. So for reference and our task at hand, the <code class="highlighter-rouge">webapp.gradle</code> file would look like the following:</p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">dependencies</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">implementation</span> <span class="nf">project</span><span class="o">(</span><span class="s2">":support:cas-server-support-captcha"</span><span class="o">)</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note the reference locates the module using its full path. The next time you run <code class="highlighter-rouge">bc</code>, the final CAS web application will have enabled reCAPTCHA functionality when it’s booting up inside Apache Tomcat.</p>

<p>The remaining tasks are super similar to the earlier post; we locate the <code class="highlighter-rouge">ValidateCaptchaAction</code> component and make the relevant change there. We then run <code class="highlighter-rouge">bc</code> to run CAS locally again to test the change and lather-rinse-repeat until the desired functionality is there. Once done, you may the commit the change to a relevant branch (of your fork, which is something you should have done earlier when you cloned the codebase) and push upstream (again, to your fork) in order to prepare a pull request and send in the change.</p>

<h1 id="debugging-cas">Debugging CAS</h1>

<p>One of the very useful things you can include in your build is the ability to allow for remote debugging via <code class="highlighter-rouge">-DenableRemoteDebugging=true</code>. Both <a href="https://www.jetbrains.com/help/idea/run-debug-configuration-remote-debug.html">IntelliJ IDEA</a> and eclipse allow you ways to connect to this port remotely and activate a debugger in order to step into the code and troubleshoot. This is hugely useful, especially in cases where you can make a change to a source file and <em>rebuild</em> the component live and hot, reloading the <code class="highlighter-rouge">.class</code> file and allowing the changes to kick in the very next time execution passes through without restarting Tomcat. Depending on how significant the change is, this should save you quite a bit of time.</p>

<h1 id="so">So…</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p>Happy Coding,</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

<p>[1] There are ways to get around this <em>limitation</em>, by specifically downloading the source code for the exact CAS version at hand. I am skipping over those since they only lead to complications, suffering and further evil in most cases.</p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/04/05/cas-codebase-feature-build/</guid>
                <description>
                    
                    An overview of how various CAS features modules today can be changed and tested from the perspective of a CAS contributor working on the codebase itself to handle a feature request, bug fix, etc.
                    
                </description>
                <pubDate>Thu, 05 Apr 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Feedback on draft Apereo strategy</title>
                <link>https://apereo.github.io/2018/04/04/apereo-strategy/</link>
                <content:encoded>
                    <![CDATA[
                    <p>In which I comment on
<a href="https://www.apereo.org/content/apereo-foundation-strategic-planning">the draft strategic plan Apereo articulated for 2018</a>.</p>

<p>As often: I am speaking here wearing only my individual contributor hat.</p>

<h1 id="feedback-on-apereo-strategy-focus-on-revenue-to-achieve-sustainability">Feedback on Apereo strategy: focus on revenue to achieve sustainability</h1>

<p>TL;DR: <strong>Emphatically focus on recurring revenue to achieve sustainability.
Aggressively defer everything not focused upon this.</strong></p>

<h2 id="context">Context</h2>

<ul>
  <li><a href="https://www.apereo.org/content/apereo-foundation-strategic-planning">Apereo strategic plan</a></li>
  <li>Apereo <a href="https://groups.google.com/a/apereo.org/d/msg/sakai-pmc/gta0LD1phrg/E0-diMLeAAAJ">failed to secure enough recurring revenue</a> to
retain a full-time position supporting Sakai (Sakai-specific funding) and more
generally roughly broke even on recurring membership revenue.</li>
</ul>

<h2 id="vision">Vision</h2>

<p>(what future state are we trying to bring about?)</p>

<p>TL;DR: <strong>Most higher education institutions will collaboratively develop,
maintain, and locally implement free and open source software solutions meeting
its needs, at all scales, and in all ways, doing this through and facilitated by
Apereo.</strong></p>

<p>Unpacking this:</p>

<p><strong>Higher education will collaboratively develop, maintain, and locally implement
free and open source software solutions meeting the needs of higher education.</strong>
These will be directly valuable (delivering effective user experiences to higher
education constituents is awesome) and will be indirectly valuable in the
pitfalls they avoid, the choices they afford, and the effect they have on the
proprietary software offered to higher education through inspiration and through
competition.</p>

<p>Higher education will do this <strong>at all scales</strong>, for example both at the handy
little WordPress plug in end of things and the comprehensive lecture capture
solution or learning management system or ERP end of things.</p>

<p>Higher education will do this <strong>in all ways</strong>, and notably, <strong>not just through
coding.</strong> The activities of collaboration and maintenance of effective free and
open source software solutions meeting the needs of higher education are so very
much more than just coding or even of developing novel software solutions.
There’s value in communities of practice, in context for understanding
higher-education-specific perspectives on more general open source software
solutions, in exerting higher-education-serving influences on open source
software projects with wider contexts beyond higher education.</p>

<p>To give an example: apparently
<a href="https://wordpress.org/about/features/">WordPress powers more than 30% of the Web</a>,
including a great many sites in and around higher education. Higher education
doesn’t need its own WordPress-like thing. But higher education may very well
have particular needs for plugins for WordPress, for ways of using WordPress,
for problems to solve with WordPress, for experiences to share. There’s a there
there in the “in higher education” part of “Using WordPress in higher
education”. Higher education might particularly need WordPress plugins to
fulfill accessibility and usability expectations, and might particularly need
clarity about what WordPress implementation choices are and are not consistent
with higher education’s especial needs to provide accessibility. There’s
worthwhile work to be done and insights to share to facilitate higher education
success in leveraging WordPress.</p>

<p><strong>Apereo will be the organization that enables higher education to succeed at
this collaborative development, maintenance, and local implementation</strong>. Apereo
will be the context for this work, particularly facilitating the
cross-institutional aspects of this and the natural handoff of participation
from institutions to institutions as time and circumstances evolve. Apereo will
deliver identifiable value to higher education, value to any given member
institution in excess of the membership fees borne by that institution.</p>

<p>To give an example: Sakai is a free and open source by for and about higher
education learning management system. Such a thing should very much exist and be
a viable option. It does and is. Sakai deserves significant sustaining
resources. The preeminent actually open source learning management system for
higher education ought to be tremendously supported. Apereo qua Apereo should be
adding lots of value to this.</p>

<p><strong>Most higher education institutions will be Apereo members, because most higher
education institutions will be (already are) making significant use of free and
open source software solutions</strong> and that use will be more effective and more
confident because of the value Apereo is adding to it. If they’re not using
Sakai as a learning management system or OpenCast for lecture capture or an open
source ERP, they’re most certainly using WordPress or Drupal somewhere or are
generating and transforming CSV files representing institutional data or
integrating across SaaS vendor products or educators are using open source text
editors to author lesson plans or… There’s tremendous breadth of
opportunity for higher education to benefit from open source, so there’s
tremendous breadth of opportunity for Apereo to add value to higher education’s
benefiting from open source.</p>

<p><strong>Strategy:</strong></p>

<p>(how are we going to get to achieve this vision?)</p>

<p>First and foremost, <strong>Apereo must achieve critical mass of recurring revenues
(membership fees) to achieve sustainability.</strong></p>

<p>There are all sorts of opportunities to add value to collaborative open source
in higher education. But to meaningfully pursue these, to meaningfully impact
the world over the longer term, Apereo needs to exist with enough substance to
be able to, well, do things. The thing about unsustainable things is that
they’re really hard to sustain. Working towards the vision will require
sustained effort for many years (forever?) and so achieving sustainability is
essential.</p>

<p>So here’s the strategy:</p>

<ol>
  <li>Increase revenue</li>
  <li>Use all available resources, including revenue, to further increase revenue.</li>
  <li>Increase revenue</li>
  <li>Apply staff and other efforts to provide members a
positive return on their membership investment. Apereo must deliver
recognizable value to the members, value enough that the members are saying
“Sure am happy to be paying for that membership, because we’re clearly
getting more out of Apereo than we’re paying into it.” This will stabilize
and retain revenue.</li>
  <li>Increase revenue through the increased memberships as more and more of higher
education sees Apereo as a source of value very much worth sustaining.</li>
  <li>Increase revenue through (carefully targeted?) increased membership fees as
more Apereo members are realizing more value from their Apereo membership.</li>
  <li>Use the increased revenue to add more value to higher education. Use the
increased value to higher education to secure more revenue. Repeat until the
vision is achieved (in practice, forever).</li>
</ol>

<p>The most important challenge here is that at the early end of this strategy
Apereo is adding less value to higher education and so revenue, in the form of
memberships, are harder to secure, whereas at the later end of this strategy
Apereo is adding more value to higher education and so revenue, in the form of
memberships, is easier to secure.</p>

<p><strong>The most existential risk is in the early phases.</strong></p>

<p><strong>So the thing to do is to focus on escaping the early phases.</strong></p>

<p>So here’s what this strategy means:</p>

<p><strong>Focus entirely on things that will increase revenue (membership). Defer
everything that won’t affect revenue (membership).</strong></p>

<p>Considering incubating a new open source software project? Is that project going
to bring in more membership revenue? Yes? Pull it in. No? Hold off.</p>

<p>Having a presence anywhere? Is that presence going to bring in more members, or
is it necessary to retain existing members? No? Don’t go.</p>

<p>Is securing ICLAs going to bring in new or retain members? Great, do it, more
members are absolutely essential to sustainability. It’s not going to impact
membership? Suspend the whole program.</p>

<p>Is re-licensing a project from a New BSD license to an Apache2 license going to
bring in more members, or is it necessary to retain existing members? Yes?
Great, undertake that hassle. No? Defer it.</p>

<p>Considering a partnership? Neat. Will it increase recurring membership revenue?
Go for it. It won’t? It’s a distraction, defer it.</p>

<p>Apereo cannot afford to do anything that isn’t increasing recurring revenue.
Doing anything that isn’t increasing recurring revenue has the opportunity cost
of <em>not</em> doing something more likely to increase revenue. Intentionally
navigating these tradeoffs is essential to maximizing Apereo’s odds of having
a meaningful influence a decade from now.</p>

<p><strong>This is painful. Opportunities that by other measures would be worthwhile must
be foregone. But this is how to get to sustainability, and without
sustainability, nothing else Apereo does is going to matter much over the long
term.</strong></p>

<p><strong>The idea isn’t to <em>never</em> do anything other than pursue recurring revenue. The
idea is prioritize pursuing recurring revenue until recurring revenue is
sufficient to afford the luxury of applying resources to pursue the
organizational mission.</strong></p>

<h2 id="feedback-on-apereo-draft">Feedback on Apereo draft</h2>

<p>With this vision (higher education succeeding wildly by collaboratively meeting
its needs through free and open source software) and strategy (achieve critical
mass to enable Apereo adding value and doing so sustainably) in mind, here’s my
feedback on Apereo’s draft strategic themes:</p>

<h3 id="1-membership-financial-health-and-fundraising">1. Membership, Financial Health and Fundraising</h3>

<blockquote>
  <p>In 2018 Apereo will focus on recruiting adopters of Apereo software and other
educational and commercial organisations into an expanded foundation
membership.</p>
</blockquote>

<p>Yes, do that. All of higher education should be Apereo members. Get far enough
towards that to achieve sustainability.</p>

<p>Consider reviving the individual membership program.</p>

<p>Consider ways to price discriminate so that institutions that can pay more do.</p>

<h3 id="2-foundation-services--new-ideas">2. Foundation Services &amp; New Ideas</h3>

<blockquote>
  <p>2018 will see a review of key Apereo services to support the community,
together with the elaboration of a process for introducing new services and
areas of activity, and reviewing - and potentially retiring old ones.</p>
</blockquote>

<p>If adding a service will yield more members or is necessary to retain members,
do it.</p>

<p>If it won’t affect membership, defer it or suspend it.</p>

<p>One kind of service that might widen memberships are those that affect breadth.
A better implementation of more active discussion lists or chat might enable
Apereo to widen scope into e.g. higher education knowledge sharing around
WordPress plugins. Become the place for higher education to talk WordPress, to
collaborate, to share – and maybe Apereo could reach 500 more people across 100
more institutions. Pull in 10% of those institutions as members and maybe we’re
getting somewhere.</p>

<p>Curtail services offered to non-members who aren’t going to become members.</p>

<p>Look for opportunities to expand into spaces and activities that will increase
membership with low or no additional infrastructure and services commitments.</p>

<p>Job posting board reserved for members? Maybe members would value being able to
post opportunities (presumably, about working with open source for the
institution) to a context that reaches IT professionals likely to have
experience with higher education and with open source?</p>

<p>Speakers or consultants directory? Maybe members would value more ready leads on
expertise about open source in higher education.</p>

<p>Institutional project matching service? Maybe members would value leads on what
others have experienced with specific open source technologies or attempting to
leverage open source for specific kinds of projects.</p>

<p><em>These may be terrible ideas.</em> The lens for evaluating them is whether they will
retain and increase membership revenue.</p>

<h3 id="3-software-community-health">3. Software Community Health</h3>

<blockquote>
  <p>Apereo will explore the potential for a light-touch framework for expressing
and communicating the health of constituent software communities during the
course of 2018, as a contribution to greater transparency and adoption.</p>
</blockquote>

<p>This doesn’t sound like it will attract or retain membership revenues. If this
isn’t going to bring in more members and it’s not essential to retain existing
members, defer it.</p>

<p>Apereo just can’t afford this. The constituent software communities are however
healthy they are. They’ll do what they can do, or not, to determine and
communicate health. There are
<a href="https://groups.google.com/a/apereo.org/d/msg/open/PWWF0xtz480/GwWd3sE5AgAJ">some badging, checklisting, health assessing efforts afoot</a>
more generally in open source. That’ll have to be good enough.</p>

<h3 id="4-communications-outreach-and-engagement">4. Communications, Outreach and Engagement</h3>

<blockquote>
  <p>Apereo will expand its communications efforts across three principle audience
axes  - specific to role (CIO, Faculty, Learning Technologist, Student,
Researcher), to interest area (specific software, theme or topic), and
geographical region or country.</p>
</blockquote>

<p>Cut this down to only the communication efforts that will attract and retain
members. That probably means focusing on helping CIOs to see value and urgency
in Apereo membership, maybe targeting institutions that have already adopted
Apereo software significantly (so, most likely to care) and in regions likely to
be able to afford an Apereo membership (so, more likely to impact overall
revenue more).</p>

<p>It’s not that other kinds of communication aren’t valuable. It’s that Apereo
can’t afford it until it can.</p>

<blockquote>
  <p>Above-campus or cloud-based service provision, and its interaction with open
source software, is a theme of specific interest that will be assigned
priority in the coming year, particularly in terms of approaches taken in
different parts of the world.</p>
</blockquote>

<p>If there’s any way to defer this, defer it. It sounds like a distraction from
securing memberships.</p>

<blockquote>
  <p>Communications and outreach is a critical enabler of objectives around
membership and financial health. In particular community members will be
encouraged and equipped to represent their engagement in Apereo activities,
and use of Apereo software, as they engage with other associations they are
active within - EDUCAUSE, AXIES, ALT etc.</p>
</blockquote>

<p>This sounds promising.</p>

<blockquote>
  <p>The Foundation will continue to support a range of global, regional and
individual software community events over the course of the coming year,
seeking economies of scale by combination or linkage where appropriate, and
working with partner organisations to increase effectiveness and reduce
costs.</p>
</blockquote>

<p>Do as little of this as Apereo can get away with and leverage it as much as
possible to draw in more members and retain existing members.</p>

<h3 id="5-partnerships">5. Partnerships</h3>

<blockquote>
  <p>Apereo will continue to seek partnerships with organisations with missions
that overlap its own, or are complimentary.</p>
</blockquote>

<p>Pursue new and invest in existing partnerships only insofar as these will pull
in more members and retain existing members.</p>

<p>Consider reworking existing partnerships. For example, every French university
should be an Apereo member. Apereo cannot afford to forgo this revenue, and
ESUP cannot afford <em>not</em> to support Apereo in this way over the longer term in
order to make the open source software ESUP relies upon more sustainable.</p>

<blockquote>
  <p>We will act to promote LAMP as a solution for smaller institutions, and
deepen our collaboration with ESUP-Portail, as it continues to grow the
adoption of, and contribution to, an increasing range of Apereo software in
France.</p>
</blockquote>

<p>Only do this if it’s going to increase membership. Investing in LAMP and ESUP
should be through the lens of expected recurring revenue returns on that
investment.</p>

<h3 id="6-development-opportunities-and-recognition-programs">6. Development Opportunities and Recognition Programs</h3>

<blockquote>
  <p>It is appropriate that we review progress so far to encourage and resource
further development, and additional strands of these [recognition]
activities. 2018 will also see the exploration of a series of developmental
activities for Apereo community participants, beginning to unlock the
potential for further sharing of expertise across the broad community.</p>
</blockquote>

<p>Apereo can’t afford this. I imagine no institution became or remained a member
because of an Apereo fellowship or an ATLAS award. (The Fellowship program in
particular seems to have an interesting track record of fellows exiting Apereo
contexts soon after their fellowship).</p>

<p>by Andrew Petro
as individual contributor</p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/04/04/apereo-strategy/</guid>
                <description>
                    
                    Focus on revenue to achieve sustainability. Defer everything else.
                    
                </description>
                <pubDate>Wed, 04 Apr 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS Best [Mal]Practice - Supercharged Overlays</title>
                <link>https://apereo.github.io/2018/04/01/cas-overlays-supercharged/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<h1 id="overview">Overview</h1>

<p>There are a number of <a href="https://apereo.github.io/tags/#CAS">tutorials and overviews</a> that describe the purpose and anatomy of a <a href="https://apereo.github.io/cas/development/installation/Maven-Overlay-Installation.html">CAS Overlay</a>. What is often left unsaid in these posts is the note that a CAS overlay, regardless of how it is orchestrated by your favorite hipster build tool of the week, can be used to override <em>any and all</em> CAS components that are configured and available at runtime where this not only includes somewhat static configuration such as property files, HTML views, and YAML configuration but also Java classes, solid source code and beyond.</p>

<p>This brief walkthrough aims to uncover the magical ways one can tap into and alter the CAS source code from an overlay perspective, without quite dealing with the CAS codebase, for good and evil…but mostly evil.</p>

<h1 id="why">Why</h1>

<p>The most immediate question to address is along the lines of…</p>

<blockquote>
  <p>Why would anyone ever want to do this?</p>
</blockquote>

<p>It more or less comes down to the following categories of rationale:</p>

<ul>
  <li>
    <p>There may be cases where analysis and troubleshooting of a CAS feature are not quite possible by simply reviewing <code class="highlighter-rouge">DEBUG</code> logs or changing configuration. You may need to access the source code to put in additional diagnostic information, include extra conditions to validate values, enforce availability of systems, etc.</p>
  </li>
  <li>
    <p>Likewise, there may be requirements whose implementation may need tapping into an internal CAS component for a change in behavior. This is the case where things work as intended, but not quite the way you envision the change to execute for your deployment. So you step in to change a <code class="highlighter-rouge">false</code> to <code class="highlighter-rouge">true</code>, remove an extra condition or add minimal behavior to support a new syntax for a configuration value, rename a field, etc.</p>
  </li>
</ul>

<p>In <em>almost</em> all cases the changes that go into the overlay, specifically dealing with core components, are decent candidates for contributions and pull requests and ultimately should be removed from the overlay.</p>

<h1 id="why-not">Why Not</h1>

<p>Any time you are about to tap into CAS internals, you should pause and reconsider alternative approaches and subsequently the overall maintenance strategy of the change, especially if the reason for the change has to do with the second category of modifications noted above. Depending on scope and component, the change may not be forward-compatible at all, the original component may be heavily refactored or removed in future versions without mercy, the feature may get removed entirely and you may be forever left with local customizations that require maintenance and care for every build and future upgrade. This is the power of open-source where modifications come freely with code at hand…with the understanding that <em>“You can do things on your own, but then, you would [mostly] be on your own”</em>.</p>

<p>Though put in somewhat extreme terms, consider this a best malpractice that if your CAS deployment overlay contains any <code class="highlighter-rouge">.java</code> code, chances are you are doing something <em>wrong</em>. There should be <a href="https://apereo.github.io/2017/09/10/stop-writing-code/">better routes and strategies</a> on how to deliver the same end result and those should not solely and exclusively belong to your deployment. You are not that special. Given timeline and budget if you find no other strategy, always label the changes to be temporary and work as hard as you can to remove it. I could not tell you how many times I have been involved in deployments where the prospect has made significant modifications to CAS internals and…</p>

<ul>
  <li>Has no clue how the changes work.</li>
  <li>…or the person responsible for the changes is no longer with the organization.</li>
  <li>…or there is no documentation and rationale for the now-outdated change.</li>
  <li>…or the organization has completely lost the original source code.</li>
  <li>…or the change is implemented in such a way that is not sustainable without major editorials.</li>
  <li>…or the change opens up the deployment to a security vulnerability.</li>
  <li>…or the change prevents the deployment from gaining a fix for a security vulnerability.</li>
  <li>etc.</li>
</ul>

<div class="alert alert-success">
<strong>A Pinch of Salt</strong><br />Of course, there are reasonable exceptions here especially in areas where there are documented and/or recommended approaches to customizations and extending system behavior. The point is, consider all alternatives before stepping into a development mood.</div>

<h1 id="having-said-that">Having Said That</h1>

<p>Let’s consider a quick hypothetical use case with CAS <code class="highlighter-rouge">5.2.x</code> and its support for <a href="https://apereo.github.io/cas/5.2.x/integration/Configuring-Google-reCAPTCHA.html">Google reCAPTCHA</a>. Suppose that you have an overlay that is adequately prepped with relevant intention modules and properties to make reCAPTCHA work. Things have been running just fine. Then comes a change in protocol from Google that changes the validation response to include the now-renamed field <code class="highlighter-rouge">successful</code> instead of the old <code class="highlighter-rouge">success</code>. The reCAPTCHA module in CAS obviously has not had a chance to catch up to this change and is still looking out for <code class="highlighter-rouge">success</code> in the validation response and begins to error out. What to do?</p>

<ul>
  <li>Step #1: Identify the need to tap into the source code.</li>
  <li>Step #2: Rename the flag in the right <code class="highlighter-rouge">.java</code> component.</li>
  <li>Step #3: Build and test the behavior.</li>
</ul>

<p>A quick analysis of the reCAPTCHA module in CAS reveals <code class="highlighter-rouge">src/main/java/org/apereo/cas/web/flow/ValidateCaptchaAction.java</code> that in fact handles the validation by checking for the value of the <code class="highlighter-rouge">success</code> field in the response. Here is the relevant code snippet:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span>
<span class="kd">final</span> <span class="n">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">lines</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">());</span>
<span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Google captcha response received: [{}]"</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">JsonNode</span> <span class="n">node</span> <span class="o">=</span> <span class="n">READER</span><span class="o">.</span><span class="na">readTree</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">has</span><span class="o">(</span><span class="s">"success"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"success"</span><span class="o">).</span><span class="na">booleanValue</span><span class="o">())</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>
<span class="o">...</span>
</code></pre></div></div>

<p>The above snippet attempts read and transform the response into a JSON object, checking for the trueness of the <code class="highlighter-rouge">success</code> field. How do we apply the source code change in the overlay to now examine for <code class="highlighter-rouge">successful</code>?</p>

<h1 id="overlay-the-code">Overlay The Code</h1>

<p>In the root directory of the overlay project, (assuming a Maven overlay), run the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create the directory path to match the component's package name</span>
mkdir <span class="nt">-p</span> src/main/java/org/apereo/cas/web/flow

<span class="c"># Download the source file for the CAS version</span>
wget https://raw.githubusercontent.com/apereo/cas/5.2.x/support/cas-server-support-captcha
        /src/main/java/org/apereo/cas/web/flow/ValidateCaptchaAction.java <span class="se">\</span>
        <span class="nt">-P</span> src/main/java/org/apereo/cas/web/flow/

<span class="c"># Run a sanity build to ensure the overlay is functional</span>
./mvnw clean package
</code></pre></div></div>

<div class="alert alert-info">
<strong>Remember</strong><br />All source code that is put into the overlay must be housed inside the <code>src/main/java</code> directory, followed by the exact path to the component noted by its package name. If the package name, for instance, is <code>org.apereo.cas.support.web.flow</code>, then the full path for the overlaid component would be <code>src/main/java/org/apereo/cas/support/web/flow</code>. All source code is compiled and placed inside the <code>WEB-INF/classes</code> parent directory.</div>

<p>Notice there are a number of failures now reported by the Maven build complaining about missing symbols. This is due to the fact that the build is now trying to compile our downloaded version of <code class="highlighter-rouge">ValidateCaptchaAction.java</code> which itself depends on a number of other components and libraries that must be available at compile-time for the task to succeed. So we need to locate what and where the missing items are and get them added to the build script.</p>

<h1 id="add-dependencies">Add Dependencies</h1>

<p>Modify the <code class="highlighter-rouge">pom.xml</code> to include the following:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-support-captcha<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-core-web<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-core-webflow<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-core-configuration<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>javax.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.1.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
...
</code></pre></div></div>

<div class="alert alert-info">
<strong>Good Dependency Hunting</strong><br />To know which dependencies and versions should be included when the build reports back errors on missing symbols, you will need to become familiar with the CAS codebase and the dependencies upon which this particular module (i.e. reCACAPTCHA) depends, both locally and globally. At this point, the code itself is the best documentation you could have available.</div>

<p>Now we run the build again:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Run a sanity build to ensure the overlay is functional</span>
./mvnw clean package
</code></pre></div></div>

<p>…and the build should proceed normally. Great! Let’s make the change now.</p>

<h1 id="make-the-change">Make The Change</h1>

<p>Our next step is to find our Java code snippet above and make the following change:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span>
<span class="kd">final</span> <span class="n">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">lines</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">());</span>
<span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Google captcha response received: [{}]"</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
<span class="kd">final</span> <span class="n">JsonNode</span> <span class="n">node</span> <span class="o">=</span> <span class="n">READER</span><span class="o">.</span><span class="na">readTree</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">has</span><span class="o">(</span><span class="s">"successful"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">node</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"successful"</span><span class="o">).</span><span class="na">booleanValue</span><span class="o">())</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>
<span class="o">...</span>
</code></pre></div></div>

<p>Rebuild and deploy. Things should now work as expected with the above change. Cool, eh?</p>

<h1 id="waithow">Wait…How?</h1>

<p>The short and simplified answer is that similar to how static content is overlaid and then <em>preferred</em> over what’s provided by default, local source code components are also made available in a similar fashion on a classpath route that is slightly prioritized over what is buried in some CAS <code class="highlighter-rouge">.jar</code> file. Due to this <em>trick</em>, when the runtime begins to locate the compiled <code class="highlighter-rouge">ValidateCaptchaAction.class</code> file, it scans the specialized classpath route first and thus finds our overlaid copy of it, deferring the default for later use. If you end up deleting the <code class="highlighter-rouge">ValidateCaptchaAction.java</code> from the overlay and thus removing its binary brother from the packaged build, the runtime will simply fall back onto what is provided by the <code class="highlighter-rouge">cas-server-support-captcha</code> module.</p>

<h1 id="so-now-what">So, Now What?</h1>

<p>As you can see, there are inherent dangers in this approach:</p>

<ul>
  <li>The original contents of <code class="highlighter-rouge">ValidateCaptchaAction</code> could change from CAS version to version, thus invalidating your local copy of it.</li>
  <li>Your build is now that more complicated with the inclusion of a handful of extra modules to make a simple one-liner change work.</li>
  <li>Any of the now-included modules can be renamed or removed from CAS version to version, thus making your build dysfunctional in the future.</li>
  <li>…and just to demonstrate the problem, our change as it is most often the case, is completely undocumented! Without comparison against the original source file, it is entirely unclear why this source file exists in an overlay which would make it difficult for the next person in line to pick up the maintenance effort, two years into the deployment.</li>
</ul>

<p>But there is light at the end of the tunnel. Now that you have made a reasonable change and are satisfied with its behavior, the next best course of action would be to remove the file altogether (and every other change you made along with it) and contribute the fix back to the CAS codebase. This is <em>NOT</em> the sort of change that should be specialized for any single deployment and in the interest of “<em>It Should Just Work</em>”, the behavior of <code class="highlighter-rouge">ValidateCaptchaAction</code> should just do the correct thing by default, removing any learning curve or need for one to make changes.</p>

<p>As a <a href="https://apereo.github.io/2018/04/05/cas-codebase-feature-build">follow-up to this blog post</a>, I will outline how the change can be developed and tested from the perspective of the CAS codebase itself.</p>

<p>Stay tuned!</p>

<h1 id="finale">Finale</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p>Happy Coding,
<a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/04/01/cas-overlays-supercharged/</guid>
                <description>
                    
                    An overview of how a CAS overlay prepped for deployment can tap into internal components, altering logic and behavior for good and evil...but mostly evil.
                    
                </description>
                <pubDate>Sun, 01 Apr 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.3.0 RC3 Feature Release</title>
                <link>https://apereo.github.io/2018/03/30/530rc3-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.2.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.2.0">November 27th, 2017</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.3.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the <strong>third</strong> release candidate in the <code class="highlighter-rouge">5.3.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.3.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<p>You can read about the previous release candidate <a href="https://apereo.github.io/2018/02/09/530rc2-release/">here</a>.</p>

<!-- TOC -->

<ul>
  <li><a href="#shake-well-before-use">Shake Well Before Use</a>
    <ul>
      <li><a href="#apache-maven">Apache Maven</a></li>
      <li><a href="#gradle">Gradle</a></li>
    </ul>
  </li>
  <li><a href="#minors">Minors</a></li>
  <li><a href="#saml-service-provider-metadata-via-rest">SAML Service Provider Metadata via REST</a></li>
  <li><a href="#oauth2-audits">OAuth2 Audits</a></li>
  <li><a href="#saml2-service-providers">SAML2 Service Providers</a></li>
  <li><a href="#couchbase-5-compatibility">Couchbase 5 Compatibility</a></li>
  <li><a href="#couchbase-authentication-attributes">Couchbase Authentication Attributes</a></li>
  <li><a href="#registered-service-access-strategy-audits">Registered Service Access Strategy Audits</a></li>
  <li><a href="#impersonation-audits">Impersonation Audits</a></li>
  <li><a href="#delegated-authentication-access-strategy-audits">Delegated Authentication Access Strategy Audits</a></li>
  <li><a href="#audit-api-improvements">Audit API Improvements</a></li>
  <li><a href="#impersonation-groovy-access-strategy">Impersonation Groovy Access Strategy</a></li>
  <li><a href="#x509-authentication-via-request-headers">X.509 Authentication via Request Headers</a></li>
  <li><a href="#cas-protocol-behavior">CAS Protocol Behavior</a></li>
  <li><a href="#bootstrap-4">Bootstrap 4</a></li>
  <li><a href="#google-authenticator-multifactor-account-registration">Google Authenticator Multifactor Account Registration</a></li>
  <li><a href="#multifactor-trusted-devices">Multifactor Trusted Devices</a></li>
  <li><a href="#yubikey-account-public-id-encryption">YubiKey Account Public ID Encryption</a></li>
  <li><a href="#service-registry-multiplicity">Service Registry Multiplicity</a></li>
  <li><a href="#embedded-apache-tomcat-session-clustering">Embedded Apache Tomcat Session Clustering</a></li>
  <li><a href="#delegated-authentication-non-sticky-sessions">Delegated Authentication Non-Sticky Sessions</a></li>
  <li><a href="#library-upgrades">Library Upgrades</a></li>
  <li><a href="#get-involved">Get Involved</a></li>
  <li><a href="#das-ende">Das Ende</a></li>
</ul>

<!-- /TOC -->

<h2 id="shake-well-before-use">Shake Well Before Use</h2>

<p>We strongly recommend that you take advantage of the release candidates as they come out. Waiting for a <code class="highlighter-rouge">GA</code> release is only going to set you up for unpleasant surprises. A <code class="highlighter-rouge">GA</code> is simply <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">a tag and nothing more</a>. In order to start experimenting with release candidates, use the following strategies.</p>

<p>At any given time, you should be able to append <code class="highlighter-rouge">-SNAPSHOT</code> to the CAS version specified in order to take advantage of snapshot builds as changes are made and published.</p>

<h3 id="apache-maven">Apache Maven</h3>

<p>In the <code class="highlighter-rouge">pom.xml</code> of <a href="https://github.com/apereo/cas-overlay-template">the overlay</a>, adjust the following tag to match below:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;cas.version&gt;</span>5.3.0-RC3<span class="nt">&lt;/cas.version&gt;</span>
</code></pre></div></div>

<h3 id="gradle">Gradle</h3>

<p>In the <code class="highlighter-rouge">gradle.properties</code> of <a href="https://github.com/apereo/cas-gradle-overlay-template">the overlay</a>, adjust the following setting to match below:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.version</span><span class="p">=</span><span class="s">5.3.0-RC3</span>
</code></pre></div></div>

<h2 id="minors">Minors</h2>

<ul>
  <li>CAS integration tests for Couchbase, DynamoDb and InfluxDb are now automated/enabled via relevant Docker images running as part of Travis CI.</li>
  <li>Thanks to <a href="https://github.com/frett">@frett</a>, TGC domain names are once more sanitized; an oversight that snuck into CAS after adopting Project Lombok.</li>
  <li>Thanks to <a href="https://github.com/luis100">@luis100</a>, delegating authentication to SAML IdPs now is able to handle <code class="highlighter-rouge">urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST</code> bindings.</li>
  <li>Thanks to <a href="https://github.com/tsschmidt">@tsschmidt</a>, loading CAS configuration properties is now made conditional.</li>
  <li>Thanks to <a href="https://github.com/sbearcsiro">@sbearcsiro</a>, overflows when calculating ticket expirations in MongoDb are now prevented.</li>
  <li>Thanks to <a href="https://github.com/frett">@frett</a>, multifactor authentication triggers based on principal/authentication attributes are now allowed to proceed in the absence of a <code class="highlighter-rouge">service</code> parameter.</li>
  <li><a href="https://travis-ci.org/apereo/cas/builds">CAS builds managed by Travis CI</a> are now broken into multiple jobs using a matrix to account for faster execution times. <code class="highlighter-rouge">SNAPSHOT</code> releases tend to publish around the 30 minute mark!</li>
  <li>Thanks to <a href="https://github.com/dodok1">@dodok1</a>, multiple RADIUS servers can now be specified in CAS properties, separated by comma.</li>
  <li>Thanks to <a href="https://github.com/fmartelli">@fmartelli</a>, delegated SAML2 authentication gains a new settings to allow for the specification of the <code class="highlighter-rouge">AttributeConsumingServiceIndex</code> exposed by Pac4j.</li>
  <li>CAS proxy-granting ticket definitions are now correctly registered in the ticket catalog.</li>
  <li>Thanks to <a href="https://github.com/sbearcsiro">@sbearcsiro</a>, a number of time units in CAS are now corrected to properly recognize seconds instead of milli-seconds.</li>
  <li>CAS configuration metadata is corrected to properly generate the needed JSON metadata based on configuration settings.</li>
  <li>Thanks to <a href="https://github.com/sbearcsiro">@sbearcsiro</a>, the embedded Apache Tomcat instance is tweaked using a <em>Customizer</em> component provided by Spring Boot so that CAS implementations can override the factory themselves (eg to enable JNDI) whilst also benefitting from the CAS tomcat configuration properties.</li>
  <li>Specification of <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Required-AuthN.html">required authentication handlers for a service</a> now does not intefere with the execution of multifactor authentication.</li>
  <li>Thanks to <a href="https://github.com/sbearcsiro">@hdeadman</a>, the OpenID Connect discovery profile is now able to properly render all settings, and should be able to list all grant types supported by CAS.</li>
  <li>Thanks to <a href="https://github.com/frett">@frett</a>, the REST API responsible for generating service tickets can now correctly audit the authentication object.</li>
  <li>Thanks to <a href="https://github.com/sbearcsiro">@sbearcsiro</a>, the embedded tomcat configuration is refactored and moved into its own component.</li>
  <li>OAuth codes issued by CAS running as an OpenID Connect provider are now strictly scoped to the requesting service when exchanged for access tokens.</li>
  <li>Thanks to <a href="https://github.com/swlyons">@swlyons</a>, the table names for the <a href="https://apereo.github.io/cas/development/installation/DynamoDb-Ticket-Registry.html">DynamoDb Ticket Registry</a> can now be customized in CAS settings.</li>
</ul>

<h2 id="saml-service-provider-metadata-via-rest">SAML Service Provider Metadata via REST</h2>

<p>SAML2 service provider metadata can now be fetched from more traditional REST endpoints, as an alternative to deploying an MDQ server.
<a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-DynamicMetadata.html">See this guide</a> for more info.</p>

<h2 id="oauth2-audits">OAuth2 Audits</h2>

<p>Thanks to <a href="https://github.com/dima767">@dima767</a>, OAuth2 and OpenID Connect interactions (authentication requests and user profile responses) with CAS are now sent to the audit log.</p>

<h2 id="saml2-service-providers">SAML2 Service Providers</h2>

<p>The following new <a href="https://apereo.github.io/cas/development/integration/Configuring-SAML-SP-Integrations.html">SAML2 service providers</a> are now supported by CAS out of the box:</p>

<ul>
  <li>Concur Solutions</li>
  <li>PollEverywhere</li>
</ul>

<h2 id="couchbase-5-compatibility">Couchbase 5 Compatibility</h2>

<p>Thanks to <a href="https://github.com/dima767">@dima767</a>, CAS integration tests for service/ticket registries are now verified and made functional against Couchbase 5. Additional test cases are also added to verify Couchbase authentication.</p>

<h2 id="couchbase-authentication-attributes">Couchbase Authentication Attributes</h2>

<p>Similar to above, authenticating credentials against a Couchbase data store in CAS now gains the ability to also fetch attributes as part of the returned data row.</p>

<h2 id="registered-service-access-strategy-audits">Registered Service Access Strategy Audits</h2>

<p>Thanks to <a href="https://github.com/dima767">@dima767</a>, <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Access-Strategy.html">service access strategy</a> events are now sent to the audit log in the event that the principal does not carry enough attributes to be granted access.</p>

<h2 id="impersonation-audits">Impersonation Audits</h2>

<p>Thanks to <a href="https://github.com/dima767">@dima767</a>, <a href="https://apereo.github.io/cas/development/installation/Surrogate-Authentication.html">CAS impersonation attempts</a>. that were put through the access strategy rules are now audited as well.</p>

<h2 id="delegated-authentication-access-strategy-audits">Delegated Authentication Access Strategy Audits</h2>

<p>While delegating authentication to an external identity provider, access strategy events that enforce the usage of the external identity provider are now sent to the audit log.</p>

<h2 id="audit-api-improvements">Audit API Improvements</h2>

<p>In collaboration with <a href="https://github.com/dima767">@dima767</a>, CAS components that are typically not managed as Spring <code class="highlighter-rouge">@Bean</code>s are now put through a mini <em>framework</em> so that can become eligible for auditing purposes. The API changes in this area, while  non-intrusive, allow CAS to audit the likes of the services access strategy events noted above.</p>

<h2 id="impersonation-groovy-access-strategy">Impersonation Groovy Access Strategy</h2>

<p>Impersonation features of CAS gain access to a Groovy option to execute <a href="https://apereo.github.io/cas/development/installation/Surrogate-Authentication.html#surrogate-access-strategy">authorization rules for surrogate authentication</a>.</p>

<h2 id="x509-authentication-via-request-headers">X.509 Authentication via Request Headers</h2>

<p>Thanks to <a href="https://github.com/hdeadman">@hdeadman</a>, X509 authentication now optionally gains the ability to extract the certificate from a request header.</p>

<h2 id="cas-protocol-behavior">CAS Protocol Behavior</h2>

<p>Certain aspects of the CAS protocol such as proxy or renewed authentication <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#global-sso-behavior">can be controlled</a> via CAS settings.</p>

<h2 id="bootstrap-4">Bootstrap 4</h2>

<p>Thanks to <a href="https://github.com/mindblender">@mindblender</a>, CAS user interfaces begin to take advantage of Bootstrap v4 and FontAwesome v5. The thymeleaf templates are also transformed to be easier to maintain as natural/native views.</p>

<h2 id="google-authenticator-multifactor-account-registration">Google Authenticator Multifactor Account Registration</h2>

<p>Multifactor athentication provided by <a href="https://apereo.github.io/cas/development/installation/GoogleAuthenticator-Authentication.html">Google Authenticator</a> in CAS has the ability to register users and devices as part of the authentication flow. In this release candidate, device registration records are by default signed/encrypted before they are stored in the registration store.</p>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />This may be a breaking change. While the setting is on by default, you can certainly disable the signing/encryption operations of CAS that deal with device registration.
</div>

<h2 id="multifactor-trusted-devices">Multifactor Trusted Devices</h2>

<p>Thanks to <a href="https://github.com/frett">@frett</a>, <a href="https://apereo.github.io/cas/development/installation/Multifactor-TrustedDevice-Authentication.html">Multifactor Trusted Devices</a> support has been extended to support custom <a href="https://en.wikipedia.org/wiki/Device_fingerprint">device fingerprinting</a> strategies.</p>

<div class="alert alert-warning">
  <strong>WATCH OUT!</strong><br />This may be a breaking change. Adding custom device fingerprint support necessitated a schema update for trust records.
</div>

<p>Furthermore, this feature gains the ability to determine device fingerprints in order to distinguish trusted devices from each other.</p>

<h2 id="yubikey-account-public-id-encryption">YubiKey Account Public ID Encryption</h2>

<p>Thanks to <a href="https://github.com/dima767">@dima767</a>, the YubiKey authentication facility gains the ability to store account’s public key in target destination stores in the <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#yubikey-registration-records-encryption-and-signing">encrypted form</a></p>

<h2 id="service-registry-multiplicity">Service Registry Multiplicity</h2>

<p>Interal improvements are in place to allow each module the capablity of hosting its own service registry, making CAS effectively able to work with more one service registry at the same time. In theory, this provides the option of having, for instance, both JSON and YAML service registries work together. The real motivation for this change is to allow the introduction of <em>internal</em> <em>immutable</em> service registries that may be ephemeral, specially in view of how CAS handles multiple protocol support with callback services that were, before this change, expected to be inserted and found in the service registry.</p>

<h2 id="embedded-apache-tomcat-session-clustering">Embedded Apache Tomcat Session Clustering</h2>

<p>The embedded Apache Tomcat is now altered slightly using options to allow for session clustering and replication.</p>

<h2 id="delegated-authentication-non-sticky-sessions">Delegated Authentication Non-Sticky Sessions</h2>

<p><a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">Delegated authentication in CAS</a> has been re-designed in certain areas to remove the requirement of sticky sessions specially in clustered deployments. The internal changes to accomodate this behavior are rather significant, so please be sure to test and contribute back lest issues are discovered. This behavior is also extended to include and support <a href="https://apereo.github.io/cas/development/integration/ADFS-Integration.html">delegating authentication to ADFS</a> instances.</p>

<h2 id="library-upgrades">Library Upgrades</h2>

<ul>
  <li>Couchbase Java Client</li>
  <li>Amazon Java SDK</li>
  <li>Mockito</li>
  <li>SemVer</li>
  <li>Swagger</li>
  <li>Disruptor</li>
  <li>Eureka</li>
  <li>Ribbon</li>
  <li>ActiveMQ</li>
  <li>InfluxDb</li>
  <li>Apache CXF</li>
  <li>JavaParser</li>
  <li>Guava</li>
  <li>Azure KeyVault</li>
  <li>Okio</li>
  <li>Yubico</li>
  <li>Authy</li>
  <li>Google Zxing</li>
  <li>Yubico U2F</li>
  <li>Maxmind</li>
  <li>Google Maps</li>
  <li>UnboundID</li>
  <li>Gradle</li>
  <li>Twilio</li>
  <li>Postgresql Driver</li>
  <li>MariaDb Driver</li>
  <li>Jose4j</li>
  <li>Bootstrap &amp; FontAwesome</li>
  <li>Apache Cassandra Driver</li>
  <li>Font Awesome</li>
  <li>Hazelcast</li>
  <li>Jackson</li>
  <li>JQuery</li>
  <li>Thymeleaf Dialect</li>
  <li>HikariCP</li>
  <li>Caffein</li>
</ul>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="das-ende">Das Ende</h2>

<p>Big thanks to all who participate in the development of this release to submit patches and contribute improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/03/30/530rc3-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.3.0 RC3 release.
                    
                </description>
                <pubDate>Fri, 30 Mar 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - REFEDS MFA Profile with shib-cas-authn3</title>
                <link>https://apereo.github.io/2018/02/26/shibcasauthn-duomfa-refeds/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>This is a short story on the birth of the <a href="https://github.com/Unicon/shib-cas-authn3">shib-cas-authn3 plugin</a> and its newfound support for the <a href="https://refeds.org/profile/mfa">REFEDS MFA Profile</a>.</p>

<h1 id="overview">Overview</h1>

<p>Though nowadays less so, you may have an IAM deployment composed of both an <a href="https://github.com/apereo/cas">Apereo CAS Server</a> and a <a href="https://www.shibboleth.net/">Shibboleth Identity Provider</a>. The original premise for managing such a deployment dates back to days where CAS v3 had [almost] no support for the SAML2 protocol and likewise, the Shibboleth Identity Provider v2 lacked support for the CAS protocol. To accommodate all integration needs, institutions deployed both solutions and then set in pursuit of a way to close the space between the two to provide a seamless user experience.</p>

<p>…and by seamless, I mean:</p>

<ul>
  <li>How could one manage SSO sessions between the two platforms?</li>
  <li>How could one fetch and release attributes to SAML2 SPs?</li>
  <li>How could one handle single logout?</li>
  <li>How would the user interface elements behave with regards to SAML2 MDUI?</li>
  <li>…</li>
</ul>

<h1 id="viola">Viola!</h1>

<p>So was born the <a href="https://github.com/Unicon/shib-cas-authn3">shib-cas-authn3 plugin</a>. The plugin simply acts as a link between the two platforms, allowing authentication requests from the Shibboleth IdP to be routed “invisibly” to CAS and then back. Conceptually it sits between the two systems, (though physically it lives inside the IdP), and knows how to translate one protocol (SAML2) to another (CAS) and then does it all in reverse order on the trip back to the SAML service provider.</p>

<p><img src="https://user-images.githubusercontent.com/1205228/36662801-d91e9aa6-1af4-11e8-9206-7f4b88632173.png" alt="untitled" /></p>

<p>This is a neat trick because to the SAML2 Service Provider, that fact that authentication from the IdP is delegated to somewhere else is entirely irrelevant. Likewise, the Shibboleth IdP also does not care what external authentication system handles and honors that request. All it cares about is, “I routed the request to X. As long as X gives me back the right stuff, I should be fine to resume”.</p>

<h2 id="authors-note">Author’s Note</h2>

<p>I say <em>nowadays less so</em> because today, the Shibboleth IdP v3 has great <a href="https://wiki.shibboleth.net/confluence/display/IDP30/CasProtocolConfiguration">support for the CAS protocol</a> and Apereo CAS v5 has native <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">support for the SAML2 Protocol</a>. While “separation of concerns”, “leaving each to its own” and having “boxes and arrows” pointing back and forth and living in perfect harmony in a pretty diagram are excellent conditions to live by, it would be best to consolidate down to one system since the concerns are no longer separate and more so, they tend to cost money and strands of hair quite a bit over time.</p>

<p>Given the right circumstances and support, <a href="https://m.signalvnoise.com/the-majestic-monolith-29166d022228">the Majestic Monolith</a> can be sweet.</p>

<h1 id="handling-refeds-mfa-profile">Handling REFEDS MFA Profile</h1>

<p>So then comes the REFEDS MFA Profile:</p>

<blockquote>
  <p>This Multi-Factor Authentication (MFA) Profile specifies requirements that an authentication event must meet in order to communicate the usage of MFA. It also defines a SAML authentication context for expressing this…</p>
</blockquote>

<p>And:</p>

<blockquote>
  <p>The MFA Authentication Context can be used by Service Providers to request that Identity Providers perform MFA as defined below and by IdPs to notify SPs that MFA was used.</p>
</blockquote>

<p>In more complicated terms, if a SAML SP were to specify <code class="highlighter-rouge">https://refeds.org/profile/mfa</code> as the required authentication context, the identity provider would need to translate and find the appropriate MFA solution to execute in order to satisfy that requirement and then reassuringly convey the result back to the SP.</p>

<p>How could we do this with the Shibboleth Identity Provider, Apereo CAS server, and the shib-cas-authn3 plugin all having their bit of fun in the flow?</p>

<h1 id="one-solution">One Solution</h1>

<p>Consider the following starting positions:</p>

<ul>
  <li>Since Apereo CAS is ultimately in charge of executing authentication, it would also be the party in charge of executing multifactor authentication.</li>
  <li>Our strategy for delivering MFA in response to <code class="highlighter-rouge">https://refeds.org/profile/mfa</code> would be one backed by Duo Security, <a href="https://apereo.github.io/2018/01/08/cas-mfa-duosecurity/">easily supported by CAS</a>.</li>
</ul>

<p>Our task list then would be to find ways to:</p>

<ul>
  <li>…communicate the requested authentication context to CAS.</li>
  <li>…translate the requested authentication context to something CAS would understand as a trigger for Duo Security MFA.</li>
  <li>…ensure the requested authentication context is satisfied by CAS, before handing off a response to the SP.</li>
</ul>

<p>Say hello to <a href="https://github.com/Unicon/shib-cas-authn3#handling-refeds-mfa-profile">shib-cas-authn3</a> <code class="highlighter-rouge">v3.2.4</code>.</p>

<div class="alert alert-info">
<strong>Collaborate</strong><br />As of this writing, <code>3.2.4</code> is still in beta. Download, deploy, verify and contribute back enhancements as time and DNA permits.
</div>

<p>Staring with <code class="highlighter-rouge">v3.2.4</code>, the plugin has native support for REFEDS MFA profile. The requested authentication context class that is <code class="highlighter-rouge">https://refeds.org/profile/mfa</code> is passed along from the Shibboleth IdP over to this plugin and is then translated to a multifactor authentication strategy supported by and configured in CAS (i.e. Duo Security). The CAS server is notified of the required authentication method via a special <code class="highlighter-rouge">authn_method</code> parameter by default. Once a service ticket is issued and plugin begins to validate the service ticket, it will attempt to ensure that the CAS-produced validation payload contains and can successfully assert the required/requested authentication context class.</p>

<p>For additional info on configuring the plugin, please see <a href="https://github.com/Unicon/shib-cas-authn3#handling-refeds-mfa-profile">the project’s README</a>.</p>

<h1 id="so">So…</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/02/26/shibcasauthn-duomfa-refeds/</guid>
                <description>
                    
                    An overview of the shib-cas-authn3 project and its support for the REFEDS MFA profile with both the Shibboleth Identity Provider and Apereo CAS lending a hand.
                    
                </description>
                <pubDate>Mon, 26 Feb 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Forced Authentication with Apereo CAS</title>
                <link>https://apereo.github.io/2018/02/26/forcedauth-modauth-cas/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>This post summarizes a recent conversation I had with a few colleagues on strategies one may use to support forced authentication with CAS and the journey we went on to discover and diagnose a few integration issues with an application protected by <a href="https://github.com/apereo/mod_auth_cas">mod_auth_cas</a>.</p>

<p>Let’s begin.</p>

<h1 id="the-problem">The Problem</h1>

<p>Some CAS deployments present with the rather common requirement to challenge the user to re-enter credentials in some applications. To accommodate this, it’s likely that deployments may opt into creative yet <em>non-standard</em> solutions such as applications themselves prompting for credentials to replay them in a back-end call. This is problematic for a number of reasons:</p>

<ul>
  <li>Applications present a differently styled login form.</li>
  <li>Applications directly get involved in handling user credentials.</li>
</ul>

<p>Last but most important:</p>

<blockquote>
  <p>The only thing necessary for the triumph of evil is for good men to replay credentials.</p>
</blockquote>

<p>So, is there a way to force re-authentication with CAS?</p>

<h1 id="forced-authentication">Forced Authentication</h1>

<p>The <a href="https://apereo.github.io/cas/development/protocol/CAS-Protocol-Specification.html">CAS protocol</a> has a specific parameter dedicated to forced authentication, named as <code class="highlighter-rouge">renew=true</code>.</p>

<p>If supplied as part of an authentication request:</p>

<blockquote>
  <p>Single sign-on will be bypassed. In this case, CAS will require the client to present credentials regardless of the existence of a single sign-on session with CAS.</p>
</blockquote>

<p>If supplied as part of a validation request:</p>

<blockquote>
  <p>Ticket validation will only succeed if the service ticket was issued from the presentation of the user’s primary credentials. It will fail if the ticket was issued from a single sign-on session.</p>
</blockquote>

<div class="alert alert-info">
<strong>Version Caveat</strong><br />If you have deployed CAS <code>5.2.x</code>, you need to at least be on <code>5.2.3</code> for the renew parameter to function correctly.</div>

<p>It goes without saying that <code class="highlighter-rouge">renew=true</code> works best if you wish to let the application make that decision when needed. Alternatively, you may also control this behavior centrally by <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Access-Strategy.html#disable-service-sso-access">marking the relevant application/service</a> in the CAS service registry (JSON file, etc) such that it would not participate in SSO and would always be asked for credentials regardless of what the application says.</p>

<h1 id="real-life-example">Real Life Example</h1>

<p>Let’s say we have an application at <code class="highlighter-rouge">https://secure-dev.example.org/groups/</code> that has SSO enabled.  We need one subfolder of that app at <code class="highlighter-rouge">https://secure-dev.example.org/groups/reauth/</code> to require re-authentication to access.</p>

<p>So, (assuming a <a href="https://apereo.github.io/cas/development/installation/JSON-Service-Management.html">JSON service registry</a>), we have one service registration record requiring SSO to cover any app on the host. Note that SSO participation is by default on and it’s perfectly good for us to practice laziness here.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">org.apereo.cas.services.RegexRegisteredService</span><span class="w">
  </span><span class="err">serviceId</span><span class="p">:</span><span class="w"> </span><span class="err">^https?</span><span class="p">:</span><span class="err">//</span><span class="p">[</span><span class="err">\w</span><span class="p">]</span><span class="err">+-dev.example.org/.*</span><span class="w">
  </span><span class="err">name</span><span class="p">:</span><span class="w"> </span><span class="err">secure-dev.example.org</span><span class="w">
  </span><span class="err">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1200</span><span class="w">
  </span><span class="err">description</span><span class="p">:</span><span class="w"> </span><span class="err">Everything</span><span class="w">
  </span><span class="err">evaluationOrder</span><span class="p">:</span><span class="w"> </span><span class="mi">1200</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>We set up another service registration with a lower (i.e. processed first; think of it like the Olympics rankings) evaluation order and <code class="highlighter-rouge">ssoEnabled: false</code> to cover the subfolder:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">org.apereo.cas.services.RegexRegisteredService</span><span class="w">
  </span><span class="err">serviceId</span><span class="p">:</span><span class="w"> </span><span class="err">^https?</span><span class="p">:</span><span class="err">//</span><span class="p">[</span><span class="err">\w</span><span class="p">]</span><span class="err">+-dev.example.org/groups/reauth/.*</span><span class="w">
  </span><span class="err">name</span><span class="p">:</span><span class="w"> </span><span class="err">secure-dev.example.org</span><span class="w"> </span><span class="err">Groups</span><span class="w"> </span><span class="err">Reauth</span><span class="w">
  </span><span class="err">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1200</span><span class="w">
  </span><span class="err">description</span><span class="p">:</span><span class="w"> </span><span class="err">Groups</span><span class="w"> </span><span class="err">Reauth</span><span class="w">
  </span><span class="err">evaluationOrder</span><span class="p">:</span><span class="w"> </span><span class="mi">1100</span><span class="w">
  </span><span class="err">accessStrategy</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">@class</span><span class="p">:</span><span class="w"> </span><span class="err">org.apereo.cas.services.DefaultRegisteredServiceAccessStrategy</span><span class="w">
    </span><span class="err">ssoEnabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Our application, protected by <a href="https://github.com/apereo/mod_auth_cas">mod-auth-cas</a> has the following configuration:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Location</span> <span class="err">/groups/reauth</span><span class="nt">&gt;</span>
    AuthType CAS
    AuthName "CAS"
    CASScope /groups/reauth
    CASAuthNHeader SOME_LoginID
    CASScrubRequestHeaders On
    CASCookie MOD_AUTH_CAS_REAUTH
    Options None
    require valid-user
    Order allow, deny
    Allow from all
<span class="nt">&lt;/Location&gt;</span>

<span class="nt">&lt;Location</span> <span class="err">/groups</span><span class="nt">&gt;</span>
    AuthType CAS
    AuthName "CAS"
    CASScope /
    CASAuthNHeader SOME_LoginID
    CASScrubRequestHeaders On
    CASCookie MOD_AUTH_CAS
    Options None
    require valid-user
    Order allow, deny
    Allow from all
<span class="nt">&lt;/Location&gt;</span>
</code></pre></div></div>

<p>At first glance, this should do exactly as you would expect if only it weren’t for a small caveat.</p>

<h2 id="the-caveat">The Caveat</h2>

<p>If the request begins with <code class="highlighter-rouge">https://secure-dev.example.org/groups/reauth/</code> first and then goes to <code class="highlighter-rouge">https://secure-dev.example.org/groups/</code>, the user would be prompted to log in - as expected because those locations use different cookie names.  However, once logged in, the user would get caught in a redirect loop between <code class="highlighter-rouge">mod_auth_cas</code> and CAS.  It turns out that there were two issues.  One was that more precise location is placed first in the config:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Location</span> <span class="err">/groups/reauth</span><span class="nt">&gt;</span>
   CASCookie MOD_AUTH_CAS_REAUTH
   CASScope /groups/reauth/
   ...
<span class="nt">&lt;Location&gt;</span>

<span class="nt">&lt;Location</span> <span class="err">/groups</span><span class="nt">&gt;</span>
   CASCookie MOD_AUTH_CAS
   CASScope /
   …
<span class="nt">&lt;Location&gt;</span>
</code></pre></div></div>

<p>This made mod_auth_cas use the last applicable <code class="highlighter-rouge">CASScope</code> directive which meant that the <code class="highlighter-rouge">MOD_AUTH_CAS_REAUTH</code> cookie was being set at <code class="highlighter-rouge">Path=/</code> instead of <code class="highlighter-rouge">Path=/groups/reauth/</code>.</p>

<p>This might have been fine except for the way mod_auth_cas parses the values in the <code class="highlighter-rouge">Cookie</code> header.  It <em>tokenizes</em> the header on <code class="highlighter-rouge">;</code> then iterates through each cookie string by matching the number of characters equal to the length of the expected cookie name defined by the <code class="highlighter-rouge">CASCookie</code> directive.  If the cookie string starts with the <code class="highlighter-rouge">CASCookie</code> name, it skips the next character,  assuming that it’s <code class="highlighter-rouge">=</code> and takes all remaining characters. So what was happening was that, given the cookie header <code class="highlighter-rouge">Cookie: BLARG=WuzzleWuzzle;MOD_AUTH_CAS_REAUTH=foofoofoofoo;</code>, mod_auth_cas was matching the cookie string <code class="highlighter-rouge">MOD_AUTH_CAS_REAUTH=foofoofoofoo</code> with the <code class="highlighter-rouge">CASCookie</code> name of <code class="highlighter-rouge">MOD_AUTH_CAS</code>.  Finding that, it skipped the <code class="highlighter-rouge">_</code> and returned <code class="highlighter-rouge">REAUTH=foofoofoofoo</code> as the CAS cookie value.  That isn’t a valid format for a CAS cookie so it redirected back to CAS.  CAS, finding a valid <code class="highlighter-rouge">TGC</code>, then performed SSO and redirected back to the service.  The service ticket was never validated because mod_auth_cas checks for the presence of a cookie before it checks for the ticket parameter.  Finding the invalid cookie again, it redirected back to CAS and so on until the browser threw up its hands in defeat.</p>

<p>So, just something to look out for:</p>

<ul>
  <li>When using mod_auth_cas, configuration elements that share a scope (e.g. <code class="highlighter-rouge">/groups</code>, <code class="highlighter-rouge">/groups/reauth</code>) <strong>MUST be listed in order of least to most precise</strong>.</li>
  <li>The <code class="highlighter-rouge">CASCookie</code> directives that share a scope <strong>MUST NOT be substrings of each other</strong>.</li>
</ul>

<h1 id="summary">Summary</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p>…and of course, a very special thanks to all colleagues who took part in this post, exchanged dialogue, verified behavior and generously took the time to share their analysis and findings. Thank you.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/02/26/forcedauth-modauth-cas/</guid>
                <description>
                    
                    Discourse on supporting forced authentication with the Apereo CAS server from the perspective of an application protected with mod-auth-cas, the Apache httpd module for CAS.
                    
                </description>
                <pubDate>Mon, 26 Feb 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Dances with Protocols</title>
                <link>https://apereo.github.io/2018/02/26/cas-delegation-protocols/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>I have been consulting on variations of a deployment strategy and use case that involves CAS acting as an identity provider while also presenting the ability to <a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">delegate authentication requests</a> to an external identity provider and act as a <em>proxy</em> in between. I had the erroneous assumption that client applications integrating with CAS in proxy mode must be those that speak the CAS protocol. This meant that while CAS itself may delegate authentication requests to a variety of identity providers that speak SAML2, OAuth2 and CAS protocols, etc the client application that ultimately would receive a response from the proxying CAS server can only understand a service ticket and the particular validation payload compliant with the CAS protocol semantics.</p>

<p>This post is an attempt at explaining my rationale with a follow-up explanation of why I was wrong.</p>

<h1 id="delegated-authentication-flow">Delegated Authentication Flow</h1>

<p>The <em>normal</em> flow for delegated authentication is something like this:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/36640612-b53abbd2-1a37-11e8-8f95-0179983c4c3e.jpg" alt="cas" /></p>

<ul>
  <li>Client application submits a <em>CAS Protocol</em> authentication request to the CAS server.</li>
  <li>CAS Server routes the request to an external identity provider, whether manually or automatically, and processes the response.</li>
  <li>When successful, CAS Server establishes an SSO session, creates a  service ticket and redirects back to the client application with that ticket.</li>
  <li>Client application validates the ticket and understands the user profile elements.</li>
</ul>

<p>Once the response is processed by the external identity provider, note that the opinion is built into the CAS authentication flow to assume the next steps to be “creating a service ticket” and “redirecting back to the calling service/application with that ticket”; details which are dictated by the CAS protocol and obviously no longer apply if the client application is a SAML SP or OAuth2 client.</p>

<h1 id="so">So…</h1>

<p>If the client application were to submit an authentication request using a protocol other than CAS, it would be only fair for the application to expect a response using the same protocol. But, how could it ever work with the CAS server always issuing <em>service tickets</em> and <em>302-redirecting</em> back to the application?</p>

<h1 id="explanation">Explanation</h1>

<p>It turns out that given the CAS design, client applications can speak any type of protocol that CAS itself supports today regardless of the authentication flow. For better or worse, this feature has to do with how <em>secondary</em> protocols (those other than CAS itself) are implemented.</p>

<p>All <em>other</em> <a href="https://apereo.github.io/cas/development/protocol/Protocol-Overview.html">authentication protocols supported by the CAS server</a> happen to be <em>clients</em> of the CAS server itself. The SAML2 module, OAuth2 module and anything else supported in CAS accept the original authentication request at the relevant endpoint, then route that request to the CAS server turning themselves into individual tiny CAS clients. At the end of the day and just like before, the CAS server creates a service ticket and issues a request back to the calling application, which in this case happens to be itself and the relevant endpoint inside itself that is to going to pick up the request and resume.</p>

<h1 id="the-protocol-dance">The Protocol Dance</h1>

<p>Let’s start with a client application that speaks SAML2. This client is configured in CAS <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">as a SAML2 service provider</a>, while CAS itself is proxying Facebook as an external identity provider.</p>

<p>This is a bit of a complicated scenario since you have about three protocols dancing together. The effective flow would be:</p>

<ul>
  <li>The SAML2 client sends an authentication request to the CAS server.</li>
  <li>The SAML2 module in CAS processes the authentication request, sees the need for authentication and routes the request to the CAS server’s login endpoint. Very importantly, it indicates in that request that the calling <em>service</em> is the SAML2 module and the endpoint expected to do follow-up processing.</li>
  <li>Just like before, CAS Server routes the request to an external identity provider (Facebook in our case), whether manually or automatically, and processes the (OAuth2) response.</li>
  <li>When successful, CAS Server establishes an SSO session, creates a  service ticket and redirects back to the SAML2 module (a complicated yet humble corner of itself effectively) that now is tasked to produce a SAML2 response.</li>
  <li>The SAML2 module receives the service ticket, validates it and understands the user profile via the provided assertion. It then produces the SAML2 response for the original client application.</li>
</ul>

<div class="alert alert-warning">
<strong>Possible Gotcha</strong><br />The above flow <i>may</i> prove to be somewhat dysfunctional, if the delegated/proxied identity provider happens to be ADFS. If your deployment today requires the above flow with ADFS acting as the identity provider, please suspect and verify.
</div>

<h1 id="so-1">So…</h1>

<p>The trick, if I could re-emphasize, is noting that all protocols are clients of the CAS server that interact with it using the CAS protocol. This is done at the request/browser level, as opposed to doing things internally via heavily customized webflows and such that would be entangled with one another. The protocol modules that exist in CAS make zero assumptions about the internal inner workings of the CAS authentication flow/engine. They treat it just like they would an external CAS server; the only difference is, they sit and live inside the CAS server directly and yet they remain completely agnostic of that fact. Simply put in our example, the SAML2 module basically says: “this incoming request needs to be authenticated. So I’ll route it to a CAS server for authentication and when it comes back, I’ll do my bit”.</p>

<p>This surely continues to maintain SSO sessions as well for all follow-up requests, because the CAS server does not care about the calling party; whether external or internal, the SSO session will be established and available for everything else.</p>

<h1 id="references">References</h1>

<p>More notes on the design are <a href="https://apereo.github.io/2017/02/17/cas-custom-protocols/">available here</a>.</p>

<h1 id="summary">Summary</h1>

<p>Remember; the client originating the authentication request can use ANY protocol supported by CAS, so long as CAS is configured to accept and recognize that protocol and regardless of whether CAS is acting as a proxy or directly authenticating the user via its own internal data stores.</p>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/02/26/cas-delegation-protocols/</guid>
                <description>
                    
                    A short overview of how Apereo CAS may support multiple authentication protocols simultaneously while acting as both the primary identity provider or proxying another. Two Socks could not be reached for comments.
                    
                </description>
                <pubDate>Mon, 26 Feb 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Why does uPortal use Apache 2 license?</title>
                <link>https://apereo.github.io/2018/02/20/apache2-chose-uportal/</link>
                <content:encoded>
                    <![CDATA[
                    <blockquote>
  <p><a href="https://groups.google.com/a/apereo.org/d/msg/licensing-discuss/kac2gzuHf6E/2Y9OzdRjBQAJ">I’d be interested to hear what licenses other projects were using, and 
why?</a></p>
</blockquote>

<h2 id="what-license-does-uportal-use">What license does uPortal use?</h2>

<p>The easy part of the question: uPortal is using <a href="https://choosealicense.com/licenses/apache-2.0/">Apache License 2.0</a>.</p>

<h2 id="why-did-uportal-license-away-from-new-bsd-its-original-license">Why did uPortal license away from New BSD, its original license?</h2>

<p>The hard part of the question: why?</p>

<p>In the beginning (in the JA-SIG, or JASIG, or Jasig days), uPortal used the 
<a href="https://choosealicense.com/licenses/bsd-3-clause/">BSD 3-Clause aka New BSD license</a>.</p>

<p>In the run up to merging with the Sakai Foundation to become the Apereo 
Foundation, Jasig adopted the position that New BSD is not good enough, which 
is now <a href="https://www.apereo.org/licensing">Apereo’s documented position</a>.</p>

<blockquote>
  <p>This license simply does not provide enough protection for either 
contributors or adopters to really understand the terms under which the 
software is being shared.</p>
</blockquote>

<p>(I don’t agree with this statement. New BSD meets the <a href="https://opensource.org/osd">Open Source 
Definition</a>, and it thoroughly disclaims warranties and liabilities. Good 
enough is good enough. I’d have no qualms about contributing to or adopting a 
New BSD licensed software product.)</p>

<p><a href="https://www.gnu.org/licenses/license-list.en.html#ModifiedBSD">GNU says this about 3-clause BSD</a>:</p>

<blockquote>
  <p>The modified BSD license is not bad, as lax permissive licenses go, though 
the Apache 2.0 license is preferable. … the Apache 2.0 license is better for 
substantial programs, since it prevents patent treachery.</p>
</blockquote>

<p>Maybe how badly you want to re-license away from New BSD hinges on how worried 
you are about patent treachery.</p>

<p>Some people worried. So Jasig required uPortal to re-license.</p>

<p>So that’s why not New BSD.</p>

<h2 id="why-did-uportal-re-license-to-apache2-its-current-license">Why did uPortal re-license to Apache2, its current license?</h2>

<p>I don’t recall just how Apache2 was selected, who did the selecting, what alternatives were considered. I don’t even recall if this is something I once knew and have forgotten.</p>

<p>A 2008 document in the Jasig wiki, <a href="https://wiki.jasig.org/download/attachments/25002436/open-source-licensing-paper.pdf?version=1&amp;modificationDate=1236022038650&amp;api=v2">Open Source Licensing</a>, (by Unicon / John Lewis) recommends Apache2 for the 
non-copyleft case and might have been influential.</p>

<p>Guessing at what might have happened:</p>

<p>Do what the Apache Software Foundation does.</p>

<p>Apache2 is widely adopted, widely understood, well documented, the practices 
around it are well documented and honed by the Apache Software Foundation. It’s 
not just a viable license, it’s a viable license ecosystem.</p>

<p>Nobody has to apologize for adopting Apache2, it’s one of those default, 
acceptable, generally recognized as safe licenses?</p>

<p><a href="https://choosealicense.com/licenses/ecl-2.0/">ECLv2</a> would also be fine, it’s just less mainstream. uPortal’s 
adopters and communities weren’t already worked up about Apache2’s patent 
language so there wasn’t enough reason to start getting worked up about that.</p>

<p>- Andrew Petro</p>

<p>wearing individual contributor <a href="https://www.apache.org/foundation/how-it-works.html#hats">hat</a>.</p>

<p>The views expressed herein are not necessarily those of Apereo, nor of uPortal, nor of my employer, nor of…</p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/02/20/apache2-chose-uportal/</guid>
                <description>
                    
                    Apache2 chose uPortal.
                    
                </description>
                <pubDate>Tue, 20 Feb 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Attribute-based Application Authorization</title>
                <link>https://apereo.github.io/2018/02/20/cas-service-rbac-attributeresolution/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>A fairly common CAS deployment use case is to enforce access to a particular set of applications via user attributes and roles. Once the authentication/authorization server passed on the required attributes and entitlements to the application, each service might individually be tasked with controlling entry access, and once authorized, enforcement of a set of specific functions inside the application which the user may be allowed to carry out. The purpose of this tutorial is to present an alternative to the first scenario, by providing options to centrally control and manage that ruleset that allows the user to enter an application that is integrated with Apereo CAS.</p>

<p>Our task list is rather short:</p>

<ol>
  <li>Configure CAS to fetch attributes from LDAP, JDBC and other potential sources.</li>
  <li>Register an application with CAS and define authorization rules for access based on retrieved attributes.</li>
</ol>

<p>To keep this tutorial simple, we are going to stick with the default CAS method of authentication with the obvious assumption that our authentication sources shall be different from sources that may produce user attributes.</p>

<h1 id="environment">Environment</h1>

<ul>
  <li>CAS <code class="highlighter-rouge">5.2.x</code></li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Maven WAR Overlay</a></li>
</ul>

<p>Follow the instructions provided by the <code class="highlighter-rouge">README</code> file to produce a functional build.</p>

<h1 id="attribute-retrieval">Attribute Retrieval</h1>

<p><a href="https://apereo.github.io/cas/development/integration/Attribute-Resolution.html">Attribute resolution strategies</a> in CAS are controlled by the <a href="https://github.com/apereo/person-directory">Person Directory project</a>. The Person Directory dependency is automatically bundled with the CAS server and provides a number of options to fetch attributes and user data from sources such as LDAP, JDBC, etc. Since we do have multiple sources of attributes, the Person Directory component is also able to aggregate and merge the results and has options to decide how to deal with disagreements in case two sources produce conflicting data.</p>

<p>There is very little left for us to do other than to teach CAS about our specific data sources.</p>

<h2 id="ldap-attribute-retrieval">LDAP Attribute Retrieval</h2>

<p>In the given <code class="highlighter-rouge">cas.properties</code> file, the following settings allow us to fetch attributes from LDAP:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.baseDn</span><span class="p">=</span><span class="s">ou=people,dc=example,dc=org</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.ldapUrl</span><span class="p">=</span><span class="s">ldap://localhost:1385</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.userFilter</span><span class="p">=</span><span class="s">uid={0}</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.useSsl</span><span class="p">=</span><span class="s">false</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.bindDn</span><span class="p">=</span><span class="s">...</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.bindCredential</span><span class="p">=</span><span class="s">...</span>

<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.attributes.displayName</span><span class="p">=</span><span class="s">displayName</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.attributes.givenName</span><span class="p">=</span><span class="s">givenName</span>
<span class="err">cas.authn.attributeRepository.ldap[0]</span><span class="py">.attributes.mail</span><span class="p">=</span><span class="s">email</span>
</code></pre></div></div>

<p>The above configuration defined the very basic essentials as far as LDAP connection information while also teaching CAS the set of attributes that should be first <em>retrieved</em> and optionally <em>remapped</em>. In practice, CAS would begin to fetch <code class="highlighter-rouge">displayName</code>, <code class="highlighter-rouge">givenName</code> and <code class="highlighter-rouge">mail</code> from the directory server and then process the final collection to include <code class="highlighter-rouge">displayName</code>, <code class="highlighter-rouge">givenName</code> and <code class="highlighter-rouge">email</code>. From this point on, CAS only knows of the user’s email address under the <code class="highlighter-rouge">email</code> attribute and needless to say, this is the attribute name that should be used everywhere else in the CAS configuration.</p>

<div class="alert alert-info">
<strong>Multiple Sources</strong><br />CAS settings able to accept multiple values are typically documented with an index, such as <code>cas.some.setting[0]=value</code>. The index [0] is meant to be incremented by the adopter to allow for distinct multiple configuration blocks
</div>

<h2 id="jdbc-attribute-retrieval">JDBC Attribute Retrieval</h2>

<p>The  table <code class="highlighter-rouge">table_users</code> in our HyperSQL database contains the user attributes we need:</p>

<table>
  <thead>
    <tr>
      <th><code class="highlighter-rouge">uid</code></th>
      <th><code class="highlighter-rouge">attribute</code></th>
      <th><code class="highlighter-rouge">value</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">casuser</code></td>
      <td><code class="highlighter-rouge">role</code></td>
      <td><code class="highlighter-rouge">Manager</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">casuser</code></td>
      <td><code class="highlighter-rouge">role</code></td>
      <td><code class="highlighter-rouge">Supervisor</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">user2</code></td>
      <td><code class="highlighter-rouge">role</code></td>
      <td><code class="highlighter-rouge">Engineer</code></td>
    </tr>
  </tbody>
</table>

<p>The above schema is what’s referred to as a <em>Multi-Row</em> setup in the Person Directory configuration. In other words, this is the sort of setup that has more than one row dedicated to a user entry and quite possibly similar to above, multiple rows carry out multiple values for a single attribute definition (i.e. <code class="highlighter-rouge">role</code>). In order to teach CAS about this setup, we could start with the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.attributes.role</span><span class="p">=</span><span class="s">personRole</span>

<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.singleRow</span><span class="p">=</span><span class="s">false</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.columnMappings.attribute</span><span class="p">=</span><span class="s">value</span>

<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.sql</span><span class="p">=</span><span class="s">SELECT * FROM table_users WHERE {0}</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.username</span><span class="p">=</span><span class="s">uid</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.driverClass</span><span class="p">=</span><span class="s">...</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.user</span><span class="p">=</span><span class="s">...</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.password</span><span class="p">=</span><span class="s">...</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.url</span><span class="p">=</span><span class="s">...</span>
</code></pre></div></div>

<p>Pay attention to how the <code class="highlighter-rouge">columnMappings</code> setting defines a set of 1-1 mappings between columns that contain the attribute name vs the attribute value. Furthermore and similar to the LDAP setup, we are teaching CAS to fetch the attribute <code class="highlighter-rouge">role</code> (again, determined based on the mappings defined) and virtually <em>rename</em> the attribute to <code class="highlighter-rouge">personRole</code>. Just like the LDAP setup and from this point on, CAS only knows of the user’s role under the <code class="highlighter-rouge">personRole</code> attribute and needles to say, this is the attribute name that should be used everywhere else in the CAS configuration.</p>

<h1 id="smoke-test">Smoke Test</h1>

<p>At this point, you should be able to authenticate into CAS and observe in the logs that the constructed authenticated principal contains the following attributes:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>... &lt;Authenticated principal <span class="o">[</span>casuser] with attributes <span class="o">[{</span><span class="nv">personRole</span><span class="o">=[</span>Manager, Supervisor], 
<span class="nv">displayName</span><span class="o">=</span>Test User, <span class="nv">givenName</span><span class="o">=</span>CAS, <span class="nv">email</span><span class="o">=</span>casuser@example.org<span class="o">}]</span> ...&gt;
</code></pre></div></div>

<p>If you <a href="https://apereo.github.io/cas/development/installation/Troubleshooting-Guide.html">need to troubleshoot</a>, the best course of action would be to adjust logs to produce <code class="highlighter-rouge">DEBUG</code> information.</p>

<h1 id="application-registration">Application Registration</h1>

<p>The CAS service management facility allows CAS server administrators to declare and configure which services/applications may make use of CAS in different ways. The core component of the service management facility is the service registry that stores one or more registered services containing metadata that drives a number of CAS behaviors including authorization rules.</p>

<p>To keep this tutorial simple, we are going to use the <a href="https://apereo.github.io/cas/development/installation/JSON-Service-Management.html">JSON Service Registry</a>. This registry reads services definitions from JSON configuration files on startup. JSON files are expected to be found inside a configured directory location and this registry will recursively look through the directory structure to find relevant JSON files.</p>

<p>For this tutorial, we expect CAS to find our JSON registration record files using the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.serviceRegistry.initFromJson</span><span class="p">=</span><span class="s">false</span>
<span class="py">cas.serviceRegistry.json.location</span><span class="p">=</span><span class="s">file:/etc/cas/config/services</span>
</code></pre></div></div>

<p>…and inside the above directory, we are going to create an <code class="highlighter-rouge">ExampleApplication-100.json</code> file that contains the following:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example</span><span class="se">\\</span><span class="s2">.application</span><span class="se">\\</span><span class="s2">.edu.*"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ExampleApplication"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>All that remains for us is to decorate the registration record with the authorization rules.</p>

<h1 id="application-authorization-rules">Application Authorization Rules</h1>

<p>The <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Access-Strategy.html">access strategy of a registered service</a> provides fine-grained control over the application authorization rules. It describes whether the service is allowed to use the CAS server, allowed to participate in single sign-on authentication, and (as it’s relevant for our use case here) it may also be configured to require a certain set of attributes that must exist before access can be granted to the service.</p>

<div class="alert alert-info">
<strong>Remember</strong><br />CAS is only gatekeeping here, deciding whether entrance is allowed to the given application. Once the user is allowed to enter, the extent of capabilities and functions available to the user are and must be decided by the application itself where CAS at that point would completely step aside.
</div>

<p>Our JSON registration record could be modified as such:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example</span><span class="se">\\</span><span class="s2">.application</span><span class="se">\\</span><span class="s2">.edu.*"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ExampleApplication"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"accessStrategy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceAccessStrategy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"requiredAttributes"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.HashMap"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"personRole"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Manager"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>In simpler terms, the above configuration is saying: <em>Access to applications that interact with CAS whose URL matches the pattern defined by the <code class="highlighter-rouge">serviceId</code> is only granted if the authenticating user has an attribute <code class="highlighter-rouge">personRole</code> that contains the value <code class="highlighter-rouge">Manager</code></em>.</p>

<h1 id="summary">Summary</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/02/20/cas-service-rbac-attributeresolution/</guid>
                <description>
                    
                    A walkthrough to demonstrate how one might fetch attributes from a number of data sources, turning them into roles that could then be used to enforce application access and authorization.
                    
                </description>
                <pubDate>Tue, 20 Feb 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.3.0 RC2 Feature Release</title>
                <link>https://apereo.github.io/2018/02/09/530rc2-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.2.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.2.0">November 27th, 2017</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.3.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the <strong>second</strong> release candidate in the <code class="highlighter-rouge">5.3.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.3.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<p>You can read about the previous release candidate <a href="https://apereo.github.io/2017/12/29/530rc1-release/">here</a>.</p>

<!-- TOC -->

<ul>
  <li><a href="#shake-well-before-use">Shake Well Before Use</a>
    <ul>
      <li><a href="#apache-maven">Apache Maven</a></li>
      <li><a href="#gradle">Gradle</a></li>
    </ul>
  </li>
  <li><a href="#minors">Minors</a></li>
  <li><a href="#hazelcast-discovery">Hazelcast Discovery</a></li>
  <li><a href="#apache-syncope-authentication">Apache Syncope Authentication</a></li>
  <li><a href="#operation-lombok">Operation Lombok</a></li>
  <li><a href="#http-security-headers-per-service">HTTP Security Headers per Service</a></li>
  <li><a href="#registered-services-rest-api">Registered Services REST API</a></li>
  <li><a href="#configuration-discovery">Configuration Discovery</a></li>
  <li><a href="#saml2-service-providers">SAML2 Service Providers</a></li>
  <li><a href="#json-whitelist-authentication">JSON Whitelist Authentication</a></li>
  <li><a href="#rest-protocol-credential-extraction">REST Protocol Credential Extraction</a></li>
  <li><a href="#aws-credential-fetching">AWS Credential Fetching</a></li>
  <li><a href="#mapped-attribute-value-filters">Mapped Attribute Value Filters</a></li>
  <li><a href="#authenticate-credentials-via-rest-protocol">Authenticate Credentials via REST Protocol</a></li>
  <li><a href="#rest-protocol-enhancements">REST Protocol Enhancements</a></li>
  <li><a href="#rest-based-audits">REST-based Audits</a></li>
  <li><a href="#saml2-attribute-friendly-names">SAML2 Attribute Friendly Names</a></li>
  <li><a href="#configuration-binding-behavior">Configuration Binding Behavior</a></li>
  <li><a href="#new-command-line-shell-commands">New Command-line Shell Commands</a></li>
  <li><a href="#saml2-audits">SAML2 Audits</a></li>
  <li><a href="#oauth2-audits">OAuth2 Audits</a></li>
  <li><a href="#rest-api-audits">REST API Audits</a></li>
  <li><a href="#audit-trail-management">Audit Trail Management</a></li>
  <li><a href="#authentication-throttling">Authentication Throttling</a></li>
  <li><a href="#mongodb-authentication-throttling">MongoDb Authentication Throttling</a></li>
  <li><a href="#library-upgrades">Library Upgrades</a></li>
  <li><a href="#get-involved">Get Involved</a></li>
  <li><a href="#das-ende">Das Ende</a></li>
</ul>

<!-- /TOC -->

<h2 id="shake-well-before-use">Shake Well Before Use</h2>

<p>We strongly recommend that you take advantage of the release candidates as they come out. Waiting for a <code class="highlighter-rouge">GA</code> release is only going to set you up for unpleasant surprises. A <code class="highlighter-rouge">GA</code> is simply <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">a tag and nothing more</a>. In order to start experimenting with release candidates, use the following strategies.</p>

<p>At any given time, you should be able to append <code class="highlighter-rouge">-SNAPSHOT</code> to the CAS version specified in order to take advantage of snapshot builds as changes are made and published.</p>

<h3 id="apache-maven">Apache Maven</h3>

<p>In the <code class="highlighter-rouge">pom.xml</code> of <a href="https://github.com/apereo/cas-overlay-template">the overlay</a>, adjust the following tag to match below:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;cas.version&gt;</span>5.3.0-RC2<span class="nt">&lt;/cas.version&gt;</span>
</code></pre></div></div>

<h3 id="gradle">Gradle</h3>

<p>In the <code class="highlighter-rouge">gradle.properties</code> of <a href="https://github.com/apereo/cas-gradle-overlay-template">the overlay</a>, adjust the following setting to match below:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.version</span><span class="p">=</span><span class="s">5.3.0-RC2</span>
</code></pre></div></div>

<h2 id="minors">Minors</h2>

<ol>
  <li>The embedded Apache Tomcat container is now given the ability to support basic authentication.</li>
  <li>Caching attributes fetched from external attribute repositories is now corrected to handle caching more efficiently.</li>
  <li>Thanks to <a href="https://github.com/leleuj">@leleuj</a>, MFA bypass via REST is  corrected to format parameters properly for the REST request.</li>
  <li>Thanks to <a href="https://github.com/alexdp">@alexdp</a>, the Apache Ignite cache is corrected to include the right cache names for proxy tickets.</li>
  <li>Thanks to <a href="https://github.com/rrenomeron">@rrenomeron</a>, better error handling is put into place while parsing YAML property files.</li>
  <li>Thanks to <a href="https://github.com/leleuj">@leleuj</a>, better error handling is put in place for email notifications specially when no principal attribute is found to indicate the target email address.</li>
  <li>The DynamoDb table name used to <a href="https://apereo.github.io/cas/development/installation/DynamoDb-Service-Management.html">hold CAS’ registered service definitions</a> can now be customized via CAS settings.</li>
  <li>The logout webflow/view is now able to correctly recognize and activate the required code snippet for Google Analytics.</li>
  <li>Thanks to <a href="https://github.com/marqc">@marqc</a>,the condition that controls the issuing of ticket-granting tickets is improved to take into account identical usernames found in multiple account sources.</li>
  <li>Thanks to <a href="https://github.com/johnlister">@johnlister</a>, better error handling is put in place during the password management reset flows when an invalid username is provided.</li>
  <li>Thanks to <a href="https://github.com/plajko">@plajko</a>, ordering of the authentication handlers selected for the current transaction is correctly enforced.</li>
  <li>Thanks to <a href="https://github.com/deel77">@deel77</a>, the Slovak language bundles are updated.</li>
  <li>Thanks to <a href="https://github.com/3cdota">@3cdota</a>,delegated authentication using Pac4j will attempt to preserve the requested URL upon CAS logout.</li>
  <li>Thanks to <a href="https://github.com/dima767">@dima767</a>, the ranking logic that affected variegated multifactor providers such as Duo Security is now corrected.</li>
  <li>Thanks to <a href="https://github.com/tienthanh2509">@tienthanh2509</a>, a new language pack for Vietnamese is now included in CAS.</li>
  <li>The LDAP service registry is able to correctly import JSON definition files where specified.</li>
  <li>Thanks to <a href="https://github.com/dacurry-tns">@dacurry-tns</a>, handling of MongoDb connection strings specified by client URIs is now improved.</li>
  <li>Thanks to <a href="https://github.com/arbner">@arbner</a>, consent view pages now have access to the authenticated principal.</li>
  <li>Thanks to <a href="https://github.com/alexdp">@alexdp</a>, Google Apps integration in CAS is improved to properly load the given certificates.</li>
  <li>Thanks to <a href="https://github.com/hdeadman">@hdeadman</a>, the SSL valve for the embedded Apache Tomcat is now correctly registered with the servlet container.</li>
  <li>Thanks to <a href="https://github.com/dima767">@dima767</a>, the log viewer available as part of the CAS dashboard gets a number of performance improvements internally.</li>
  <li>Thanks to <a href="https://github.com/fjollberg">@fjollberg</a>, authenticating to Couchbase buckets receives a number of bug fixes.</li>
  <li>Thanks to <a href="https://github.com/plajko">@plajko</a>, a number of MongoDb performance and configuration improvements are included in this release candidate. Additionally, the default size of the embedded Apache Tomcat’s thread pool is now increased.</li>
  <li>Thanks to <a href="https://github.com/plajko">@plajko</a>, JWT ids generated with CAS as OpenId Connect OP are set to the service ticket identifier to account for proper session mapping when dealing with SLO.</li>
  <li>Minor bug fix in the way attributes are resolved and fetched from REST endpoints.</li>
</ol>

<h2 id="hazelcast-discovery">Hazelcast Discovery</h2>

<p>CAS is now able to leverage Apache jclouds and Microsoft Azure, when it comes to <a href="https://apereo.github.io/cas/development/installation/Hazelcast-Ticket-Registry.html">Hazelcast and auto-discovery</a>.</p>

<h2 id="apache-syncope-authentication">Apache Syncope Authentication</h2>

<p>As yet another method of authentication, CAS is now able to <a href="https://apereo.github.io/cas/development/installation/Syncope-Authentication.html">leverage Apache Syncope</a> to locate user accounts.</p>

<h2 id="operation-lombok">Operation Lombok</h2>

<p>CAS begins to adopt <a href="https://projectlombok.org">Project Lombok</a> in order to reduce noise and boilerplate code used to obtain logger objects, generate getter/setter methods, etc. This is part of a bigger gradual step at possibly converting the codebase relevant modules over to Kotlin to further improve readability and reduce LOC.</p>

<p>Before the migration, total number of lines for Java classes stood at <code class="highlighter-rouge">207,002</code>. Today, after the migration the number of lines is reduced down to <code class="highlighter-rouge">190,398</code>.</p>

<h2 id="http-security-headers-per-service">HTTP Security Headers per Service</h2>

<p>Injection of HTTP security headers into the response can now be controlled on a per-service basis. See <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Http-Security-Headers.html">this guide</a> for more info.</p>

<h2 id="registered-services-rest-api">Registered Services REST API</h2>

<p>For some time, CAS has had support for a <a href="https://apereo.github.io/cas/development/protocol/REST-Protocol.html">REST-like API allowing one to add service definitions</a> into the registry. This API was quite limited in accepting different properties of a given service definition or different types of services for various protocols. In this release candidate, this API is improved slightly to accept all types of service definitions in the API request body and making it slightly easier to execute such requests with proper authentication and authorization enforcements.</p>

<div class="alert alert-warning">
  <strong>Beware</strong><br />This is a breaking change. Please revisit the API requests and reformulate them accordingly.
</div>

<h2 id="configuration-discovery">Configuration Discovery</h2>

<p>The <a href="https://apereo.github.io/cas/development/installation/Configuration-Discovery.html">Configuration Discovery</a> endpoint in CAS is now able to report back configured and supported clients used in the context of delegated authentication.</p>

<h2 id="saml2-service-providers">SAML2 Service Providers</h2>

<p>The following new SAML2 service providers are now supported by CAS out of the box:</p>

<ul>
  <li>Amazon</li>
</ul>

<h2 id="json-whitelist-authentication">JSON Whitelist Authentication</h2>

<p>A <a href="https://apereo.github.io/cas/development/installation/Whitelist-Authentication.html">JSON-based authentication strategy</a> is now included that allows one to mimic user account details, mostly useful for development and testing.</p>

<h2 id="rest-protocol-credential-extraction">REST Protocol Credential Extraction</h2>

<p>The <a href="https://apereo.github.io/cas/development/protocol/REST-Protocol.html">CAS REST protocol</a> in this release candidate is given the ability to extract multiple sets of credentials from the request body and prep them for authentication. In practice this means that various modules, such as <a href="https://apereo.github.io/cas/development/installation/YubiKey-Authentication.html">YubiKey</a> and <a href="https://apereo.github.io/cas/development/installation/GoogleAuthenticator-Authentication.html">Google Authenticator</a>, may be allowed to insert a special credential extractor into the REST engine automatically when detected in order to let the REST request achieve MFA.</p>

<h2 id="aws-credential-fetching">AWS Credential Fetching</h2>

<p>For components that tightly integrate with AWS such as <a href="https://apereo.github.io/cas/development/installation/AWS-CloudDirectory-Authentication.html">Cloud Directory Authentication</a> or <a href="https://apereo.github.io/cas/development/installation/Logging-Cloudwatch.html">CloudWatch</a>, etc CAS is now given the ability to fetch credentials from a variety of sources as part of an ordered chain. Sources include system properties, environment variables, EC2 instance metadata, etc.</p>

<div class="alert alert-warning">
  <strong>Beware</strong><br />This is a breaking change. As part of this change, a number of module names for CloudWatch logging, etc have changed their names to belong to the <code>support</code> category of CAS modules rather than <code>core</code>. Review the documentation and adjust accordingly.
</div>

<h2 id="mapped-attribute-value-filters">Mapped Attribute Value Filters</h2>

<p>A <a href="https://apereo.github.io/cas/development/integration/Attribute-Value-Release-Policies.html#mutant-mapped-regex">new attribute value filter</a> is added whose main ability is to filter attribute values by a collection of patterns and then supplant the value dynamically based on the results of the regex match.</p>

<h2 id="authenticate-credentials-via-rest-protocol">Authenticate Credentials via REST Protocol</h2>

<p><a href="https://apereo.github.io/cas/development/protocol/REST-Protocol.html#authenticate-credentials">A new REST endpoint</a> is now exposed that is tasked to only verify the validity of the provided credentials without dealing with the ticket API.</p>

<h2 id="rest-protocol-enhancements">REST Protocol Enhancements</h2>

<p>The CAS REST protocol is now enhanced internally to be able to accept other types of protocols and parameters in order to issue a response (i.e. service ticket). As a first candidate, the REST protocol is now able to issue SAML1 tickets just as well as the normal web-based SSO flows.</p>

<h2 id="rest-based-audits">REST-based Audits</h2>

<p>CAS audit data and logs may now be <a href="https://apereo.github.io/cas/development/installation/Audits.html">POSTed to a REST endpoint</a> of your choosing.</p>

<h2 id="saml2-attribute-friendly-names">SAML2 Attribute Friendly Names</h2>

<p>CAS <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">acting as a SAML2 identity provider</a> is given the ability to individually configure friendly names for attributes released to service providers.</p>

<h2 id="configuration-binding-behavior">Configuration Binding Behavior</h2>

<p>Starting with this release candidate, the configuration binding operations start to be a bit less forgiving when it comes to detecting <em>unknown</em> CAS settings found in property sources such as the <code class="highlighter-rouge">cas.properties</code> file. If you have existing settings that are no longer accepted or recognized, CAS will present you with an error at runtime and on startup forcing you clean up the configuration and find the correct replacements where relevant.</p>

<p>As part of this change, please note that the following settings that deal with CAS standalone configuration resolution have been renamed:</p>

<ul>
  <li><code class="highlighter-rouge">cas.standalone.config</code> to <code class="highlighter-rouge">cas.standalone.configurationDirectory</code></li>
  <li><code class="highlighter-rouge">cas.standalone.config.file</code> to <code class="highlighter-rouge">cas.standalone.configurationFile</code></li>
  <li><code class="highlighter-rouge">cas.standalone.security</code> to <code class="highlighter-rouge">cas.standalone.configurationSecurity</code></li>
</ul>

<div class="alert alert-info">
  <strong>Beware</strong><br />This is done to ensure configuration settings recognized by CAS are kept up-to-date, accurate and relevant throughout upgrades. As yet another reminder, it is unnecessary to copy an entire collection of CAS settings and values into property sources without fully knowing their application and impact. Per the usual recommendation, you are to keep the entire overlay construct clean, precise  and laser-focused on behavior you do in fact need.
</div>

<h2 id="new-command-line-shell-commands">New Command-line Shell Commands</h2>

<p>The <a href="https://apereo.github.io/cas/development/installation/Configuring-Commandline-Shell.html">CAS command-line shell</a> is now given the following capabilities:</p>

<ul>
  <li>Export database schemas and DDLs</li>
  <li>Generate SAML IdP metadata and related keystores and certificates</li>
  <li>Jasypt-related commands to test available cipher algorithms and providers used to secure CAS properties, thanks to <a href="https://github.com/hdeadman">@hdeadman</a>.</li>
</ul>

<h2 id="saml2-audits">SAML2 Audits</h2>

<p>SAML2 requests and responses accepted and produced by CAS while <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">running as a SAML2 identity provider</a> are now routed to the audit log. As part of this change, the auditing functionality in CAS is slightly improved to allow for dynamic registration of audit action and resource resolution events that may be carried out by any CAS module at runtime and typically on startup.</p>

<h2 id="oauth2-audits">OAuth2 Audits</h2>

<p>OAuth2 user profiles produced by CAS while <a href="https://apereo.github.io/cas/development/installation/OAuth-OpenId-Authentication.html">running as an OAuth2 identity provider</a> are now routed to the audit log.</p>

<h2 id="rest-api-audits">REST API Audits</h2>

<p>Interactions with the <a href="https://apereo.github.io/cas/development/protocol/REST-Protocol.html#authenticate-credentials">CAS REST API</a> that would allow one to obtain ticket-granting tickets and/or service tickets are now also sent to the audit log.</p>

<h2 id="audit-trail-management">Audit Trail Management</h2>

<p>Audit record management in CAS is given the abllity to work with multiple managers, storing audit data in many destinations at the same time. The auditing library is also given the ablity to fetch audit data based on a starting date whose value may be controlled in CAS settings.</p>

<div class="alert alert-warning">
  <strong>Beware</strong><br />As part of this change, a number of settings that specifically controlled the behavior of audit functionality based on log files and Slf4j have changed location, moving over to a <code>slf4j</code> category. Review the documentation for all settings and adjust accordingly if you have included any of those settings in your property sources.
</div>

<h2 id="authentication-throttling">Authentication Throttling</h2>

<p>Authentication throttling configuration is slightly simplified to skip creating NoOp throttlers when throttling is disabled. As part of this change, other components that take advantage of throttling such as REST and OAuth protocols are affected to use the same throttler and configuration that would is used for  other areas of the system namely the usual login endpoints.</p>

<div class="alert alert-info">
  <strong>Beware</strong><br />As part of this change, the <code>throttler</code> setting that REST and OAuth module settings carried is now removed in favor of the default throttler functionality.</div>

<h2 id="mongodb-authentication-throttling">MongoDb Authentication Throttling</h2>

<p>In addition to recording audit records in <a href="https://apereo.github.io/cas/development/installation/Audits.html#mongodb-audits">MongoDb databases</a>, CAS also offers the authentication throttling functionality <a href="https://apereo.github.io/cas/development/installation/Configuring-Authentication-Throttling.html">based on MongoDb</a> that is tightly integrated with the same auditing facility.</p>

<h2 id="library-upgrades">Library Upgrades</h2>

<ul>
  <li>Kotlin</li>
  <li>Checkstyle</li>
  <li>Spring Webflow</li>
  <li>Commons Pool</li>
  <li>Spring Boot</li>
  <li>Apache Tomcat</li>
  <li>Pac4j</li>
  <li>Gradle</li>
  <li>Person Directory</li>
  <li>Apache HttpClient</li>
  <li>HikariCP</li>
  <li>Inspektr</li>
  <li>Spring</li>
  <li>Java CAS Client (version <code class="highlighter-rouge">3.5.0</code> is now available)</li>
</ul>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="das-ende">Das Ende</h2>

<p>Big thanks to all who participate in the development of this release to submit patches and contribute improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/02/09/530rc2-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.3.0 RC2 release.
                    
                </description>
                <pubDate>Fri, 09 Feb 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.2.x Deployment - WAR Overlays</title>
                <link>https://apereo.github.io/2018/02/06/cas52-gettingstarted-overlay/</link>
                <content:encoded>
                    <![CDATA[
                    <p>This is a short and sweet tutorial on how to deploy CAS via <a href="https://apereo.github.io/cas/5.2.x/installation/Maven-Overlay-Installation.html">the WAR Overlay method</a>.</p>

<p>This tutorial specifically requires and focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.2.x</code></li>
  <li>Java 8</li>
</ul>

<div class="alert alert-info">
  <strong>Need Help?</strong><br />If you ever get stuck and are in need of additional assistance, start by reviewing the suggestions <a href="https://apereo.github.io/cas/5.2.x/installation/Troubleshooting-Guide.html">provided here</a>. You may also look at available support options <a href="https://apereo.github.io/cas/Support.html">provided here</a>.
</div>

<!--
Furthermore, this tutorial assumes that you are running CAS in its `standalone` mode, [described here](https://apereo.github.io/cas/5.2.x/installation/Configuration-Server-Management.html).
-->

<h1 id="overlaywhat">Overlay…What?</h1>

<p>Overlays are a strategy to combat repetitive code and/or resources. Rather than downloading the CAS codebase and building it from source, overlays allow you to download a pre-built vanilla CAS web application server provided by the project itself, override/insert specific behavior into it and then merge it all back together to produce the final (web application) artifact. You can find a lot more about how overlays work <a href="https://apereo.github.io/cas/5.2.x/installation/Maven-Overlay-Installation.html">here</a>.</p>

<p>The concept of the WAR Overlay is NOT a CAS invention. It’s specifically an Apache Maven feature and of course, there are techniques and plugins available to apply the same concept to Gradle-based builds as well.You are free to choose between Maven or Gradle. For this tutorial, I opted into the <a href="https://github.com/apereo/cas-overlay-template">Maven WAR overlay</a>.</p>

<p>Once you have forked and cloned the repository locally, you’re ready to begin.</p>

<div class="alert alert-info">
  <strong>Note</strong><br />Remember to switch to the appropriate branch. Today, the <code>master</code> branch of the repository applies to CAS <code>5.2.x</code> deployments. That may not necessarily remain true when you start your own deployment. So examine the branches and make sure you <code>checkout</code> the one matching your intended CAS version.
</div>

<h1 id="overlays-anatomy">Overlay’s Anatomy</h1>

<p>Similar to Grey’s, a <em>Maven</em> WAR overlay is composed of several facets the most important of which is the <code class="highlighter-rouge">pom.xml</code> file. This is a build descriptor file whose job is to teach Apache Maven how to obtain, build, configure (and in certain cases deploy) artifacts.</p>

<div class="alert alert-info">
  <strong>KISS</strong><br />You do not need to download Apache Maven separately. The project provides one for you automatically with the embedded Maven Wrapper.
</div>

<p>The <code class="highlighter-rouge">pom.xml</code> is composed of several sections. The ones you need to worry about are the following.</p>

<h2 id="properties">Properties</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;cas.version&gt;</span>5.2.2<span class="nt">&lt;/cas.version&gt;</span>
    <span class="nt">&lt;springboot.version&gt;</span>1.5.8.RELEASE<span class="nt">&lt;/springboot.version&gt;</span>
    <span class="nt">&lt;maven.compiler.source&gt;</span>1.8<span class="nt">&lt;/maven.compiler.source&gt;</span>
    <span class="nt">&lt;maven.compiler.target&gt;</span>1.8<span class="nt">&lt;/maven.compiler.target&gt;</span>
    <span class="nt">&lt;app.server&gt;</span>-tomcat<span class="nt">&lt;/app.server&gt;</span> 
    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre></div></div>

<p>This is the bit that describes build settings, and specifically, here, what versions of CAS, Spring Boot, and Java are required for the deployment. You are in practice mostly concerned with the <code class="highlighter-rouge">&lt;cas.version&gt;</code> setting and as new (maintenance) releases come out, it would be sufficient to simply update that version and re-run the build.</p>

<p>This might be a good time to review the CAS project’s <a href="https://apereo.github.io/cas/developer/Release-Policy.html">Release Policy</a> as well as <a href="https://apereo.github.io/cas/developer/Maintenance-Policy.html">Maintenance Policy</a>.</p>

<h2 id="dependencies">Dependencies</h2>

<p>The next piece describes the <em>dependencies</em> of the overlay build. These are the set of components almost always provided by the CAS project that will be packaged up and put into the final web application artifact. At a minimum, you need to have the <code class="highlighter-rouge">cas-server-webapp-${app.server}</code> module available because that is the web application into which you intend to inject your settings and customizations if any. Also, note that the module declarations are typically configured to download the CAS version instructed by the property <code class="highlighter-rouge">${cas.version}</code>.</p>

<p>Here is an example:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cas-server-webapp${app.server}<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>war<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<p>Including a CAS module/dependency in the <code class="highlighter-rouge">pom.xml</code> simply advertises to CAS <em>your intention</em> of turning on a new feature or a variation of a current behavior. Do NOT include something in your build just because it looks and sounds cool. Remember that the point of an overlay is to only keep track of things you actually need and care about, and no more.</p>

<div class="alert alert-warning">
  <strong>Remember</strong><br />Keep your build clean and tidy. A messy build often leads to a messy deployment, complicates your upgrade path and is a documented cause of early hair loss. Keep changes down to the absolute essentials and document their need for your deployment. If you review the configuration a year from now, you should have an idea of why things are the way they are.
</div>

<h2 id="and-what-about">And What About…?</h2>

<p>There are many other pieces in the <code class="highlighter-rouge">pom.xml</code>, such as repositories, profiles, plugins, etc that I skipped. For everything else, there is MasterCard…and of course the official <a href="http://maven.apache.org/guides/">Apache Maven guides</a>. Enjoy!</p>

<h1 id="the-build">The Build</h1>

<p>Now that you have a basic understanding of the build descriptor, it’s time to actually run the build. An Apache Maven build is often executed by passing specific goals/commands to Apache Maven itself, aka <code class="highlighter-rouge">mvn</code>. So for instance in the terminal and once inside the project directory you could execute things like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
mvn clean
</code></pre></div></div>

<p>…which may be a problem if you don’t have already have Apache Maven downloaded and installed. While you can do that separate install, the WAR Overlay project provides you with an embedded Apache Maven instance whose job is to first determine whether you have Maven installed and if not, download and configure one for you based on the project’s needs. So you can replace that command above with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
mvnw clean
</code></pre></div></div>

<p>…which may be a problem because, how are you supposed to know what commands/goals can be passed to the build? You can <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">study them</a> for sure, but the project provides you with a shell script that wraps itself around the Maven wrapper and provides an easy facade for you to remember commands and their use. This is the <code class="highlighter-rouge">build.sh</code> file, which you can run as such:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
./build.sh <span class="nb">help
</span>Usage: build.sh <span class="o">[</span>copy|clean|package|run|debug|bootrun]
</code></pre></div></div>

<p>What do these commands do?</p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">copy</code></td>
      <td>Copies the configuration from the local <code class="highlighter-rouge">etc/cas/config</code> directory to <code class="highlighter-rouge">/etc/cas/config</code>. <a href="https://apereo.github.io/cas/5.2.x/installation/Configuration-Server-Management.html">See this guide</a> to learn more.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">clean</code></td>
      <td>Deletes any previously-built and leftover artifacts from the <code class="highlighter-rouge">target</code> directory.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">package</code></td>
      <td>Runs <code class="highlighter-rouge">clean</code> and <code class="highlighter-rouge">copy</code>. Then packages the CAS web application artifact and run through the overlay to inject local customizations. The outcome is a <code class="highlighter-rouge">target/cas.war</code> file which is ready to be deployed.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">run</code></td>
      <td>Involves <code class="highlighter-rouge">package</code> and then deploys and runs the CAS web application via its own embedded server container.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">debug</code></td>
      <td>Same thing as <code class="highlighter-rouge">run</code>, except that you can remote-debug the CAS web application over port <code class="highlighter-rouge">5000</code>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">bootrun</code></td>
      <td>Same thing as <code class="highlighter-rouge">run</code>, except the deployment is managed by the <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html">Spring Boot Maven plugin</a>. This command has very specialized and limited use cases. Please <a href="https://github.com/apereo/cas/issues/2334">review this issue</a> to learn more.</td>
    </tr>
  </tbody>
</table>

<div class="alert alert-info">
  <strong>Remember</strong><br />Docs grow old. Always consult the overlay project's <code>README</code> file to keep to date.
</div>

<p>As an example, here’s what I see if I were to run the <code class="highlighter-rouge">package</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh copy package

Creating configuration directory under /etc/cas
Copying configuration files from etc/cas to /etc/cas/config
etc/cas/config/application.yml -&gt; /etc/cas/config/application.yml
etc/cas/config/cas.properties -&gt; /etc/cas/config/cas.properties
etc/cas/config/log4j2.xml -&gt; /etc/cas/config/log4j2.xml

<span class="o">[</span>INFO] Scanning <span class="k">for </span>projects...
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] Using the MultiThreadedBuilder implementation with a thread count of 5
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Building cas-overlay 1.0
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-clean-plugin:2.5:clean <span class="o">(</span>default-clean<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:resources <span class="o">(</span>default-resources<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Using <span class="s1">'UTF-8'</span> encoding to copy filtered resources.
<span class="o">[</span>INFO] skip non existing resourceDirectory /cas-overlay-template/src/main/resources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.3:compile <span class="o">(</span>default-compile<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] No sources to compile
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:testResources <span class="o">(</span>default-testResources<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Using <span class="s1">'UTF-8'</span> encoding to copy filtered resources.
<span class="o">[</span>INFO] skip non existing resourceDirectory /cas-overlay-template/src/test/resources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.3:testCompile <span class="o">(</span>default-testCompile<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] No sources to compile
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-surefire-plugin:2.12.4:test <span class="o">(</span>default-test<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] No tests to run.
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-war-plugin:2.6:war <span class="o">(</span>default-war<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Packaging webapp
<span class="o">[</span>INFO] Assembling webapp <span class="o">[</span>cas-overlay] <span class="k">in</span> <span class="o">[</span>/cas-overlay-template/target/cas]
<span class="o">[</span>info] Copying manifest...
<span class="o">[</span>INFO] Processing war project
<span class="o">[</span>INFO] Processing overlay <span class="o">[</span> id org.apereo.cas:cas-server-webapp-tomcat]
<span class="o">[</span>INFO] Webapp assembled <span class="k">in</span> <span class="o">[</span>786 msecs]
<span class="o">[</span>INFO] Building war: /cas-overlay-template/target/cas.war
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
...
</code></pre></div></div>

<p>You can see that the build attempts to download, clean, compile and package all artifacts, and finally, it produces a <code class="highlighter-rouge">/cas-overlay-template/target/cas.war</code> which you can then use for actual deployments.</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />You are allowed to pass any of Maven's native command-line arguments to the <code>build.sh</code> file. Things like <code>-U</code> or <code>-X</code> might be useful to have handy.
</div>

<h1 id="configuration">Configuration</h1>

<p>I am going to skip over the configuration of <code class="highlighter-rouge">/etc/cas/config</code> and all that it deals with. If you need the reference, you may always <a href="https://apereo.github.io/cas/5.2.x/installation/Configuration-Management.html">use this guide</a> to study various aspects of CAS configuration.</p>

<p>Suffice it to say that, quite simply, CAS deployment expects <em>the main</em> configuration file to be found under <code class="highlighter-rouge">/etc/cas/config/cas.properties</code>. This is a key-value store that is able to dictate and alter the behavior of the running CAS software.</p>

<p>As an example, you might encouter something like:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.server.name</span><span class="p">=</span><span class="s">https://cas.example.org:8443</span>
<span class="py">cas.server.prefix</span><span class="p">=</span><span class="s">https://cas.example.org:8443/cas</span>
<span class="py">logging.config</span><span class="p">=</span><span class="s">file:/etc/cas/config/log4j2.xml</span>
</code></pre></div></div>

<p>…which at a minimum, identifies the CAS server’s URL and prefix and instructs the running server to locate the logging configuration at <code class="highlighter-rouge">file:/etc/cas/config/log4j2.xml</code>. The overlay by default ships with a <code class="highlighter-rouge">log4j2.xml</code> that you can use to customize logging locations, levels, etc. Note that the presence of all that is contained inside <code class="highlighter-rouge">/etc/cas/config/</code> is optional. CAS will continue to fall back onto defaults if the directory and the files within are not found.</p>

<h2 id="keep-track">Keep Track</h2>

<p>It is <strong>VERY IMPORTANT</strong> that you contain and commit the entire overlay directory (save the obvious exclusions such as the <code class="highlighter-rouge">target</code> directory) into some sort of source control system, such as <code class="highlighter-rouge">git</code>. Treat your deployment just like any other project with tags, releases, and functional baselines.</p>

<h1 id="registering-applications">Registering Applications</h1>

<p>Client applications that wish to use the CAS server for authentication must be registered with the server apriori. CAS provides a number of <a href="https://apereo.github.io/cas/5.2.x/installation/Service-Management.html#storage">facilities to keep track of the registration records</a> and you may choose any that fits your needs best. In more technical terms, CAS deals with service management using two specific components: Individual implementations that support a form of a database are referred to as <em>Service Registry</em> components and they are many. There is also a parent component that sits on top of the configured service registry as more of an orchestrator that provides a generic facade and entry point for the rest of CAS without entangling all other operations and subsystems with the specifics and particulars of a storage technology.</p>

<p>In this tutorial, we are going to try to configure CAS with <a href="https://apereo.github.io/cas/5.2.x/installation/LDAP-Service-Management.html">the LDAP service regitry</a>.</p>

<h2 id="configuration-1">Configuration</h2>

<p>First, ensure you have declared the appropriate module/intention in the build:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>cas-server-support-ldap-service-registry<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>Next, you must teach CAS how to contact the LDAP server to read and write registration records. This is done in the <code class="highlighter-rouge">cas.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.serviceRegistry.initFromJson</span><span class="p">=</span><span class="s">false</span>

<span class="py">cas.serviceRegistry.ldap.ldapUrl</span><span class="p">=</span><span class="s">ldaps://ldap1.example.edu ldaps://ldap2.example.edu</span>
<span class="py">cas.serviceRegistry.ldap.baseDn</span><span class="p">=</span><span class="s">dc=example,dc=org</span>
<span class="py">cas.serviceRegistry.ldap.bindDn</span><span class="p">=</span><span class="s">cn=Directory Manager,dc=example,dc=org</span>
<span class="py">cas.serviceRegistry.ldap.bindCredential</span><span class="p">=</span><span class="s">Password</span>
</code></pre></div></div>

<div class="alert alert-info">
  <strong>LDAP Schema</strong><br />Service definitions are by default stored inside the <code>description</code> attribute as JSON objects with the objectClass <code>casRegisteredService</code>. The numeric identifier for each service definition that is used for lookups and search operations is also kept under attribute <code>uid</code> all of which you can of course customize. The format and syntax of the JSON is identical to that of JSON Service Registry. That’s all, as far as the schema goes.
</div>

<p>That’s all. Next, you will need to pre-populate the LDAP server with registration records manually, or better yet, use the <a href="https://apereo.github.io/cas/5.2.x/installation/Installing-ServicesMgmt-Webapp.html">CAS Management web application</a>’s user interface to do so in more interactive terms.</p>

<p>To populate the LDAP server manually, remember that there is no pre-defined fancy schema where a registration record in CAS would be broken apart and mapped to individual attributes one by one. The body of the registration record, sampled below, is stored in LDAP under the designated attribute:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://app.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ApplicationName"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h1 id="ticketing">Ticketing</h1>

<p>A robust CAS deployment requires the presence and configuration of an <em>internal</em> database that is responsible for <a href="https://apereo.github.io/cas/5.2.x/installation/Configuring-Ticketing-Components.html">keeping track of tickets</a> issued by CAS. CAS itself comes by default with a memory-based node-specific cache that is often more than sufficient for smaller deployments or certain variations of a <a href="https://apereo.github.io/cas/5.2.x/planning/High-Availability-Guide.html">clustered deployment</a>. Just like the service management facility, large variety of databases and storage options are supposed by CAS under the facade of a <em>Ticket Registry</em>.</p>

<p>In this tutorial, we are going to configure CAS to use a <a href="https://apereo.github.io/cas/5.2.x/installation/Hazelcast-Ticket-Registry.html">Hazelcast Ticket Registry</a> with the assumption that our deployment is going to be deployed in an AWS-sponsored environment. Hazelcast Ticket Registry is often a decent choice when deploying CAS in a cluster and can take advantage of AWS’s native support for Hazelcast in order to read node metadata properly and locate other CAS nodes in the same cluster in order to present a common, global and shared ticket registry. This is an ideal choice that requires very little manual work and/or troubleshoot, comparing to using options such as Multicast or manually noting down the address and location of each CAS server in the cluster.</p>

<h2 id="configuration-2">Configuration</h2>

<p>First, ensure you have declared the appropriate module/intention in the build:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>cas-server-support-hazelcast-ticket-registry<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>Next, the AWS-specific configuration of Hazelcast would go into our <code class="highlighter-rouge">cas.properties</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.ticket.registry.hazelcast.cluster.discovery.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.accessKey</span><span class="p">=</span><span class="s">...</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.secretKey</span><span class="p">=</span><span class="s">...</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.region</span><span class="p">=</span><span class="s">us-east-1</span>
<span class="py">cas.ticket.registry.hazelcast.cluster.discovery.aws.securityGroupName</span><span class="p">=</span><span class="s">...</span>
<span class="c"># cas.ticket.registry.hazelcast.cluster.discovery.aws.tagKey=
# cas.ticket.registry.hazelcast.cluster.discovery.aws.tagValue=
</span></code></pre></div></div>

<p>That should do it.</p>

<p>Of course, if you are working on a more modest CAS deployment in an environment that is more or less owned by you and you prefer more explicit control over CAS node registrations in your cluster, the following settings would be more ideal:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.ticket.registry.hazelcast.cluster.instanceName=localhost
# cas.ticket.registry.hazelcast.cluster.port=5701
# cas.ticket.registry.hazelcast.cluster.portAutoIncrement=true
</span><span class="py">cas.ticket.registry.hazelcast.cluster.members</span><span class="p">=</span><span class="s">123.321.123.321,223.621.123.521,...</span>
</code></pre></div></div>

<h1 id="overlay-customization">Overlay Customization</h1>

<p>If I <code class="highlighter-rouge">cd</code> into the <code class="highlighter-rouge">target/cas</code> directory, I can see an <em>exploded</em> version of the <code class="highlighter-rouge">cas.war</code> file. This is the directory that contains the results of the overlay process. Since I have not actually customized and overlaid anything yet, all configuration files simply match their default and are packaged as such. So as an example, let’s change something.</p>

<p>Digging further down, I notice there exists a <code class="highlighter-rouge">/target/cas/WEB-INF/classes/messages.properties</code> file, which is <a href="https://apereo.github.io/cas/5.2.x/installation/User-Interface-Customization-Localization.html">the default message bundle</a>. I decided that I am going to change the text associated with <code class="highlighter-rouge">screen.welcome.instructions</code>.</p>

<div class="alert alert-warning">
  <strong>Remember</strong><br />Do NOT ever make changes in the <code>target</code> directory. The changesets will be cleaned out and set back to defaults every time you do a build. Follow the overlay process to avoid surprises.
</div>

<p>First, I will need to move the file to my project directory so that Apache Maven during the overlay process can use that instead of what is provided by default.</p>

<p>Here we go:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
mkdir <span class="nt">-p</span> src/main/resources
cp target/cas/WEB-INF/classes/messages.properties src/main/resources/
</code></pre></div></div>

<p>Then I’ll leave everything in that file alone, except the line I want to change.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="py">screen.welcome.instructions</span><span class="p">=</span><span class="s">Speak Friend and you shall enter.</span>
<span class="err">...</span>
</code></pre></div></div>

<p>Then I’ll package things up as usual.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh package

...
<span class="o">[</span>INFO] <span class="nt">---</span> maven-war-plugin:2.6:war <span class="o">(</span>default-war<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Packaging webapp
<span class="o">[</span>INFO] Assembling webapp <span class="o">[</span>cas-overlay] <span class="k">in</span> <span class="o">[</span>/cas-overlay-template/target/cas]
<span class="o">[</span>info] Copying manifest...
<span class="o">[</span>INFO] Processing war project
<span class="o">[</span>INFO] Processing overlay <span class="o">[</span> id org.apereo.cas:cas-server-webapp-tomcat]
<span class="o">[</span>INFO] Webapp assembled <span class="k">in</span> <span class="o">[</span>1005 msecs]
<span class="o">[</span>INFO] Building war: /cas-overlay-template/target/cas.war
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
...

</code></pre></div></div>

<p>If I look at <code class="highlighter-rouge">target/cas/WEB-INF/classes/messages.properties</code> after the build, I should see that the overlay process has picked and overlaid onto the default <em>my version</em> of the file.</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />Only overlay and modify files you actually need and try to use externalized resources and configuration as much as possible. Just because you CAN override something in the default package, it doesn't mean that you should.
</div>

<h1 id="deploy">Deploy</h1>

<p>You have a number of options when it comes to deploying the final <code class="highlighter-rouge">cas.war</code> file. <a href="https://apereo.github.io/2016/10/04/casbootoverlay/">This post</a> should help.</p>

<h1 id="what-about">What About…?</h1>

<ul>
  <li><a href="https://apereo.github.io/2018/01/08/cas-mfa-duosecurity/">CAS Multifactor Authentication with Duo Security</a></li>
  <li><a href="https://apereo.github.io/2017/03/24/cas51-ldapauthnjasypt-tutorial/">CAS 5 LDAP AuthN and Jasypt Configuration</a></li>
  <li><a href="https://apereo.github.io/2017/03/22/cas51-delauthn-tutorial/">CAS 5 SAML2 Delegated AuthN Tutorial</a></li>
</ul>

<p>For more content, <a href="https://apereo.github.io/tags/#CAS">please see this link</a>.</p>

<h1 id="so">So…</h1>

<p>It’s important that you start off simple and make changes one step at a time. Once you have a functional environment, you can gradually and slowly add customizations to move files around.</p>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/02/06/cas52-gettingstarted-overlay/</guid>
                <description>
                    
                    Learn how to configure and build your own CAS deployment via the WAR overlay method, get rich quickly, stay healthy indefinitely and respect family and friends in a few very easy steps.
                    
                </description>
                <pubDate>Tue, 06 Feb 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Link CAS OIDC user to existing Database user</title>
                <link>https://apereo.github.io/2018/02/02/OIDC-link-account/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-info">
  <strong>Contributed Content</strong><br />Francis Le Coq was kind enough to share this guide.
</div>

<div class="alert alert-success">
  <strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>This example is here to show an example of our try to use CAS in order to authenticate users via France Connect, by registering them to our own database linked with an user that is already registered.</p>

<h1 id="what-we-want">What we want</h1>

<p>The first thing is that the user register only internally via our own services, not via a public page but via our private system. That means that the user on first usage already has an account and can log into CAS via the Login Form.</p>

<p>The second thing is that we want to give the possibility for the user to connect an OIDC, in our example it would be France Connect, but only if the user has already access to our website via Login Form.</p>

<p>In conclusion, on first connect via France Connect, the user will have to log onto France Connect and log onto Login Form in second in order to be recognized as the owner of the France Connect account used. On next France Connect login, the user will directly have access.</p>

<p>Form Login is the basic, login and password form from CAS.</p>

<h1 id="our-environment">Our environment</h1>

<ul>
  <li>CAS <code class="highlighter-rouge">5.2.2</code></li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Maven WAR Overlay</a></li>
</ul>

<h1 id="what-is-our-configuration">What is our configuration</h1>

<p>We use an LDAP server and an OIDC CAS configuration. Not more than that. The user has two choices when on the CAS interface, the Login Form and the France Connect button.</p>

<p>We will use “cas.authn.pac4j.oidc” for configuring our OIDC to authenticate our user using France Connect.
We will use “cas.authn.ldap” to authenticate our user using LDAP database.
We will use “cas.authn.attributeRepository.ldap” to retrieve some attributes after user authentication.</p>

<h1 id="what-do-we-need">What do we need</h1>

<p>We need to :</p>
<ul>
  <li>Connect to France Connect on the behalf of the user (when the user click on the button) and get the OIDC ID</li>
  <li>Take this ID and store it</li>
  <li>Ask the user to identify via Login Form</li>
  <li>Link the UserId and OIDC ID and store into our LDAP database</li>
  <li>Send back the user to its final destination which is the asked service</li>
</ul>

<p>Simple !</p>

<h1 id="how-to-do-it">How to do it</h1>

<h2 id="define-our-first-service">Define our first service</h2>
<p>We will use CAS services, by asking a “requiredAttributes”</p>

<p>Create a file into your <a href="https://apereo.github.io/cas/5.2.x/installation/Configuration-Properties.html#json-service-registry">service folder</a> or equivalent, https-01.json :</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//On</span><span class="w"> </span><span class="err">any</span><span class="w"> </span><span class="err">service</span><span class="p">,</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">ask</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">UID</span><span class="p">,</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">redirect</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"^(https|imaps)://.*"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">9997</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome in here"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">9998</span><span class="p">,</span><span class="w">
  </span><span class="err">//</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">usernameAttribute</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">always</span><span class="w"> </span><span class="err">uid</span><span class="w"> </span><span class="err">attribute</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">service</span><span class="w">
  </span><span class="s2">"usernameAttributeProvider"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.PrincipalAttributeRegisteredServiceUsernameProvider"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"usernameAttribute"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"uid"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"accessStrategy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">We</span><span class="w"> </span><span class="err">created</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">changed</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">AccessStrategy</span><span class="p">,</span><span class="w"> </span><span class="err">see</span><span class="w"> </span><span class="err">below</span><span class="w"> </span><span class="err">why</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.esupportail.cas.services.ClaExternalIDRegisteredServiceAccessStrategy"</span><span class="p">,</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">doesn't</span><span class="w"> </span><span class="err">find</span><span class="w"> </span><span class="err">'uid'</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">redirect</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">URL</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">link</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">store</span><span class="w"> </span><span class="err">IDs</span><span class="w">
    </span><span class="s2">"unauthorizedRedirectUrl"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://my-jetty-server/claExternalID/"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"requiredAttributes"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
	    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.HashMap"</span><span class="p">,</span><span class="w">
	    </span><span class="s2">"uid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">".*"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
	  </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>On first OIDC authentication, France Connect transmit some attributes, but none of them are named ‘uid’, so at this moment CAS redirect the user to <code class="highlighter-rouge">"unauthorizedRedirectUrl": "https://my-jetty-server/claExternalID/"</code>.</p>

<p>In this simple URL we are missing some information that we need in our use case, the OIDC Id and the service target. It is not implemented into CAS to add those parameters automatically to the URL.</p>

<p>The second service configuration is</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"^https?://.*/claExternalID/associate/.*"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Votre identité FranceConnect n'est pas connu dans l'établissement"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w">
  </span><span class="s2">"theme"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cla"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Veuillez vous authentifier auprès de l'université pour confirmer votre identité"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"evaluationOrder"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w">
  </span><span class="s2">"usernameAttributeProvider"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.PrincipalAttributeRegisteredServiceUsernameProvider"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"usernameAttribute"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"uid"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"attributeReleasePolicy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.ReturnAllAttributeReleasePolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"principalAttributesRepository"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.authentication.principal.cache.CachingPrincipalAttributesRepository"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"mergingStrategy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ADD"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>This is when your standalone server send back to the second login Form, you need to give the theme.</p>

<h2 id="force-cas-to-give-oidc-id">Force CAS to give OIDC ID</h2>

<p>When CAS check “requiredAttributes”, if an attribute is missing it will throw an Exception and a handler will catch this exception in order to redirect to the URL we added inside our service configuration.</p>

<p>So we will add a new Exception inside the StrategyAccess and the ExceptionHandler will customize the Url.</p>

<p>For that part we need to add our new <code class="highlighter-rouge">ClaExternalIDPrincipalException</code> that will store the attributes coming  from our <code class="highlighter-rouge">ClaExternalIDRegisteredServiceAccessStrategy</code>. Second part, we need to override the handler <code class="highlighter-rouge">AuthenticationExceptionHandlerAction</code> and replace it by our own <code class="highlighter-rouge">ClaExternalIDAuthenticationExceptionHandlerAction</code>.</p>

<p>First our <code class="highlighter-rouge">ClaExternalIDRegisteredServiceAccessStrategy</code>, this class is used into service configuration. It allows us to throw the exception, it needs as well to store the attributes needed later on.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClaExternalIDRegisteredServiceAccessStrategy</span> <span class="kd">extends</span> <span class="n">DefaultClaExternalIDRegisteredServiceAccessStrategy</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">ClaExternalIDRegisteredServiceAccessStrategy</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="c1">//this function is used to check "requiredAttributes"</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">doPrincipalAttributesAllowServiceAccess</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">principal</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">principalAttributes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">enoughAttributesAvailableToProcess</span><span class="o">(</span><span class="n">principal</span><span class="o">,</span> <span class="n">principalAttributes</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Access is denied. enoughAttributesAvailableToProcess"</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">doRejectedAttributesRefusePrincipalAccess</span><span class="o">(</span><span class="n">principalAttributes</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Access is denied. doRejectedAttributesRefusePrincipalAccess"</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">doRequiredAttributesAllowPrincipalAccess</span><span class="o">(</span><span class="n">principalAttributes</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">requiredAttributes</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Access is denied. doRequiredAttributesAllowPrincipalAccess"</span><span class="o">);</span>
            <span class="n">principalAttributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"principal"</span><span class="o">,</span> <span class="n">principal</span><span class="o">);</span>
            <span class="c1">//We throw our exception, it will be intercepted by the Handler inside the Webflow</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ClaExternalIDPrincipalException</span><span class="o">(</span><span class="s">"ClaExternalIDPrincipalException"</span><span class="o">,</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;(),</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;(),</span> <span class="n">principalAttributes</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Access is authorized"</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>As you saw above, a new class appear <code class="highlighter-rouge">ClaExternalIDPrincipalException</code>, the handler will need it to recognize the situation.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClaExternalIDPrincipalException</span> <span class="kd">extends</span> <span class="n">PrincipalException</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">ClaExternalIDPrincipalException</span><span class="o">(</span>
            <span class="kd">final</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span>
            <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Throwable</span><span class="o">&gt;&gt;</span> <span class="n">handlerErrors</span><span class="o">,</span>
            <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">HandlerResult</span><span class="o">&gt;</span> <span class="n">handlerSuccesses</span><span class="o">,</span>
            <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">principalAttributes</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">handlerErrors</span><span class="o">,</span> <span class="n">handlerSuccesses</span><span class="o">);</span>
        <span class="n">setPrincipalAttributes</span><span class="o">(</span><span class="n">principalAttributes</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPrincipalAttributes</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">principalAttributes</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">principalAttributes</span> <span class="o">=</span> <span class="n">principalAttributes</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getPrincipalAttributes</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">principalAttributes</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>To finish this part, the handler that will modify the Url</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClaExternalIDAuthenticationExceptionHandlerAction</span> <span class="kd">extends</span> <span class="n">AuthenticationExceptionHandlerAction</span> <span class="o">{</span>

    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">handleAuthenticationException</span><span class="o">(</span><span class="kd">final</span> <span class="n">AuthenticationException</span> <span class="n">e</span><span class="o">,</span>
                                                   <span class="kd">final</span> <span class="n">RequestContext</span> <span class="n">requestContext</span><span class="o">)</span> <span class="o">{</span>

        <span class="kd">final</span> <span class="n">URI</span> <span class="n">url</span> <span class="o">=</span> <span class="n">WebUtils</span><span class="o">.</span><span class="na">getUnauthorizedRedirectUrlIntoFlowScope</span><span class="o">(</span><span class="n">requestContext</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getHandlerErrors</span><span class="o">().</span><span class="na">containsKey</span><span class="o">(</span><span class="n">UnauthorizedServiceForPrincipalException</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">()))</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">url</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Unauthorized service access for principal; CAS will be redirecting to [{}]"</span><span class="o">,</span> <span class="n">url</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">CasWebflowConstants</span><span class="o">.</span><span class="na">STATE_ID_SERVICE_UNAUTHZ_CHECK</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">//We add this part to catch the exception thrown and we customize the url,</span>
        <span class="c1">// adding the attributes from OIDC and the url service asked</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="k">instanceof</span> <span class="n">ClaExternalIDPrincipalException</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">url</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="n">ClaExternalIDPrincipalException</span> <span class="n">eClaExternalID</span> <span class="o">=</span> <span class="o">(</span><span class="n">ClaExternalIDPrincipalException</span><span class="o">)</span> <span class="n">e</span><span class="o">;</span>
                <span class="kd">final</span> <span class="n">URI</span> <span class="n">url2</span> <span class="o">=</span> <span class="n">getUrl</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">eClaExternalID</span><span class="o">.</span><span class="na">getPrincipalAttributes</span><span class="o">(),</span> <span class="n">WebUtils</span><span class="o">.</span><span class="na">getService</span><span class="o">(</span><span class="n">requestContext</span><span class="o">).</span><span class="na">getOriginalUrl</span><span class="o">());</span>
                <span class="n">WebUtils</span><span class="o">.</span><span class="na">putUnauthorizedRedirectUrlIntoFlowScope</span><span class="o">(</span><span class="n">requestContext</span><span class="o">,</span> <span class="n">url2</span><span class="o">);</span>

                <span class="n">LOGGER</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Unauthorized service access for principal; CAS will be redirecting to [{}]"</span><span class="o">,</span> <span class="n">url2</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">CasWebflowConstants</span><span class="o">.</span><span class="na">STATE_ID_SERVICE_UNAUTHZ_CHECK</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">final</span> <span class="n">String</span> <span class="n">handlerErrorName</span> <span class="o">=</span> <span class="n">getErrors</span><span class="o">()</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getHandlerErrors</span><span class="o">().</span><span class="na">values</span><span class="o">()::</span><span class="n">contains</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Class:</span><span class="o">:</span><span class="n">getSimpleName</span><span class="o">)</span>
                <span class="o">.</span><span class="na">findFirst</span><span class="o">()</span>
                <span class="o">.</span><span class="na">orElseGet</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Unable to translate handler errors of the authentication exception [{}]. Returning [{}]"</span><span class="o">,</span> <span class="n">e</span><span class="o">,</span> <span class="n">UNKNOWN</span><span class="o">);</span>
                    <span class="k">return</span> <span class="n">UNKNOWN</span><span class="o">;</span>
                <span class="o">});</span>

        <span class="kd">final</span> <span class="n">MessageContext</span> <span class="n">messageContext</span> <span class="o">=</span> <span class="n">requestContext</span><span class="o">.</span><span class="na">getMessageContext</span><span class="o">();</span>
        <span class="kd">final</span> <span class="n">String</span> <span class="n">messageCode</span> <span class="o">=</span> <span class="n">DEFAULT_MESSAGE_BUNDLE_PREFIX</span> <span class="o">+</span> <span class="n">handlerErrorName</span><span class="o">;</span>
        <span class="n">messageContext</span><span class="o">.</span><span class="na">addMessage</span><span class="o">(</span><span class="k">new</span> <span class="n">MessageBuilder</span><span class="o">().</span><span class="na">error</span><span class="o">().</span><span class="na">code</span><span class="o">(</span><span class="n">messageCode</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">handlerErrorName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Create an URI object with attributes as paramaters in it
     */</span>
    <span class="kd">protected</span> <span class="n">URI</span> <span class="nf">getUrl</span><span class="o">(</span><span class="kd">final</span> <span class="n">URI</span> <span class="n">uri</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">principalAttributes</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">target</span><span class="o">){</span>
        <span class="n">MultiValueMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">queryParams</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedMultiValueMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>

        <span class="n">principalAttributes</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">key</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="k">instanceof</span> <span class="n">Iterable</span><span class="o">){</span>
                <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">y</span> <span class="o">:</span> <span class="o">(</span><span class="n">Iterable</span><span class="o">)</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">queryParams</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">y</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">queryParams</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">i</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">queryParams</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"target"</span><span class="o">,</span> <span class="n">target</span><span class="o">);</span>

        <span class="n">UriComponents</span> <span class="n">uriComponents</span> <span class="o">=</span> <span class="n">UriComponentsBuilder</span><span class="o">.</span><span class="na">newInstance</span><span class="o">()</span>
            <span class="o">.</span><span class="na">fromUri</span><span class="o">(</span><span class="n">uri</span><span class="o">).</span><span class="na">queryParams</span><span class="o">(</span><span class="n">queryParams</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">uriComponents</span><span class="o">.</span><span class="na">toUri</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"Failed to create the URL"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>At this moment, everything is good but our handler is not registered to be used by Spring.</p>

<h2 id="register-the-newly-created-handler">Register the newly created handler</h2>

<p>It is pretty simple, we will override the Bean <code class="highlighter-rouge">authenticationExceptionHandler</code> by creating our own customized configuration class.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span><span class="o">(</span><span class="s">"ClaExternalIDConfiguration"</span><span class="o">)</span>
<span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="n">CasConfigurationProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClaExternalIDConfiguration</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CasConfigurationProperties</span> <span class="n">casProperties</span><span class="o">;</span>

    <span class="nd">@RefreshScope</span>
    <span class="nd">@Bean</span>
    <span class="cm">/**
     * This bean has the same name that the CAS "CasCoreWebflowConfiguration", so it will
     *  overwrite that class, it will work only because it is implemeted inside
     *  the gradle overlay in our example
     */</span>
    <span class="kd">public</span> <span class="n">Action</span> <span class="nf">authenticationExceptionHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ClaExternalIDAuthenticationExceptionHandlerAction</span><span class="o">(</span><span class="n">handledAuthenticationExceptions</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Exception</span><span class="o">&gt;&gt;</span> <span class="nf">handledAuthenticationExceptions</span><span class="o">()</span> <span class="o">{</span>
        <span class="cm">/*
         * Order is important here; We want the account policy exceptions to be handled
         * first before moving onto more generic errors. In the event that multiple handlers
         * are defined, where one failed due to account policy restriction and one fails
         * due to a bad password, we want the error associated with the account policy
         * to be processed first, rather than presenting a more generic error associated
         */</span>
        <span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Exception</span><span class="o">&gt;&gt;</span> <span class="n">errors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashSet</span><span class="o">&lt;&gt;();</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">javax</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">auth</span><span class="o">.</span><span class="na">login</span><span class="o">.</span><span class="na">AccountLockedException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">javax</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">auth</span><span class="o">.</span><span class="na">login</span><span class="o">.</span><span class="na">CredentialExpiredException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">javax</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">auth</span><span class="o">.</span><span class="na">login</span><span class="o">.</span><span class="na">AccountExpiredException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">AccountDisabledException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">InvalidLoginLocationException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">AccountPasswordMustChangeException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">InvalidLoginTimeException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">javax</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">auth</span><span class="o">.</span><span class="na">login</span><span class="o">.</span><span class="na">AccountNotFoundException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">javax</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">auth</span><span class="o">.</span><span class="na">login</span><span class="o">.</span><span class="na">FailedLoginException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">UnauthorizedServiceForPrincipalException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">PrincipalException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">UnsatisfiedAuthenticationPolicyException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">UnauthorizedAuthenticationException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">errors</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">casProperties</span><span class="o">.</span><span class="na">getAuthn</span><span class="o">().</span><span class="na">getExceptions</span><span class="o">().</span><span class="na">getExceptions</span><span class="o">());</span>

        <span class="k">return</span> <span class="n">errors</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>A last file for the configuration is needed in order to declare the configuration file into Spring.</p>
<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span><span class="p">=</span><span class="s">org.esupportail.cas.config.ClaExternalIDConfiguration</span>
</code></pre></div></div>

<h2 id="linking-the-oidc-id-and-uid">Linking the OIDC Id and UID</h2>

<p>This part can be manage by a simple jetty server. Or with some work a spring Webflow implemented yourself.</p>

<p>In our side we choose the first case. As explained above, the server will need to receive the first call with the url we constructed and store the OIDC id into the session for example.</p>

<p>Next it will send back to a new page implementing a CAS client, that will ask for a new login form authentication. When that authentication is done and granted, it will send back to this page and receive the UID.</p>

<p>At this moment, the server link both OIDC id and UID together into the database.</p>

<p>And on next login, CAS will get automatically the UID based on the OIDC id received by the OIDC supplier and grant the access.</p>

<h2 id="make-disappear-the-button-on-second-login">Make disappear the button on second login</h2>

<p>For that, a theme has to be used via the service configuration, in our code we just replaced the casLoginView.html by one that <code class="highlighter-rouge">&lt;div th:replace="fragments/loginProviders" /&gt;</code> has been removed.</p>

<h1 id="conclusion">Conclusion</h1>

<p>This solution is not perfect and could be maybe improved by using the webflow in order to make the linking possible. As well it has been only tested via an java overlay and will need some improvements if that is transformed into a module.</p>

<p>I hope it was instructive and it helped you to do what you wanted to do :)</p>

<p>The source are available on Github of course !</p>

<p>Find here our <a href="https://github.com/EsupPortail/cas-server-support-claExternalID/tree/5.2.x">Example source code</a>
Plus our simple <a href="https://github.com/EsupPortail/claExternalID/tree/5.2.x">Standalone LDAP linking server</a></p>

<p><a href="https://github.com/cifren">Francis Le Coq</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/02/02/OIDC-link-account/</guid>
                <description>
                    
                    In which we show to link OIDC id to LDAP database user.
                    
                </description>
                <pubDate>Fri, 02 Feb 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS Multifactor Authentication with  Duo Security</title>
                <link>https://apereo.github.io/2018/01/08/cas-mfa-duosecurity/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
<strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>As a rather common use case, the majority of CAS deployments that intend to turn on multifactor authentication support tend to do so via Duo Security. This is a quick and <em>simplified</em> guide to demonstrate an approach to that use case along with some additional explanations regarding specific multifactor triggers supported in CAS today.</p>

<p>Our task list is rather short:</p>

<ol>
  <li>Configure LDAP authentication with CAS</li>
  <li>Trigger Duo Security for users who belong to the <code class="highlighter-rouge">mfa-eligible</code> group, indicated by the <code class="highlighter-rouge">memberOf</code> attribute on the LDAP user account.</li>
</ol>

<h1 id="environment">Environment</h1>

<ul>
  <li>CAS <code class="highlighter-rouge">5.2.x</code></li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Maven WAR Overlay</a></li>
</ul>

<h1 id="configuring-authentication">Configuring Authentication</h1>

<p>Prior to configuring <em>multiple</em> factors of authentication, we need to first establish a primary mode of validating credentials. To kill two birds with one stone [1], we are going to o address yet another common use case and keep things simple by sticking with <a href="https://apereo.github.io/cas/development/installation/LDAP-Authentication.html">LDAP authentication</a>. The strategy here, as indicated by the CAS documentation, is to declare the intention/module in the build script and then configure the relevant <code class="highlighter-rouge">cas.authn.ldap[x]</code> settings for the directory server in use. Most commonly, that would translate into the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.ldap[0]</span><span class="py">.type</span><span class="p">=</span><span class="s">AUTHENTICATED</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.ldapUrl</span><span class="p">=</span><span class="s">ldaps://ldap1.example.org </span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.baseDn</span><span class="p">=</span><span class="s">dc=example,dc=org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.userFilter</span><span class="p">=</span><span class="s">cn={user}</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindDn</span><span class="p">=</span><span class="s">cn=Directory Manager,dc=example,dc=org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindCredential</span><span class="p">=</span><span class="s">...</span>
</code></pre></div></div>

<p>Note that the method of authentication, whether on its own or using separate attribute repositories and queries must have the ability to resolve the needed attribute which will be used later by CAS to trigger multifactor authentication. For this context, the simplest way would be to let LDAP authentication retrieve the attribute directly from the directory server.  The following setting allows us to do just that:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.ldap[0]</span><span class="py">.principalAttributeList</span><span class="p">=</span><span class="s">memberOf</span>
</code></pre></div></div>

<p>At this point in the authentication flow, we have established an authenticated subject that would be populated with fetched attribute <code class="highlighter-rouge">memberOf</code>.</p>

<h1 id="configuring-duo-security">Configuring Duo Security</h1>

<p>Here, our task is to enable <a href="https://apereo.github.io/cas/development/installation/DuoSecurity-Authentication.html">Duo Security</a> in CAS. Practically, similar to the LDAP authentication configuration, this involves declaring the right module in the build and then providing specific Duo Security settings to CAS properties. Things such as the secret key, integration key, etc which should be provided by your Duo Security subscription. Most commonly, that would translate into the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.mfa.duo[0]</span><span class="py">.duoSecretKey</span><span class="p">=</span>
<span class="err">cas.authn.mfa.duo[0]</span><span class="py">.duoApplicationKey</span><span class="p">=</span>
<span class="err">cas.authn.mfa.duo[0]</span><span class="py">.duoIntegrationKey</span><span class="p">=</span>
<span class="err">cas.authn.mfa.duo[0]</span><span class="py">.duoApiHost</span><span class="p">=</span>
</code></pre></div></div>

<p>At this point, we have enabled Duo Security and we just need to find a way to instruct CAS to route the authentication flow over to Duo Security in the appropriate condition. This is where triggers come into place.</p>

<h1 id="configuring-multifactor-authentication-triggers">Configuring Multifactor Authentication Triggers</h1>

<p>The entire purpose of a trigger here is to detect a condition by which the authentication flow should be rerouted. There are a large number of <a href="https://apereo.github.io/cas/development/installation/Configuring-Multifactor-Authentication-Triggers.html">triggers supported by CAS</a>, all of which kick into action and behave all the same regardless of the multifactor authentication provider. Our task here is to build a special condition that activates multifactor authentication if any of the values assigned to the attribute <code class="highlighter-rouge">memberOf</code> contain the value <code class="highlighter-rouge">mfa-eligible</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.mfa.globalPrincipalAttributeNameTriggers</span><span class="p">=</span><span class="s">memberOf</span>
<span class="py">cas.authn.mfa.globalPrincipalAttributeValueRegex</span><span class="p">=</span><span class="s">mfa-eligible</span>
</code></pre></div></div>

<p>Notice that the conditions above do not indicate anything about Duo Security. If the above condition holds true, how does CAS know that the authentication flow should be routed to <em>Duo Security</em>?</p>

<p>Per the CAS documentation:</p>

<blockquote>
  <p>Trigger MFA based on a principal attribute(s) whose value(s) matches a regex pattern. Note that this behavior is only applicable if there is only a single MFA provider configured since that would allow CAS to know what provider to next activate.</p>
</blockquote>

<p>In other words, if the above condition holds true and CAS is to route to <em>a</em> multifactor authentication flow, that would obviously be one supported and provided by Duo Security since that’s the only provider that is currently configured to CAS. Of course, if there are multiple providers available at runtime (i.e. Duo Security, YubiKey, etc) then we would need massage the condition since the automatic detection of the multifactor provider would not be immediately obvious…and that sort of thing would be outside the scope of this tutorial.</p>

<h1 id="summary">Summary</h1>

<p>I hope this review was of some help to you and I am sure that both this post as well as the functionality it attempts to explain can be improved in any number of ways. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

<p>[1] No birds were harmed during the production of this blog post.</p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/01/08/cas-mfa-duosecurity/</guid>
                <description>
                    
                    A short walkthrough to demonstrate how one might turn on multifactor authentication with CAS using Duo Security, leveraging a variety of triggers.
                    
                </description>
                <pubDate>Mon, 08 Jan 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Deploying Apereo CAS Behind a Proxy</title>
                <link>https://apereo.github.io/2018/01/05/cas-deployment-with-proxy/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>I suppose the majority of CAS deployments today sit behind some sort of proxy or load balancer, especially with high-availability requirements in mind. F5, HAProxy, etc. In most setups, the proxy upfront terminates SSL and then hands off the request over to CAS on a secured connection typically on port <code class="highlighter-rouge">8080</code>. While doing this sort of thing with an external servlet container such as Apache Tomcat is perfectly doable and folks have been doing that for ages, this guide aims to demonstrate how one might go about achieving the same result using the embedded Apache Tomcat container that ships with CAS.</p>

<h1 id="environment">Environment</h1>

<ul>
  <li>CAS <code class="highlighter-rouge">5.2.1</code></li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Maven WAR Overlay</a></li>
</ul>

<h1 id="configuration">Configuration</h1>

<p>We are using the embedded Apache Tomcat container provided by CAS automatically. This is the <em>recommended approach</em> in almost all cases (The embedded bit; not the Apache Tomcat bit) as the container configuration is entirely automated by CAS and its version is guaranteed to be compatible with the running CAS deployment. Furthermore, updates and maintenance of the servlet container are handled at the CAS project level where you as the adopter are only tasked with making sure your deployment is running the latest available release to take advantage of such updates.</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />Note that CAS does also provide embedded servlet container options based on Jetty and Undertow. Depending on the functionality at hand, certain features may require additional support and development for automation. YMMV.
</div>

<p>So, in order to open up a communication channel between the proxy and the CAS embedded Apache Tomcat server, we want to do the following:</p>

<ol>
  <li>Ensure Apache Tomcat runs on port <code class="highlighter-rouge">8080</code>, assuming that’s what the proxy uses to talk to CAS.</li>
  <li>Ensure Apache Tomcat has SSL turned off.</li>
  <li>Ensure the Apache Tomcat <em>connector</em> listening on the above port is marked as <code class="highlighter-rouge">secure</code>.</li>
</ol>

<p>The above tasklist translates to the following properties expected to be found in your <code class="highlighter-rouge">cas.properties</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">server.port</span><span class="p">=</span><span class="s">8080</span>
<span class="py">server.ssl.enabled</span><span class="p">=</span><span class="s">false</span>
<span class="py">cas.server.http.enabled</span><span class="p">=</span><span class="s">false</span>
<span class="py">cas.server.httpProxy.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.server.httpProxy.secure</span><span class="p">=</span><span class="s">true</span>
<span class="py">cas.server.httpProxy.scheme</span><span class="p">=</span><span class="s">https</span>
<span class="py">cas.server.httpProxy.protocol</span><span class="p">=</span><span class="s">HTTP/1.1</span>
</code></pre></div></div>

<p>That’s all.</p>

<h1 id="summary">Summary</h1>

<p>I hope this review was of some help to you. As you have been reading, I can guess that you have come up with a number of missing bits and pieces that would satisfy your use cases more comprehensively with CAS. In a way, that is exactly what this tutorial intends to inspire. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2018/01/05/cas-deployment-with-proxy/</guid>
                <description>
                    
                    A short tutorial on how to get Apereo CAS deployed behind proxies and load balancers that aim to terminate SSL.
                    
                </description>
                <pubDate>Fri, 05 Jan 2018 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.3.0 RC1 Feature Release</title>
                <link>https://apereo.github.io/2017/12/29/530rc1-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.2.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.2.0">November 27th, 2017</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.3.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the <strong>first</strong> release candidate in the <code class="highlighter-rouge">5.3.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.3.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<!--
You can read about the previous release candidate [here](https://apereo.github.io/2017/08/04/520rc2-release/).
-->

<!-- TOC -->

<ul>
  <li><a href="#shake-well-before-use">Shake Well Before Use</a>
    <ul>
      <li><a href="#apache-maven">Apache Maven</a></li>
      <li><a href="#gradle">Gradle</a></li>
    </ul>
  </li>
  <li><a href="#minors">Minors</a></li>
  <li><a href="#cosmosdb-service-registry">CosmosDb Service Registry</a></li>
  <li><a href="#saml2-service-providers">SAML2 Service Providers</a></li>
  <li><a href="#delegated-authn-saml2-metadata-endpoints">Delegated AuthN SAML2 Metadata Endpoints</a></li>
  <li><a href="#groovy-access-strategy">Groovy Access Strategy</a></li>
  <li><a href="#service-replication-via-hazelcast">Service Replication via Hazelcast</a></li>
  <li><a href="#global-attribute-caching-policies">Global Attribute Caching Policies</a></li>
  <li><a href="#documentation-cleanup">Documentation CleanUp</a></li>
  <li><a href="#dynamic-metadata-management">Dynamic Metadata Management</a></li>
  <li><a href="#externalized-views">Externalized Views</a></li>
  <li><a href="#health-indicators--monitors">Health Indicators &amp; Monitors</a></li>
  <li><a href="#hashicorp-consul">HashiCorp Consul</a></li>
  <li><a href="#hazelcast-aws-ec2-discovery">Hazelcast AWS EC2 Discovery</a></li>
  <li><a href="#multifactor-authentication-trigger-per-service-via-groovy">Multifactor Authentication Trigger Per Service Via Groovy</a></li>
  <li><a href="#microsoft-azures-keyvault-secrets">Microsoft Azure’s KeyVault Secrets</a></li>
  <li><a href="#response-type-per-service">Response Type Per Service</a></li>
  <li><a href="#delegated-authentication-access-policy">Delegated Authentication Access Policy</a></li>
  <li><a href="#shibboleth-attribute-resolver">Shibboleth Attribute Resolver</a></li>
  <li><a href="#splunk-logging">Splunk Logging</a></li>
  <li><a href="#u2f-authentication-registration-record-encryption">U2f Authentication Registration Record Encryption</a></li>
  <li><a href="#library-upgrades">Library Upgrades</a></li>
  <li><a href="#get-involved">Get Involved</a></li>
  <li><a href="#das-ende">Das Ende</a></li>
</ul>

<!-- /TOC -->

<h2 id="shake-well-before-use">Shake Well Before Use</h2>

<p>We strongly recommend that you take advantage of the release candidates as they come out. Waiting for a <code class="highlighter-rouge">GA</code> release is only going to set you up for unpleasant surprises. A <code class="highlighter-rouge">GA</code> is simply <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">a tag and nothing more</a>. In order to start experimenting with release candidates, use the following strategies.</p>

<p>At any given time, you should be able to append <code class="highlighter-rouge">-SNAPSHOT</code> to the CAS version specified in order to take advantage of snapshot builds as changes are made and published.</p>

<h3 id="apache-maven">Apache Maven</h3>

<p>In the <code class="highlighter-rouge">pom.xml</code> of the overlay, adjust the following tag to match below:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;cas.version&gt;</span>5.3.0-RC1<span class="nt">&lt;/cas.version&gt;</span>
</code></pre></div></div>

<h3 id="gradle">Gradle</h3>

<p>In the <code class="highlighter-rouge">gradle.properties</code> of the overlay, adjust the following setting to match below:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.version</span><span class="p">=</span><span class="s">5.3.0-RC1</span>
</code></pre></div></div>

<h2 id="minors">Minors</h2>

<ol>
  <li>A boolean flag is now exposed in CAS settings to toggle <a href="https://apereo.github.io/cas/development/integration/Configuring-Google-reCAPTCHA.html">Google reCAPTCHA</a> behavior.</li>
  <li>Scratch codes for <a href="https://apereo.github.io/cas/development/installation/GoogleAuthenticator-Authentication.html">Google Authenticator multifactor authentication</a> are now properly recognized as valid tokens.</li>
  <li>A series of small bug fixes to ensure claims and scopes are properly recognized and released via the <a href="https://apereo.github.io/cas/development/installation/OIDC-Authentication.html">OpenID Connect protocol</a>.</li>
  <li>Thanks to <a href="https://github.com/Thaslin">@Thaslin</a>,<a href="https://apereo.github.io/cas/development/integration/ADFS-Integration.html">delegating authentication to ADFS</a> gains support for WCTX while handling concurrent requests. This problem manifests itself when multiple iframes redirect to CAS at nearly the same time. Since only one static session key was used for the CAS service, all requests were redirected to the same service URL after authentication success. Using the WCTX parameter as part of the session key solves this problem.</li>
  <li>Thanks to <a href="https://github.com/pdrados">@pdrados</a>, <a href="https://apereo.github.io/cas/development/installation/Configuring-RiskBased-Authentication.html">risk-based authentication</a> gains a few new fixes when CAS begins to calculate the authentication risk factor based on date/time.</li>
  <li>Thanks to <a href="https://github.com/robertoschwald">@robertoschwald</a>, the CAS protocol specification is slightly revved to provide a few fixes to the XSD schema and to remove the <code class="highlighter-rouge">memberOf</code> attribute.</li>
  <li>A number of improvements to URL validators by <a href="https://github.com/swoeste">@swoeste</a> to support <em>unknown</em> yet valid TLDs. Regex support is now added to CAS HTTP configuration to ensure URL authorities can be correctly verified based on that pattern.</li>
  <li>Thanks to <a href="https://github.com/hdeadman">@hdeadman</a>, the <a href="https://apereo.github.io/cas/development/installation/Configuring-Commandline-Shell.html">command-line shell</a> is slightly improved when it’s asked to add properties for a configuration group that is not strictly controlled by CAS itself. (i.e. <code class="highlighter-rouge">add-property -group tomcat</code>).</li>
  <li>LDAP support is slightly enhanced with a new setting to enable dereferencing aliases.</li>
  <li>The CAS internal Gradle build is integrated with <a href="https://github.com/google/error-prone">Google’s error-prone plugin</a> to detect anomalies and prevent bugs.</li>
  <li>References to Spring’s <code class="highlighter-rouge">VelocityEngineFactory</code> are removed and CAS attempts to create its own <code class="highlighter-rouge">VelocityEngine</code> instance required and used to support SAML and friends. This is also a prepping move before CAS switches over to Spring 5 where Velocity functionality is now absent.</li>
  <li>CAS startup banner details, such as CAS version or commit id, etc are now also included in the <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html"><code class="highlighter-rouge">info</code> endpoint</a>.</li>
  <li>The HTTP security filter is made more flexible by accepting values for <code class="highlighter-rouge">X-FRAME-OPTIONS</code> and <code class="highlighter-rouge">X-XSS-PROTECTION</code>.</li>
  <li>The embedded Apache Tomcat container now supports a few additional filters such as CSRF and Remote-Address.</li>
  <li>CAS audit logs see a few small improvements when data is formatted as JSON. Ticket validation events in the audit log are also able to show the authenticated principal and the collection of attributes released to the application as part of the assertion.</li>
  <li>CAS is now able to inject arbitrary headers into the response where needed to account for custom workflows and security settings.</li>
  <li>The configuration metadata is slightly improved to ensure metadata for inherited fields is properly generated.</li>
  <li>When securing admin pages and dashboard in CAS via IP address, there is now the ability to determine the IP via alternative headers such as <code class="highlighter-rouge">X-Forwarded-For</code>.</li>
  <li>A number of documentation improvements by <a href="https://github.com/dstepe">@dstepe</a>, <a href="https://github.com/mac-reid">@mac-reid</a>.</li>
  <li>Thanks to <a href="https://github.com/dacurry-tns">@dacurry-tns</a>, connections to MongoDb are now improved to better handle <code class="highlighter-rouge">clientUri</code> settings.</li>
  <li>Thanks to <a href="https://github.com/mbenson">@mbenson</a>, the CAS BOM is now improved to include all CAS modules.</li>
  <li>Thanks to <a href="https://github.com/gledsonrabelo">@gledsonrabelo</a>, the prefix for proxy tickets is now fixed to be <code class="highlighter-rouge">PT</code>.</li>
</ol>

<h2 id="cosmosdb-service-registry">CosmosDb Service Registry</h2>

<p>CAS service definitions can now be managed and controlled via Microsoft Azure’s <a href="https://apereo.github.io/cas/development/installation/CosmosDb-Service-Management.html">CosmosDb</a>.</p>

<h2 id="saml2-service-providers">SAML2 Service Providers</h2>

<p>The following new SAML2 service providers are now supported by CAS out of the box:</p>

<ul>
  <li>GitLab</li>
  <li>Hipchat</li>
  <li>AppDynamics</li>
</ul>

<h2 id="delegated-authn-saml2-metadata-endpoints">Delegated AuthN SAML2 Metadata Endpoints</h2>

<p>When delegating authentication to external SAML2 identity providers, CAS is able to present both the SP (CAS) and the IdP metadata via <a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html#saml2-identity-providers">dedicated endpoints</a>.</p>

<h2 id="groovy-access-strategy">Groovy Access Strategy</h2>

<p><a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Access-Strategy.html">Service access strategy policies</a> can now take advantage of a Groovy script for more dynamic rules.</p>

<h2 id="service-replication-via-hazelcast">Service Replication via Hazelcast</h2>

<p>In the event that CAS service definitions are not managed globally via a centralized store, service definition files managed as JSON or YAML files can be replicated across the CAS cluster <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Replication.html">via Hazelcast</a> in addition to the native tooling options of the CAS platform.</p>

<h2 id="global-attribute-caching-policies">Global Attribute Caching Policies</h2>

<p><a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Caching.html">Attribute release caching</a> in CAS may certainly be done on a per-service basis. In this release, CAS provides a strategy for caching attributes at a more global level specifically at release time.</p>

<h2 id="documentation-cleanup">Documentation CleanUp</h2>

<p>A large number of CAS settings that are <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties-Common.html">shared and common</a> across modules are cleaned up to only be referenced once in a common area, pointing to a specific configuration key. This is a gradual effort and will take some time to complete.</p>

<p>For instance, when it comes to MongoDB support there are a large number of CAS modules and components that support and integrate with it whose settings, structurally, are very much shared. Consider the duplicated settings below for features <code class="highlighter-rouge">feature1</code> and <code class="highlighter-rouge">feature2</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.feature1.mongo.host</span><span class="p">=</span><span class="s">localhost1</span>
<span class="py">cas.feature1.mongo.timeout</span><span class="p">=</span><span class="s">2000</span>

<span class="py">cas.feature2.mongo.host</span><span class="p">=</span><span class="s">localhost2</span>
<span class="py">cas.feature2.mongo.timeout</span><span class="p">=</span><span class="s">4000</span>
</code></pre></div></div>

<p>Instead, the common settings such as <code class="highlighter-rouge">host</code>, <code class="highlighter-rouge">timeout</code>, etc are moved to a common block and take the form of:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">${configurationKey}</span><span class="py">.mongo.host</span><span class="p">=</span><span class="s">localhost1</span>
<span class="err">${configurationKey}</span><span class="py">.mongo.timeout</span><span class="p">=</span><span class="s">2000</span>
</code></pre></div></div>

<p>…where the <code class="highlighter-rouge">configurationKey</code> can either be <code class="highlighter-rouge">cas.feature1</code> or <code class="highlighter-rouge">cas.feature2</code>, etc.</p>

<div class="alert alert-warning">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Beware</strong><br />As part of the cleanup, the property <code>userFilter</code> that dealt with LDAP authentication filters and queries is now deprecated and replaced with <code>searchFilter</code> to be consistent with all other LDAP integration modules and features.
</div>

<h2 id="dynamic-metadata-management">Dynamic Metadata Management</h2>

<p>Managing service provider metadata documents, especially for bilateral integrations can now be done with the likes of MongoDB, SQL databases or Groovy, etc. <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html#dynamic-metadata">See this guide</a> for more info.</p>

<h2 id="externalized-views">Externalized Views</h2>

<p>CAS UI pages and that of Thymeleaf can now be loaded from external locations outside the web application context. While this was always a possible, this release candidate provides the ability to conditionally load views from an external path when found, and otherwise fall back to the default location inside the web application.</p>

<h2 id="health-indicators--monitors">Health Indicators &amp; Monitors</h2>

<p>CAS for some time has had the ability to monitor external systems and data sources such as LDAP, Memcached, etc. In this release candidate, the legacy CAS <code class="highlighter-rouge">Monitor</code> API is removed in favor of Spring Boot’s native <code class="highlighter-rouge">HealthIndicator</code> components. CAS monitors are removed from the <code class="highlighter-rouge">/status</code> page and moved to the Spring Boot’s <code class="highlighter-rouge">/health</code> endpoint. Note that the new endpoint by default does not show details of the monitors configured unless the request is an <em>authenticated</em> one with Spring Security. This behavior of course can be controlled via CAS settings.</p>

<p>Note that as a result of this change, status codes that are returned by CAS have changed to include: <code class="highlighter-rouge">UNKNOWN</code>, <code class="highlighter-rouge">UP</code>, <code class="highlighter-rouge">DOWN</code>, <code class="highlighter-rouge">WARN</code> and <code class="highlighter-rouge">OUT_OF_SERVICE</code> many of which are by default provided by Spring Boot.</p>

<h2 id="hashicorp-consul">HashiCorp Consul</h2>

<p>Thanks to Spring Cloud, CAS can now be tightly integrated with HashiCorp’s Consul for service discovery, health checks as well as configuration management via Consul’s key-value store. See <a href="https://apereo.github.io/cas/development/installation/Service-Discovery-Guide.html">this guide</a> for more info.</p>

<h2 id="hazelcast-aws-ec2-discovery">Hazelcast AWS EC2 Discovery</h2>

<p>Hazelcast support in CAS is now equipped to handle AWS EC2 auto-discovery. It is useful when you do not want to provide or you cannot provide the list of possible IP addresses for the cluster members. Furthermore, you may now specify a partitioning group configuration that may be zone-aware. <a href="https://apereo.github.io/cas/development/installation/Hazelcast-Ticket-Registry.html">See this guide</a> for more info.</p>

<h2 id="multifactor-authentication-trigger-per-service-via-groovy">Multifactor Authentication Trigger Per Service Via Groovy</h2>

<p>Multifactor authentication triggers per applications can now be more dynamically decided via a Groovy script. <a href="https://apereo.github.io/cas/development/installation/Configuring-Multifactor-Authentication-Triggers.html#applications">See this guide</a> for more info.</p>

<h2 id="microsoft-azures-keyvault-secrets">Microsoft Azure’s KeyVault Secrets</h2>

<p>Azure Key Vault Secrets can now act as a storage mechanism for CAS properties and settings in conjunction with Spring Cloud. See <a href="https://apereo.github.io/cas/development/installation/Configuration-Server-Management.html#spring-cloud">this guide</a> for more info.</p>

<h2 id="response-type-per-service">Response Type Per Service</h2>

<p>The CAS protocol likely since its inception has provided support for a <code class="highlighter-rouge">method</code> parameter whose value would allow CAS to respond back to the service/application with a ticket via a redirect, a POST, etc. This behavior can now be applied to a registered service definition, controlling application behavior and expectations centrally. If you have a group of individual applications who all expected CAS to contact them back with a POST, you may group them together in a definition and set the <code class="highlighter-rouge">responseType</code> accordingly rather than having each individual application specify a <code class="highlighter-rouge">method=POST</code> in the authentication request.</p>

<h2 id="delegated-authentication-access-policy">Delegated Authentication Access Policy</h2>

<p>In the event that CAS is allowed and configured to delegate the authentication request to an external provider such as a SAML2 IdP, you may now assign policies to registered service definitions in the CAS service registry to let each service control the set of authorized external identity providers. This behavior is enforced in the UI and while tickets are generated or validated.</p>

<p><a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">See this guide</a> for more info.</p>

<h2 id="shibboleth-attribute-resolver">Shibboleth Attribute Resolver</h2>

<p>Support for resolving attributes using a Shibboleth IdP’s <code class="highlighter-rouge">attribute-resolver.xml</code> is now removed.</p>

<h2 id="splunk-logging">Splunk Logging</h2>

<p>Support for <a href="https://apereo.github.io/cas/development/installation/Logging-Splunk.html">publishing logs to Splunk</a> is now included in this release. CAS is not quite taking advantage of native Splunk logging capabilities to format messages and that bit surely might receive more attention in future releases.</p>

<h2 id="u2f-authentication-registration-record-encryption">U2f Authentication Registration Record Encryption</h2>

<p>Support for encryption/decryption of U2F authentication registration records stored in RDBMS as well as MongoDB repositories has been added
via <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#fido-u2f">new properties</a></p>

<h2 id="library-upgrades">Library Upgrades</h2>

<ul>
  <li>Gradle</li>
  <li>Hibernate</li>
  <li>AspectJ</li>
  <li>Spring</li>
  <li>Spring Boot</li>
  <li>Spring Cloud</li>
  <li>AWS Java SDK</li>
  <li>Hazelcast</li>
  <li>HikariCP</li>
  <li>Authy</li>
  <li>Azure CosmosDb</li>
  <li>Cassandra</li>
  <li>Apache Commons</li>
  <li>Apache CXF</li>
  <li>Apache Tomcat</li>
  <li>Eureka</li>
  <li>Apache Fediz</li>
  <li>Geo2IP</li>
  <li>Maxmind</li>
  <li>Google Maps</li>
  <li>Apache HttpClient</li>
  <li>Apache Ignite</li>
  <li>Couchbase</li>
  <li>Jose4J</li>
  <li>Apache Log4j</li>
  <li>MariaDB Driver</li>
  <li>Mockito</li>
  <li>Apache Velocity</li>
  <li>OpenSAML</li>
  <li>Pac4j</li>
  <li>SemVer</li>
  <li>Zipkin</li>
  <li>Sleuth</li>
</ul>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="das-ende">Das Ende</h2>

<p>Big thanks to all who participate in the development of this release to submit patches and contribute improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/12/29/530rc1-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.3.0 RC1 release.
                    
                </description>
                <pubDate>Fri, 29 Dec 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS SAML Integration With ADFS</title>
                <link>https://apereo.github.io/2017/11/22/cas-saml-integration-adfs/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>This is a short and sweet tutorial on how to integrate Apereo CAS, acting as a SAML identity provider, with ADFS.</p>

<h1 id="environment">Environment</h1>

<ul>
  <li>CAS <code class="highlighter-rouge">5.2.0-SNAPSHOT</code></li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Maven WAR Overlay</a></li>
</ul>

<h1 id="cas-configuration">CAS Configuration</h1>

<p>In order to allow CAS to become a SAML2 identity provider, the overlay needs to be prepped based on the <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">instructions provided here</a>. Remember to add the relevant module to the overlay along with the list of required build repositories.</p>

<p>The SAML IdP configuration will need to minimally match the following settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.samlIdp.entityId</span><span class="p">=</span><span class="s">https://cas.example.edu/idp</span>
<span class="py">cas.authn.samlIdp.scope</span><span class="p">=</span><span class="s">example.edu</span>
<span class="py">cas.authn.samlIdp.metadata.location</span><span class="p">=</span><span class="s">file:/etc/cas/saml</span>
</code></pre></div></div>

<p>You will, of course, need to adjust your entityId and scope as needed. Upon startup, CAS will attempt to generate the appropriate metadata based on provided settings and produced artifacts will be placed at <code class="highlighter-rouge">/etc/cas/saml</code>. Of course, the running CAS process will need to have the right permissions in order to create this directory and the contents within it.</p>

<p>To keep things simple, we will also configure CAS to use <a href="https://apereo.github.io/cas/development/installation/LDAP-Authentication.html">LDAP authentication</a> such that the established single sign-on session is based on the authenticated principal whose is based on the <code class="highlighter-rouge">sAMAccountName</code> attribute.</p>

<p>The ADFS instance needs to be registered with CAS as a service provider. You can choose a variety of <a href="https://apereo.github.io/cas/development/installation/Service-Management.html">service management options</a>. For this tutorial, I will be using the <a href="https://apereo.github.io/cas/development/installation/JSON-Service-Management.html">JSON Service Registry</a> with the following snippet as the ADFS registration record:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.support.saml.services.SamlRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://adfs.example.edu/adfs/services/trust"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"adfs"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">10000007</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"adfs service"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"logoutType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NONE"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"attributeReleasePolicy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.ReturnMappedAttributeReleasePolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"allowedAttributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.TreeMap"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"upn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"groovy { return 'DOMAIN</span><span class="se">\\\\</span><span class="s2">' + attributes['username'][0] }"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"requiredNameIdFormat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"metadataLocation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/path/to/adfs-metadata.xml"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signAssertions"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="s2">"signResponses"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>You certainly need to modify the <code class="highlighter-rouge">serviceId</code> and <code class="highlighter-rouge">metadataLocation</code> for your configuration but the most important bit in the above snippet is the blob that controls the <code class="highlighter-rouge">allowedAttributes</code>. The attribute release policy is essentially doing the following:</p>

<ul>
  <li><code class="highlighter-rouge">upn</code> is released and mapped to the ADFS-required SAML name <code class="highlighter-rouge">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn</code>.</li>
  <li><code class="highlighter-rouge">http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountnwin</code> is required by ADFS and is released here as a custom attribute. Since it requires a value in the format of <code class="highlighter-rouge">DOMAIN\\username</code>, this value is constructed via an inline groovy script, with each <code class="highlighter-rouge">\</code> escaped with another <code class="highlighter-rouge">\</code>. Remember that <code class="highlighter-rouge">username</code> here is the name mapped to the attribute <code class="highlighter-rouge">sAMAccountName</code> that is retrieved from LDAP and is the CAS principal id. Also note that because all attributes in CAS are sort of treated and assumed to be multi-valued, we need to ensure that we grab the attribute value for <code class="highlighter-rouge">username</code> by indexing it with <code class="highlighter-rouge">[0]</code>.</li>
</ul>

<h1 id="adfs-configuration">ADFS Configuration</h1>

<p>Start with adding a Claims Provider Trust. In the screenshot below, ours is called <code class="highlighter-rouge">CAS Login –TEST</code>.</p>

<p><img src="https://user-images.githubusercontent.com/1205228/33142854-1222951c-cf75-11e7-8921-79f38283ffaa.png" alt="image" /></p>

<p>On the “Monitoring” tab, enter the URL of your CAS IdP metadata into the “Claims provider’s federation metadata URL:” field (i.e <code class="highlighter-rouge">https://cas.example.edu/cas/idp/metadata</code>).</p>

<p><img src="https://user-images.githubusercontent.com/1205228/33142888-2ef45d88-cf75-11e7-877c-17fb83758b57.png" alt="image" /></p>

<p>On the “Identifiers” tab, enter a “Display name:” and enter the entity ID that you specified in your CAS IdP configuration into the ”Claims provider identifier” field (i.e. <code class="highlighter-rouge">https://cas.example.edu/idp</code>).</p>

<p><img src="https://user-images.githubusercontent.com/1205228/33142917-45d59bc0-cf75-11e7-9a60-407f70b4dd76.png" alt="image" /></p>

<p>On the “Endpoints” tab, enter the endpoints for “SAML Single Sign-On Endpoints” and “SAML Logout Endpoints”. These can be found from your CAS IdP metadata. The first two values entered here are based on the “SingleSignOnService” bindings at the following endpoints:</p>

<ul>
  <li><code class="highlighter-rouge">https://cas.example.edu/cas/idp/profile/SAML2/POST/SSO</code></li>
  <li><code class="highlighter-rouge">https://cas.example.edu/cas/idp/profile/SAML2/Redirect/SSO</code></li>
</ul>

<p>The logout endpoint is based on the “SingleLogoutService” binding located at the following endpoint:</p>

<ul>
  <li><code class="highlighter-rouge">https://cas.example.edu/cas/idp/profile/SAML2/POST/SLO</code></li>
</ul>

<p><img src="https://user-images.githubusercontent.com/1205228/33142928-57e82dc8-cf75-11e7-9ef8-2d22b0f9f3f0.png" alt="image" /></p>

<p>To enable CAS only (ADFS will auto-redirect to CAS), run the following PowerShell command on the ADFS server:</p>

<p><code class="highlighter-rouge">Set-AdfsRelyingPartyTrust -TargetName "Microsoft Office 365 Identity Platform" -ClaimsProviderName "CAS Login - TEST"</code></p>

<p>To revert back to Active Directory, run the following PowerShell command on the ADFS server:</p>

<p><code class="highlighter-rouge">Set-AdfsRelyingPartyTrust -TargetName "Microsoft Office 365 Identity Platform" -ClaimsProviderName "Active Directory"</code></p>

<h1 id="summary">Summary</h1>

<p>I hope this review was of some help to you. As you have been reading, I can guess that you have come up with a number of missing bits and pieces that would satisfy your use cases more comprehensively with CAS. In a way, that is exactly what this tutorial intends to inspire. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/11/22/cas-saml-integration-adfs/</guid>
                <description>
                    
                    A short tutorial on how to integrate CAS, acting as a SAML identity provider, with ADFS.
                    
                </description>
                <pubDate>Wed, 22 Nov 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Introduction to CAS Commandline Shell</title>
                <link>https://apereo.github.io/2017/10/30/intro-cas-cli-shell/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>Amongst the new features of CAS <code class="highlighter-rouge">5.2.x</code> is a <a href="https://apereo.github.io/cas/development/installation/Configuring-Commandline-Shell.html">command-line tool</a> whose objective is to automate some of the more mundane deployment tasks by tapping into the CAS APIs to provide help on available settings/modules and various other utility functions. This shell engine that is based on <a href="https://projects.spring.io/spring-shell/">Spring Shell</a> is presented as both a CLI utility and an interactive shell.</p>

<p>In this post, I am going to provide an overview of the CAS Shell and enumerate a few utility functions that might prove useful during a CAS deployment.</p>

<h1 id="environment">Environment</h1>

<ul>
  <li>CAS <code class="highlighter-rouge">5.2.0-SNAPSHOT</code></li>
  <li><a href="https://github.com/apereo/cas-overlay-template">CAS Maven WAR Overlay</a></li>
</ul>

<h1 id="spawn-the-shell">Spawn The Shell</h1>

<p>While I am using the Maven WAR overlay, note that each CAS WAR Overlay deployment project should already be equipped with this functionality. You should not have to do anything <em>special</em> and extra to interact with the shell. See the relevant overlay documentation and <code class="highlighter-rouge">README</code> file for more info on how to invoke and work with the shell.</p>

<p>Specifically applicable to the Maven WAR Overlay, one may launch the CLI by simply executing the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh cli
</code></pre></div></div>

<p>This should present you with the general welcome message as well as a list of command-line options accepted for various functions.</p>

<h1 id="command-line-options">Command-line Options</h1>

<p>One of the more useful utilities baked into CAS CLI tool is the ability to search for CAS settings and get better documentation and help on each. All individual CAS properties in most cases carry relevant Javadocs, examples, and links embedded right alongside the field in the housing component. The CAS build process upon every release attempts to collect all settings and their documentation into a JSON metadata file that can be queried by the CLI tool for more info. This of course not only includes CAS specific settings (i.e. <code class="highlighter-rouge">cas.authn.xyz=something</code>) but also all other Spring Boot settings and just about any other component that exposes its settings via a <code class="highlighter-rouge">@ConfigurationProperties</code>.</p>

<p>If you want to learn more about how this is done, please <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/configuration-metadata.html">see this article</a>.</p>

<h2 id="examples">Examples</h2>

<div class="alert alert-info">
  <strong>Note</strong><br />For the majority of the listed commands, I am going to skip the output. Feel free to try these yourself and observe the outcome.
</div>

<h3 id="configuration-metadata">Configuration Metadata</h3>

<p>Let’s say we are looking for additional documentation on <code class="highlighter-rouge">duoApplicationKey</code>. To run the search, use:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Skipping the CAS Banner via `-skb` </span>
./build.sh cli <span class="nt">-skb</span> <span class="nt">-p</span> duoApplicationKey
</code></pre></div></div>

<p>Cool, but maybe that’s too limiting. How about notes on every setting in CAS that deals with <code class="highlighter-rouge">duo</code>?</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh cli <span class="nt">-skb</span> <span class="nt">-p</span> duo.+
</code></pre></div></div>

<p>The output seems too verbose. How about we compact it a little bit?</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh cli <span class="nt">-skb</span> <span class="nt">-p</span> duo.+ <span class="nt">--summary</span>
</code></pre></div></div>

<p>Nice. What about some other non-CAS setting like, I don’t know, <code class="highlighter-rouge">maxHttpPostSize</code>?</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh cli <span class="nt">-p</span> maxHttpPostSize <span class="nt">-skb</span>
</code></pre></div></div>

<p>You see the above setting applies to Tomcat, Jetty and a few more. Here is a slightly fancier and more direct version:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh cli <span class="nt">-p</span> server.tomcat.max-http-post-size <span class="nt">-skb</span>
</code></pre></div></div>

<h3 id="others">Others</h3>

<p>Other CLI options include the following:</p>

<ul>
  <li>Generating JWTs: <code class="highlighter-rouge">./build.sh cli -gw -sub Misagh -skb</code></li>
  <li>Generating keys for a CAS setting group that requires signing/encryption keys: <code class="highlighter-rouge">./build.sh cli -gk -p cas.tgc -skb</code></li>
  <li>…</li>
</ul>

<p>As more options and commands are added to the CLI, you should always confirm new additions by simply running <code class="highlighter-rouge">./build.sh cli -h -skb</code> to get a listing of all options.</p>

<h1 id="interactive-shell">Interactive Shell</h1>

<p>There is also an interactive shell which essentially provides identical functionality to the CLI yet it is more flexible and powerful in many ways. Some of the key highlights include:</p>

<ul>
  <li>A simple, annotation-driven, programming model to contribute custom commands</li>
  <li>Tab completion, colorization, and script execution</li>
  <li>Already built-in commands, such as clear screen, gorgeous help, exit</li>
</ul>

<p>You can simply launch into the shell via <code class="highlighter-rouge">./build.sh cli -sh</code>. While in the shell, simply type <code class="highlighter-rouge">quit</code> to exit the shell.</p>

<h2 id="shell-commands">Shell Commands</h2>

<p>In addition to a number built-in commands such as <code class="highlighter-rouge">help</code>, <code class="highlighter-rouge">version</code> and the most useful <code class="highlighter-rouge">cls</code> or <code class="highlighter-rouge">clear</code>, the following CAS-provided commands are available.</p>

<p>Remember:</p>

<ul>
  <li>Use double-tab to take advantage of auto-completion and history.</li>
  <li>Use <code class="highlighter-rouge">help</code> to see a listing of all commands.</li>
  <li>Use <code class="highlighter-rouge">help &lt;command-name&gt;</code> to learn more about the command itself.</li>
</ul>

<h3 id="find">Find</h3>

<p>Identical to its CLI equivalent, allows one to look up a CAS setting:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cas&gt;find <span class="nt">--name</span> duo
</code></pre></div></div>

<h3 id="undocumented-settings">Undocumented Settings</h3>

<p>Acts as a sanity check and lists undocumented properties for which allowing contributors to step up and contribute to the documentation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cas&gt;list-undocumented
</code></pre></div></div>

<h3 id="generate-jwts">Generate JWTs</h3>

<p>Identical to its CLI equivalent:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cas&gt;generate-jwt <span class="nt">--subject</span> Misagh
</code></pre></div></div>

<h3 id="generate-crypto-keys">Generate Crypto Keys</h3>

<p>Identical to its CLI equivalent:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cas&gt;generate-key <span class="nt">--group</span> cas.tgc
</code></pre></div></div>

<h3 id="json-to-yaml">JSON To YAML</h3>

<p>Convert a CAS service definition file in JSON to YAML and optionally save the file at path:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cas&gt;generate-yaml /etc/cas/config/services/WSFED-400.json <span class="nt">--destination</span> /etc/cas/config/services/WSFED-400.yml
</code></pre></div></div>

<h3 id="validate-service">Validate Service</h3>

<p>Validate a service definition file in JSON or YAML to ensure correctness of syntax. Note that this command should and does support all service types (SAML2, OAuth, etc) provided by CAS:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cas&gt;validate-service <span class="nt">--file</span> /etc/cas/config/services/WSFED-400.json
</code></pre></div></div>

<h3 id="add-properties">Add Properties</h3>

<p>All associated settings with a given property group are added to the properties file defined. Existing values should be preserved.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cas&gt;add-properties <span class="nt">--group</span> cas.tgc <span class="nt">--file</span> /etc/cas/config/my.properties
</code></pre></div></div>

<h1 id="extending-commands">Extending Commands</h1>

<p>When the shell is launched with the <code class="highlighter-rouge">-sh</code> option, all components under the <code class="highlighter-rouge">org.apereo.cas.shell</code> that are annotated with <code class="highlighter-rouge">org.springframework.stereotype.Service</code> are picked up as command implementations.</p>

<p>The outline of a given command is as such:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">apereo</span><span class="o">.</span><span class="na">cas</span><span class="o">.</span><span class="na">shell</span><span class="o">.</span><span class="na">commands</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DoesStuffCommand</span> <span class="kd">implements</span> <span class="n">CommandMarker</span> <span class="o">{</span>
   
    <span class="nd">@CliCommand</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"do-stuff"</span><span class="o">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">"This does stuff"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doStuff</span><span class="o">()</span> <span class="o">{</span>
       <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>If you are interested in adding new and fancier commands, by all means create your own based on the above outline and contribute back.</p>

<h1 id="summary">Summary</h1>

<p>I hope this review was of some help to you. As you have been reading, I can guess that you have come up with a number of missing bits and pieces that would satisfy your use cases more comprehensively with CAS. In a way, that is exactly what this tutorial intends to inspire. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/10/30/intro-cas-cli-shell/</guid>
                <description>
                    
                    A short review of an interactive command-line shell provided by Apereo CAS.
                    
                </description>
                <pubDate>Mon, 30 Oct 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Multitenancy With CAS</title>
                <link>https://apereo.github.io/2017/10/23/cas-multitenancy/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />This blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>According to <a href="https://www.wikiwand.com/en/Multitenancy">Wikipedia</a>, the term “software multitenancy” is defined as:</p>

<blockquote>
  <p>…a software architecture in which a single instance of software runs on a server and serves multiple tenants. A tenant is a group of users who share a common access with specific privileges to the software instance.</p>
</blockquote>

<p>I have been asked on and off about multitenancy capabilities of CAS and whether <a href="https://apereo.github.io/2017/02/18/onthe-theoryof-possibility/">it is possible</a> to have one CAS deployment serve many tenants. To be clear, multitenancy in a CAS context would cover the following areas for each tenant:</p>

<ul>
  <li>Brand and theme the user interface.</li>
  <li>Define and limit authentication sources including attribute retrieval and release.</li>
  <li>Control logging strategies and audits in different granular details.</li>
  <li>Define and limit enabled/supported authentication protocols both as an IdP and IdP Proxy (delegated authentication).</li>
  <li>Feature management, such as tickets, security, access strategy, flow customizations, etc.</li>
  <li>…</li>
</ul>

<p>In addition to the problem of isolating configuration per tenant, there also needs to be a mechanism by which CAS may shake hands with each tenant to recognize and activate their connected configuration. Furthermore, any design needs to also carefully weigh and evaluate possibilities of <em>feature imbalance</em> which is the problem of introducing capabilities requested by a tenant without impact and side-effects to others and doing so in such a way to ensure all tenants can get their fair share of system capabilities if and when asked.</p>

<p>If all of this sounds complex and seems like a lot of work, it is simply because it is. If this is something you desire to see in your deployment, please <a href="https://twitter.com/misagh84">reach out</a>.</p>

<p>While support for multi-tenancy in the above terms and conditions is absent in CAS today, in this tutorial I wish to uncover <em>a few</em> aspects of the CAS software that may prove as viable alternatives or shortcuts for the time being to handle multitenancy-like features.</p>

<h1 id="scenario">Scenario</h1>

<p>Let’s suppose we are in charge of a CAS deployment that is tasked to serve two distinct tenants A and B each of which wish to register a few different applications registered with CAS with a variety of other rules that affect attribute release, themes, etc.</p>

<h2 id="constraints">Constraints</h2>

<p>It is important to treat these tenants as generic as possible and not make any assumptions about their underlying deployment or architecture. Equally significant, note that our tenants are simply <em>unable</em> to make changes whatsoever on their end to make our lives easier on this end. We might be able to relax this clause and make amends later in the future, (assuming fairly tight control over the environment) but until then, tenants’ expectation is to integrate with a given CAS deployment as if it was only their own completely ignorant of its multitenancy capabilities. Everything that can be done should be done with CAS to see that expectation to reality.</p>

<h1 id="poor-mans-multitenancy">Poor Man’s Multitenancy</h1>

<p>One possible solution is to turn the problem from one of software into one of deployment topology. Rather than having <em>a single</em> CAS deployment serving many tenants, you would simply have many smaller deployments serving each tenant and you would assign each tenant a specific endpoint that handles their needs exclusively. For our tenants, we could have <code class="highlighter-rouge">https://sso.example.org/tenantA/cas/</code> and <code class="highlighter-rouge">https://sso.example.org/tenantB/cas</code> endpoint and so on. (If you care, rewrite the URLs prettier at some level to hide details) All CAS functionality is scoped to the specific endpoints that are shared with each tenant and the software itself cares not how it is contacted and by whom so long as requests are well-formed.</p>

<p>While arguably this is the simplest of all options and grants the most flexibility, it goes without saying that managing many small deployments, upgrades and maintenance efforts across the platform does incur cost and risk and requires quite a bit of automation, technique and infrastructure support to let all play nice.</p>

<h1 id="authentication">Authentication</h1>

<p>To further complicate the scenario, let’s suppose that tenant A uses a MySQL database for its account source and authentication while tenant B uses Active Directory. Our goal is to let tenant A users only use MySQL while tenant B users are limited to Active Directory and we want to do so based on the semantics of the credential passed. Simply put, if the credential id matches the syntax of <code class="highlighter-rouge">xyz@tenantA.org</code>, we would want CAS to use MySQL and if the credential matches <code class="highlighter-rouge">xyz@tenantB.org</code>, CAS would use Active Directory instead.</p>

<p>I am of course assuming, rather obviously, that tenants support username/password authentication modes. Fancier forms of authentication are left out for brevity. Let’s also assume that we know how to configure CAS to use MySQL and Active Directory as authentication sources. With that, the first question we might ask is: Can CAS be configured to use a specific authentication strategy based on the properties of the credential?</p>

<p>The answer is, yes.</p>

<p>Most authentication strategies in CAS are given a <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties-Common.html#authentication-credential-selection">predicate to examine the requested credential</a> for eligibility. This predicate is simply a fancy a condition whose outcome determines whether the authentication strategy/handler should proceed to operate on the credential.</p>

<p>So, we can design the following conditions for our MySQL and Active Directory authentication modes:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="err">cas.authn.jdbc.search[0]</span><span class="py">.credentialCriteria</span><span class="p">=</span><span class="s">.+@tenantA</span><span class="se">\.</span><span class="s">org</span>
<span class="err">...</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.credentialCriteria</span><span class="p">=</span><span class="s">.+@tenantB</span><span class="se">\.</span><span class="s">org</span>
<span class="err">...</span>
</code></pre></div></div>

<p>In the above settings, the <code class="highlighter-rouge">credentialCriteria</code> is a regular expression pattern that is tested against the credential identifier. A successful match indicates credential eligibility.</p>

<h1 id="attribute-retrieval">Attribute Retrieval</h1>

<p>Having configured authentication sources for each tenant, how could we retrieve attributes in much the same way?</p>

<p>A number of authentication strategies in CAS have the ability to fetch attributes from the same source in which the account was found. In our case above, we want <code class="highlighter-rouge">firstName</code> and <code class="highlighter-rouge">lastName</code> to be retrieved from MySQL and <code class="highlighter-rouge">cn</code> and <code class="highlighter-rouge">givenName</code> from Active Directory once the authentication attempt is successful. The requirements are translated as below:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="err">cas.authn.jdbc.search[0]</span><span class="py">.principalAttributeList</span><span class="p">=</span><span class="s">firstName,lastName</span>
<span class="err">...</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.principalAttributeList</span><span class="p">=</span><span class="s">cn,givenName</span>
<span class="err">...</span>
</code></pre></div></div>

<p>Simple, eh?</p>

<h1 id="attribute-release">Attribute Release</h1>

<p>In our quest to multi-tenancy, we need to design a strategy to release bundles of attributes to each tenant. One option is to simply register all applications with CAS and design attribute release policies for each. While reasonable, this approach might lead to some maintenance overhead, especially as you begin to design attribute release rules from a tenant perspective and as that number grows over time. To elaborate, let’s say all applications managed by tenant A should receive the <code class="highlighter-rouge">firstName</code> attribute but only a few privileged applications in the same group need access to <code class="highlighter-rouge">lastName</code>. Are we to duplicate the same attribute release policy rules for each service definition with <code class="highlighter-rouge">firstName</code> as the allowed attribute and only in special cases then make room for <code class="highlighter-rouge">lastName</code>? Not quite. What might be more desirable is if we had a way to <em>share policy rules</em> across tenants and definitions to centralize configuration and policy.</p>

<p>One option is to <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Policies.html#groovy-script">use a Groovy script</a> shared across members of a given tenant. For instance, our release policy includes something like this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"some-application-part-of-tenant-A"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Tenant A application"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="s2">"attributeReleasePolicy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.GroovyScriptAttributeReleasePolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"groovyScript"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"classpath:/tenantA-attr-release-policy.groovy"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>…and the shared script would have the following outline:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.*</span>

<span class="kt">def</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">currentAttributes</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">principal</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">service</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>You may also want to get even fancier by assigning <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Custom-Properties.html">arbitrary tags to each service definition</a> to further control different sorts of centralized policies in the script.</p>

<h1 id="themes">Themes</h1>

<p>Based on the <a href="https://apereo.github.io/cas/development/installation/User-Interface-Customization-Themes.html">CAS documentation for dynamic themes</a>,</p>

<blockquote>
  <p>CAS can also utilize a service’s associated theme to selectively choose which set of UI views will be used to generate the standard views. This is especially useful in cases where the set of pages for a theme that is targeted for a different type of audience are entirely different structurally that simply using a simple theme is not practical to augment the default views.</p>
</blockquote>

<p>Sounds exactly like what we might want to use for our tenants. In my example, I am simply going to customize the CAS login view fragment for each tenant and then assign the special theme identifier to all tenant A members. Let’s say I am going to call the theme identifier <code class="highlighter-rouge">tenantATheme</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"some-application-part-of-tenant-A"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Tenant A application"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="s2">"theme"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tenantATheme"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"attributeReleasePolicy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.GroovyScriptAttributeReleasePolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"groovyScript"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tenantATheme"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Then, I would create the theme directory which would contain the customized login view for tenant A members:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir <span class="nt">-p</span> src/main/resources/templates/tenantATheme
<span class="nb">cd </span>src/main/resources/templates/tenantATheme
touch casLoginView.html
</code></pre></div></div>

<p>My theme may also contain its own CSS and Javascript variants under a <code class="highlighter-rouge">src/main/resources/tenantATheme.properties</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">standard.custom.css.file</span><span class="p">=</span><span class="s">/themes/[theme_name]/css/cas.css</span>
<span class="py">cas.javascript.file</span><span class="p">=</span><span class="s">/themes/[theme_name]/js/cas.js</span>
<span class="py">admin.custom.css.file</span><span class="p">=</span><span class="s">/themes/[theme-name]/css/admin.css</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">casLoginView.html</code> found at <code class="highlighter-rouge">src/main/resources/templates/tenantATheme</code> will now always be used for applications that are members of tenant A and carry the assigned theme in their definition.</p>

<h1 id="summary">Summary</h1>

<p>I hope this review was of some help to you. As you have been reading, I can guess that you have come up with a number of missing bits and pieces that would satisfy your use cases more comprehensively with CAS. In a way, that is exactly what this tutorial intends to inspire. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/10/23/cas-multitenancy/</guid>
                <description>
                    
                    A short review of multitenancy feature variants and equivalents in Apereo CAS.
                    
                </description>
                <pubDate>Mon, 23 Oct 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>JWT Of All Things With CAS</title>
                <link>https://apereo.github.io/2017/10/17/cas-jwt-authn-with-duo/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>Apereo CAS has had built-in support for <a href="https://jwt.io/">JWTs</a> for some time now in a variety of different ways. Notions of JWT support really date back to CAS <code class="highlighter-rouge">3.5.x</code> with the work <a href="https://github.com/epierce/cas-server-extension-token">@epierce</a> did as a CAS extension to enable token authentication support. Since then, support for JWTs has significantly improved and grown over the years and continues to get better with an emerging number of use cases whose chief concern is improving performance and removing round-trip calls, among other things.</p>

<p>In this tutorial, I am going to briefly review various forms of JWT functionality in CAS. Specifically, the following topics will be reviewed:</p>

<ul>
  <li><a href="https://apereo.github.io/cas/development/installation/JWT-Authentication.html">JWT Authentication</a>: Allowing CAS to accept JWTs as credentials in non-interactive authentication modes mostly.</li>
  <li>JWTs with <a href="https://apereo.github.io/cas/development/installation/DuoSecurity-Authentication.html">Duo Security Multifactor Authentication</a>: Exploring an approach where a non-interactive authentication request may be routed to a multifactor authentication flow and back.</li>
  <li><a href="https://apereo.github.io/cas/development/installation/Configure-ServiceTicket-JWT.html">JWTs as Service Tickets</a>: Allowing CAS to transform service tickets issued for applications into JWTs.</li>
</ul>

<h1 id="environment">Environment</h1>

<ul>
  <li>Apereo CAS <code class="highlighter-rouge">5.2.0-SNAPSHOT</code></li>
  <li>curl <code class="highlighter-rouge">7.54.0</code></li>
</ul>

<p>…and last but not least, a functional vanilla CAS overlay. For this tutorial, I am using the <a href="https://github.com/apereo/cas-overlay-template">CAS Maven WAR Overlay</a> project.</p>

<h1 id="jwt-authentication">JWT Authentication</h1>

<p>CAS provides support for token-based authentication on top of JWTs, where an authentication request can be granted an SSO session based on a form of credentials that are JWTs. CAS expects a <code class="highlighter-rouge">token</code> parameter (or request header) to be passed along to the <code class="highlighter-rouge">/login</code> endpoint as the credential. The parameter value must of course be a JWT.</p>

<h2 id="let-there-be-jwt">Let There Be JWT</h2>

<p>To generate a JWT, I ended up using the <a href="https://apereo.github.io/cas/development/installation/Configuring-Commandline-Shell.html">CAS Command-line Shell</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
./build.sh cli <span class="nt">-sh</span>
</code></pre></div></div>

<p>This will allow you to enter the interactive shell, where you have documentation, tab-completion and history for all commands.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Welcome to CAS Command-line Shell. For assistance press or <span class="nb">type</span> <span class="s2">"help"</span> <span class="k">then </span>hit ENTER.
cas&gt;

cas&gt;generate-jwt <span class="nt">--subject</span> Misagh

<span class="o">====</span> Signing Secret <span class="o">====</span>
MY4Jpxr5VeZsJ...

<span class="o">====</span> Encryption Secret <span class="o">====</span>
MZCjxBbDFq9cHPdy...

Generating JWT <span class="k">for </span>subject <span class="o">[</span>Misagh] with signing key size <span class="o">[</span>256], signing algorithm <span class="o">[</span>HS256],
    encryption key size <span class="o">[</span>48], encryption method <span class="o">[</span>A192CBC-HS384] and encryption algorithm <span class="o">[</span>dir]

<span class="o">====</span> JWT <span class="o">====</span>
eyJjdHkiOiJKV1QiLCJ...
</code></pre></div></div>

<p>Hooray! We have a JWT.</p>

<p>There are a variety of other parameters such as encryption methods and signing algorithms you can choose from to generate the JWT. For the purposes of this tutorial, let’s keep things simple. Of course, you don’t have to use the CAS command-line shell. Any valid compliant JWT generator would do fine.</p>

<div class="alert alert-info">
  <strong>Don't Take Things Literally</strong><br />I am abbreviating the secrets and the generated JWT above. Do NOT copy paste these into your environment and configuration, thinking they might do the trick.
</div>

<h2 id="configure-application">Configure Application</h2>

<p>CAS <a href="https://apereo.github.io/cas/development/installation/JWT-Authentication.html">needs to be taught</a> the security properties of the JWT to unpack and validate it and produce the relevant authenticated session. For a given authentication request, CAS will try to find the matching record for the application in its registry that is capable of validating JWTs. If such a record is found and the request is in fact accompanied by JWT credentials, the credential is validated and the service ticket issued.</p>

<p>My CAS overlay is already equipped with the <a href="https://apereo.github.io/cas/development/installation/JWT-Authentication.html">relevant configuration module</a> and my application record using <a href="https://apereo.github.io/cas/development/installation/JSON-Service-Management.html">the JSON service registry</a> looks something like this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Example"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
  </span><span class="s2">"properties"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.HashMap"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"jwtSigningSecret"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceProperty"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"values"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"MY4Jpxr5VeZsJ..."</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"jwtEncryptionSecret"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceProperty"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"values"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"MZCjxBbDFq9cHPdy..."</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Now, we are ready to start sending requests.</p>

<h2 id="authenticate">Authenticate</h2>

<p>Using <code class="highlighter-rouge">curl</code> from a terminal, here is the authentication sequence:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-i</span> <span class="s2">"https://mmoayyed.example.net/cas/login?service=https://www.example.org&amp;token=eyJjdHkiOiJKV1QiLCJ..."</span>

HTTP/1.1 302
...
Location: https://www.example.org?ticket<span class="o">=</span>ST-1-zmEt1zfAuHv9vG6DogfBeH5ylmc-mmoayyed-4
...
</code></pre></div></div>

<p>A few things to note:</p>

<ul>
  <li>The <code class="highlighter-rouge">-i</code> option allows <code class="highlighter-rouge">curl</code> to output the response headers where <code class="highlighter-rouge">Location</code> in the above case contains the redirect URL with the issued service ticket.</li>
  <li>The entire url in the <code class="highlighter-rouge">curl</code> command in encased in double-quotes. This is necessary for <code class="highlighter-rouge">curl</code> to ensure the query string is entirely passed along to CAS.</li>
</ul>

<p>Of course, I can pass the JWT as a request header too:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-i</span> <span class="s2">"https://mmoayyed.example.net/cas/login?service=https://www.example.org"</span> <span class="nt">--header</span> <span class="s2">"token:eyJjdHkiOiJKV1QiLCJ..."</span>

HTTP/1.1 302
...
Location: https://www.example.org?ticket<span class="o">=</span>ST-1-qamgyzfAuHv9vG6DogfBeH5ylmc-mmoayyed-4
...
</code></pre></div></div>

<p>Grab the <code class="highlighter-rouge">ticket</code> from the <code class="highlighter-rouge">Location</code> header and proceed to validate it, as you would any regular service ticket.</p>

<h1 id="duo-security-mfa-with-jwts">Duo Security MFA With JWTs</h1>

<p>I want to be able to use my JWT to authenticate with CAS and get a service ticket issued to my application at <code class="highlighter-rouge">https://www.example.org</code>, but I also want the request to be verified via second-factor credentials and an MFA flow provided by Duo Security. How do I do that?</p>

<p><a href="https://apereo.github.io/cas/development/installation/DuoSecurity-Authentication.html">Duo Security integration support</a> of CAS is able to also support non-browser based multifactor authentication requests. In order to trigger this behavior, applications (i.e. <code class="highlighter-rouge">curl</code>, REST APIs, etc.) need to specify a special <code class="highlighter-rouge">Content-Type</code> to signal to CAS that the request is submitted from a non-web based environment. The multifactor authentication request is submitted to Duo Security in <code class="highlighter-rouge">auto</code> mode which effectively may translate into an out-of-band factor (push or phone) recommended by Duo as the best for the user’s devices.</p>

<div class="alert alert-warning">
  <strong>YMMV</strong><br />If you are using a different kind of multifactor authentication provider, you will need to verify whether it's able to support such behaviors.
</div>

<h2 id="configure-duo-security">Configure Duo Security</h2>

<p>My overlay is prepped with the <a href="https://apereo.github.io/cas/development/installation/DuoSecurity-Authentication.html">relevant configuration module</a> of course and settings that include integration keys, secret keys, etc.</p>

<h2 id="application-mfa-trigger">Application MFA Trigger</h2>

<p>I am also going to configure <a href="https://apereo.github.io/cas/development/installation/Configuring-Multifactor-Authentication-Triggers.html#applications">an application-based trigger</a> for <code class="highlighter-rouge">https://www.example.org</code> so that authentication requests are routed to the relevant multifactor authentication provider.</p>

<p>So my application record will take on the following form:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Example"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
  </span><span class="s2">"multifactorPolicy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceMultifactorPolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"multifactorAuthenticationProviders"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.LinkedHashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"mfa-duo"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="s2">"properties"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.HashMap"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"jwtSigningSecret"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceProperty"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"values"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"MY4Jpxr5VeZsJ..."</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"jwtEncryptionSecret"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceProperty"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"values"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"MZCjxBbDFq9cHPdy..."</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="authenticate-1">Authenticate</h2>

<p>Using <code class="highlighter-rouge">curl</code> again from a terminal, here is the authentication sequence:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-i</span> <span class="s2">"https://mmoayyed.example.net/cas/login?service=https://www.example.org"</span>
    <span class="nt">--header</span> <span class="s2">"token:eyJjdHkiOiJKV1QiLCJ..."</span> <span class="nt">--header</span> <span class="s2">"Content-Type: application/cas"</span>

HTTP/1.1 302
...
Location: https://www.example.org?ticket<span class="o">=</span>ST-1-gdfe1zfAuHv9vG6DogfBeH5ylmc-mmoayyed-4
...
</code></pre></div></div>

<p>Things work exactly the same as before, except that this time your device registered with Duo Security will receive a  notification where your approval will authorize CAS to establish a session and generate a ticket.</p>

<h1 id="jwt-service-tickets">JWT Service Tickets</h1>

<p>All operations so far have issued a regular service ticket back to the application that must be validated in a subsequent trip so the application can retrieve the authenticated user profile. In a different variation, it’s possible for the service ticket itself to <a href="https://apereo.github.io/cas/development/installation/Configure-ServiceTicket-JWT.html">take on the form of a JWT</a>. JWT-based service tickets are issued to applications based on the same semantics defined by the CAS Protocol. CAS having received an authentication request via its <code class="highlighter-rouge">/login</code> endpoint will conditionally issue back JWT service tickets to the application in form of a <code class="highlighter-rouge">ticket</code> parameter via the requested http method.</p>

<div class="alert alert-info">
  <strong>Let's REST</strong><br />In case you are using the CAS REST APIs, you should know that service tickets issued as part of REST API operations <a href="https://apereo.github.io/cas/development/protocol/REST-Protocol.html#jwt-service-tickets">may also be JWTs</a>.
</div>

<h2 id="configure-jwts">Configure JWTs</h2>

<p>In order for CAS to transform service tickets into JWTs, essentially we need to execute the reverse of the above configuration steps. We will need to ensure CAS is provided with relevant keys to generate JWTs and these keys are in turn used by the application to unpack the <em>JWTness</em> of generated service ticket.</p>

<p>The overlay also needs to be equipped with <a href="https://apereo.github.io/cas/development/installation/Configure-ServiceTicket-JWT.html">the relevant extension module</a> of course to allow for this functionality.</p>

<p>You may generate the required secrets manually per the above link. In this example, I left them undefined in my properties which forces CAS to generate a few on its own and warn me about them when it starts up:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>... - &lt;Secret key <span class="k">for </span>encryption is not defined <span class="k">for</span> <span class="o">[</span>Token/JWT Tickets]<span class="p">;</span> 
    CAS will attempt to auto-generate the encryption key&gt;
... - &lt;Generated encryption key <span class="o">[</span>...] of size <span class="o">[</span>256] <span class="k">for</span> <span class="o">[</span>Token/JWT Tickets]. 
    The generated key MUST be added to CAS settings under setting <span class="o">[</span>cas.authn.token.crypto.encryption.key].&gt;
... - &lt;Secret key <span class="k">for </span>signing is not defined <span class="k">for</span> <span class="o">[</span>Token/JWT Tickets]. 
    CAS will attempt to auto-generate the signing key&gt;
... - &lt;Generated signing key <span class="o">[</span>...] of size <span class="o">[</span>512] <span class="k">for</span> <span class="o">[</span>Token/JWT Tickets]. 
    The generated key MUST be added to CAS settings under setting <span class="o">[</span>cas.authn.token.crypto.signing.key].&gt;
</code></pre></div></div>

<p>Fine! Let’s proceed.</p>

<h2 id="configure-application-1">Configure Application</h2>

<p>JWTs as service tickets are issued on a per-application basis. This means that once CAS finds a matching record for the application in its registry, it will try to determine if the application requires JWTs as service tickets. So my application record will take on the following form:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.RegexRegisteredService"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"serviceId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.example.org"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Example"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
  </span><span class="s2">"multifactorPolicy"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceMultifactorPolicy"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"multifactorAuthenticationProviders"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.LinkedHashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"mfa-duo"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="s2">"properties"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"java.util.HashMap"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"jwtSigningSecret"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceProperty"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"values"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"MY4Jpxr5VeZsJ..."</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"jwtEncryptionSecret"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceProperty"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"values"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"MZCjxBbDFq9cHPdy..."</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"jwtAsResponse"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"@class"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apereo.cas.services.DefaultRegisteredServiceProperty"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"values"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"java.util.HashSet"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"true"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Now, we are ready to start sending requests.</p>

<h2 id="authenticate-2">Authenticate</h2>

<p>Using <code class="highlighter-rouge">curl</code> again from a terminal, here is the authentication sequence:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-i</span> <span class="s2">"https://mmoayyed.example.net/cas/login?service=https://www.example.org"</span> 
    <span class="nt">--header</span> <span class="s2">"token:eyJjdHkiOiJKV1QiLCJ..."</span> <span class="nt">--header</span> <span class="s2">"Content-Type: application/cas"</span>

HTTP/1.1 302
...
Location: https://www.example.org?ticket<span class="o">=</span>eyJhbGciOiJIUzUxMiJ9.WlhsS05tRllRV2xQYVVwRlVsV...
...
</code></pre></div></div>

<p>This works exactly the same as before, except that now the <code class="highlighter-rouge">ticket</code> parameter contains a JWT as a service ticket.</p>

<h1 id="summary">Summary</h1>

<p>I hope this tutorial was of some help to you. As you have been reading, I can guess that you have come up with a number of missing bits and pieces that would satisfy your JWT needs more comprehensively with CAS. In a way, that is exactly what this tutorial intends to inspire. Please feel free to <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">engage and contribute</a> as best as you can.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/10/17/cas-jwt-authn-with-duo/</guid>
                <description>
                    
                    A short tutorial on how to let Apereo CAS handle authentication events accompanied by JWTs.
                    
                </description>
                <pubDate>Tue, 17 Oct 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.2.0 RC4 Feature Release</title>
                <link>https://apereo.github.io/2017/10/16/520rc4-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on Github. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.1.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.1.0">May 27th 2017</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.2.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the <strong>fourth</strong> release candidate in the <code class="highlighter-rouge">5.2.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.2.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<p>You can read more about the previous release candidate <a href="https://apereo.github.io/2017/09/15/520rc3-release/">here</a>.</p>

<!-- TOC -->

<ul>
  <li><a href="#shake-well-before-use">Shake Well Before Use</a>
    <ul>
      <li><a href="#apache-maven">Apache Maven</a></li>
      <li><a href="#gradle">Gradle</a></li>
    </ul>
  </li>
  <li><a href="#minors">Minors</a></li>
  <li><a href="#test-coverage">Test Coverage</a></li>
  <li><a href="#attribute-resolution-dashboard">Attribute Resolution Dashboard</a></li>
  <li><a href="#management-web-application">Management Web Application</a>
    <ul>
      <li><a href="#authentication">Authentication</a></li>
      <li><a href="#contacts">Contacts</a></li>
      <li><a href="#attribute-value-filters">Attribute Value Filters</a></li>
      <li><a href="#user-interface">User Interface</a></li>
    </ul>
  </li>
  <li><a href="#redis-sentinel-support">Redis Sentinel Support</a></li>
  <li><a href="#jms-ticket-registry">JMS Ticket Registry</a></li>
  <li><a href="#oauth-user-profile-rendering">OAuth User Profile Rendering</a></li>
  <li><a href="#attribute-consent">Attribute Consent</a>
    <ul>
      <li><a href="#attribute-hashing">Attribute Hashing</a></li>
      <li><a href="#groovy-support">Groovy Support</a></li>
    </ul>
  </li>
  <li><a href="#service-expiration-policies">Service Expiration Policies</a></li>
  <li><a href="#acceptable-usage-policy">Acceptable Usage Policy</a>
    <ul>
      <li><a href="#mongodb-storage">MongoDb Storage</a></li>
    </ul>
  </li>
  <li><a href="#groovy-password-encoders">Groovy Password Encoders</a></li>
  <li><a href="#configuration-metadata-ui">Configuration Metadata UI</a></li>
  <li><a href="#metrics">Metrics</a>
    <ul>
      <li><a href="#storage">Storage</a></li>
    </ul>
  </li>
  <li><a href="#rest-service-registry">REST Service Registry</a></li>
  <li><a href="#library-upgrades">Library Upgrades</a></li>
  <li><a href="#get-involved">Get Involved</a></li>
  <li><a href="#das-ende">Das Ende</a></li>
</ul>

<!-- /TOC -->

<h2 id="shake-well-before-use">Shake Well Before Use</h2>

<p>We strongly recommend that you take advantage of the release candidates as they come out. Waiting for a <code class="highlighter-rouge">GA</code> release is only going to set you up for unpleasant surprises. A <code class="highlighter-rouge">GA</code> is simply <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">a tag and nothing more</a>. In order to start experimenting with release candidates, use the following strategies.</p>

<p>At any given time, you should be able to append <code class="highlighter-rouge">-SNAPSHOT</code> to the CAS version specified in order to take advantage of snapshot builds as changes are made and published.</p>

<h3 id="apache-maven">Apache Maven</h3>

<p>In the <code class="highlighter-rouge">pom.xml</code> of the overlay, adjust the following tag to match below:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;cas.version&gt;</span>5.2.0-RC4<span class="nt">&lt;/cas.version&gt;</span>
</code></pre></div></div>

<h3 id="gradle">Gradle</h3>

<p>In the <code class="highlighter-rouge">gradle.properties</code> of the overlay, adjust the following setting to match below:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.version</span><span class="p">=</span><span class="s">5.2.0-RC4</span>
</code></pre></div></div>

<h2 id="minors">Minors</h2>

<ol>
  <li>Thanks to <a href="https://github.com/CobraFlow">@CobraFlow</a>, delegated authentication using CAS is now able to correctly parse the CAS protocol setting.</li>
  <li>Cassandra authentication support is now able to correctly pick up the connection factory from the application context, and uses the correct setting for usernames when constructing authentication queries.</li>
  <li>Thanks to <a href="https://github.com/marwatk">@marwatk</a>, the password management webflow is now correctly registering an event to respond to <em>Password Must Change</em> scenarios.</li>
  <li>Documentation guidelines to explain how to <a href="https://apereo.github.io/cas/development/installation/Configuring-Deployment-System-Service.html">deploy CAS as an OS service</a>.</li>
  <li>Thanks to <a href="https://github.com/acdcu">@acvcu</a>, multifactor authentication bypass options now correctly take into account the principal attribute name.</li>
  <li>Small improvements in the way access strategy policies are enforced, specially when dealing attribute release policies that have semi complex mapping rules.</li>
  <li>Mapping attributes to be considered as CAS usernames now correctly takes into account multi-valued attributes.</li>
  <li>Thanks to <a href="https://github.com/marwatk">@marwatk</a>, validating security question answers are now made extensible to account for custom validation rules.</li>
  <li>Anchor fragments are now automatically preserved while redirecting back to the application with a ticket.</li>
  <li>MDUI elements for services found in the registry now correctly honor information and privacy URLs.</li>
  <li>Thanks to <a href="https://github.com/bhohler">@bhohler</a>, verification of credential’s password against Cloud Directory is now done properly.</li>
  <li>Signing certificates configured for <a href="https://apereo.github.io/cas/development/integration/ADFS-Integration.html">WSFED delegated authentication</a> are now made watchable.</li>
  <li>Thanks to <a href="https://github.com/bsandiford">@bsandiford</a>, memcached serialization via Kryo now takes into account a few more ticket expiration policies and other components. It is also set to issue a warning if and when unregistered classes in the kryo registry are found.</li>
  <li>CAS as a Spring Boot Application can now be deployed as <a href="https://apereo.github.io/cas/development/installation/Configuring-Servlet-Container.html">a fully-executable file</a>.</li>
  <li>Thanks to <a href="https://github.com/marwatk">@marwatk</a>, extensible error handling logic is now built into the password management to ensure password update operations can correctly report back failure events.</li>
  <li>Slight cleanup to ensure MongoDb and Redis ticket registries are able to take advantage of crypto operations.</li>
  <li>Thanks to <a href="https://github.com/sbearcsiro">@sbearcsiro</a>, servide registry auto-initialization from JSON services now is prevented from adding duplicate records.</li>
  <li>Minor improvements to the audit log message where super long messages are now abbreviated down to <code class="highlighter-rouge">125</code> characters.</li>
  <li>Thanks to <a href="https://github.com/marwatk">@marwatk</a>, ordering of security questions for password management is now preserved.</li>
  <li>Plenty of minor documentation improvements, such a few notes on how the <a href="https://apereo.github.io/cas/development/installation/AutoInitialization-Service-Management.html">service registry initialization</a> works and what one might be able to do in order to disable CAS’ embedded logging configuration when <a href="https://apereo.github.io/cas/development/installation/Configuring-Servlet-Container.html#external">using an external servlet container</a>.</li>
  <li>Thanks to <a href="https://github.com/NgSekLong">@NgSekLong</a>, the signature block type produced in a SAML2 response is now controllable via settings to encode signatures in <code class="highlighter-rouge">PEM</code> or <code class="highlighter-rouge">DER</code> mode.</li>
  <li>Thanks to <a href="https://github.com/frett">@frett</a>, the payload produced by proxy validation event is now able to remain CAS Protocol v3 compatibble by releasing attributes.</li>
  <li><a href="https://apereo.github.io/cas/development/installation/X509-Authentication.html">X509 principal resolution</a> is now able to support EDIPI defined as part of the certificate’s CN.</li>
  <li><a href="https://apereo.github.io/cas/development/installation/Trusted-Authentication.html">Remote Trusted authentication</a> is now able to use a custom request header to extract the authenticated username.</li>
  <li><a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">Delegated authentication</a> is now able to support <a href="www.keycloak.org/">Keycloak</a>.</li>
</ol>

<h2 id="test-coverage">Test Coverage</h2>

<p>CAS is now integrated with <a href="https://coveralls.io/github/apereo/cas">coveralls.io</a> to report back test coverage statistics. The propduced report will help to identify areas that need more attention in terms of QA and verification. As of this writing, CAS stands at 43% test coverage and that number will continue to grow in the coming months with the addition of test cases and fine-tuning of the reporting tool to skip and ignore relevant areas.</p>

<h2 id="attribute-resolution-dashboard">Attribute Resolution Dashboard</h2>

<p>The attribute resolution interface presented as part of CAS dashboard now allows for one to test authentication and observe the CAS payload that might be released to a registered application in the CAS service registry, indicating various protocols.</p>

<p><img src="https://user-images.githubusercontent.com/1205228/31140834-8b63f688-a882-11e7-9010-abe7ec37798a.png" alt="image" /></p>

<h2 id="management-web-application">Management Web Application</h2>

<h3 id="authentication">Authentication</h3>

<p>Authentication strategies for the CAS management web application have been improved to support a <a href="https://apereo.github.io/cas/development/installation/Installing-ServicesMgmt-Webapp.html">few more options</a>. Similarly, authorization rules are now allowed to support JSON/YAML backends.</p>

<h3 id="contacts">Contacts</h3>

<p>Thanks to <a href="https://github.com/tsschmidt">@tsschmidt</a>, the registered service definition model is now able to <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Contacts.html">support contacts</a>. Support for contacts is also made available in the management web application.</p>

<p><img src="https://user-images.githubusercontent.com/1205228/31142213-73581fc0-a886-11e7-9fed-61e7e89b1021.png" alt="image" /></p>

<h3 id="attribute-value-filters">Attribute Value Filters</h3>

<p>Thanks to <a href="https://github.com/tsschmidt">@tsschmidt</a>, attribute value filters are now also supported in the CAS management web application:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/31539488-8b8241d4-b015-11e7-8138-945917cb106b.png" alt="image" /></p>

<h3 id="user-interface">User Interface</h3>

<p>Thanks to <a href="https://github.com/tsschmidt">@tsschmidt</a>, UX continues to see improvements and minor bug fixes. Time and availability permitting, we are working to include workflow and wizard functionality into the interface.</p>

<h2 id="redis-sentinel-support">Redis Sentinel Support</h2>

<p>Redis Sentinel provides high availability for Redis. In practical terms this means that using Sentinel you can create a Redis deployment that resists without human intervention to certain kind of failures. Redis Sentinel also provides other collateral tasks such as monitoring, notifications and acts as a configuration provider for clients.</p>

<p>Thanks to <a href="https://github.com/ozayduman">@ozayduman</a>, components in CAS that integrate with Redis such the <a href="https://apereo.github.io/cas/development/installation/Redis-Ticket-Registry.html">Redis Ticket Registry</a> or the <a href="https://apereo.github.io/cas/development/installation/Redis-Service-Management.html">Redis Service Registry</a> are now extended to support Sentinel for better HA configuration.</p>

<h2 id="jms-ticket-registry">JMS Ticket Registry</h2>

<p>A new ticket registry implementation is now available which <a href="https://apereo.github.io/cas/development/installation/Messaging-JMS-Ticket-Registry.html">based on JMS</a> with support for a variety of messaging systems such as ActiveMQ, Artemis, etc.</p>

<h2 id="oauth-user-profile-rendering">OAuth User Profile Rendering</h2>

<p><a href="https://apereo.github.io/cas/development/installation/OAuth-OpenId-Authentication.html">Additional options</a> are now exposed that control the rendering of the OAuth user profile.</p>

<h2 id="attribute-consent">Attribute Consent</h2>

<h3 id="attribute-hashing">Attribute Hashing</h3>

<div class="alert alert-warning">
  <strong>Beware</strong><br />This may be a breaking change. 
  Consult <a href="https://apereo.github.io/cas/development/">the docs</a> to learn more.
</div>

<p><a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Consent.html">Attribute consent</a> functionality no longer applies a SHA-512 hashing function to attribute names and values. The consent decisions are now limited to signing and encryption only. With the one-way hash removed, CAS now presents the functionality underneath to decrypt records and present them back to the user in form of administrative dashboards and user interfaces, allowing users to revoke or modify a decision.</p>

<h3 id="groovy-support">Groovy Support</h3>

<p><a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Consent.html">Attribute consent</a> can now be managed via an externally-defined Groovy script for easier extensibility and customizations.</p>

<h2 id="service-expiration-policies">Service Expiration Policies</h2>

<p>Service definitions are now given <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Expiration-Policy.html">the ability to expire</a> on a designated date.</p>

<p>Thanks to <a href="https://github.com/tsschmidt">@tsschmidt</a>, the management web application also supports this capability too:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/31487273-020eeca0-af47-11e7-9a74-759d38659c0a.png" alt="image" /></p>

<h2 id="acceptable-usage-policy">Acceptable Usage Policy</h2>

<h3 id="mongodb-storage">MongoDb Storage</h3>

<p><a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-AUP.html">Acceptable Usage Policy</a> is now slightly improved to support MongoDb for a storage option.</p>

<h2 id="groovy-password-encoders">Groovy Password Encoders</h2>

<p>CAS password encoders are now allowed to be defined <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties-Common.html#password-encoding">as a Groovy script</a> to assist with designing custom encoding schemes.</p>

<h2 id="configuration-metadata-ui">Configuration Metadata UI</h2>

<p>Accessing <a href="https://apereo.github.io/cas/development/installation/Configuration-Metadata-Repository.html">CAS configuration metadata</a> is now possible via the CAS dashboards:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/30881885-1dc62358-a314-11e7-8ebc-f79c41891d88.png" alt="image" /></p>

<p>Most if not all CAS properties are annotated with <code class="highlighter-rouge">@RequiredProperty</code> and <code class="highlighter-rouge">@RequiredModule</code> which are then picked up by the metadata generation process and translated for REST APIs, etc.</p>

<h2 id="metrics">Metrics</h2>

<h3 id="storage">Storage</h3>

<p><a href="https://apereo.github.io/cas/development/installation/Configuring-Metrics.html">CAS metrics</a> may be routed to varying types of databases for storage and analytics.</p>

<h2 id="rest-service-registry">REST Service Registry</h2>

<p>Managing service definitions may also be carried out via a <a href="https://apereo.github.io/cas/development/installation/REST-Service-Management.html">REST implementation</a> of your choice.</p>

<h2 id="library-upgrades">Library Upgrades</h2>

<ul>
  <li>Spring Boot</li>
  <li>Spring Webflow</li>
  <li>Spring</li>
  <li>jQuery</li>
  <li>jQuery UI</li>
  <li>Gradle</li>
  <li>Hibernate</li>
  <li>Apache Tomcat</li>
  <li>Apache Http Client</li>
  <li>Spring Data</li>
  <li>Log4j</li>
  <li>Spring MongoDb</li>
  <li>Dropwizard Metrics</li>
  <li>Swagger</li>
  <li>Bootstrap Datepicker</li>
  <li>AspectJ</li>
  <li>MariaDb Driver</li>
  <li>Google Maps</li>
  <li>AWS Java SDK</li>
</ul>

<p>Additionally, Javascript linting process is internally updated to support ECMAScript 6.</p>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="das-ende">Das Ende</h2>

<p>Big thanks to all who participate in the development of this release to submit patches, report issues and suggest improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/10/16/520rc4-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.2.0 RC4 release.
                    
                </description>
                <pubDate>Mon, 16 Oct 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Extending CAS 5 Webflows</title>
                <link>https://apereo.github.io/2017/10/07/webflow-extcfg/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>Unlike previous versions, CAS 5 attempts to automate all required Spring Webflow changes on a per-module basis. This aligns well with the new <code class="highlighter-rouge">IDD</code> (Intention-Driven Development) model where all one should have to do is, declare the appropriate module in the build script…and viola. CAS will take care of the rest.</p>

<p>You may ask: Wait! What’s really happening? How can it accomplish everything that we had to apply manually before? Why am I being asked to do less work? What exactly do the CAS internals look like? Did machines finally take over? Most importantly, Turkey’s <a href="http://ind.pn/2dsJ0iV">tombili</a> died?!</p>

<p>Some answers follow.</p>

<h1 id="hakuna-matata">Hakuna Matata</h1>

<p>Stop worrying. Stop coding. You are no longer required to become a Spring Webflow ninja or Java champion overnight to apply a myriad of XML configuration snippets here and there to get something to work. That’s all taken care of for you. Sit back and relax.</p>

<p>More importantly, avoid making ad-hoc changes to the Webflow as much as possible. Consider how the change you have in mind might be more suitable as a direct contribution to CAS itself so you can just take advantage of its configuration; NOT its maintenance.</p>

<p>If you find something that is broken where the auto-configuration strategy fails to deliver as advertised, discuss that with the project community. Submit an issue and/or file a patch. Avoid one-off changes.</p>

<h1 id="the-flexibility-argument">The “Flexibility” Argument</h1>

<p>You may have been illusioned to think that the auto-configuration strategy is less powerful because much of the configuration is hidden away and you no longer have the flexibility to change anything and everything.</p>

<p>Consider:</p>

<ul>
  <li>Just because you had access to 20 configuration files, that did not mean that you could go about changing anything and everything. This claim is not a question of capability. It’s a question of sanity and rationale. Is there a reason the project should expose you to 20 files where in reality, you mostly should, nay, MUST care about just a few?</li>
  <li>Similarly, just because you now have access to only a few configuration files that does not mean your capabilities of modifying the software internals are now diminished and your freedom lost. The mechanics may have changed but not the underlying principals.</li>
</ul>

<p>In fact, you can do A LOT MORE.</p>

<h1 id="what-did-you-do">What Did You Do?</h1>

<p>So in the olden days, the following recipe was <em>more or less</em> what was done:</p>

<ol>
  <li>Write a Spring Webflow <code class="highlighter-rouge">Action</code> in Java that does X.</li>
  <li>Declare a Spring bean definition in <code class="highlighter-rouge">XML</code> that configures that action class.</li>
  <li>Modify the Spring Webflow configuration to point to that action at the right injection point.</li>
</ol>

<p>Wait. I may have missed a few steps. The recipe did also include:</p>

<ol>
  <li>A degree in software engineering and/or computer science may be needed.</li>
  <li>Learn Java</li>
  <li>Learn Spring; Convince yourself that this is really expected of you.</li>
  <li>Learn Spring Webflow; Convince yourself that this is really expected of you.</li>
  <li>Learn CAS APIs</li>
  <li>Learn CAS Spring Webflow</li>
</ol>

<p>What is also inconsistent with this strategy is that a perhaps-simple change spanned across multiple unfamiliar barriers. Even if you learned and mastered all the underlying technologies, you still needed to touch Java, Spring XML and Spring Webflow XML configuration to get something to work.</p>

<p>Is that verbosity the same thing as flexibility?</p>

<h1 id="so-now-what">So, Now What?</h1>

<p>Every CAS module that needs to dynamically augment the Spring Webflow routes simply takes on the following form:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomethingWebflowConfigurer</span> <span class="kd">extends</span> <span class="n">AbstractCasWebflowConfigurer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doInitialize</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">Flow</span> <span class="n">flow</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getLoginFlow</span><span class="o">();</span>
        <span class="c1">// Magic happens; Call 'super' to see what you have access to...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>CAS modules register their <code class="highlighter-rouge">WebflowConfigurer</code> instances in <code class="highlighter-rouge">@Configuration</code> classes:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span><span class="o">(</span><span class="s">"SomethingConfiguration"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomethingConfiguration</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"loginFlowRegistry"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">FlowDefinitionRegistry</span> <span class="n">loginFlowDefinitionRegistry</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">FlowBuilderServices</span> <span class="n">flowBuilderServices</span><span class="o">;</span>

    <span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"somethingWebflowConfigurer"</span><span class="o">)</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">CasWebflowConfigurer</span> <span class="nf">somethingWebflowConfigurer</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">SomethingWebflowConfigurer</span> <span class="n">w</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SomethingWebflowConfigurer</span><span class="o">();</span>
        <span class="n">w</span><span class="o">.</span><span class="na">setLoginFlowDefinitionRegistry</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">loginFlowDefinitionRegistry</span><span class="o">);</span>
        <span class="n">w</span><span class="o">.</span><span class="na">setFlowBuilderServices</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">flowBuilderServices</span><span class="o">);</span>
        <span class="o">...</span>
        <span class="k">return</span> <span class="n">w</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>When CAS comes up, it scans the context to find <code class="highlighter-rouge">@Configuration</code> classes and then will invoke each and every <code class="highlighter-rouge">WebflowConfigurer</code> to execute changes.</p>

<h1 id="what-about-you">What About You?</h1>

<p>CAS itself handles Spring Webflow changes related to its first-class features by default automatically. That strategy equally applies, should you need to write your own configurers if you absolutely need to.</p>

<h2 id="accidents-happen">Accidents Happen</h2>

<p>What if you have two <code class="highlighter-rouge">WebflowConfigurer</code>s who all decide to inject actions and state into the same Spring Webflow areas? What if multiple <code class="highlighter-rouge">WebflowConfigurer</code>s are competing to set themselves up as starting points of the CAS webflow? Who wins, who mourns?</p>

<p>Indeed, these are questions you ought to be thinking about as a <em>developer</em>. With power comes responsibility.</p>

<h1 id="summary">Summary</h1>

<p>Today:</p>

<ul>
  <li>Changes are all scoped to one technology, that is Java.</li>
  <li>You have the full power of Java to dynamically augment the Spring Webflow as you see fit.</li>
  <li>Your changes are all self-contained.</li>
  <li>Unlike XML, your changes are now part of the CAS APIs. If you upgrade and something breaks, you will be notified immediately at build time.</li>
</ul>

<p>That’s all.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/10/07/webflow-extcfg/</guid>
                <description>
                    
                    Learn and master extending CAS 5 Spring Webflow definitions.
                    
                </description>
                <pubDate>Sat, 07 Oct 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>August 2017 uPortal Slack summary</title>
                <link>https://apereo.github.io/2017/09/26/August-2017-uportal-slack-summary/</link>
                <content:encoded>
                    <![CDATA[
                    <p>In August 2017, 2 people participated substantially in conversation in the <a href="https://apereo.slack.com/messages/C0MNUQDN3/">slack.apereo.org #uportal channel</a>. (This is around one fifth as many participants as in June.)</p>

<ul>
  <li>Andrew Petro</li>
  <li>Christian Murphy</li>
</ul>

<p>Conversation highlights include:</p>

<ul>
  <li>Raising awareness of an initial pass at implementing GitLocalize for internationalizing uPortal documentation c.f. <a href="https://groups.google.com/a/apereo.org/d/topic/uportal-dev/Jh5emWPXnHA/discussion">uportal-dev@ thread</a>.</li>
  <li>Raising awareness of a branch freeze for the uPortal 4.3.2 release c.f. <a href="https://groups.google.com/a/apereo.org/d/msg/uportal-dev/ivPu41wyBJU/Cw0ANuOgBQAJ">uportal-dev@ thread</a>.</li>
  <li>Raising awareness of <a href="https://github.com/blog/2415-introducing-embedded-code-snippets">a new GitHub feature for embedding code snippets</a>.</li>
  <li>Raising awareness of a one liner for re-building and re-deploying skins in uPortal 5 ( <code class="highlighter-rouge">./gradlew tomcatStop overlays:uPortal:clean overlays:uPortal:tomcatDeploy tomcatStart</code> )</li>
  <li>Raising awareness of <a href="https://github.com/SethMichaelLarson/trytravis">a tool for trying whether WIP code will pass Travis CI</a> without needing to push.</li>
</ul>

<h2 id="on-slack">On Slack</h2>

<p>I have <a href="https://groups.google.com/a/apereo.org/d/msg/open/cbk9NLb43LQ/btRpD_09AwAJ">concerns about the openness properties of Slack as implemented by Apereo</a>.</p>

<ul>
  <li>You can’t access it anonymously.</li>
  <li>It’s not Google search indexed.</li>
  <li>Older messages aren’t available even if you log in.</li>
</ul>

<p>Summarizing the conversations here on <code class="highlighter-rouge">apereo.github.io</code> in this anonymously, publicly accessible, and Google-indexable context somewhat mitigates these problems. But not necessarily other problems that make <a href="https://dave.cheney.net/2017/04/11/why-slack-is-inappropriate-for-open-source-communications">email list communications preferable in open source projects</a>.</p>

<p>Arguably, all of the conversations held in the <code class="highlighter-rouge">#uportal</code> Slack channel could have been held via email on <code class="highlighter-rouge">uportal-dev@</code> or <code class="highlighter-rouge">uportal-user@</code> email lists additionally or instead. Some relevant email list threads are linked above.</p>

<p>For myself, I’m convinced that we just shouldn’t use Slack in the Apereo uPortal project. Use the email lists. Possibly look to implementing Discourse for better discussion forums / “email lists”.</p>

<h2 id="see-also">See also</h2>

<ul>
  <li><a href="https://apereo.github.io/2017/07/05/uportal-slack-summary/">June 2017 uPortal Slack summary</a> (~11 participants)</li>
  <li><a href="https://apereo.github.io/2017/08/02/july-2017-uportal-slack-summary/">July 2017 uPortal Slack summary</a> (~5 participants)</li>
</ul>

<p>-<a href="https://apetro.ghost.io">Andrew</a></p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/09/26/August-2017-uportal-slack-summary/</guid>
                <description>
                    
                    Summarizing Slack traffic about uPortal in August 2017.
                    
                </description>
                <pubDate>Tue, 26 Sep 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.1.x Load Tests by Lafayette College</title>
                <link>https://apereo.github.io/2017/09/25/cas51-perfresults-LafayetteCollege/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-info">
  <strong>Contributed Content</strong><br /><a href="mailto:waldbiec@lafayette.edu">Carl Waldbieser</a>, an active member of the CAS community, was kind enough to share this analysis.
</div>

<p>Lafayette College has an active user base of XXX and regularly records 78 CAS authentication events/minute on average with peaks of 220 events/minute. In preparation of deploying CAS <code class="highlighter-rouge">5.1.x</code>, locust.io was used to put CAS under load and soak and stress tests. Results indicate that CAS <code class="highlighter-rouge">5.1.x</code> deployed with reasonable hardware in a multi-node deployment architecture using nginx+ and hazelcast. Deployment architecture, testing scenarios and results are detailed in the rest of this blogs post.</p>

<p>In preparation for a service upgrade from CAS server version <code class="highlighter-rouge">5.0.x</code> to version <code class="highlighter-rouge">5.1.x</code>, load testing trials were conducted on the CAS stage environment. All trials were carried out against the same deployment architecture, with all nodes configured identically. The deployment architecture and nodes have not changed since the last load test was conducted around April 25, 2017.</p>

<h1 id="overview">Overview</h1>

<p>The deployment architecture itself consists of 3 virtual machine nodes:</p>

<ul>
  <li>cas3.stage.lafayette.edu</li>
  <li>cas4.stage.lafayette.edu</li>
  <li>cas5.stage.lafayette.edu</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/1205228/30987126-c3d0618e-a4a2-11e7-8817-122c954752d3.png" alt="architecture-500x538" /></p>

<p>Each node has 3.7 GiB real memory available to it and 2 CPUs.  The characteristics of the CPUs are as follows:</p>

<ul>
  <li>Architecture: x86_64</li>
  <li>CPU op-mode(s): 32-bit, 64-bit</li>
  <li>Byte Order: Little Endian</li>
  <li>CPU(s): 2</li>
  <li>On-line CPU(s) list: 0,1</li>
  <li>Thread(s) per core: 1</li>
  <li>Core(s) per socket: 2</li>
  <li>Socket(s): 1</li>
  <li>NUMA node(s): 1</li>
  <li>Vendor ID: GenuineIntel</li>
  <li>CPU family: 6</li>
  <li>Model: 42</li>
  <li>Model name: Intel Xeon E312xx (Sandy Bridge)</li>
  <li>Stepping: 1</li>
  <li>CPU MHz: 1899.999</li>
  <li>BogoMIPS: 3799.99</li>
  <li>Hypervisor vendor: KVM</li>
  <li>Virtualization type: full</li>
  <li>L1d cache: 32K</li>
  <li>L1i cache: 32K</li>
  <li>L2 cache: 4096K</li>
  <li>NUMA node0 CPU(s): 0,1</li>
</ul>

<p>The nodes are deployed behind an Nginx+ proxy in an active-active-active configuration.  The nodes share ticket information using encrypted hazelcast messages, so any application state is shared.</p>

<h1 id="the-test-swarm">The Test Swarm</h1>

<p>The testing framework used was <a href="http://locust.io/"><strong>locust.io</strong></a>, a Python based load testing framework.  The test suite deploys a fixed number of “locusts” against a web site.  The initial population ramps up with a configurable “hatch rate”.  In the tests, locusts were conceptually divided into 3 “lifetime” categories:</p>

<ul>
  <li>Short-lived locusts live approximately 60 seconds.</li>
  <li>Medium-lived locusts last for approximately 5 minutes.</li>
  <li>Long-lived locusts exist for approximately 2 hours.</li>
</ul>

<p>The category to which a given locust is assigned is randomly determined with a ratio of short : medium : long being 7:2:1.  Ideally, 70% of the population is short-lived, 20% is medium lived, and 10% is long-lived.</p>

<p>The lifetime of a locust determines how long it will retain and make use of a single web SSO session.  Short-lived locusts discard their sessions quickly.  Long-lived locusts hold on to them for considerable time.  All locusts continually request and validate service tickets throughout their lives every 5-15 seconds.</p>

<p>All locusts are only 25% likely to log out upon their deaths.  The CAS service must continue to track TGTs of locusts that have not logged out until the ticket expires, so this behavior can put pressure on the memory storage resources of the nodes.</p>

<p>Each locust uses credentials taken randomly from one of 9 test accounts.  Each locust has a 1% chance of entering an erroneous password for an account.  Locusts that fail to authenticate will die immediately.</p>

<p>When a locust dies, it is reborn immediately.  Its lifetime category remains the same, but its SSO session and all other random parameters are reset.</p>

<h1 id="sso-session-tracking">SSO Session Tracking</h1>

<p>SSO sessions are tracked by the TGTs they produce.  Any event that creates or destroys a TGT is logged, and these observations are plotted after the fact.  Because only 25% of locusts will explicitly end a session, many sessions will accumulate and consume storage in the CAS ticket registry until the session times out.  Using the probability of long, medium, and short lived locusts in the population, the actual number of active sessions at any time is estimated.  The charts produced should provide a reasonable estimate of how many simultaneous sessions are being managed by the CAS service at any given time.</p>

<table>
  <tr>
    <td>Trial</td>
    <td>01</td>
  </tr>
  <tr>
    <td>Date / duration</td>
    <td> 2017-09-05 from 09:30:00-04:00 until 16:44:00-04:00 (7h 14m)</td>
  </tr>
  <tr>
    <td>Number of locusts</td>
    <td>150</td>
  </tr>
  <tr>
    <td>Hatch rate</td>
    <td>10/s</td>
  </tr>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/30940336-9615a106-a3ed-11e7-99c9-4867207a1d1c.png" alt="image" /></p>

<p>The first trial produced authentication events at a rate of 1,800.11 events/minute.  The majority of these were service ticket creation and validation events.  The trial was concluded with no noticeable degradation in performance.</p>

<p><img src="https://user-images.githubusercontent.com/1205228/30940375-be2d7b6e-a3ed-11e7-834f-e36611196c67.png" alt="image" /></p>

<p>Net SSO sessions increased at a rate of 73.5 sessions per minute until the idle session timeout duration was reached.</p>

<table>
  <tr>
    <td>Trial</td>
    <td>02</td>
  </tr>
  <tr>
    <td>Date / duration</td>
    <td> 2017-09-20, 09:00:00-04:00 - 17:00:00-04:00 (8 hours)</td>
  </tr>
  <tr>
    <td>Number of locusts</td>
    <td>50</td>
  </tr>
  <tr>
    <td>Hatch rate</td>
    <td>10/s</td>
  </tr>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/30940409-dfedd104-a3ed-11e7-9dad-2a612d620a41.png" alt="image" /></p>

<p>An average of 600.46 events per second were handled by the CAS service under load during this trial.  There were no noticeable service disruptions.</p>

<p><img src="https://user-images.githubusercontent.com/1205228/30940430-f7330316-a3ed-11e7-978a-85e894ee1d82.png" alt="image" /></p>

<p>Net SSO sessions increased at a rate of 27.4 sessions per minute, until the session idle timeout duration was reached.</p>

<table>
  <tr>
    <td>Trial</td>
    <td>03</td>
  </tr>
  <tr>
    <td>Date / duration</td>
    <td> 2017-09-22, 09:05:00-04:00 - 09:33:00-04:00 (28 minutes)</td>
  </tr>
  <tr>
    <td>Number of locusts</td>
    <td>175</td>
  </tr>
  <tr>
    <td>Hatch rate</td>
    <td>10/s</td>
  </tr>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/30940483-1a8fbdae-a3ee-11e7-834c-c4195f541e1f.png" alt="image" /></p>

<p><img src="https://user-images.githubusercontent.com/1205228/30940514-2ff0260c-a3ee-11e7-8639-baa84dea93a3.png" alt="image" /></p>

<p>Net SSO sessions increased at a rate of 82.9 sessions per minute.</p>

<table>
  <tr>
    <td>Trial</td>
    <td>04</td>
  </tr>
  <tr>
    <td>Date / duration</td>
    <td>2017-09-22, 11:49:00-04:00 - 12:30:00-04:00 (41 minutes)</td>
  </tr>
  <tr>
    <td>Number of locusts</td>
    <td>200</td>
  </tr>
  <tr>
    <td>Hatch rate</td>
    <td>10/s</td>
  </tr>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/30940569-5556cda6-a3ee-11e7-8264-e8e74b0285ff.png" alt="image" /></p>

<p><img src="https://user-images.githubusercontent.com/1205228/30940590-6b3bdfee-a3ee-11e7-831b-9a94a8043b50.png" alt="image" /></p>

<p>Net SSO sessions increased at a rate of 93.0 sessions per minute.</p>

<table>
  <tr>
    <td>Trial</td>
    <td>05</td>
  </tr>
  <tr>
    <td>Date / duration</td>
    <td>2017-09-22, 15:10:00-04:00 - 15:47:00-04:00 (37 minutes)</td>
  </tr>
  <tr>
    <td>Number of locusts</td>
    <td>125</td>
  </tr>
  <tr>
    <td>Hatch rate</td>
    <td>10/s</td>
  </tr>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/30940615-8191ee50-a3ee-11e7-984b-7baadd2fc58d.png" alt="image" /></p>

<p><img src="https://user-images.githubusercontent.com/1205228/30940640-92a1097e-a3ee-11e7-985d-99655421f6aa.png" alt="image" /></p>

<p>Net SSO sessions increased at a rate of 64.0 sessions per minute.</p>

<table>
  <tr>
    <td>Trial</td>
    <td>06</td>
  </tr>
  <tr>
    <td>Date / duration</td>
    <td>2017-09-22, 16:35:00-04:00 - 16:50:00-04:00 (20 minutes)</td>
  </tr>
  <tr>
    <td>Number of locusts</td>
    <td>250</td>
  </tr>
  <tr>
    <td>Hatch rate</td>
    <td>10/s</td>
  </tr>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/30940675-ac953d28-a3ee-11e7-9864-46c3d1474961.png" alt="image" /></p>

<p><img src="https://user-images.githubusercontent.com/1205228/30940692-bf9d0266-a3ee-11e7-9ad0-ada30272a356.png" alt="image" /></p>

<p>Net SSO sessions increased at a rate of 124.6 sessions per minute.</p>

<h2 id="effect-of-number-of-locusts-on-mean-rate-of-events">Effect of Number of Locusts on Mean Rate of Events</h2>

<p>Observations from the previous trial and the current trial were plotted in order to give some sense of the influence the number of locusts in the test swarm would have on the mean rate of events processed by the service each minute.  The data suggest that for each additional locust added, there are approximately 12 more events generated per minute.</p>

<p><img src="https://user-images.githubusercontent.com/1205228/30955982-75549116-a442-11e7-8f9a-d250926302d4.png" alt="image" /></p>

<h2 id="observed-and-predicted-mean-rates">Observed and Predicted Mean Rates</h2>

<table>
  <tr>
    <td></td>
    <td>mean_rate</td>
    <td>mean_rate_observed</td>
  </tr>
  <tr>
    <td>locusts</td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td>0</td>
    <td>1.09</td>
    <td>N/A</td>
  </tr>
  <tr>
    <td>25</td>
    <td>300.51</td>
    <td>N/A</td>
  </tr>
  <tr>
    <td>50</td>
    <td>599.93</td>
    <td>600.46</td>
  </tr>
  <tr>
    <td>75</td>
    <td>899.35</td>
    <td>N/A</td>
  </tr>
  <tr>
    <td>100</td>
    <td>1,198.76</td>
    <td>N/A</td>
  </tr>
  <tr>
    <td>125</td>
    <td>1,498.18</td>
    <td>1,496.84</td>
  </tr>
  <tr>
    <td>150</td>
    <td>1,797.60</td>
    <td>1,800.11</td>
  </tr>
  <tr>
    <td>175</td>
    <td>2,097.02</td>
    <td>2,095.36</td>
  </tr>
  <tr>
    <td>200</td>
    <td>2,396.43</td>
    <td>2,395.12</td>
  </tr>
  <tr>
    <td>225</td>
    <td>2,695.85</td>
    <td>N/A</td>
  </tr>
  <tr>
    <td>250</td>
    <td>2,995.27</td>
    <td>2,996.53</td>
  </tr>
  <tr>
    <td>275</td>
    <td>3,294.69</td>
    <td>N/A</td>
  </tr>
  <tr>
    <td>300</td>
    <td>3,594.10</td>
    <td>N/A</td>
  </tr>
  <tr>
    <td>325</td>
    <td>3,893.52</td>
    <td>N/A</td>
  </tr>
  <tr>
    <td>350</td>
    <td>4,192.94</td>
    <td>N/A</td>
  </tr>
</table>

<h2 id="effect-of-number-of-locusts-on-increase-in-sso-sessions">Effect of Number of Locusts on Increase in SSO Sessions</h2>

<p>The rate at which net new SSO sessions are created during the period from the beginning of a trial until the discarded TGTs begin to timeout is also useful.  Since it seems to be a linear function of the number of locusts, this figure can be used to predict the number of SSO sessions that will be present were a trial to reach the session timeout mark.</p>

<p><img src="https://user-images.githubusercontent.com/1205228/30955909-366a6f0c-a442-11e7-93b7-844e57c343ad.png" alt="image" /></p>

<h1 id="conclusions">Conclusions</h1>

<p>Measurements 1 taken from the production CAS service from September 1-22, 2017 during normal business hours (9am to 5pm) have the following characteristics:</p>

<table>
  <tr>
    <td>mean</td>
    <td>78 events / minute</td>
  </tr>
  <tr>
    <td>median</td>
    <td>75 events / minute</td>
  </tr>
  <tr>
    <td>mode</td>
    <td>59 events / minute</td>
  </tr>
  <tr>
    <td>max</td>
    <td>220 events / minute</td>
  </tr>
  <tr>
    <td>min</td>
    <td>8 events / minute</td>
  </tr>
  <tr>
    <td>standard deviation</td>
    <td>28</td>
  </tr>
</table>

<p>The data suggests that the production CAS service is operating well under the maximum sustainable load, and should have plenty of capacity to spare for temporary spikes in utilization.</p>

<p><a href="mailto:waldbiec@lafayette.edu">Carl Waldbieser</a></p>

<p><sup>1</sup> Splunk query for Sep 1-21, 2017:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">index</span><span class="o">=</span><span class="n">auth_cas</span> <span class="p">(</span><span class="n">sourcetype</span><span class="o">=</span><span class="n">cas</span> <span class="k">OR</span> <span class="n">sourcetype</span><span class="o">=</span><span class="n">cas5</span><span class="p">)</span> <span class="n">action</span><span class="o">=*</span> <span class="n">date_hour</span> <span class="o">&gt;=</span> <span class="mi">9</span> <span class="n">date_hour</span> <span class="o">&lt;=</span> <span class="mi">16</span> <span class="n">date_wday</span><span class="o">!=</span><span class="nv">"saturday"</span> <span class="n">date_wday</span><span class="o">!=</span><span class="nv">"sunday"</span> <span class="o">|</span> <span class="n">bin</span> <span class="n">_time</span> <span class="n">span</span><span class="o">=</span><span class="mi">1</span><span class="n">m</span> <span class="o">|</span> <span class="n">stats</span> <span class="k">count</span> <span class="k">by</span> <span class="n">_time</span> <span class="o">|</span> <span class="n">stats</span> <span class="k">min</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">max</span><span class="p">(</span><span class="k">count</span><span class="p">)</span>  <span class="n">mean</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">mode</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="n">median</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="n">stdev</span><span class="p">(</span><span class="k">count</span><span class="p">)</span>
</code></pre></div></div>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/09/25/cas51-perfresults-LafayetteCollege/</guid>
                <description>
                    
                    Lafayette College shares the results of stress tests executed against a recent CAS 5.1.x deployment.
                    
                </description>
                <pubDate>Mon, 25 Sep 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.2.0 RC3 Feature Release</title>
                <link>https://apereo.github.io/2017/09/15/520rc3-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!-- 
<div class="alert alert-danger">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The contents of this blog are managed and hosted on Github. If you wish to update the contents of this post, please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.1.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.1.0">May 27th 2017</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.2.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the <em>third</em> release candidate in the <code class="highlighter-rouge">5.2.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.2.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<p>You can read more about the previous release candidate <a href="https://apereo.github.io/2017/08/04/520rc2-release/">here</a>.</p>

<!-- TOC -->

<ul>
  <li><a href="#shake-well-before-use">Shake Well Before Use</a>
    <ul>
      <li><a href="#apache-maven">Apache Maven</a></li>
      <li><a href="#gradle">Gradle</a></li>
    </ul>
  </li>
  <li><a href="#minors">Minors</a></li>
  <li><a href="#management-web-application-redesign">Management Web Application Redesign</a></li>
  <li><a href="#authentication-events">Authentication Events</a>
    <ul>
      <li><a href="#influxdb-storage">InfluxDb Storage</a></li>
    </ul>
  </li>
  <li><a href="#caffein-for-guava-caching">Caffein for Guava Caching</a></li>
  <li><a href="#saml2-service-provider-integrations">SAML2 Service Provider Integrations</a></li>
  <li><a href="#monitoring">Monitoring</a>
    <ul>
      <li><a href="#mongodb">MongoDb</a></li>
      <li><a href="#ehcache">Ehcache</a></li>
      <li><a href="#memcached">Memcached</a></li>
    </ul>
  </li>
  <li><a href="#authentication-interrupt">Authentication Interrupt</a></li>
  <li><a href="#jmeter-performance-testing">JMeter Performance Testing</a></li>
  <li><a href="#attribute-consent">Attribute Consent</a>
    <ul>
      <li><a href="#ldap-storage">LDAP Storage</a></li>
      <li><a href="#policy-per-service">Policy Per Service</a></li>
      <li><a href="#mongodb-storage">MongoDb Storage</a></li>
      <li><a href="#schema-change">Schema Change</a></li>
    </ul>
  </li>
  <li><a href="#time-based-multifactor-authentication-trigger">Time-based Multifactor Authentication Trigger</a></li>
  <li><a href="#protocol-attributes-release-per-service">Protocol Attributes Release per Service</a></li>
  <li><a href="#oauth--openid-connect">OAuth &amp; OpenID Connect</a>
    <ul>
      <li><a href="#authorized-grantresponse-types">Authorized Grant/Response Types</a></li>
      <li><a href="#token-revocation">Token Revocation</a></li>
      <li><a href="#pairwise-subject-identifiers">Pairwise Subject Identifiers</a></li>
    </ul>
  </li>
  <li><a href="#unique-principal-authentication-policy">Unique Principal Authentication Policy</a></li>
  <li><a href="#mongodb-configuration">MongoDb Configuration</a></li>
  <li><a href="#surrogate-authentication">Surrogate Authentication</a></li>
  <li><a href="#fido-u2f-mfa">FIDO U2F MFA</a>
    <ul>
      <li><a href="#mongodb-storage-1">MongoDb Storage</a></li>
    </ul>
  </li>
  <li><a href="#audit-storage">Audit Storage</a></li>
  <li><a href="#acceptable-usage-policy">Acceptable Usage Policy</a></li>
  <li><a href="#memcached-ticket-registry">Memcached Ticket Registry</a>
    <ul>
      <li><a href="#performance">Performance</a></li>
      <li><a href="#connection-pooling">Connection Pooling</a></li>
    </ul>
  </li>
  <li><a href="#redis-service-registry">Redis Service Registry</a></li>
  <li><a href="#saml2-improvements">SAML2 Improvements</a>
    <ul>
      <li><a href="#saml2-artifact-resolution">SAML2 Artifact Resolution</a></li>
      <li><a href="#saml2-attribute-queries">SAML2 Attribute Queries</a></li>
      <li><a href="#saml2-post-simplesign">SAML2 POST SimpleSign</a></li>
    </ul>
  </li>
  <li><a href="#library-upgrades">Library Upgrades</a></li>
  <li><a href="#get-involved">Get Involved</a></li>
  <li><a href="#das-ende">Das Ende</a></li>
</ul>

<!-- /TOC -->

<h2 id="shake-well-before-use">Shake Well Before Use</h2>

<p>We strongly recommend that you take advantage of the release candidates as they come out. Waiting for a <code class="highlighter-rouge">GA</code> release is only going to set you up for unpleasant surprises. A <code class="highlighter-rouge">GA</code> is simply <a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">a tag and nothing more</a>. In order to start experimenting with release candidates, use the following strategies.</p>

<p>At any given time, you should be able to append <code class="highlighter-rouge">-SNAPSHOT</code> to the CAS version specified in order to take advantage of snapshot builds as changes are made and published.</p>

<h3 id="apache-maven">Apache Maven</h3>

<p>In the <code class="highlighter-rouge">pom.xml</code> of the overlay, adjust the following tag to match below:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;cas.version&gt;</span>5.2.0-RC3<span class="nt">&lt;/cas.version&gt;</span>
</code></pre></div></div>

<h3 id="gradle">Gradle</h3>

<p>In the <code class="highlighter-rouge">gradle.properties</code> of the overlay, adjust the following tag to match below:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.version</span><span class="p">=</span><span class="s">5.2.0-RC3</span>
</code></pre></div></div>

<h2 id="minors">Minors</h2>

<ul>
  <li>MongoDb authentication is improved to honor the MongoDb connection pool and threads which monitor that pool.</li>
  <li>The default port for the management web application when run in embedded mode is now switched to <code class="highlighter-rouge">8444</code> to avoid conflicts with the main CAS web application server when both are run in the same environment.</li>
  <li>Thanks to <a href="https://github.com/karlbanke">@karlbanke</a>, MongoDb functionality gains a few new additional settings that control ssl, replicas, etc.</li>
  <li>The default ability of defining Spring beans in XML inside the management web application has been removed.</li>
  <li>Thanks to <a href="https://github.com/tsschmidt">@tsschmidt</a>, the <code class="highlighter-rouge">/status</code> endpoint is now changed to run synchronous blocking mode to avoid side effects.</li>
  <li>The default ability of defining Spring beans in XML/Groovy inside the CAS web application has been removed.</li>
  <li>The management web application is now able to advertise readiness in logs via ascii art.</li>
  <li>Thanks to <a href="https://github.com/scalding">@scalding</a>, generating persistent ids in a Shibboleth-friendly way now correctly takes into account the salt and more.</li>
  <li>Thanks to <a href="https://github.com/robertoschwald">@robertoschwald</a>, generating primary keys for hibernate schemas is improved to take on a more <code class="highlighter-rouge">native</code> approach with some caveats documented that affect MySQL while running in a Galera cluster.</li>
  <li>Thanks to <a href="https://github.com/tduehr">@tduehr</a>, generating random secure strings falls back to a more performant though ever-so-slightly less secure strategy and algorithm until Java 9 is released.</li>
  <li>The multifactor trusted device functionality for Google Authenticator and Swivel now correctly registers the relevant MFA flow into the CAS webflow engine at runtime.</li>
  <li>Thanks to <a href="https://github.com/arbner">@arbner</a>, SAML MDUI functionality is now able to parse fields based on localized values correctly.</li>
  <li>Thanks to <a href="https://github.com/arbner">@arbner</a>, consent functionality is now able to recognize the relevant service when used in SAML IdP mode.</li>
  <li>Thanks to <a href="https://github.com/pdrados">@pdrados</a>, the attribute name carrying the principal DN as part of LDAP authentication is now set to a static fixed name to avoid attribute encoding issues and easier release policies.</li>
  <li>A number of small readjustments to schemas that deal with storing trusted device records in databases, in cases where a number of field names clashes with reserved database keywords.</li>
  <li>Thanks to <a href="https://github.com/SRieckhoff">@SRieckhoff</a>, a possible NPE with SPNEGO authentication is now prevented.</li>
  <li>SAML1 validation response is now updated in the documentation to ensure it matches the structure produced by CAS.</li>
  <li>Thanks to <a href="https://github.com/tduehr">@tduehr</a>, Apache Ignite support is given the ability to run in client mode.</li>
  <li>Thanks to <a href="https://github.com/kingjared">@kingjared</a>, generating SAML1 assertions gains an <code class="highlighter-rouge">issueLength</code> property to set the interval between the <code class="highlighter-rouge">NotBefore</code> and <code class="highlighter-rouge">NotOnOrAfter</code> timestamps.</li>
  <li>The JSON rendering performance of the CAS validation payload is significantly improved.</li>
</ul>

<h2 id="management-web-application-redesign">Management Web Application Redesign</h2>

<p>Huge thanks to <a href="https://github.com/tsschmidt">@tsschmidt</a>, the CAS management web application is given an entirely new facelift and redesign using Material UI and Angular 4 based on Typescript. Aside from the fantastic new looks, the application is now able to support and handle most if not all of the configuration knobs and tweaks one can apply to a given service definition. This is a huge milestone allowing for a more solid foundation to start building much fancier integrations and features, such as auto-expiring services, approval workflows and more.</p>

<p>Here are a few sample screenshots:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/30121747-b9349c62-9341-11e7-8c86-58dcc0d3bffc.png" alt="image" />
<img src="https://user-images.githubusercontent.com/1205228/30121768-cb9abd3c-9341-11e7-8b23-0ad4e60bb6e9.png" alt="image" />
<img src="https://user-images.githubusercontent.com/1205228/30121784-dccada38-9341-11e7-8a41-71b835b9c860.png" alt="image" />
<img src="https://user-images.githubusercontent.com/1205228/30121802-e89c07f6-9341-11e7-85c4-7a3fb77ebdfb.png" alt="image" />
<img src="https://user-images.githubusercontent.com/1205228/30121827-f67a42e8-9341-11e7-9326-c87faf4e2c73.png" alt="image" />
<img src="https://user-images.githubusercontent.com/1205228/30121851-0337134e-9342-11e7-8059-14f1f8d42195.png" alt="image" /></p>

<h2 id="authentication-events">Authentication Events</h2>

<h3 id="influxdb-storage">InfluxDb Storage</h3>

<p><a href="https://apereo.github.io/cas/development/installation/Configuring-Authentication-Events.html">CAS authentication events</a> now gain the ability to use InfluxDb for storage.</p>

<h2 id="caffein-for-guava-caching">Caffein for Guava Caching</h2>

<p>Most if not all internal caching strategies and policies have switched from using the Guava library to Caffein. This is for the most part an invisible change, yet the swich allows CAS to dictate more granular expiration policies for caches that apply to each individual entry in the cache, rather than the cache itself as a whole.</p>

<h2 id="saml2-service-provider-integrations">SAML2 Service Provider Integrations</h2>

<p>A number of new <a href="https://apereo.github.io/cas/development/integration/Configuring-SAML-SP-Integrations.html">SAML2 service provider integrations</a> are added to settings that include New Relic, Egnyte and more.</p>

<h2 id="monitoring">Monitoring</h2>

<h3 id="mongodb">MongoDb</h3>

<p>A <a href="https://apereo.github.io/cas/development/installation/Configuring-Monitoring.html">new monitor</a> is now included that is able to report back status and statistics on a MongoDb instance.</p>

<h3 id="ehcache">Ehcache</h3>

<p>The Ehcache monitor is now improved to ensure it can work correctly with its ticket registry, taking into account caches created dynamically by the ticket catalog.</p>

<h3 id="memcached">Memcached</h3>

<p>The configuration of the memcached monitor is now moved into a separate block in order to leverage and provide support for connection pooling.</p>

<h2 id="authentication-interrupt">Authentication Interrupt</h2>

<p>CAS has the ability to pause and interrupt the authentication flow to reach out to external services and resources, querying for status and setings that would then dictate how CAS should manage and control the SSO session. Interrupt services are able to present notification messages to the user, provide options for redirects to external services, etc. A common use case of this functionality deals with presenting a bulletin board during the authentication flow to present messages and announcements to select users and then optionally require that audience to complete a certain task before CAS is able to honor the authentication request and establish a session.</p>

<p><a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-Interrupt.html">See this guide</a> for more info.</p>

<h2 id="jmeter-performance-testing">JMeter Performance Testing</h2>

<p>Thanks to <a href="https://github.com/astohn">@astohn</a>, JMeter scripts for performance and stress testing CAS are <a href="https://apereo.github.io/cas/development/planning/High-Availability-Performance-Testing.html#jmeter">now available</a>.</p>

<h2 id="attribute-consent">Attribute Consent</h2>

<h3 id="ldap-storage">LDAP Storage</h3>

<p>Thanks to <a href="https://github.com/arbner">@arbner</a>, attribute consent gains a new storage option to save decisions in LDAP. See <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Consent.html#ldap">this guide</a> for more info.</p>

<h3 id="policy-per-service">Policy Per Service</h3>

<p>Handling attribute consent now takes on a more wholesome API approach where there exists a <code class="highlighter-rouge">consentPolicy</code> that can dictate how attribute are selected and qualified for consent. See <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Consent.html">this guide</a> for more info.</p>

<h3 id="mongodb-storage">MongoDb Storage</h3>

<p>A new storage option is now added to include support for MongoDb. See <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Consent.html">this guide</a> for more info.</p>

<h3 id="schema-change">Schema Change</h3>

<div class="alert alert-warning">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Beware</strong><br />This may be a breaking change.
  Consult <a href="https://apereo.github.io/cas/development/">the docs</a> to learn more.
</div>

<p>The structure of a consent decision is changed to rename the field <code class="highlighter-rouge">date</code> to <code class="highlighter-rouge">createdDate</code>, in to avoid collisions when the storage option is one of JDBC where <code class="highlighter-rouge">date</code> is considered a reserved keyword. You may need to readjust the schema manually in order to have CAS recognize existing records.</p>

<h2 id="time-based-multifactor-authentication-trigger">Time-based Multifactor Authentication Trigger</h2>

<p>Adaptive authentication can also be configured to trigger multifactor authentication based on specific days and times.</p>

<p>See <a href="https://apereo.github.io/cas/development/installation/Configuring-Adaptive-Authentication.html">this guide</a> for more info.</p>

<h2 id="protocol-attributes-release-per-service">Protocol Attributes Release per Service</h2>

<p>Attribute release policies gain a small setting to control whether the application is authorized and allowed to receive authentication/protocol attributes. <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Policies.html">See this guide</a> for more info.</p>

<h2 id="oauth--openid-connect">OAuth &amp; OpenID Connect</h2>

<h3 id="authorized-grantresponse-types">Authorized Grant/Response Types</h3>

<p><a href="https://apereo.github.io/cas/development/installation/OAuth-OpenId-Authentication.html#register-clients">OAuth</a> and <a href="https://apereo.github.io/cas/development/installation/OIDC-Authentication.html#register-clients">OpenID Connect</a> service definitions now get to specify the list of supported and authorized response and grant types. Note that for the time being, the absence of authorized response and grant types in the configration simply means the service is allowed to accept everything though this may change in the future.</p>

<p>Additionally, some foundational work is done to allow for parsing of requested scopes so they can later be mapped to attribute and claim release policies.</p>

<h3 id="token-revocation">Token Revocation</h3>

<p>Support for revoking OpenID Connect access/refresh tokens is now included in this release.</p>

<h3 id="pairwise-subject-identifiers">Pairwise Subject Identifiers</h3>

<p>OpenID Connect support in CAS now presents the ability to support different subject types. This specifically includes support for <code class="highlighter-rouge">pairwise</code> subject id generation. <a href="https://apereo.github.io/cas/development/installation/OIDC-Authentication.html">See this guide</a> for more info.</p>

<h2 id="unique-principal-authentication-policy">Unique Principal Authentication Policy</h2>

<p>An <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#authentication-policy">additional authentication policy</a> is now provided that can prevent an authentication event, if the user has already logged on and has a session with CAS.</p>

<h2 id="mongodb-configuration">MongoDb Configuration</h2>

<div class="alert alert-warning">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Beware</strong><br />This may be a breaking change.
  Consult <a href="https://apereo.github.io/cas/development/">the docs</a> to learn more.
</div>

<p>In refactoring a number of configuration classes that deal with MongoDb settings, the <a href="https://apereo.github.io/cas/development/installation/MongoDb-Service-Management.html">MongoDb service registry</a> is changed slightly to use a <code class="highlighter-rouge">collection</code> property rather than <code class="highlighter-rouge">collectionName</code> in order to keep things consistent across all settings. Similarly, a number of property placeholders have changed from <code class="highlighter-rouge">mongodb</code> to simply just <code class="highlighter-rouge">mongo</code> in order to again ensure a consistent naming strategy is used everywhere.</p>

<h2 id="surrogate-authentication">Surrogate Authentication</h2>

<div class="alert alert-warning">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Beware</strong><br />This may be a breaking change.
  Consult <a href="https://apereo.github.io/cas/development/">the docs</a> to learn more.
</div>

<p>Surrogate authentication (Impersonation) gains the ability to dictate an expiration policy assigned to a surrogate session. Additionally, surrogate account storage and querying can now be done via a REST resource as well. Access strategies for impersonation are also improved to allow per-service authorization rules.</p>

<p>Note that the baseline module to include in the overlay has changed in this release candidate to clearly separate core and webflow functionality. <a href="https://apereo.github.io/cas/development/installation/Surrogate-Authentication.html">Consult this guide</a> for more info.</p>

<h2 id="fido-u2f-mfa">FIDO U2F MFA</h2>

<h3 id="mongodb-storage-1">MongoDb Storage</h3>

<p>Device registration records for <a href="https://apereo.github.io/cas/development/installation/FIDO-U2F-Authentication.html#registration">FIDO U2F</a> may now be saved inside a MongoDb instance.</p>

<h2 id="audit-storage">Audit Storage</h2>

<p><a href="https://apereo.github.io/cas/development/installation/Audits.html">Audit logs</a> are now given the ability to store audit records inside a MongoDb database.</p>

<h2 id="acceptable-usage-policy">Acceptable Usage Policy</h2>

<div class="alert alert-warning">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Beware</strong><br />This may be a breaking change.
  Consult <a href="https://apereo.github.io/cas/development/">the docs</a> to learn more.
</div>

<p><a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-AUP.html">AUP support</a> gains the ability store decisions via JDBC and REST. Note that the baseline module to include in the overlay has changed in this release candidate to clearly separate core and webflow functionality.</p>

<h2 id="memcached-ticket-registry">Memcached Ticket Registry</h2>

<h3 id="performance">Performance</h3>

<p>The registry has long carried the behavior to execute blocking ticket operations. In this release candidate, the registry switches to a more asynchronous model to gain maximum performance.</p>

<h3 id="connection-pooling">Connection Pooling</h3>

<p>Memcached client instances are now pooled and during ticket registry operations are borrowed from and then returned to the pool in order to ensure maximum performance.</p>

<h2 id="redis-service-registry">Redis Service Registry</h2>

<p>A new service registry implementation based on <a href="https://apereo.github.io/cas/development/installation/Redis-Service-Management.html">Redis</a> is now available.</p>

<h2 id="saml2-improvements">SAML2 Improvements</h2>

<div class="alert alert-info">
  <strong>Federation Interoperability Profile</strong><br />
  The CAS project strives to conform to the <a href="https://kantarainitiative.github.io/SAMLprofiles/fedinterop.html">SAML V2.0 Implementation Profile for Federation Interoperability</a>. An evaluation of the requirements against the current CAS release is available <a href="https://docs.google.com/spreadsheets/d/1NYN5n6AaNxz0UxwkzIDuXMYL1JUKNZZlSzLZEDUw4Aw/edit?usp=sharing">here</a>. It is <b>RECOMMENDED</b> that you view, evaluate and comment on functionality that is currently either absent or marked questionable where verification is needed.
</div>

<p>SAML2 capabilities of CAS in this release provide support for the following:</p>

<ul>
  <li>Metadata caching can be controlled via the <code class="highlighter-rouge">validUntil</code> element in the entity metadata.</li>
  <li>A <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html#entity-attributes-filter">new attribute release filter</a> is now available based on metadata entity attributes.</li>
  <li>A <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html##requested-attributes-filter">new attribute release filter</a> is now available to release attributes based on requested attributes specified in the SP metadata.</li>
  <li>All signing operations are now able to consult metadata in order to resolve signing keys and iterate through all to find a successful matching candidate.</li>
</ul>

<h3 id="saml2-artifact-resolution">SAML2 Artifact Resolution</h3>

<p>SAML2 capabilities of CAS in this release add support for the Artifact Resolution profile.
See <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">this guide</a> for more info.</p>

<h3 id="saml2-attribute-queries">SAML2 Attribute Queries</h3>

<p>SAML2 capabilities of CAS in this release add support for the Attribute Query profile.
See <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">this guide</a> for more info.</p>

<h3 id="saml2-post-simplesign">SAML2 POST SimpleSign</h3>

<p>SAML2 capabilities of CAS in this release add support for the POST SimpleSign profile.
See <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">this guide</a> for more info.</p>

<h2 id="library-upgrades">Library Upgrades</h2>

<ul>
  <li>Spring Shell</li>
  <li>Spring Cloud Sleuth</li>
  <li>Apache Fediz</li>
  <li>Apache Fortress</li>
  <li>Spring Boot Admin</li>
  <li>Hibernate Validator</li>
  <li>MongoDb Driver</li>
  <li>Guava</li>
  <li>Caffein</li>
  <li>Amazon SDK</li>
  <li>Apache Tomcat</li>
  <li>Google Maps</li>
  <li>Twillio</li>
  <li>Kryo</li>
  <li>PostgreSQL</li>
  <li>MariaDb Driver</li>
  <li>Jose4J</li>
  <li>Apache Ignite</li>
  <li>Couchbase Driver</li>
  <li>Thymeleaf</li>
  <li>Infinispan</li>
  <li>Dropwizard Metrics</li>
</ul>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="das-ende">Das Ende</h2>

<p>A big hearty thanks to all who participate in the development of this release to submit patches, report issues and suggest improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/09/15/520rc3-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.2.0 RC3 release.
                    
                </description>
                <pubDate>Fri, 15 Sep 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Do State The Obvious</title>
                <link>https://apereo.github.io/2017/09/13/efficient-marketing-intech/</link>
                <content:encoded>
                    <![CDATA[
                    <p><img src="http://assets.amuniversal.com/2d9dac40554801363c91005056a9545d" alt="" /></p>

<p>If you are into open source and a bit of a neophiliac when it comes to discovering new software, chances are you have read something akin to the following statements etched proudly at the top of some project’s README on GitHub:</p>

<blockquote>
  <p>Yo! X helps you write applications that behave consistently, run in different environments, and are easy to test. It is fast, simple, reliable with zero-overhead production readiness and nada ceremony.</p>
</blockquote>

<p>You know why?</p>

<p>Because sometimes people wake up in the morning and ask themselves: “What shall I do today? Oh, I know! I shall design a framework that forces applications to behave terribly inconsistent and of course, they must all run in the same exact environment down to the kilobyte level. Not only the application must be crap to test but it must be slow, Lost-The-TV-Show-level convoluted with so much overhead that once you’re done with production, you will yourself wholeheartedly finance a “Thank the Gods for we are forever done with this junk” ceremony.</p>

<p>Yes. Yes. That happens, which is why projects need to explicitly state the obvious opposite.</p>

<p>Seriously[?],</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/09/13/efficient-marketing-intech/</guid>
                <description>
                    
                    A short and sweet reminder and explanation of how marketing in tech works.
                    
                </description>
                <pubDate>Wed, 13 Sep 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Stop Writing Code</title>
                <link>https://apereo.github.io/2017/09/10/stop-writing-code/</link>
                <content:encoded>
                    <![CDATA[
                    <p>As a fellow somewhat active in the technology space and that of open-source identity and access management, a reasonable portion of my time throughout the week is loaned to conference calls reviewing and discussing the viability of software upgrades and feature deployments. Much of this is spent on reviewing what already exists, analyzing any and all available documentation at luck’s behest and finally enumerating approaches to the ultimate upgrade goal. Take note that in the majority of these conversations, the underlying motivation first and foremost is to fall back to stock functionality and try-remove most if not all of the existing <em>local</em> customizations for which at one point significant time and investment was made.</p>

<p>“Why?” That is an excellent question. This post intends to provide a local and customized answer.</p>

<h1 id="the-trap">The Trap</h1>

<p>Amongst many other factors, a significant and common motivation for one to adopt and deploy open-source software is to avoid vendor lock-in and feel empowered by a permitting license to tailor the packaging to one’s needs. Indeed, the source is open and you are for the most part allowed and encouraged to ride the freedom train and turn the package inside out where needed. As time marches on with more applications on-boarded and newer systems integrated, your deployment would be bombarded with all sorts of new and unfamiliar requirements whose successful delivery at times would undoubtedly require writing code.</p>

<p>Take a deep breath and pause when you get to this stage, for there be dragons here.</p>

<h1 id="customizations">Customizations</h1>

<p>Let’s get the obvious out of the way; not all customizations are “evil”. In my experience, the opposite is usually far truer. In fact, most open-source projects likely have a documented set of guidelines where a certain batch of changes in particular areas of the system is recommended or even expected. In such scenarios, the <em>internals</em> of the deployment are treated very much like a black-box and the software is considered <strong>more like a product rather than a platform</strong>. Common examples include providing one’s  own strategy for authentication, content, user interface and logging where you are expected to make the system uniquely yours. So long as you stay within these boundaries, you will do perfectly fine.</p>

<p>It’s when you have to step out of bounds that things get more interesting.</p>

<h1 id="let-there-be-change">Let There Be Change</h1>

<p>As much as you would try to avoid this, there will be requirements and integrations whose implementation requires you to step out of bounds and write the code. These are the most common rationales I have learned:</p>

<ul>
  <li>Integration with home-grown legacy system/behavior.</li>
  <li>NIH syndrome.</li>
  <li><em>“But that’s how we have always done things”</em>.</li>
  <li>Integration with black box whose design philosophy is immune to reasonable thought and suggestion.</li>
  <li>Inability or unwillingness to reason with certain stakeholders with sensitive requirements.</li>
  <li><em>“Meh…it was faster this way”</em>.</li>
  <li>Toying around with an exciting new idea with merit for wider adoption. (By far, the most prevalent).</li>
</ul>

<p>So you step into it. Deadlines begin to breath down your neck. Management continues to push for 5am Saturday production deployments to minimize downtime and risk. The inner-child in you continues to have reservations about the nature of the change, the rightness of it all pondering if there is a better path yet you keep reminding yourself to side-step doubt and consider the code and change a <em>temporary</em> solution that would surely be revisited, refactored and hopefully removed some day after production.</p>

<p>Of course, that day rarely comes. What’s more alarming is that over time, you continue this exercise again and again…and again such that a year from now, the thing no longer resembles anything of its original nature.</p>

<h1 id="potential-problems">Potential Problems</h1>

<p>Such extensions to software are like bad roommates that rarely move out. They sit on your couch all day, eat your food and insist on watching Grey’s Anatomy all day fascinated by life and love. They require continuous care to ensure the system as a whole would not remain stale and maintenance to warrant unbroken paths to future upgrades. Substantial effort may need to be spent during the design phase as you have to account for best security/coding/deployment practices; Then you would need to document the behavior and share, review and teach it to other coworkers who one day might step into your position. All of this is a very long way of saying: hidden cost. 
But on the other hand, let’s not forget though that you might have immense satisfaction once you deliver because you very proudly were able to analyze, understand, design, implement and deliver a useful practical needed change. So, good for you. Very well done!</p>

<p>It’s quite obvious that none of us can stop change. The legacy systems, the vendors, the integrations, the requirements…they will continue to come and as much as you may disagree with intent or behavior, <em>thou shall deliver</em>. When you start to make changes, the <em>Why</em> and the <em>How</em> are important but those are not this post’s concern. For the purposes of this rant, the Where is where it’s at.</p>

<p>Literally.</p>

<h1 id="the-where">The Where</h1>

<p>Let me reemphasize that I think the majority of all changes are well intentioned, solve an underlying pain point and on the surface look reasonable and attractive. As a colleague, my personal and professional position is to just evaluate and yet never argue the Why with you, because after all I am just a guest in your house and once I leave, you are responsible for the mortgage. So I might express concerns about the validity and soundness of the use case, but ultimately, it is always and forever will be your decision.</p>

<p>Now that we have gotten that out of the way, let’s figure out how we are going to implement the change together. Rather than firing up your workstation immediately to redefine HTTP, exchange passwords in plain-text, design your own message queue or REST-based content protocol and replace XML with JSON because <em>readability</em> or any other creative solutions, I recommend you take the following approach instead.</p>

<h2 id="talk">Talk</h2>

<p>It is likely that someone else in your open-source community has already coded and delivered the very same thing. Nowadays, it’s very difficult to come up with something that hasn’t already been thought of and <a href="https://www.wikiwand.com/en/Simpsons_Already_Did_It">done by the Simpsons</a>.</p>

<p>Ask around. Chances are you will find similarities and opportunities for collaboration.</p>

<h2 id="negotiate">Negotiate</h2>

<p>So it might turn out that you essentially need to start from <em>scratch</em>. Great. This is your moment in the spotlight to negotiate a contribution agreement with the community. Questions you should be asking might include <em>“Is anyone else interested in this functionality? Is anyone else interested to collaborate on this? Is the community interested in adopting this if and when we deliver?”</em></p>

<p>These are excellent questions.</p>

<p>As I have repeatedly outlined, it most often does not matter what <em>this</em> is. Maybe you are working on a brand new capability absent in the current software stack…or maybe you’re adding a new variation to an existing feature, like the ability to use a relational database instead of a NoSQL database…or perhaps you want the system to dance for you based on the native and traditional customs of the end-user’s current region determined by the browser’s locale…who knows.</p>

<p>Ordinarily, <a href="https://apereo.github.io/2017/02/18/onthe-theoryof-possibility/">it’s all good</a>. The worst that could happen is, <em>“No, sorry. Code this for you only”</em>.</p>

<h2 id="execute">Execute</h2>

<p>Assuming positive reception and answers to the above questions, the task would then turn into one of contributing back and figuring out the quirks and the specifics as to make the intended behavior and feature generic and useful enough for the masses. Do not overdo. Do not pre-optimize. Remove institution-specific assumptions, write a bit of documentation and share. Do it all out in the open, from the start without fear. Others will step up to adopt, collaborate and improve the functionality over time, or else it’s perfect just as you intended it to be.</p>

<p>With time it will either get better, or <a href="http://matrix.wikia.com/wiki/The_Trainman">the trainman</a> will take it back to the machine world.</p>

<h2 id="wip">WIP</h2>

<p><a href="https://ben.straub.cc/2015/04/02/wip-pull-request/">Read this</a>.</p>

<h1 id="so">So</h1>

<p>What this post is trying to say, if it’s saying anything, is that your goal in all such endeavors should be to avoid marooning changes on islands whose only citizens are you and your company. At rare times, it might be that the change is so unique enough for others to dissuade them from ever bunking with you on that island and that might be just fine, but most usually the use case is objective, shareable and reasonable. So avoid making <em>custom</em> changes; Being a single parent is tough, so avoid carrying the maintenance burden solely on your own. Avoid treating your deployment unreasoningly unique. You are not that special.</p>

<p>Stop writing code. Write it where it belongs.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/09/10/stop-writing-code/</guid>
                <description>
                    
                    A legitimate, comprehensive and inescapably detailed account of the spiderweb of deceit in today’s technology scene; The open-source software ecosystem where victims fall prey to the Goldilocks Syndrome of software customizations and home-grown functionality. This guide aims to uncover the deepest darkest secrets of this treacherous path and yet intentionally offers no hopes or viable solutions at all…except one.
                    
                </description>
                <pubDate>Sun, 10 Sep 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.1.x User Swap - Cause and Analysis</title>
                <link>https://apereo.github.io/2017/08/31/cas5-userswap-buganalysis/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-info">
  <strong>Contributed Content</strong><br /><a href="mailto:travis.schmidt@gmail.com">Travis Schmidt</a>, an active member of the CAS community, was kind enough to share this analysis.
</div>

<h1 id="problem">Problem</h1>

<p>Shortly after deploying CAS <code class="highlighter-rouge">5.1.2</code> to our production environment, we received incident reports of users signing into various systems as themselves, but were presented with the accounts of other random users.  The first applications we received reports on were GMail and Box, which both used Shibboleth and the ShibCAS plugin to authenticate, so that is where we first focused our attention. Later that day after investigating the first incidents, another was reported on a system that only used CAS to authenticate and our attention switched solely to CAS.  After the CAS only incident was reported we did an emergency roll back to our previous CAS <code class="highlighter-rouge">4.2.6</code> version.  After the rollback, no new incidents have been reported.</p>

<h1 id="reproducing-the-error">Reproducing the Error</h1>

<h2 id="first-attempt">First Attempt</h2>

<p>In order to try and identify a cause we looked at the differences between our development environment and our production environment.  The most obvious difference is that production is four nodes while development is only three nodes.  Since it appeared user info was swapped, the Hazelcast ticket registry was our first suspect and we focused our initial efforts there.  We added a fourth node to match production and began load testing again, but were not able to reproduce the error with just this added.</p>

<h2 id="second-attempt">Second Attempt</h2>

<p>We next focused on our JMeter script used to load test the application.  We modified it to put random delays between users being presented with the login page and posting the login page, calls to all three service validate protocols, and a delayed logout to about half the user threads.  We still did not produce the error with this new script.</p>

<h2 id="third-attempt">Third Attempt</h2>

<p>Lastly we tried a massive amount of load, significant factor higher than what we expect in production.  We saw significant amount of timeout errors and where the system could not keep up, but not the user swap error.</p>

<h2 id="finally">Finally</h2>

<p>I realized that a significant difference between this deployment and our previous deployment was the removal of the <code class="highlighter-rouge">statistics/ping</code> endpoint.  This meant that the F5 load balancer, and the monitoring systems were changed to call the <code class="highlighter-rouge">cas/status</code> endpoint.  In production this meant that the <code class="highlighter-rouge">cas/status</code> endpoint was being called on each node once every 2-3 seconds.  For all the load testing we did before deployment and after, the development nodes were removed from the load balancer and a static page was being sent to the F5 from Apache.  This extra load was never present when running load test before deployment. After running the load test with this <code class="highlighter-rouge">cas/status</code> being called by the F5, we started to see the timeouts happen earlier in the run.</p>

<p>For all test runs to this point I was stopping the test at the first error, and then trying to exam the state of the system.  No real information was gleamed from looking at logs.  After one test had stopped I tried doing a <code class="highlighter-rouge">cas/login</code> to the node that produced the error.  This is where our breakthrough came.  Instead of being presented with the login page, I was looking at the status page. I set the tests to only stop the thread that caused the error and continued running the test.  This is when we started to see the responses start to be mixed.  It would always start with AJP timeouts, but after a bit we start seeing responses being mixed, and eventually two service validate calls would hit just right and <code class="highlighter-rouge">tesuserYYY</code> would be validated as <code class="highlighter-rouge">testuserXXX</code>.</p>

<p>Now we were able to consistently reproduce the error.</p>

<h1 id="identifying-the-cause">Identifying the Cause</h1>

<h2 id="deployment-infrastructure">Deployment Infrastructure</h2>

<p>CAS is run on Apache Tomcat servers that are fronted on each instance by an Apache httpd web server that uses AJP to proxy request to the application.  I think this configuration is quite normal and probably used widely elsewhere.  We focused our attention on Apache, firstly because they were upgraded the same time as the deployment, and secondly because restarting the web server on an affected node cleared the swapping issue.  We tried downgrading, and applying even newer updates, but the problem still persisted.</p>

<p>We then tried to upgrade Tomcat to <code class="highlighter-rouge">8.5.x</code> from our current <code class="highlighter-rouge">8.0.x</code> version that we are using, but the problem still persisted.</p>

<h2 id="analyzing-customizations">Analyzing Customizations</h2>

<p>We have quite a few customizations that we make to the CAS application.  In order to rule out that we introduced the issue with our code, we created clean version of the CAS <code class="highlighter-rouge">5.1.x</code> branch with <a href="https://apereo.github.io/cas/5.1.x/installation/Hazelcast-Ticket-Registry.html">Hazelcast</a>, <a href="https://apereo.github.io/cas/5.1.x/installation/LDAP-Authentication.html">LDAP</a> and <a href="https://apereo.github.io/cas/5.1.x/installation/DuoSecurity-Authentication.html">Duo Security</a> modules compiled in.  The error still occurred with this version of CAS.</p>

<h2 id="analyzing-the-network">Analyzing the Network</h2>

<p>We next focused on the AJP proxy between Apache and Tomcat.  We reconfigured Tomcat to accept connections on <code class="highlighter-rouge">8443</code> and called it directly bypassing Apache.  This somewhat mitigated the issue.  After several runs this way we always saw swapping occur, but it always seemed to just swap the status page with a login or service validate call, but never saw the CAS protocol endpoints swap, or a user swap on validate.</p>

<h2 id="viola">Viola!</h2>

<p>Our focus was then on to the component that produces the status page, <code class="highlighter-rouge">HealthCheckController</code>.  After numbly staring at the code for a while, and trying a few things, we finally noticed that the mapped method for the status page was coded to return a <code class="highlighter-rouge">WebAsyncTask</code>. How the callable object was being used would turn out to be the cause of our issue.</p>

<h1 id="fixing-the-problem">Fixing the Problem</h1>

<p>I <a href="https://github.com/apereo/cas/pull/2891">put together a patch</a> targeted at the next CAS <code class="highlighter-rouge">5.1.x</code> release (<code class="highlighter-rouge">5.1.4</code> at the time of this writing) to address this problem. The patch is of course merged, and it is also brought forward to <code class="highlighter-rouge">master</code>. You should be able to mitigate this problem, the very next time you upgrade your CAS <code class="highlighter-rouge">5.1.x</code> instance.</p>

<p>To see the CAS release schedule, please <a href="https://github.com/apereo/cas/milestones">click here</a>.</p>

<p><a href="mailto:travis.schmidt@gmail.com">Travis Schmidt</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/08/31/cas5-userswap-buganalysis/</guid>
                <description>
                    
                    Travis Schmidt shares an analysis of chasing down a bug in CAS 5.1.x where user identities were swapped.
                    
                </description>
                <pubDate>Thu, 31 Aug 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Summer 2017 uPortal Roadmap Update</title>
                <link>https://apereo.github.io/2017/08/30/summer-2017-uportal-roadmap-update/</link>
                <content:encoded>
                    <![CDATA[
                    <h1 id="summary">Summary</h1>
<p>Almost two dozen conference attendees came to the uPortal Roadmap BOF at the Open Apereo 2017 conference. Prior to the conference, members of the community were invited to submit and comment on roadmap ideas in <a href="https://goo.gl/wZ7VTC">a shared google doc</a>. 15 items were suggested but during the BOF we focused on which ones we anticipated someone would actually devote time and resources to. In the end, we anticipate making progress over the next year on the 8 items listed below.</p>

<h1 id="release-of-uportal-5">Release of uPortal 5</h1>
<p>This long awaited release includes a refactoring of the build system using a Gradle-based build in the <a href="https://github.com/Jasig/uPortal-start">uPortal-start</a> repository. We are currently aiming for a mid-September release candidate and feature freeze followed by a GA release by the end of October.</p>

<h1 id="semantic-versioning-and-releasing-often">Semantic versioning and releasing often</h1>
<p>While no specific action items were identified, we renewed our commitment to ship releases more often and use semantic versioning when doing so. We should not be afraid of doing more frequent major releases.</p>

<h1 id="better-web-service-api-documentation">Better web service API documentation</h1>
<p>Most of the existing web service APIs are not well documented. This makes them harder to use or sometimes even be aware of. There was a commitment to documenting new APIs that are developed. UW-Madison committed to documenting APIs it depends on.</p>

<h1 id="easier-adoption-complete-and-accurate-documentation">Easier adoption: Complete and accurate documentation</h1>
<p>A work in progress, we are looking at shifting uPortal 5 documentation to github.io with an initial focus on installing and configuring core uPortal. This remains <a href="https://jasig.github.io/uPortal/">in early stages</a> and the details are in flux. Discussion continues on the uportal email lists.</p>

<h1 id="separation-of-presentation-layer">Separation of presentation layer</h1>
<p>This will be a work in progress for some time. While uPortal Home has adopted this modern architecture, uPortal core is being refactored piecemeal. It is anticipated that developers will move towards more modularization as they work with specific parts of the codebase.</p>

<h1 id="uportal-install---demo-edition-fka-quickstart">uPortal install - demo edition (fka QuickStart)</h1>
<p>This would be a modern version of the quick start we previously published with uPortal releases. Someone interested in seeing uPortal in action would be able to download the demo edition and have it running locally within minutes.</p>

<h1 id="uportal-install---front-end-developer-edition">uPortal install - front end developer edition</h1>
<p>While the demo edition is targeted for demonstration purposes only, this version of uPortal is an easy way for front end developers to stand up a uPortal server locally, turn it on, and start developing the front ends of applications. The only additional requirements would be downloading a JDK and git client and cloning the <a href="https://github.com/Jasig/uPortal-start">uPortal-start</a> repo.</p>

<h1 id="develop-a-lightweight-uportal-ecosystem-incubation-process">Develop a lightweight uPortal ecosystem incubation process</h1>
<p>Developers in the uPortal community are doing interesting innovative work for local campuses that others could benefit from yet this work cannot be easily adopted. This roadmap item is an effort to lower the barriers to local work participating more directly in the greater uPortal ecosystem. The uPortal Steering Committee is close to issuing a draft of a process that, given certain assumptions, will make it easier for someone to share code without having to go through the full Apereo project incubation process. Everyone has some code to share. Borrowing from the Sirius Cybernetics Corporation, “Share and enjoy!”</p>

<p><a href="mailto:jim.helwig@wisc.edu">Jim Helwig</a>
uPortal Steering Committee Chair</p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/08/30/summer-2017-uportal-roadmap-update/</guid>
                <description>
                    
                    Primarily summarizing the Open Apereo 2017 uPortal Roadmap BOF.
                    
                </description>
                <pubDate>Wed, 30 Aug 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Interrupt CAS With Class</title>
                <link>https://apereo.github.io/2017/08/30/cas-loginflow-interrupt/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<blockquote>
  <p>The fastest route to a 10X engineer is to give them 0.1X the distractions. - Eric Meyer</p>
</blockquote>

<p>While that is generally sensible advice, when it comes to CAS there are times where you wish to interrupt the CAS authentication flow and the present the end-user with notifications and annoucements. A common use case deals with presenting a message board during the authentication flow to select users and then optionally require the audience to complete a certain task before CAS is able to honor the authentication request and establish a session. Examples of such messages tasks may include: <em>“The kitchen’s menu today features <a href="https://www.wikiwand.com/en/Khash_(dish)">Khash</a>. Click here to get directions.”</em> or <em>“The office of compliance and regulations has announced a new policy on using forks. Click to accept, or forever be doomed with spoons”</em>.</p>

<p>This is a tutorial on how to present such interruptions to your CAS audience, as a fairly recent feature in CAS <code class="highlighter-rouge">5.2.x</code> and beyond. To learn more about this behavior, please <a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-Interrupt.html">see this guide</a>.</p>

<div class="alert alert-info">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>WATCH OUT!</strong><br />As of this writing, CAS <code>5.2.x</code> is not officially released. See the <a href="https://github.com/apereo/cas/milestones">release schedule</a> for more info.
</div>

<h1 id="interrupt-source">Interrupt Source</h1>

<p>First and foremost, there needs to be an engine of some sort that is able to produce notifications and interruptions. CAS supports a range of such engines that are backed by JSON &amp; Groovy resources, REST endpoints or one you decide to create and inject into the runtime.</p>

<p>For the purposes of this tutorial, I will be using the static JSON resource which is a perfectly suitable option for super small deployments or relevant during development and testing. The JSON resource path is taught to CAS via the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.interrupt.json.location</span><span class="p">=</span><span class="s">file:/etc/cas/config/interrupt.json</span>
</code></pre></div></div>

<h1 id="interrupt-rules">Interrupt Rules</h1>

<p>Once you have defined the above setting and assuming your overlay is prepped with relevant <a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-Interrupt.html">configuration module</a>, CAS will attempt to understand the interruption rules that are defined in the <code class="highlighter-rouge">interrupt.json</code> file. My rules are defined as such:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"casuser"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"We have interrupted your CAS authentication workflow to bring you the following information. Select one of the links below to go somewhere and do something fun and then come back to continue with &lt;strong&gt;CAS&lt;/strong&gt;."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"Go to Google"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.google.com"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Go to Yahoo"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.yahoo.com"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"ssoEnabled"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="s2">"interrupt"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The above ruleset simply says: <em>Whenever <code>casuser</code> authenticates, present the <code class="highlighter-rouge">message</code> to the user with a number of <code class="highlighter-rouge">links</code>. Make sure an SSO session is not established which would have the user present credentials again in subsequent attempts.</em></p>

<h1 id="the-looks">The Looks</h1>

<p>Once that is all in place, <code class="highlighter-rouge">casuser</code> will see the following screen, after having authenticated successfully:</p>

<p><img src="https://user-images.githubusercontent.com/1205228/29816821-eb5a597a-8cca-11e7-8ee8-f5433b01f90d.png" alt="image" /></p>

<p>It’s that simple.</p>

<h1 id="so">So…</h1>

<p>For more advanced and production-quality interruptions you likely need to write a Groovy script or design a REST endpoint that ties CAS with your own institutional messages and you most certainly should want to decorate the user interface much better.</p>

<p>Given this is very new today, I am sure you will find plenty of opportunities to improve the functionality with more cowbell. Laundry doesn’t fold itself so <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">please do</a>.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/08/30/cas-loginflow-interrupt/</guid>
                <description>
                    
                    An overview of a recent CAS 5.2.x feature that allows one to interrupt the authentication flow with notifications and advertisements, dictating CAS should treat the authenticated session with configuration and compassion.
                    
                </description>
                <pubDate>Wed, 30 Aug 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Let Your Docker Containers Speak</title>
                <link>https://apereo.github.io/2017/08/24/tip-docker-container-to-host/</link>
                <content:encoded>
                    <![CDATA[
                    <p>If you are like me, you have probably come to the same conclusion that Docker does wonders with the automation of much of the needed  infrastructure while working on a particular development task. For example, I primarily keep myself busy in the realm of <a href="https://www.unicon.net/solutions/identity-and-access-management">Identity and Access Management (IAM)</a> and there does not a day go by where I find myself in need of a running <a href="https://github.com/UniconLabs/spring-security-saml-java-sp">SAML service provider</a>, a CASified PHP application protected by <a href="https://github.com/apereo/mod_auth_cas">mod_auth_cas</a> running inside Apache, or a full blown <a href="https://github.com/Unicon/grouper-dockerized">Grouper deployment</a> for which I might be trying to add a changelog consumer, etc.</p>

<p>Docker can automate and (more importantly) isolate all of that <em>noise</em>, allowing me to focus on the task at hand. Today and while I have opted for both approaches given context and need, my preference is to keep the core platform/application I am working on outside the running Docker ecosystem while leaving all of the stuff-I-need-for-the-integration components inside. I find that this strategy allows for faster builds and more performant/natural debugging and diagnostics. However, one problem I run into often is: how do I connect the two separate environments? Or put another way, how do I let a component running in Docker make a back-channel call to something outside running on the host?</p>

<p>Being so far away from home can be challenging. This blog is about that problem.</p>

<h2 id="that-problem">That Problem</h2>

<p>My docker setup usually is based on <a href="https://github.com/UniconLabs/dockerized-idp-testbed">this project</a>, which is the wonderful produce of my esteemed colleague, <a href="https://github.com/jtgasper3">@jtgasper3</a>. As the perfect IAM testbed, it is <em>composed</em> (catch the pun?) of an LDAP server, a Shibboleth SP, Apache httpd, a CASified PHP application, simpleSAMLphp, a Shibboleth IdP and possibly more.</p>

<p>I simply enable/disable components I need running in the package and viola! It takes care of the rest. I am not going to bore you with all the intricate details of how this is all organized docker-wise, but one thing that is perhaps relevant is that each running component is tagged with a <code class="highlighter-rouge">networks</code> configuration that simply <a href="https://docs.docker.com/compose/networking/">controls the application networking</a> via custom networks where each can be linked to a driver configuration (i.e. <code class="highlighter-rouge">bridge</code>, the default for the Docker engine). This might come in handy, should you decide to go fancier and beyond what I explain here for a solution.</p>

<p>Long story short, the issue had to do with the dockerized Shibboleth SP unable to make a SOAP query to my IdP running outside. If you think about it, this sort of makes sense. What runs inside does not necessarily know anything about what’s on the outside. It might seem like everything is simply running on <em>the same machine</em>, but <code class="highlighter-rouge">localhost</code> for you, an outsider, is a very different unknown to the Shibboleth SP container running in its own network.</p>

<p>I needed an inside man.</p>

<h2 id="one-solution">One Solution</h2>

<p>I am convinced there are better solutions that muck around with native docker networking configuration, bridging host and container. Indeed, one can set up <a href="https://docs.docker.com/compose/compose-file/#extra_hosts">extra hosts</a>, perhaps define a <code class="highlighter-rouge">host</code> <a href="https://docs.docker.com/compose/compose-file/#network_mode">network mode</a> of some kind, etc. Who knows! That was a rabbit hole I didn’t want to venture into and so I settled for the following simpler albeit temporary solution.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">DOCKERHOST</span><span class="o">=</span><span class="k">$(</span>ifconfig | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"([0-9]{1,3}</span><span class="se">\.</span><span class="s2">){3}[0-9]{1,3}"</span> | <span class="se">\</span>
                  <span class="nb">grep</span> <span class="nt">-v</span> 127.0.0.1 | awk <span class="s1">'{ print $2 }'</span> | <span class="se">\</span>
                  cut <span class="nt">-f2</span> <span class="nt">-d</span>: | head <span class="nt">-n1</span><span class="k">)</span>
</code></pre></div></div>

<p>If you open up your terminal and run that command, you might see something like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">echo</span> <span class="nv">$DOCKERHOST</span>
192.168.1.170
</code></pre></div></div>

<p>Sweet! Next, I was able to modify the relevant configuration files and use <code class="highlighter-rouge">192.168.1.170</code> anywhere the dockerized Shibboleth SP needed to make a call to the outside world. While this works fine, I should note that it is absolutely a <strong>temporary solution</strong> as hardcoding an IP address that might change later on obviously is a broken path but it did suffice my development needs at the time.</p>

<h1 id="post-credits-scene">Post-credits Scene</h1>

<p>…and oh, if you need to find a quick way to SSH into a running Docker container, put the following in your profile:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>dockerssh<span class="o">()</span> <span class="o">{</span>
    <span class="nb">export </span><span class="nv">CID</span><span class="o">=</span><span class="k">$(</span>docker ps <span class="nt">-aqf</span> <span class="s2">"name=</span><span class="nv">$1</span><span class="s2">"</span><span class="k">)</span><span class="p">;</span> docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nv">$CID</span> /bin/bash
<span class="o">}</span>
</code></pre></div></div>

<p>Then use as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dockerssh <span class="o">[</span>container-name]
</code></pre></div></div>

<p>…and you’re in.</p>

<p>HTH.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/08/24/tip-docker-container-to-host/</guid>
                <description>
                    
                    A short story on how to allow a running Docker container to get in touch with home and host.
                    
                </description>
                <pubDate>Thu, 24 Aug 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Better by design 2017: Integrating accessibility across design and development lifecycle</title>
                <link>https://apereo.github.io/2017/08/22/bbd-integrating-a11y-across-lifecycle/</link>
                <content:encoded>
                    <![CDATA[
                    <p>I recently attended a day-long workshop on <a href="http://betterbydesignconference.com/workshops/workshop-accessibility-design-development-life-cycle/">Integrating accessibility across the design and development lifecycle</a> by <a href="http://www.karlgroves.com/">Karl Groves</a> at <a href="http://betterbydesignconference.com/">Better By Design</a> 2017.</p>

<p>The most important point I took from the workshop was a reminder to <strong>automate functionally testing the front end for those usability characteristics and WCAG targets amenable to automated testing</strong>.</p>

<p>Mostly the workshop was a call-to-action to care about accessibility, to comply with law and regulation about accessibility, and to avoid expensive legal liability. The workshop motivated thinking about accessibility and usability through the lens of fictional startups wherein, contrary to our typical lived developer experience, accessibility would be prioritized in product vision, design, hiring, corporate priorities, technical support, etc. A healthy thought experiment perhaps too far from my lived reality to be fully relatable.</p>

<h2 id="automate-front-end-testing">Automate front-end testing.</h2>

<p>Suggested tech stack:</p>

<ul>
  <li><a href="http://www.seleniumhq.org/projects/webdriver/">Selenium WebDriver</a> : drive web browsers via automation</li>
  <li><a href="https://mochajs.org/">Mocha</a>: JavaScript test framework</li>
  <li><a href="http://chaijs.com/">Chai</a>: assertion library</li>
  <li><a href="https://github.com/shouldjs/should.js">Should</a>: another assertion library</li>
  <li><a href="https://cucumber.io/">Cucumber</a> : executable specifications</li>
</ul>

<p>The speaker’s product, <a href="https://tenon.io/">tenon.io</a> , has something to offer for a11y checking automation.</p>

<h2 id="its-usability">It’s usability</h2>

<p>Don’t primarily think of it as a11y, as extra stuff to do to accommodate disability. Think of it as making your app usable for everyone.</p>

<p>Focusing on a11y and disability is useful for legal compliance and to help broaden thinking of all the users and all their needs. If it takes thinking about blindness specifically to get you to pay attention to screen reader experiences, so be it. But mostly if you build it right, if it’s clear <strong>what things are and what they do</strong>, if it’s usable and thoughtful and high quality, accessibility takes care of itself.</p>

<p>And of course automate testing for any code quality characteristics that can be automatically detected, because that’s what computers are for.</p>

<h2 id="software-development-has-a-quality-and-a-culture-problem">Software development has a quality and a culture problem</h2>

<p>The problem is</p>

<ul>
  <li>Software products are of agonizingly poor quality.</li>
  <li>Software development culture is often broken, with lack of empathy, empowerment, attention to quality and detail, resources.</li>
</ul>

<p>Of course low quality software built in agonizing culture has poor usability and poor accessibility.</p>

<p>Do less. Do it with radically higher quality. Win.</p>

<h2 id="the-different-versions-and-levels-of-wcag">The different versions and levels of WCAG</h2>

<p>WCAG 1: three priority levels (1, 2, 3) organized by importance to the usability.</p>

<p>WCAG 2: A, AA, and AAA levels organized by expected cost to implement.</p>

<p>WCAG A is no-UI-impact stuff that you have no excuse not to do. Very low cost.</p>

<p>WCAG AA is modest-impact stuff that you really ought to do but it comes at a cost. This is de-facto where the industry has landed as acceptable. You’re liable to suit if you don’t meet WCAG AA; remediation will likely be to meet WCAG AA.</p>

<p>WCAG AAA is potentially tremendously expensive stuff.</p>

<p>All of A, AA, and AAA are important to accessibility, usability. It’s not that the AAA stuff isn’t important, it’s that it’s potentially expensive to comply.</p>

<p>Good practice: <strong>meet all of AA. Meet parts of AAA that you can feasibly</strong> achieve.
Good practice: <strong>don’t volunteer to meet AAA</strong> – you’re probably just not going to do it.</p>

<p>Recommendation: lurk or participate directly in WCAG 3 standard development. ( <a href="https://www.w3.org/community/silver/">community group</a>)</p>

<h2 id="performance-budget-analogy">Performance budget analogy</h2>

<p>Concept: performance budget. From the outset, how slow will we allow our site / application / pages to be? By what measures? Then work within that budget.</p>

<p>Analogous concept: accessibility budget. How un-usable will we allow our site / application / pages to be? Then work within that budget.  Don’t remediate to WCAG AA. Decide WCAG AA is your “accessibility budget” from the outset and anything violating WCAG AA, it’s just not in your project’s budget.</p>

<h2 id="drag-and-drop-re-ordering-as-a11y-challenge">Drag-and-drop re-ordering as a11y challenge</h2>

<p>Almost any UI control can be made usable and accessible for all users.</p>

<p>Drag-and-drop re-ordering is a notorious exception to this. Provide an alternative experience so that users who cannot easily use visual drag-and-drop controls can instead re-order or re-arrange objects in another way.</p>

<h2 id="misc">Misc</h2>

<p>Other grab bag of points made, references.</p>

<ul>
  <li><strong>Accessibility</strong> as differentiator on resume. a11y is important and getting more important; companies are hiring for it.</li>
  <li>Paciello Group: <a href="http://inclusivedesignprinciples.org/">inclusive design principles</a>.</li>
  <li>Inclusive Design Patterns book by Heydon Pickering . Seems to be <a href="http://smashingconf.com/pdf/inclusive-design-patterns.pdf">available online as a PDF</a>.</li>
  <li><a href="http://atomicdesign.bradfrost.com/">Brad Frost atomic design</a>, <a href="http://patternlab.io/">pattern lab</a></li>
  <li><a href="http://inclusivedesignprinciples.org/">Inclusive Design Principles</a></li>
  <li><a href="http://www.joshblue.com/">Josh Blue</a> (comedian)</li>
  <li><a href="https://www.dhs.gov/trusted-tester">DHS Trusted Tester program</a></li>
  <li><a href="http://uiaccess.com/accessucd/">Just Ask: Integrated Accessibility throughout Design</a> (book) (contents available online)</li>
  <li><a href="http://www.jeffgothelf.com/lean-ux-book/">Lean UX</a> (book)</li>
  <li><a href="https://github.com/w3c/aria-practices">ARIA practices guide</a> , <a href="https://www.w3.org/TR/wai-aria-practices-1.1/">as published</a></li>
</ul>

<h2 id="planning-to-automate-myuw-accessibility-testing">Planning to automate MyUW accessibility testing</h2>

<p>Added to draft Q4 MyUW roadmap an item to automate functionally testing a11y criteria in MyUW as deployed to a test tier. This doesn’t guarantee we’ll actually do this in Q4 – it just places a reminder to consider it when tightening up Q4 planning.</p>

<p>-<a href="https://apetro.ghost.io">Andrew</a></p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/08/22/bbd-integrating-a11y-across-lifecycle/</guid>
                <description>
                    
                    Notes from Karl Groves workshop on integrating a11y across design and development lifecycle at Better By Design 2017.
                    
                </description>
                <pubDate>Tue, 22 Aug 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.2.0 RC2 Feature Release</title>
                <link>https://apereo.github.io/2017/08/04/520rc2-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.1.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.1.0">May 27th 2017</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.2.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the <em>second</em> release candidate in the <code class="highlighter-rouge">5.2.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.2.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<p>You can read more about the previous release candidate <a href="https://apereo.github.io/2017/06/30/520rc1-release/">here</a>.</p>

<!-- TOC -->

<ul>
  <li><a href="#minors">Minors</a></li>
  <li><a href="#default-theme-for-services">Default Theme For Services</a></li>
  <li><a href="#authentication-plan-configurators">Authentication Plan Configurators</a></li>
  <li><a href="#authentication-graph">Authentication Graph</a></li>
  <li><a href="#dynamic-authentication-policies">Dynamic Authentication Policies</a></li>
  <li><a href="#configuration-documentation">Configuration Documentation</a>
    <ul>
      <li><a href="#what-does-this-mean-for-you">What does this mean for you?</a></li>
      <li><a href="#why-not-use-plain-markdown-instead">Why not use plain markdown instead?</a></li>
    </ul>
  </li>
  <li><a href="#configuration-metadata-server">Configuration Metadata Server</a></li>
  <li><a href="#apache-fortress-integration">Apache Fortress Integration</a></li>
  <li><a href="#sqrl-authentication-support">SQRL Authentication Support</a></li>
  <li><a href="#encryptionsigning-log-messages">Encryption/Signing Log Messages</a></li>
  <li><a href="#clustered-service-replication">Clustered Service Replication</a></li>
  <li><a href="#gradle-build-performance">Gradle Build Performance</a></li>
  <li><a href="#service-definition-file-checking">Service Definition File Checking</a></li>
  <li><a href="#scripted-username-providers">Scripted Username Providers</a></li>
  <li><a href="#attribute-consent">Attribute Consent</a></li>
  <li><a href="#saml2-metadata-expiration">SAML2 Metadata Expiration</a></li>
  <li><a href="#swagger-documentation">Swagger Documentation</a></li>
  <li><a href="#cas-demos">CAS Demos</a></li>
  <li><a href="#multimapped-attributes">Multimapped Attributes</a></li>
  <li><a href="#password-management">Password Management</a></li>
  <li><a href="#rest-attribute-repository">REST Attribute Repository</a></li>
  <li><a href="#scripted-attribute-repositories">Scripted Attribute Repositories</a></li>
  <li><a href="#surrogate-authn-via-jdbc">Surrogate Authn via JDBC</a></li>
  <li><a href="#library-upgrades">Library Upgrades</a></li>
  <li><a href="#whats-next">What’s Next?</a></li>
  <li><a href="#get-involved">Get Involved</a></li>
  <li><a href="#das-ende">Das Ende</a></li>
</ul>

<!-- /TOC -->

<h2 id="minors">Minors</h2>

<ul>
  <li>Service access strategies based on principal attributes should now correctly be enforced prior to jumping into subsequent factors of authentication.</li>
  <li>Thanks to <a href="https://github.com/gbatalski">@gbatalski</a>, JWT authentication in CAS is now able to support base64-encoded secrets.</li>
  <li>Thanks to <a href="https://github.com/benht">@benht</a>, expired tickets are now properly removed from CAS when using MongoDb ticket registry.</li>
  <li>Thanks to <a href="https://github.com/klewczuk">@klewczuk</a>, refresh tokens are no longer auto-generated when using grant type <code class="highlighter-rouge">refresh_token</code>.</li>
  <li>Thanks to <a href="https://github.com/WhiteMarlin">@WhiteMarlin</a>, a number of reference to <code class="highlighter-rouge">Jasig</code> are now removed from CAS language bundles.</li>
  <li>Database drivers are now defined to be available at <code class="highlighter-rouge">runtime</code> via the published POM, so they can be included in the overlay.</li>
  <li>Groovy/Scripting utilities are cleaned up to use a consistent strategy across the codebase where needed.</li>
  <li>MongoDb Ticket/Service registry configuration is now able to take advantage of distinct unique group of settings.</li>
  <li>YAML service registry bean is now properly renamed so it can honor <code class="highlighter-rouge">@Conditional</code> annotations.</li>
  <li>Thanks to <a href="https://github.com/pdrados">@pdrados</a>, throttled authentication attempts are better explained in the UI via a new http status code.</li>
  <li>Service registry initialization from JSON is now able to honor service definitions found at the path specified via settings, rather than only loading those found on the classpath’s <code class="highlighter-rouge">services</code> directory.</li>
  <li>Thanks to <a href="https://github.com/bbooth">@bbooth</a>, password management flows now correctly register a password update state.</li>
  <li>Thanks to <a href="https://github.com/swoeste">@swoeste</a>, URL validation is now provided an option to support <code class="highlighter-rouge">localhost</code> type urls, when dealing with things such as SLO.</li>
  <li>Thanks to <a href="https://github.com/tduehr">@tduehr</a>, generating random strings that specially affect ticket ids and such are now improved to use more secure algorithms and strategies.</li>
</ul>

<h2 id="default-theme-for-services">Default Theme For Services</h2>

<p>Thanks to <a href="https://github.com/swoeste">@swoeste</a>, the CAS default theme is now also consulted by registered services. Services still have the ability to define a specific theme and have it be resolved by the theme resolution machinery, but if no theme is defined, services are now given the ability to fall back onto the default theme specified by <code class="highlighter-rouge">cas.theme.defaultThemeName</code>.</p>

<h2 id="authentication-plan-configurators">Authentication Plan Configurators</h2>

<p>All configuration components in CAS that register authentication handlers into the runtime engine have now become their own <code class="highlighter-rouge">@Bean</code> marked as <code class="highlighter-rouge">@Conditional</code> for easier overrides.</p>

<h2 id="authentication-graph">Authentication Graph</h2>

<p>The CAS statistics page now boasts the ability to present authentication events as a chart.</p>

<h2 id="dynamic-authentication-policies">Dynamic Authentication Policies</h2>

<p>Additional authentication policies are now made available to check account status and state via Groovy and REST endpoints. This is useful in the event that the underlying authentication scheme does not provide a way to check for account status and you wish to resort to more elaborate means of enforcing policies dynamically. <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#authentication-policy">See this guide for more info</a>.</p>

<h2 id="configuration-documentation">Configuration Documentation</h2>

<div class="alert alert-warning">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Beware</strong><br />This may be a breaking change. 
  Consult <a href="https://apereo.github.io/cas/development/">the docs</a> to learn more.
</div>

<p>The entire CAS configuration model is now annotated and documented using Javadocs. The build process is also augmented
to scan the configuration model and produce a <em>repository</em> of all settings, groups, etc along with their description, values, hints and
documentation. This repository is then later used by the CAS configuration metadata server to allow deployers to query settings via REST or CLI tools. In future releases, GUIs will also be able to auto-initialize a module using relevant settings that are sorted and
ranked from the same repository instance.</p>

<h3 id="what-does-this-mean-for-you">What does this mean for you?</h3>

<p>In cleaning up the configuration model and in order to maximize reuse, a number of duplicate settings were moved around and refactored
so as so to allow centralization of documentation items without having to duplicate notes and descriptions. At a high level, the following category of settings are cleaned up and made reusable:</p>

<ul>
  <li>
    <p>Various <code class="highlighter-rouge">encryptionKey</code> and <code class="highlighter-rouge">signingKey</code> settings were duplicated throughout the codebase. These are now cleaned up so that for instance every component that requires access to crypto-related settings now hosts <code class="highlighter-rouge">crypto.encryption</code> and <code class="highlighter-rouge">crypto.signing</code> settings that house keys and settings in a reusable way.</p>
  </li>
  <li>
    <p>The same strategy is also applied to scheduler-related tasks that define <code class="highlighter-rouge">repeatInterval</code> and <code class="highlighter-rouge">startUpDelay</code> where these are moved to a parent reusable component that is usually noted by the <code class="highlighter-rouge">schedule</code> key name (i.e. <code class="highlighter-rouge">cas.xyz.schedule.repeatInterval</code> rather than <code class="highlighter-rouge">cas.xyz.repeatInterval</code>).</p>
  </li>
  <li>
    <p>Properties that referenced a Spring-managed resource prior to this release took the form of <code class="highlighter-rouge">cas.setting.config.location</code>. These are now cleaned up to simply define the resource as <code class="highlighter-rouge">cas.setting.location</code>.</p>
  </li>
  <li>
    <p>Explicit properties are now made available for both JSON and YAML service registries in form of <code class="highlighter-rouge">cas.serviceRegistry.json</code> and <code class="highlighter-rouge">cas.serviceRegistry.yaml</code>.</p>
  </li>
</ul>

<p>In your own local configuration, you will need to adjust key names to match the new locations.</p>

<h3 id="why-not-use-plain-markdown-instead">Why not use plain markdown instead?</h3>

<p>This all means that rather than documenting every single setting and key in the project documentation via markdown, the project documentation specially for settings and confguration now sits right beside the setting itself. This not only turns documentation into working code, and it not only provides additional processing power and querying to be done on the setting, it furthermore allows the codebase to automate the requirement of documentation for settings as well and fail the build in case something goes undocumented.</p>

<p>Note that this is just a <em>very modest</em> starting point and the field descriptions that now are available for settings will continually need to be improved, revised and expanded. Writing good documentation for adopters who step forward with varying levels of skill is a very difficult and delicate task and good-enough is usually never enough. You’re encouraged to continually improve the docs and explain things to the level you deem appropriate for your own audience.</p>

<h2 id="configuration-metadata-server">Configuration Metadata Server</h2>

<p>The metadata server is an interactive CLI tool that allows one to query the CAS configuration metadata and learn more about propeties, groups, etc. The configuration metadata repository is built and generated for every CAS build and release and the metadata server is then simply tasked to query the database and respnd to commands. The server ships with both a CLI as well as interactive shell interface.</p>

<p><a href="https://apereo.github.io/cas/development/installation/Configuration-Metadata-Repository.html">See this guide</a> for more info.</p>

<h2 id="apache-fortress-integration">Apache Fortress Integration</h2>

<p>Thanks to <a href="https://github.com/yudhik">@yudhik</a>, CAS gains integration support with Apache Fortress. Apache Fortress is a standards-based access management system that provides role-based access control, delegated administration and password policy services with LDAP.</p>

<p>Read more about the CAS integration <a href="https://apereo.github.io/cas/development/integration/Configuring-Fortress-Integration.html">here</a>.</p>

<h2 id="sqrl-authentication-support">SQRL Authentication Support</h2>

<p>Modest amount of work has been done to begin support for the <a href="https://apereo.github.io/cas/development/protocol/SQRL-Protocol.html">SQRL Protocol</a>.
This is very much in an experimental state as both the specification as well as client implementations today are rather incomplete and in flux.
This will eventually be ironed out, provied the finalization of the protocol spec itself.</p>

<h2 id="encryptionsigning-log-messages">Encryption/Signing Log Messages</h2>

<p>In certain cases where CAS begins to generate keys for signing/encryption tasks, there are now additional log messages that indicate the setting name under which the newly generated key must be placed.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-07-24 07:29:26,249 WARN <span class="o">[</span>org.apereo.cas.util.cipher.BaseStringCipherExecutor] - &lt;Secret key <span class="k">for </span>encryption is not defined <span class="k">for</span> <span class="o">[</span>Ticket-granting Cookie]<span class="p">;</span> CAS will attempt to auto-generate the encryption key&gt;
2017-07-24 07:29:26,259 WARN <span class="o">[</span>org.apereo.cas.util.cipher.BaseStringCipherExecutor] - &lt;Generated encryption key <span class="o">[</span>...] of size <span class="o">[</span>256] <span class="k">for</span> <span class="o">[</span>Ticket-granting Cookie]. The generated key MUST be added to CAS settings under setting <span class="o">[</span>cas.tgc.crypto.encryption.key].&gt;
</code></pre></div></div>

<h2 id="clustered-service-replication">Clustered Service Replication</h2>

<p>CAS gains the ability to replicate and redistribute registered service definition files across the cluster via Hazelcast and more. <a href="https://apereo.github.io/cas/development/installation/Configuring-Service-Replication.html">See this guide</a> to learn more.</p>

<h2 id="gradle-build-performance">Gradle Build Performance</h2>

<p>Internally, the CAS Gradle build is readjusted to ensure required build repositories are only made available to submodules that need them for artifacts, which should allow for much faster load times when the project is loaded into a development environment in a non-offline mode manner.</p>

<h2 id="service-definition-file-checking">Service Definition File Checking</h2>

<p>In the event that a resource-based service registry is employed (i.e. JSON, YAML), additional checks are now built in to ensure that the service files are named appropriately.</p>

<h2 id="scripted-username-providers">Scripted Username Providers</h2>

<p>CAS gains the ability to use Java’s native scripting functionality for username attribute providers to support <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-PrincipalId.html">Groovy, Javascript and Python</a> scripts.</p>

<h2 id="attribute-consent">Attribute Consent</h2>

<p>At last, CAS provides the ability to enforce <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Consent.html">user-informed consent</a> upon attribute release.</p>

<h2 id="saml2-metadata-expiration">SAML2 Metadata Expiration</h2>

<p>SAML2 services now gain the ability to define an expiration duration for their metadata. If left undefined, a global default will be used for all resolved metadata in the cache.</p>

<h2 id="swagger-documentation">Swagger Documentation</h2>

<p>CAS is now able to auto-generate <a href="https://apereo.github.io/cas/development/integration/Swagger-Integration.html">API documentation</a> for all endpoints, controllers and REST services, via Swagger.</p>

<h2 id="cas-demos">CAS Demos</h2>

<div class="alert alert-warning">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Beware</strong><br />This may be a breaking change. 
  Consult <a href="https://apereo.github.io/cas/development/">the docs</a> to learn more.
</div>

<p>A number of URLs for <a href="https://apereo.github.io/cas/development/#demos">CAS demos</a> running on Heroku have changed.</p>

<h2 id="multimapped-attributes">Multimapped Attributes</h2>

<p>CAS gains the ability to map and rename the same attribute definition multiple times to different names.
This can be done either as part of attribute retrieval or at release time.</p>

<h2 id="password-management">Password Management</h2>

<div class="alert alert-warning">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Beware</strong><br />This may be a breaking change. 
  Consult <a href="https://apereo.github.io/cas/development/">the docs</a> to learn more.
</div>

<p><a href="https://apereo.github.io/cas/development/installation/Password-Management.html">Password management functionality</a> in CAS is now broken up into distinct modules depending on the backened storage service in use.</p>

<h2 id="rest-attribute-repository">REST Attribute Repository</h2>

<p>CAS gains the ability to <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#rest">contact REST endpoints</a> to resolve attributes.</p>

<h2 id="scripted-attribute-repositories">Scripted Attribute Repositories</h2>

<p>CAS gains the ability to use Java’s native scripting functionality for attribute repository sources to support <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#pythonjavascriptgroovy">Groovy, Javascript and Python</a> scripts to resolve and retrieve attributes.</p>

<h2 id="surrogate-authn-via-jdbc">Surrogate Authn via JDBC</h2>

<p>CAS gains the ability to support <a href="https://apereo.github.io/cas/development/installation/Surrogate-Authentication.html">surrogate authentication</a> via JDBC resources.</p>

<h2 id="library-upgrades">Library Upgrades</h2>

<ul>
  <li>Apache Tomcat</li>
  <li>Eureka</li>
  <li>Spring Boot admin</li>
  <li>Spring</li>
  <li>Spring Boot</li>
  <li>Pac4J</li>
  <li>Amazon SDK</li>
  <li>Spring Cloud</li>
  <li>Jose4J</li>
  <li>Apache CXF</li>
  <li>Postgresql driver</li>
  <li>MariaDb driver</li>
  <li>MySQL driver</li>
  <li>Couchbase</li>
  <li>Apache Cassandra</li>
  <li>Gradle</li>
  <li>Hazelcast</li>
  <li>Ldaptive</li>
</ul>

<h2 id="whats-next">What’s Next?</h2>

<p>We are all working to make sure the CAS <code class="highlighter-rouge">5.2.0</code> release is on <a href="https://github.com/apereo/cas/milestones">schedule</a>.</p>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="das-ende">Das Ende</h2>

<p>A big hearty thanks to all who participated in the development of this release to submit patches, report issues and suggest improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/08/04/520rc2-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.2.0 RC2 release.
                    
                </description>
                <pubDate>Fri, 04 Aug 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>July 2017 uPortal Slack summary</title>
                <link>https://apereo.github.io/2017/08/02/july-2017-uportal-slack-summary/</link>
                <content:encoded>
                    <![CDATA[
                    <p>In July 2017, 5 people participated substantially in conversation in the <a href="https://apereo.slack.com/messages/C0MNUQDN3/">slack.apereo.org #uportal channel</a>. (This is around half as many participants as in June.)</p>

<ul>
  <li>Andrew Petro</li>
  <li>Benito Gonzalez</li>
  <li>Christian Murphy</li>
  <li>Drew Wills</li>
  <li>KaJuan Johnson</li>
</ul>

<p>Conversation highlights include:</p>

<ul>
  <li>Christian expressing interest in the new GitHub feature around CODEOWNERS files automating suggested code reviewers. (<a href="https://groups.google.com/a/apereo.org/d/topic/uportal-dev/-GZrLbjcM7A/discussion">uportal-dev thread</a>).</li>
  <li>Drew expressing excitement about <a href="https://github.com/Jasig/uPortal-start/pull/21">a Pull Pequest removing Ant and Maven from the uPortal-start build</a>. (<a href="https://groups.google.com/a/apereo.org/d/topic/uportal-dev/W0T9MSRpfNw/discussion">uportal-dev@ thread</a>)</li>
  <li>KaJuan asking about filtering and placeholder replacement in Gradle.</li>
  <li>Christian expressing excitement about <a href="https://github.com/Jasig/uPortal/pull/937">a Pull Request cleaning up uPortal’s Gradle build</a></li>
  <li>Christian asking that the Coveralls status reports for uPortal PRs be switched back on.</li>
  <li>Christian asking about <code class="highlighter-rouge">uPortal-developer</code> GitHub team access to a couple specific repos.</li>
  <li>A branch of conversation about Apereo needing something like <a href="https://attic.apache.org/">the Apache Attic</a></li>
  <li>A branch of conversation with the insight that if we want to emulate Apache, maybe we should just do more of our work directly in an Apache Software Foundation context.</li>
  <li>Love for the now active <a href="https://twitter.com/uPortal">Apereo uPortal Twitter account</a> and exploring updating its avatar image.</li>
</ul>

<h2 id="on-slack">On Slack</h2>

<p>I have <a href="https://groups.google.com/a/apereo.org/d/msg/open/cbk9NLb43LQ/btRpD_09AwAJ">concerns about the openness properties of Slack as implemented by Apereo</a>. You can’t access it or read its logs anonymously; it’s not Google search indexed. Past ten thousand messages back, messages aren’t available even if you log in.</p>

<p>Summarizing the conversations in this anonymously, publicly accessible, and Google indexable context somewhat mitigates these problems. But not necessarily other problems that make <a href="https://dave.cheney.net/2017/04/11/why-slack-is-inappropriate-for-open-source-communications">email list communications preferable in open source projects</a>.</p>

<p>Arguably, all of the conversations held in the <code class="highlighter-rouge">#uportal</code> Slack channel this month could have been held via email on <code class="highlighter-rouge">uportal-dev@</code> or <code class="highlighter-rouge">uportal-user@</code> email lists additionally or instead. Some relevant email list threads are linked above.</p>

<p>-<a href="https://apetro.ghost.io">Andrew</a></p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/08/02/july-2017-uportal-slack-summary/</guid>
                <description>
                    
                    Summarizing Slack traffic about uPortal in July 2017.
                    
                </description>
                <pubDate>Wed, 02 Aug 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>June 2017 uPortal Slack summary</title>
                <link>https://apereo.github.io/2017/07/05/uportal-slack-summary/</link>
                <content:encoded>
                    <![CDATA[
                    <p>In June 2017, 11 people participated substantially in conversation in the <a href="https://apereo.slack.com/messages/C0MNUQDN3/">slack.apereo.org #uportal channel</a>.</p>

<ul>
  <li>Aaron Grant</li>
  <li>Andrew Petro</li>
  <li>Brandon Powell</li>
  <li>Christian Cousquer</li>
  <li>Christian Murphy</li>
  <li>David Sibley</li>
  <li>Drew Wills</li>
  <li>Jim Helwig</li>
  <li>Marissa Warner-Wu</li>
  <li>Matt Clare</li>
  <li>Tim Vertein</li>
</ul>

<p>Conversation highlights include:</p>

<ul>
  <li>Aaron Grant’s <a href="https://github.com/blamonet/uportal_commit_stats">uportal_commit_stats</a> script and findings about uPortal contributions. <a href="https://github.com/ejwa/gitinspector">gitinspector</a> might also be useful for uPortal-related Git history analysis.</li>
  <li>Internationalization of documentation stored in Git. What Symfony does in its <a href="https://github.com/symfony/symfony-docs">primary</a> and <a href="https://github.com/symfony-fr/symfony-docs-fr">French-translation</a> documentation. (Separate repos.). Alternatively, the <a href="https://github.com/Anthony-Gaudino/jekyll-multiple-languages-plugin">jekyll-multiple-languages-plugin</a> . Example <a href="https://github.com/bpowell/i18n-react-portlet">ReactJS portlet with i18n support</a> based in <a href="https://www.i18next.com/">i18next</a>.</li>
  <li>Sharing resources from the Open Apereo 2017 conference, including <a href="https://cousquer.github.io/apereo2017/">Portal?! uPortal! What is this Béchamel</a>, <a href="https://www.slideshare.net/bpowell29a/speeding-up-uportal-with-reactjs">Speeding up uPortal with ReactJS</a>, <a href="https://www.icloud.com/keynote/0vEJysMgblVjGUv0ystx1xWrA#two-hard-problems">two-hard-problems</a>. (Cf. <a href="https://groups.google.com/a/apereo.org/d/topic/uportal-dev/24RjwcDhtOg/discussion">uportal-dev@ thread re conference artifacts</a>.)</li>
  <li>Encouraging interest in the new <a href="https://groups.google.com/a/apereo.org/forum/#!forum/accessibility">Accessibility group</a>. (Cf. <a href="https://groups.google.com/a/apereo.org/d/topic/uportal-user/KQbBMtUHHFY/discussion">Accessibility Across Apereo thread on uportal-user@</a>)</li>
  <li><a href="https://www.styled-components.com/">styled-components</a> for styling React.js apps, <a href="https://www.polymer-project.org/2.0/docs/browsers">browser support for Polymer</a>.</li>
  <li><a href="http://azumbrunnen.me/">conversational UI example</a></li>
  <li>Weather API options, including World Weather Online, Weather Underground, weather.gov, DarkSky API.</li>
  <li>The <a href="https://twitter.com/uPortal">@uPortal</a> Twitter account.</li>
  <li>The role of some CSS classes ` <xsl:attribute name="class">up-portlet-control focus externalLink</xsl:attribute>` (turns out to be used in some JavaScript associated with the maximize menu option).</li>
  <li>uPortal 5 <a href="https://github.com/Jasig/uPortal-start/pull/6">fanciness for setting up Tomcat</a> and <a href="https://github.com/Jasig/uPortal-start/pull/8">deployment via Gradle</a>. <a href="https://github.com/Jasig/uPortal-start/pull/10">Renaming the overlays directory</a> (cf. <a href="https://groups.google.com/a/apereo.org/d/topic/uportal-dev/7Fu4UfnXpQE/discussion">uportal-dev@ thread on overlays directory renaming</a> or <a href="https://groups.google.com/a/apereo.org/d/topic/uportal-dev/uaeYARDVRZY/discussion">another</a>).</li>
  <li><a href="https://www.collabco.co.uk/features/dashboards/">myday cloud-based portal</a></li>
  <li><a href="https://sonarwhal.com/">sonar</a>, a linting tool for the web</li>
</ul>

<h2 id="on-slack">On Slack</h2>

<p>I have <a href="https://groups.google.com/a/apereo.org/d/msg/open/cbk9NLb43LQ/btRpD_09AwAJ">concerns about the openness properties of Slack as implemented by Apereo</a>. You can’t access it or read its logs anonymously; it’s not Google search indexed. Only the most recent ten thousand messages are available, so in practice this means logs are unavailable older than about a month back.</p>

<p>Summarizing the conversations in this anonymously, publicly accessible and Google indexable context somewhat mitigates these problems. But not necessarily other problems that make <a href="https://dave.cheney.net/2017/04/11/why-slack-is-inappropriate-for-open-source-communications">email list communications preferable in open source projects</a>.</p>

<p>Arguably, all of the conversations held in the <code class="highlighter-rouge">#uportal</code> Slack channel this month could have been held via email on <code class="highlighter-rouge">uportal-dev@</code> or <code class="highlighter-rouge">uportal-user@</code> email lists additionally or instead. Some relevant email list threads are linked above.</p>

<p>-<a href="https://apetro.ghost.io">Andrew</a></p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/07/05/uportal-slack-summary/</guid>
                <description>
                    
                    Summarizing Slack traffic about uPortal in June 2017.
                    
                </description>
                <pubDate>Wed, 05 Jul 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Apereo CAS - Contribution Guidelines</title>
                <link>https://apereo.github.io/2017/07/05/cas-contribution-guide/</link>
                <content:encoded>
                    <![CDATA[
                    <p>Most if not all open source projects [should] have a <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contributor guide</a>, whose job is to explain the project policy and pace when it comes to accepting changes from the community. Indeed and among many other things, providing guidelines and documentation that teach one how to build, test and contribute patches of all sorts and colors is a pretty good sign of a healthy project and a vibrant community.</p>

<p>The overarching theme of this guide starts with the following questions:</p>

<ol>
  <li>What is the Apereo CAS project policy on accepting contributions?</li>
  <li>How may one, seriously and in a step-wise fashion, get started with contributions?</li>
</ol>

<h1 id="what-do-i-work-on">What do I work on?</h1>

<p>Certain number of projects in open source try to advertise work items and tasks which they think might be <a href="https://github.com/spring-projects/spring-boot/issues?q=is%3Aopen+is%3Aissue+label%3A%22status%3A+ideal-for-contribution%22">good candidates for contributions</a>. This is generally and often <em>not</em> the Apereo CAS project policy. The policy is much simpler than that.</p>

<p>It goes something like this:</p>

<blockquote>
  <p>Everything is ideal for contributions.</p>
</blockquote>

<p>In other words,</p>

<ul>
  <li>There is no <em>“We vs. You”</em>.</li>
  <li>There is no <em>“Some folks can only fix certain issues and some can’t”</em>.</li>
  <li>There is no <em>“Person X made the change; so X must fix it too”</em> (aka code ownership)</li>
  <li>There is no <em>“I am just a user; you are the developers”</em>.</li>
</ul>

<p>Of course, if you are a newcomer to the project and have just begun to understand the ins and outs of the <a href="https://apereo.github.io/2017/06/12/cas-codebase-overview/">CAS project codebase</a>, there may certainly be areas in which you might find more comfort to slowly get your feet wet. You’re welcome to <a href="https://apereo.github.io/cas/Mailing-Lists.html">ask for suggestions</a>. For the most part, the work item you wish to work on should be something you find interesting and enjoyable with some degree of practicality.</p>

<p>Remember that you are deploying open source software, which means you have automatically become a project/community member and a potential maintainer, whether you realize it or not. Staying in <em>consume-only</em> mode generally leads to poor results.</p>

<h1 id="what-can-i-work-on">What can I work on?</h1>

<p>All contributions are extremely welcomed with open arms regardless of shape, size and color. You may be interested in helping with fixing typos, writing documentation, authoring test cases, developing code, squashing bugs, etc. All is welcome.</p>

<p><a href="https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/">More contributions simply equal more confidence</a>.</p>

<p>In other words, if you happen to come across a bothersome use case and/or something you consider a perfect candidate for improvement and attention, you are most definitely, aggressively and wholeheartedly encouraged to spend time and DNA to improve the quality of your Apereo CAS life. There is no point in silent suffering.</p>

<p>If you find that contributing to the project is at the moment out of your reach, don’t worry. There are resources, <a href="https://www.coursera.org/">here</a> and <a href="https://www.apereo.org/content/commercial-affiliates">here</a> that can provide training and support to get you started for the win.</p>

<h1 id="do-i-need-an-issue-first">Do I need an issue first?</h1>

<p>No.</p>

<p>If you have already identified an enhancement or a bug, it is STRONGLY recommended that you simply submit a pull request to address the case. There is no need for special ceremony to create separate issues. The pull request <strong>IS</strong> the issue and it will be tracked and tagged as such. Remember that this is open source software in an open and collaborative community. It’s not “Some folks report issues and some folks fix problems” software.</p>

<h1 id="how-do-i-report-issues-then">How do I report issues then?</h1>

<p>You are welcome to submit issues via the <a href="https://github.com/apereo/cas/issues">project’s issue tracker</a>. Someone will review the report and will try to evaluate whether this is a genuine RFE or defect in which case the issue will be closed with a follow-up request for contributions and patches.</p>

<p>The issue tracker is only a simple communication tool to assess a given problematic case or enhancement request. It’s not tracking anything, really. You are for the most part and at all costs encouraged to submit patches that fix the reported issue and remove pain, rather than waiting for someone to come along and fix it. As prescribed, there is no <em>“we vs. you”</em>.</p>

<p>Very simply put:</p>

<blockquote>
  <p>You are the one you have been waiting for.</p>
</blockquote>

<div class="alert alert-success">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Notepad Works</strong><br />Try not to use the issue tracker as a backlog for items that need fixes from others. Any good task management software on your laptop will do instead. 
</div>

<h1 id="but-cant-i-just-use-the-software">But, can’t I just use the software?</h1>

<p>The distinction between user and developer is, for the most part, an imaginary one in open source. You are not a user. You are not a developer. <em>We</em> all are contributors. If you have already diagnosed a problem or have found a use case for an attractive improvement and feature, we strongly recommend you simply <a href="https://github.com/apereo/cas/graphs/contributors">walk down the path</a> of making that all a reality and <em>contribute</em> back. If you find yourself unable to do so, you will need to find and procure resources that can <a href="https://www.coursera.org/">teach you the how-to</a> or <a href="https://www.apereo.org/content/commercial-affiliates">do it for you</a>. Reporting an issue and hoping/waiting for someone else to come along and provide a fix for you is never an acceptable strategy.</p>

<blockquote>
  <p>I am only one; but still I am one. I cannot do everything; but still I can do something; and because I cannot do everything, I will not refuse to do the something that I can do. - Edward Everett Hale</p>
</blockquote>

<p>If you insist on being treated like a user, you then need to revisit and realign expectations with <a href="https://www.apereo.org/content/commercial-affiliates">folks and resources</a> that can provide you with the treatment you need. All of the work that goes into the development of a rich comprehensive software platform is almost exclusively done on a voluntary basis. Therefor, if you have expectations that resemble something of a commercial support agreement with clauses that include promises, guarantee, SLAs and follow-ups, you simply need to level up with an entity that actually provides that sort of functionality.</p>

<h1 id="how-do-i-know-whos-working-on-what">How do I know who’s working on what?</h1>

<ul>
  <li>Follow the <em>WIP Pattern</em> and submit <a href="https://ben.straub.cc/2015/04/02/wip-pull-request/">early pull requests</a>. This is in fact the recommended strategy from Github:</li>
</ul>

<blockquote>
  <p>Pull Requests are a great way to start a conversation of a feature, so start one as soon as possible- even before you are finished with the code. Your team can comment on the feature as it evolves, instead of providing all their feedback at the very end.</p>
</blockquote>

<p>Or put another way:</p>

<blockquote>
  <p>You’re opening pull requests when you start work, not when you’re finished.</p>
</blockquote>

<p>There is of course the alternative: <a href="https://apereo.github.io/cas/Mailing-Lists.html">ask</a>.</p>

<h1 id="can-i-backport-a-change-to-a-maintenance-branch">Can I backport a change to a maintenance branch?</h1>

<p>Yes, absolutely. Provided the change fits the scope of the maintenance branch and its tracking release and assuming the branch is still under care, you are more than welcome to move changes across the codebase various branches as much as needed to remove pain and improve.</p>

<h1 id="what-if-the-change-is-too-big">What if the change is too big?</h1>

<p>Start by reviewing the <a href="https://apereo.github.io/cas/developer/Release-Policy.html">release policy</a>. The change you have in mind should fit the scope of the release that is planned. If needed, <a href="https://apereo.github.io/cas/Mailing-Lists.html">please discuss</a> the release schedule and policy with other community members to find alternative solutions and strategies for delivery.</p>

<h1 id="is-it-worth-it">Is it worth it?</h1>

<p>The CAS project generally operates based on its own <a href="https://apereo.github.io/cas/developer/Maintenance-Policy.html">maintenance policy</a>. Before making changes, you want to cross check the CAS deployment you have today and ensure it is still and to what extent considered viable and maintained by the project.</p>

<h1 id="how-do-i-get-on-the-roadmap">How do I get on the roadmap?</h1>

<p>By simply delivering the change and having it get merged into the codebase relevant branches. There is no predefined roadmap for the project. The roadmap is what you intend to work on. Work items get completed based on community’s availability, interest, time and money.</p>

<h1 id="practically-how-soon-is-that-exactly">Practically, how soon is that exactly?</h1>

<p>You can review the <a href="https://github.com/apereo/cas/milestones">release schedule</a> from here. Note that the dates specified for each are somewhat tentative, and may be pushed around depending on need and severity.</p>

<p>As for general contributions, patches in form of pull requests are generally merged as fast as possible provided they are in <em>good health</em>. This means a given pull request must pass a series of automated checks that examine style, tests and such before it becomes eligible for a merge. If your proposed pull request does not yet have the green marking, worry not. Keep pushing to the branch that contains your change to auto-update the pull request and make life green again.</p>

<p>If you find that the project is not moving forward at a pace you find reasonable, simply <em>ping</em> the pull request and gently remind someone to step forward and review the issue with you.</p>

<h1 id="how-do-i-do-this">How do I do this?</h1>

<p>There is the <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contributor guide</a>, for sure. However, in this section we are going to practically take a look at the entire process from start to finish and see the patch all the way through.</p>

<p>In order to successfully finish this exercise you need:</p>

<ol>
  <li><a href="https://git-scm.com/downloads">Git</a></li>
  <li><a href="https://www.jetbrains.com/idea/download/">IntelliJ IDEA</a>, eclipse or NetBeans (Depending on the change, <code class="highlighter-rouge">vim</code> may be perfectly fine too)</li>
  <li><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Java (JDK)</a></li>
</ol>

<h2 id="fork-the-repository">Fork the repository</h2>

<p>First thing you need to do is to <a href="https://help.github.com/articles/fork-a-repo/">fork the CAS repository</a> under your own account. The CAS repository is hosted on Github and is available <a href="https://github.com/apereo/cas">here</a>.</p>

<h2 id="clone-repositories">Clone repositories</h2>

<p>There are much faster ways of cloning the codebase, but let’s keep it simple for now:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:apereo/cas.git
<span class="nb">cd </span>cas
git remote add mmoayyed git@github.com:mmoayyed/cas.git
git checkout master
</code></pre></div></div>

<p>Next, if you simply list the remotes you should see:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>origin  git@github.com:apereo/cas.git <span class="o">(</span>fetch<span class="o">)</span>
origin  git@github.com:apereo/cas.git <span class="o">(</span>push<span class="o">)</span>
mmoayyed  git@github.com:mmoayyed/cas.git <span class="o">(</span>fetch<span class="o">)</span>
mmoayyed  git@github.com:mmoayyed/cas.git <span class="o">(</span>push<span class="o">)</span>
</code></pre></div></div>

<p>You want to isolate your changes inside individual topics branches and never commit anything to the <code class="highlighter-rouge">master</code> branch. The workflow more or less is the following:</p>

<ol>
  <li>Create topic branch.</li>
  <li>Make changes and test.</li>
  <li>Commit changes to branch.</li>
  <li>Go back to #2 until you are satisfied.</li>
</ol>

<div class="alert alert-success">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Functional Build</strong><br />You may want to ensure the codebase can be built locally from source. <a href="https://apereo.github.io/cas/developer/Build-Process.html">Follow this guide</a> to learn more.
</div>

<h2 id="create-branch">Create branch</h2>

<p>To create a topic branch for the change, execute:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git status
git checkout <span class="nt">-b</span> my-topic-branch-which-fixes-something
</code></pre></div></div>

<h2 id="commit-changes">Commit changes</h2>

<p>When you’re ready to commit changes after having made changes, execute:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add <span class="nt">--all</span> <span class="o">&amp;&amp;</span> git commit <span class="nt">-am</span> <span class="s2">"This change fixes a problem"</span>
</code></pre></div></div>

<p>Note that the <code class="highlighter-rouge">--all</code> flag adds <em>all</em> modified files in the project directory. If you wish to pick and choose, you can either individually add files via a <code class="highlighter-rouge">git add fileName</code> command one at a time or perhaps, it might be best to simply opt for a GUI client such as <a href="https://www.sourcetreeapp.com/">SourceTree</a> or <a href="https://github.com/gitextensions/gitextensions">Git Extensions</a>.</p>

<h2 id="push-changes">Push changes</h2>

<p>Push your changes from the <em>local</em> branch to a <em>remote</em> branch of your own fork:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push mmoayyed my-topic-branch-which-fixes-something
</code></pre></div></div>

<h2 id="submit-pull-request">Submit pull request</h2>

<p>Follow the <a href="https://help.github.com/articles/about-pull-requests/">guide here</a> to create a pull request based on your branch to the CAS project. In this particular case, the <em>target</em> branch is the <code class="highlighter-rouge">master</code> branch because your own branch was created off of the <code class="highlighter-rouge">master</code> branch.</p>

<h1 id="how-fast-can-i-consume-the-change">How fast can I consume the change?</h1>

<p><code class="highlighter-rouge">SNAPSHOT</code> releases are published by the automatic <a href="https://travis-ci.org/apereo/cas/builds">Travis CI process</a>. As soon as a patch is merged, you want to track its build status and once it turns green, you should be good to update snapshots in your build script. Practically, this process can take up to 50 minutes or less. Refer to the <code class="highlighter-rouge">README</code> file of the build script and the project documentation to learn how you may update the overlay to take advantage of the change.</p>

<p>This practically usually involves running the build with a <code class="highlighter-rouge">-U</code> or <code class="highlighter-rouge">--refresh-dependencies</code> command for Apache Maven and Gradle respectively.</p>

<h1 id="so">So…</h1>

<p>I hope this brief overview was of some assistance to you. If you happen to come across other ideas that would make all our CAS lives easier, by all means and without hesitation, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">please get involved</a>.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/07/05/cas-contribution-guide/</guid>
                <description>
                    
                    A quick hands-on guide for one to get started with contributing to the development and prosperity of the Apereo CAS project.
                    
                </description>
                <pubDate>Wed, 05 Jul 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.2.0 RC1 Feature Release</title>
                <link>https://apereo.github.io/2017/06/30/520rc1-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The official CAS <code class="highlighter-rouge">5.1.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.1.0">May 27th 2017</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.2.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the first release candidate in the <code class="highlighter-rouge">5.2.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.2.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<!-- TOC -->

<ul>
  <li><a href="#01-minors">0.1. Minors</a></li>
  <li><a href="#02-documentation">0.2. Documentation</a></li>
  <li><a href="#03-webjars-for-static-resources">0.3. WebJARs for Static Resources</a></li>
  <li><a href="#04-trusted-authentication-attributes">0.4. Trusted Authentication Attributes</a></li>
  <li><a href="#05-amazon-cloud-directory-authentication">0.5. Amazon Cloud Directory Authentication</a></li>
  <li><a href="#06-cas-protocol-v2-forward-compatibility">0.6. CAS Protocol v2 Forward Compatibility</a></li>
  <li><a href="#07-jwts-for-rest-api">0.7. JWTs for REST API</a></li>
  <li><a href="#08-dynamic-caches-for-ticket-registries">0.8. Dynamic Caches for Ticket Registries</a></li>
  <li><a href="#09-update-checking">0.9. Update Checking</a></li>
  <li><a href="#010-header-response-method">0.10. HEADER Response Method</a></li>
  <li><a href="#011-adfs-delegated-authentication">0.11. ADFS Delegated Authentication</a></li>
  <li><a href="#012-adfs-saml-integration">0.12. ADFS SAML Integration</a></li>
  <li><a href="#013-ticket-registry-encryption">0.13. Ticket Registry Encryption</a></li>
  <li><a href="#014-stormpath-support-removed">0.14. Stormpath Support Removed</a></li>
  <li><a href="#015-ticket-validator-ssl-configuration">0.15. Ticket Validator SSL Configuration</a></li>
  <li><a href="#016-registered-services-endpoint">0.16. Registered Services Endpoint</a></li>
  <li><a href="#017-yubikey-mongodbjpa-storage">0.17. YubiKey MongoDb/JPA Storage</a></li>
  <li><a href="#018-couchbase-authentication">0.18. Couchbase Authentication</a></li>
  <li><a href="#019-apache-cassandra-authentication">0.19. Apache Cassandra Authentication</a></li>
  <li><a href="#020-custom-ldap-password-policy">0.20. Custom LDAP Password Policy</a></li>
  <li><a href="#021-fido-u2f-device-registration">0.21. FIDO U2F Device Registration</a></li>
  <li><a href="#022-jwts-as-service-tickets">0.22. JWTs As Service Tickets</a></li>
  <li><a href="#023-swivel-secure-authentication">0.23. Swivel Secure Authentication</a></li>
  <li><a href="#024-openid-connect-introspection">0.24. OpenID Connect Introspection</a></li>
  <li><a href="#025-oauth-client-credentials-grant">0.25. OAuth Client Credentials Grant</a></li>
  <li><a href="#026-attribute-repository-merging">0.26. Attribute Repository Merging</a></li>
  <li><a href="#027-library-upgrades">0.27. Library Upgrades</a></li>
  <li><a href="#028-whats-next">0.28. What’s Next?</a></li>
  <li><a href="#029-get-involved">0.29. Get Involved</a></li>
  <li><a href="#030-das-ende">0.30. Das Ende</a></li>
</ul>

<!-- /TOC -->

<h2 id="01-minors">0.1. Minors</h2>

<ul>
  <li>Performance improvements to ensure service selection strategies are properly sorted at runtime.</li>
  <li>A few bug fixes that affect the password management functionality and webflow handling of authentication failure events, thanks to <a href="https://github.com/pdrados">@pdrados</a>.</li>
  <li>Small regression in how URL-based SAML2 metadata resources are retrieved from <code class="highlighter-rouge">http</code> vs <code class="highlighter-rouge">https</code> resources.</li>
  <li>Thanks to <a href="https://github.com/pavelhoral">@pavelhoral</a>, ticket registries properly take into account the task of encoding tickets, if needed, before deleting them.</li>
  <li>Thanks to <a href="https://github.com/jkacer">@jkacer</a>, failed authentication attempts are improved to no longer be reported as throttled authentication attempts. Changes are backported as far as back as <code class="highlighter-rouge">5.0.x</code>.</li>
  <li>Plenty of minor performance improvements to the CAS service registry as well as the overall ticket registry components and that of Hazelcast in particular, thanks to <a href="https://github.com/DavidRG13">@DavidRG13</a> and <a href="https://github.com/tsschmidt">@tsschmidt</a>.</li>
  <li>Delegated authentication flows now gain support for naming the client, thanks to <a href="https://github.com/rrenomeron">@rrenomeron</a>.</li>
  <li>The Duo WebSDK has been upgraded to its most recent version.</li>
</ul>

<h2 id="02-documentation">0.2. Documentation</h2>

<p>Thanks to <a href="https://github.com/mindblender">@mindblender</a>, the <a href="https://apereo.github.io/cas/development/">documentation site</a> for the CAS project is now equipped with a much better search user interface.</p>

<h2 id="03-webjars-for-static-resources">0.3. WebJARs for Static Resources</h2>

<p>Targeting CAS deployments in environments that have no network access can be tricky. In this release candidate, CAS begins to beautifully bundle static UI resources (css, javascript, etc) into the build for offline access. These resources are turned into dependencies that the project stuffs into the build by default using WebJARs. The <code class="highlighter-rouge">org.webjars</code> project seems to package up most things that CAS needs in jars that are available in maven central and the servlet 3.0 specification makes the resources available to be served up by CAS.</p>

<p>Huge thanks to <a href="https://github.com/hdeadman">@hdeadman</a> for executing on this.</p>

<h2 id="04-trusted-authentication-attributes">0.4. Trusted Authentication Attributes</h2>

<p>The <a href="https://apereo.github.io/cas/development/installation/Trusted-Authentication.html">Trusted Authentication</a> features of CAS are now able to extract attributes from the remote request object, in cases where CAS is sitting behind a Shibboleth Service Provider, etc. Thanks to <a href="https://github.com/scalding">@scalding</a> for the find and suggestions on how to improve this best.</p>

<h2 id="05-amazon-cloud-directory-authentication">0.5. Amazon Cloud Directory Authentication</h2>

<p>Thanks to <a href="https://github.com/vulpayga">@vulpayga</a>, CAS gains the ability to use <a href="https://apereo.github.io/cas/development/installation/AWS-CloudDirectory-Authentication.html">Amazon Cloud Directory for authentication</a>.</p>

<h2 id="06-cas-protocol-v2-forward-compatibility">0.6. CAS Protocol v2 Forward Compatibility</h2>

<p>It is now possible to ensure CAS protocol <code class="highlighter-rouge">v2</code> views are forward compatible with CAS <code class="highlighter-rouge">v3</code>. The most significant change here is the ability to release attributes via <code class="highlighter-rouge">v2</code>. The behavior is controlled via a <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#views">setting</a> that can be turned on/off globally for the CAS deployment. You can read more about this behavior <a href="https://apereo.github.io/2017/06/23/cas-protocol-compatibility/">here</a>.</p>

<h2 id="07-jwts-for-rest-api">0.7. JWTs for REST API</h2>

<p>The <a href="https://apereo.github.io/cas/development/protocol/REST-Protocol.html">CAS REST API/Protocol</a> is now equipped with the capability to issue JWTs for service tickets.</p>

<h2 id="08-dynamic-caches-for-ticket-registries">0.8. Dynamic Caches for Ticket Registries</h2>

<p>The <a href="https://apereo.github.io/cas/development/installation/Ehcache-Ticket-Registry.html">Ehcache Ticket Registry</a> now gains the option to split caches dynamically based on ticket types, rather than keeping every ticket inside a single statically created cache. The same changeset is also applied to the ticket registry based on <a href="https://apereo.github.io/cas/development/installation/MongoDb-Ticket-Registry.html">MongoDb</a> as well as that of <a href="https://apereo.github.io/cas/development/installation/Ignite-Ticket-Registry.html">Apache Ignite</a>.</p>

<h2 id="09-update-checking">0.9. Update Checking</h2>

<p>CAS has been given the ability to check for newer released versions and report back as part of its banner. This behavior is off by default, and may be conditionally enabled via <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#cas-banner">the following guide</a>.</p>

<h2 id="010-header-response-method">0.10. HEADER Response Method</h2>

<p>CAS has for some time had the ability to redirect back to a requesting application providing the generated service ticket in form of a <code class="highlighter-rouge">GET</code> or <code class="highlighter-rouge">POST</code> via the <code class="highlighter-rouge">method</code> parameter. In this release, CAS adds an extra <code class="highlighter-rouge">HEADER</code> option, stuffing the ticket into a response header. This might be useful if you intend to execute non-interactive modes of authentication such as Basic Authentication.</p>

<h2 id="011-adfs-delegated-authentication">0.11. ADFS Delegated Authentication</h2>

<p><a href="https://apereo.github.io/cas/development/integration/ADFS-Integration.html">Delagating authentication to ADFS</a> is now enhanced to support more than once ADFS instance.</p>

<h2 id="012-adfs-saml-integration">0.12. ADFS SAML Integration</h2>

<p>A number of minor bugs have been fixed in this release to ensure ADFS acting as a SAML2 SP can be integrated with CAS acting as a SAML2 identity provider.</p>

<h2 id="013-ticket-registry-encryption">0.13. Ticket Registry Encryption</h2>

<p>The ticket registry implementations based on <a href="https://apereo.github.io/cas/development/installation/Ignite-Ticket-Registry.html">Apache Ignite</a> and <a href="https://apereo.github.io/cas/development/installation/MongoDb-Ticket-Registry.html">MongoDb</a> are now enhanced to support ticket registry encryption.</p>

<h2 id="014-stormpath-support-removed">0.14. Stormpath Support Removed</h2>

<p><a href="https://stormpath.com/">Stormpath</a> support has been removed from the codebase. This feature will no longer be available, as Stormpath APIs are soon to be retired in mid August after the Okta acquisition.</p>

<h2 id="015-ticket-validator-ssl-configuration">0.15. Ticket Validator SSL Configuration</h2>

<p>There are areas in CAS where a ticket is issued and validated internally to allow access to other downstream components. The configuration of ticket validation component is now exposed to the entire runtime and takes advantage of familiar CAS settings when it comes to SSL factories and hostname verifications.</p>

<h2 id="016-registered-services-endpoint">0.16. Registered Services Endpoint</h2>

<p>A <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html">new endpoint</a> is now exposed in CAS that can report back the collection of registered services with CAS.</p>

<h2 id="017-yubikey-mongodbjpa-storage">0.17. YubiKey MongoDb/JPA Storage</h2>

<p><a href="https://apereo.github.io/cas/development/installation/YubiKey-Authentication.html">YubiKey multifactor authentication</a> is now able to use MongoDb or a relational database for persisting device registration records. Improvements are in to also support new device registration workflows.</p>

<h2 id="018-couchbase-authentication">0.18. Couchbase Authentication</h2>

<p>CAS gains the ability to use <a href="https://apereo.github.io/cas/development/installation/Couchbase-Authentication.html">Couchbase</a> as an authentication store. Remember that Couchbase can also be used to <a href="https://apereo.github.io/cas/development/installation/Couchbase-Service-Management.html">manage CAS services</a> and act as a <a href="https://apereo.github.io/cas/development/installation/Couchbase-Ticket-Registry.html">ticket store</a> for HA deployments.</p>

<h2 id="019-apache-cassandra-authentication">0.19. Apache Cassandra Authentication</h2>

<p>Thanks to <a href="https://github.com/vulpayga">@vulpayga</a>, CAS gains the ability to use <a href="https://apereo.github.io/cas/development/installation/Cassandra-Authentication.html">Apache Cassandra</a> as an authentication store.</p>

<h2 id="020-custom-ldap-password-policy">0.20. Custom LDAP Password Policy</h2>

<p>There is now support for implementing your own custom LDAP password policy handler based on Ldaptive. Your implementation <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#ldap-authentication">needs to be taught to CAS</a> and should take on the following form:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.ldaptive.auth.AuthenticationResponseHandler</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyPasswordPolicyAuthenticationResponseHandler</span> <span class="kd">implements</span> <span class="n">AuthenticationResponseHandler</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="021-fido-u2f-device-registration">0.21. FIDO U2F Device Registration</h2>

<p>FIDO U2F support for multifactor authentication is now equipped with the ability to store device registration records inside a relational database and more. <a href="https://apereo.github.io/cas/development/installation/FIDO-U2F-Authentication.html#registration">See this</a> for more info.</p>

<h2 id="022-jwts-as-service-tickets">0.22. JWTs As Service Tickets</h2>

<div class="alert alert-warning">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Beware</strong><br />This may be a breaking configuration change. 
  Consult <a href="https://apereo.github.io/cas/development/">the docs</a> to learn more.
</div>

<p>The ability to issue <a href="https://apereo.github.io/cas/development/installation/Configure-ServiceTicket-JWT.html#configuration">JWTs as service tickets</a> is now refactored and moved into its own dedicated module such that it can then become reusable as a pluggable extension point in other parts of the codebase. If you had this feature turned on, you may need to adjust the module definition in your build slightly to stay on course with the coolness.</p>

<h2 id="023-swivel-secure-authentication">0.23. Swivel Secure Authentication</h2>

<p>CAS can now take advantage of Swivel Secure’s image-based multifactor authentication. See <a href="https://apereo.github.io/cas/development/installation/SwivelSecure-Authentication.html">this guide</a> to learn more.</p>

<p>Special thanks to <a href="https://github.com/dacurry-tns">@dacurry-tns</a> for contributing the baseline integration.</p>

<h2 id="024-openid-connect-introspection">0.24. OpenID Connect Introspection</h2>

<p>Modest support is now added for OpenID Connect to allow for introspection of access tokens.</p>

<h2 id="025-oauth-client-credentials-grant">0.25. OAuth Client Credentials Grant</h2>

<p>Support for OAuth2’s <code class="highlighter-rouge">client_credentials</code> grant is now <a href="https://apereo.github.io/cas/development/installation/OAuth-OpenId-Authentication.html">included in this release</a>.</p>

<h2 id="026-attribute-repository-merging">0.26. Attribute Repository Merging</h2>

<p>Attributes retrieved during the authentication phase are now given the ability to merge with attributes retrieved from separate attribute repository sources. This behavior previously was only available to select authentication strategies and is now globally applied to all.</p>

<h2 id="027-library-upgrades">0.27. Library Upgrades</h2>

<ul>
  <li>Spring Data</li>
  <li>Spring MongoDb</li>
  <li>Spring Cloud</li>
  <li>Spring Security</li>
  <li>EhCache</li>
  <li>Apache CXF</li>
  <li>Thymeleaf</li>
  <li>Sentry</li>
  <li>Memcached</li>
  <li>Apache Ignite</li>
  <li>Gradle</li>
  <li>Spring Boot</li>
  <li>Couchbase</li>
  <li>Infinispan</li>
  <li>UnboundID SCIM</li>
</ul>

<h2 id="028-whats-next">0.28. What’s Next?</h2>

<p>We are all working to make sure the CAS <code class="highlighter-rouge">5.2.0</code> release is on <a href="https://github.com/apereo/cas/milestones">schedule</a>.</p>

<h2 id="029-get-involved">0.29. Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Suggest and apply documentation improvements.</li>
</ul>

<h2 id="030-das-ende">0.30. Das Ende</h2>

<p>A big hearty thanks to all who participated in the development of this release to submit patches, report issues and suggest improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/06/30/520rc1-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.2.0 RC1 release.
                    
                </description>
                <pubDate>Fri, 30 Jun 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5 - Maintaining Protocol Compatibility</title>
                <link>https://apereo.github.io/2017/06/23/cas-protocol-compatibility/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>The <a href="https://apereo.github.io/cas/5.1.x/protocol/CAS-Protocol.html">third specification of the CAS protocol</a> was released around the time CAS <code class="highlighter-rouge">v4.0.0</code> came into existence. The primary objective of the revision was to bring the spec up to speed with common community practices and extensions, one of which most significantly was the ability to let CAS release attributes to authorized relying parties and applications.</p>

<p>In order to preserve protocol backward-compatibility, a new <code class="highlighter-rouge">/p3/serviceVaildate</code> endpoint was added whose only job was to release attributes to be consumed by clients. This way, existing CAS clients unable to parse the new <code class="highlighter-rouge">&lt;cas:attributes&gt;</code> block in the validation response could continue to function as they did. Newer clients could simply hit the new endpoint to receive attributes.</p>

<h1 id="problem-statement">Problem Statement</h1>

<p>There are cases where a certain number of today’s CAS clients are perfectly able to consume attributes from CAS protocol <code class="highlighter-rouge">v2</code>. How? Because support for attributes was an accepted <em>mod</em> made by most deployers and client developers. A deployer running some version of CAS <code class="highlighter-rouge">3.x</code> for instance had already applied the change to CAS for attribute release and had built clients or instructed vendors to build clients such that they all could consume attributes and enjoy coolness.</p>

<p>How’s that situation convered in the most recent CAS 5 release line?</p>

<h1 id="solution">Solution</h1>

<p>The trick is to ensure that the component responsible for validating tickets and producing the final payload is using the <em>correct</em> versions of the view/response which match that of CAS protocol <code class="highlighter-rouge">v3</code>. The most bullet-proof way of applying this change is with CAS 5’s auto-configuration strategy described below.</p>

<h2 id="cas-50x">CAS 5.0.x</h2>

<p>Design your own <code class="highlighter-rouge">@Configuration</code> class and have it simply match the following body. This component will be placed inside the CAS overlay under <code class="highlighter-rouge">/src/main/java/org/apereo/cas/config</code> and it must be housed inside the Java package <code class="highlighter-rouge">org.apereo.cas</code>. You may need to create the directory structure and you may also need to ensure relevant dependencies are under the <code class="highlighter-rouge">compile</code> scope so the configuration below can properly compile.</p>

<p>As you can see below, all we are doing is swapping out one set of views with another.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">apereo</span><span class="o">.</span><span class="na">cas</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apereo.cas.web.ServiceValidateController</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.annotation.PostConstruct</span><span class="o">;</span>

<span class="cm">/**
 * This is {@link CustomConfiguration} that replaces the CAS Protocol 2 validation endpoint (/serviceValidate)
 * with the CAS Protocol 3 (essentially applying the attribute modification to CAS protocol 2..
 *
 * @author John Gasper
 * @since 5.0.x
 */</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="s">"CustomConfiguration"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomConfiguration</span>
<span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">CustomConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"serviceValidateController"</span><span class="o">)</span>
    <span class="n">ServiceValidateController</span> <span class="n">serviceValidateController</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"cas3ServiceSuccessView"</span><span class="o">)</span>
    <span class="n">View</span> <span class="n">cas3ServiceSuccessView</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"cas3ServiceFailureView"</span><span class="o">)</span>
    <span class="n">View</span> <span class="n">cas3ServiceFailureView</span><span class="o">;</span>

    <span class="nd">@PostConstruct</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initializeRootApplicationContext</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">serviceValidateController</span><span class="o">.</span><span class="na">setSuccessView</span><span class="o">(</span><span class="n">cas3ServiceSuccessView</span><span class="o">);</span>
        <span class="n">serviceValidateController</span><span class="o">.</span><span class="na">setFailureView</span><span class="o">(</span><span class="n">cas3ServiceFailureView</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="cas-51x">CAS 5.1.x</h2>

<p>Same exact strategy as <code class="highlighter-rouge">5.0.x</code>, except that now you’re given the freedom to put the Java component anywhere inside any package in the overlay project, provided it’s <a href="https://apereo.github.io/cas/development/installation/Configuration-Management-Extensions.html">correctly registered</a> with the CAS auto configuration engine.</p>

<h2 id="cas-52x-53x">CAS 5.2.x, 5.3.x</h2>

<p>All that is still way too much work,  right? So starting with CAS <code class="highlighter-rouge">5.2.x</code> all one should have to do is to introduce the following setting in the <code class="highlighter-rouge">cas.properties</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.view.cas2.v3ForwardCompatible</span><span class="p">=</span><span class="s">true</span>
</code></pre></div></div>

<p>That’s it.</p>

<h1 id="so">So…</h1>

<p>Special thanks to <a href="https://github.com/jtgasper3">@jtgasper3</a> for sharing this neat trick and letting me brag about it.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/06/23/cas-protocol-compatibility/</guid>
                <description>
                    
                    A short and sweet CAS 5 guide on how to get CAS Protocol v2 to act as v3.
                    
                </description>
                <pubDate>Fri, 23 Jun 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>MyUW in 2016 - by the numbers</title>
                <link>https://apereo.github.io/2017/06/20/myuw-2016-numbers/</link>
                <content:encoded>
                    <![CDATA[
                    <p>This post considers MyUW in 2016 as framed by metrics.</p>

<p>Unless otherwise stated, all numbers are about calendar 2016. Point in time numbers are about December 31, 2016.</p>

<p>(See also <a href="https://www.icloud.com/keynote/0qw9oJfJU_Q1YX-1wCXQ8bKzg#MyUW_in_2016_by_the_numbers">minimalist slide deck</a>. One use for this post is as notes to support presenting or consuming that deck.)</p>

<h2 id="myuw-as-production-service">MyUW as production service</h2>

<h3 id="10-million-sessions">10 million sessions</h3>

<p>Per Google Analytics, MyUW served around <strong>ten million</strong> user sessions. MyUW serves a lot of traffic.</p>

<h3 id="8-million-outbound-links">8 million outbound links</h3>

<p>Users followed a link in MyUW out to something outside MyUW more than <strong>8,000,000</strong> times, including four million launches of Office365 and two million launches of the course dashboard. MyUW eases navigation to other systems.</p>

<h3 id="100000-notifications-displays">100,000 notifications displays</h3>

<p>Users viewed their full notification page around 100,000 times. Besides helping users navigate to other applications, MyUW helps users understand what they need to do and where they might need to navigate.</p>

<h3 id="100000-searches-and-app-directory-browses">100,000 searches and app directory browses</h3>

<p>MyUW presented the directory of applications around 100,000 times and provided search results in around 100,000 user sessions. Not all MyUW content relevant to all users can fit on default home pages, so MyUW supports users searching and browsing the available content.</p>

<h3 id="100000-home-page-modifications">100,000 home page modifications</h3>

<p>Once you’ve searched or browsed to something interesting, you can add it to your home page. Users modified their home pages almost 100,000 times, including adding the new Wiscard Balance widget almost 6,000 times.</p>

<h3 id="releases-every-7-days">Releases every 7 days</h3>

<p>MyUW releases to production every 7 days, in our 5am to 7am Tuesday morning release window. We rarely incur downtime even during this service window. We aspire to release more often, with better automation and evolving local culture to support and sustain this. Still, we’re already releasing relatively frequently. Releasing frequently allows us to ship less change more often to get feedback sooner and to incur less release risk.</p>

<p>We occasionally add additional release windows to ship urgent change. Our blue-green deployment practices allow us to do so without incurring service downtime – mostly no one notices.</p>

<h3 id="5-tiers">5 tiers</h3>

<p>We have <strong>5</strong> tiers:</p>

<ul>
  <li><code class="highlighter-rouge">predev</code>: Infrastructure and framework development. Content is relatively stable.</li>
  <li><code class="highlighter-rouge">test</code>: Content development. Infrastructure is relatively stable.</li>
  <li><code class="highlighter-rouge">qa</code>: Stable, tagged, versioned releases of all components. The purpose of this tier is to demonstrate specific, promotable versions working correctly together.</li>
  <li><code class="highlighter-rouge">stage</code> : Production in all ways except it runs the latest production build (the build “staged” for release) and no <code class="highlighter-rouge">my.wisc.edu</code> traffic is routed to it. Exactly the Docker image that’s running in <code class="highlighter-rouge">stage</code> is promoted to <code class="highlighter-rouge">prod</code> in the release process.</li>
  <li><code class="highlighter-rouge">prod</code> : Production. Runs a specific, deliberately-released version of the whole bundle. Typically a bundle precisely as it was validated in <code class="highlighter-rouge">stage</code>.</li>
</ul>

<p>Five tiers mean more opportunity for various development efforts to not step on one another’s toes, more opportunity for quality assurance and testing, and more opportunity to co-opt an environment to test e.g. a major upgrade of an external dependency.</p>

<p>Five tiers also helps make breaking changes and complicated upgrade paths painful enough that we look for ways to avoid breaking change, to simplify upgrade paths, and to change gracefully. Components coping better with more versions of dependencies yields a more stable solution, gives us better options in the rare case where we do need to drop back to an older version of a module, and yields more adoptable and supportable software products.</p>

<h3 id="4-production-vms">4 production VMs</h3>

<p>We have <strong>4</strong> production VMs running 8 virtual MyUW nodes of which 4 are typically in service at any time. This provides sufficient capacity to handle peak load, allows one or typically even two nodes to fail without significant adverse effect to service experience, and allows blue-green deployments with zero service downtime.</p>

<h3 id="160-apps">160 apps</h3>

<p>We had ~160 “real” items in the app directory, including</p>

<ul>
  <li>~50 apps for Madison students or applicants</li>
  <li>~25 administrative tools (both portal administration and some business function administration)</li>
  <li>~20 apps for Madison staff</li>
  <li>~20 apps for Madison constituents in general</li>
  <li>~5 apps supporting advising</li>
  <li>~5 apps supporting research</li>
</ul>

<p>We update this content frequently, with 261 changes to app directory content in 2016.</p>

<p>( <code class="highlighter-rouge">git log --since=2016-01-01 --before=2017-01-01 --oneline | wc -l</code> ).</p>

<h2 id="myuw-as-complex-system">MyUW as complex system</h2>

<p>MyuW has <strong>~50</strong> items eligible to appear by default on the user’s home screen. (No real user sees 50 items by default. Group matching pares this down to items that may be relevant.)</p>

<p>There are <strong>~90</strong> groups available for targeting in MyUW, including <strong>13</strong> managed in Manifest, UW-Madison’s Grouper instance.</p>

<h2 id="myuw-as-growing-and-evolving">MyUW as growing and evolving</h2>

<p><strong>5</strong> new notifications in 2016. Lots of potential in this feature, as yet un-realized.</p>

<h2 id="myuw-as-designed">MyUW as designed</h2>

<p>MyUW implements responsive design, flexing across browser window sizes. This improves the experience across the breadth of devices using MyUW, including the <strong>20%</strong> tablet or mobile phone form-factor traffic.</p>

<p>MyUW budgets for 0.75 FTE UX design from DoIT Communications.</p>

<p><strong>~40</strong> apps had interesting widgets, namely</p>

<ul>
  <li><a href="https://public.my.wisc.edu/web/apps/details/uw-badger-headlines">Badger Headlines</a> and <a href="https://public.my.wisc.edu/web/apps/details/ncaa-d1-news">NCAA D1 News</a></li>
  <li>Benefit Information x2</li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/campus-news">Campus News</a></li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/CourseGuide-Browse-Courses">Course Guide</a> and its <a href="https://public.my.wisc.edu/web/apps/details/CourseGuide-Help">help</a></li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/course-services">Course Services</a></li>
  <li>DoIT <a href="https://public.my.wisc.edu/web/apps/details/doit-scheduled-outages">planned</a> and <a href="https://public.my.wisc.edu/web/apps/details/doit-unplanned-outages">unplanned outages</a></li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/wisc-mail">Email</a></li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/google-apps">Google Apps</a></li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/doit-help-desk-notices">Help desk notices</a></li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/hr-payroll-benefits-news">HR, Payroll, and Benefit News</a> x2</li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/my-professional-development">Learning and Talent Development</a></li>
  <li>Local Contact Info</li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/HRSManagerTimeApproval">Manager Time Approval</a></li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/MyCourses">My Courses</a></li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/earnings-statement">Payroll Information</a> x2</li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/rprg">Research Project Resource Guide</a></li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/scholarships-at-uw-madison">Scholarships@UW-Madison</a></li>
  <li>UW-Extension CEOEL x11</li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/uwp-news-feed">UWP news</a>, <a href="https://public.my.wisc.edu/web/apps/details/uwrf-news-feed">UWRF news</a></li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/uwrf-employee-resources">UWRF resources</a></li>
  <li>Weather x2</li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/wiscard-balance">Wiscard Balance</a></li>
  <li><a href="https://public.my.wisc.edu/web/apps/details/uw-madison-working-at-uw">Working at UW</a></li>
</ul>

<h2 id="myuw-as-teams">MyUW as teams</h2>

<h3 id="infrastructure-team">Infrastructure team</h3>

<p>5 dedicated staff</p>

<ul>
  <li>3 full stack developers</li>
  <li>1 front end developer via ADI</li>
  <li>1 strategist</li>
</ul>

<p>and a wider cast, including</p>

<ul>
  <li>.75 User Experience consultant</li>
  <li>partial Site Reliability Engineer</li>
  <li>0.25 Tier ~2 Help Desk</li>
  <li>and a wider cast</li>
</ul>

<p>Dedicated, focused, invested staff in for the long term is key to MyUW success, to being a team, to delivering our quality, confident service.</p>

<p>0.25 FTE focused on escalated support cases, documenting known issues, digesting support into actionable product intelligence: working great, key to MyUW’s success.</p>

<h3 id="development-teams">Development teams</h3>

<p>4 teams active developing MyUW frame-based apps</p>

<ul>
  <li>MyUW Infrastructure</li>
  <li>MyUW Academic Applications</li>
  <li>ADI - Integrated Applications</li>
  <li>UW-Extension - Continuing Education, Outreach &amp; E-Learning</li>
</ul>

<h3 id="service-team">Service team</h3>

<p>Infrastructure Scrum team, plus</p>

<ul>
  <li>Service team lead</li>
  <li>Cybersecurity liaison</li>
  <li>MyUW Academic Applications liaison</li>
  <li>ADI - Integration Applications liaison</li>
  <li>DoIT Communications liaison</li>
  <li>UX</li>
  <li>Help Desk</li>
  <li>Site reliability engineer</li>
</ul>

<h2 id="myuw-as-serving-the-entire-uw-system">MyUW as serving the entire UW System</h2>

<h3 id="16-themes">16 themes</h3>

<h3 id="system-targeted-25-app-directory-entries">System-targeted 25 app directory entries</h3>

<ul>
  <li>~15 apps for System staff</li>
  <li>~10 apps for UW Extension CEOEL students</li>
</ul>

<h2 id="myuw-and-open-source">MyUW and open source</h2>

<h3 id="return-on-investment">Return on investment</h3>

<p><a href="https://blogs.worldbank.org/opendata/leveraging-open-source-public-institution-new-analysis-reveals-significant-returns-investment-open">The World Bank found</a> a <strong>200%</strong> return-on-investment in participating in open source. This is our strategy: build and collaborate on open source products in the hope of a positive return on this investment via collaboration, shared maintenance, and benefiting from the work of others. We develop more thoughtfully and more sustainably when we approach our work as building open source software products that are configured and adopted locally.</p>

<h3 id="50-releases-of-7-products">50 releases of 7 products</h3>

<p>MyUW posted <a href="https://apereo.github.io/2017/01/19/myuw-2016/"><strong>50 releases</strong> of <strong>7</strong> MyUW-led open source products in 2016</a>.</p>

<h3 id="1-apereo-board-member">1 Apereo board member</h3>

<p>MyUW team member Jim Helwig has long served on the <a href="https://www.apereo.org/content/leadership">Apereo Board of Directors</a>. Taking a hand in the governance of Apereo is part of how we contribute to its sustainability and thus to the sustainability of the context in which we can realize a return on our open source investment.</p>

<h3 id="2-uportal-steering-committee-members">2 uPortal steering committee members</h3>

<p>MyUW team members Jim Helwig and Andrew Petro serve on the Apereo uPortal steering committee. Taking a hand in the governance of uPortal is part of how MyUW contributes to its sustainability and thus to the sustainability of a context in which we can realize a return on our open source investment.</p>

<h3 id="425-commits-by-others">425 commits by others</h3>

<p>There were <a href="https://github.com/Jasig/uPortal/graphs/contributors?from=2016-01-30&amp;to=2016-12-31&amp;type=c">425 commits in 2016 to <code class="highlighter-rouge">Jasig/uPortal</code> <em>not</em> by University of Wisconsin employees</a>.</p>

<h2 id="in-summary">In summary</h2>

<p>MyUW is</p>

<ul>
  <li>a high-usage production service</li>
  <li>a complex system</li>
  <li>growing and with not-yet-fully-realized potential</li>
  <li>designed</li>
  <li>a team</li>
  <li>serving the entire University of Wisconsin system</li>
  <li>practicing open source</li>
</ul>

<p><a href="http://apetro.ghost.io/">Andrew Petro</a></p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/06/20/myuw-2016-numbers/</guid>
                <description>
                    
                    Reflecting upon MyUW in 2016 as framed by metrics.
                    
                </description>
                <pubDate>Tue, 20 Jun 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS Codebase Overview</title>
                <link>https://apereo.github.io/2017/06/12/cas-codebase-overview/</link>
                <content:encoded>
                    <![CDATA[
                    <p>Over the past couple of weeks, I have received a lot of positive feedback on CAS codebase organization and management. This blog post attempts to provide an overview of the current codebase status and offers to explain the supporting rationale and the decisions made to cleanup, break down and decompose the monolithic structure of the CAS project whose latest release as of today is <a href="https://github.com/apereo/cas/releases/tag/v5.1.0">available here</a>.</p>

<h1 id="the-1000-foot-view">The 1000-Foot View</h1>

<p>If you were to clone <a href="https://github.com/apereo/cas/">the CAS project on Github</a> and count the provided subprojects, as of this writing you might see something like the following snippet:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">cd </span>cas-server
<span class="o">&gt;</span> gradlew projects | wc <span class="nt">-l</span>
221
</code></pre></div></div>

<p>That’s a lot of projects! How is this managed and who can make sense of this beast?</p>

<p>At a very high-level, the project is broken into the following categories:</p>

<table>
  <thead>
    <tr>
      <th>Module</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">api</code></td>
      <td>CAS APIs that generically define the outline of a given behavior, such as authentication.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">core</code></td>
      <td>Implementations of said APIs. The presence of <em>almost everything</em> under this category is absolutely required for the CAS runtime to function correctly.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">docker</code></td>
      <td>Build configuration for automatic builds invoked by <a href="https://cloud.docker.com/">Docker Cloud</a>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">docs</code></td>
      <td><a href="https://apereo.github.io/cas">Project documentation</a> artifacts managed by <a href="https://pages.github.com/">Github Pages</a>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">etc</code></td>
      <td>Miscellaneous configuration files used by the build or the documentation site.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">gradle</code></td>
      <td>Houses <a href="https://docs.gradle.org/current/userguide/gradle_wrapper.html">the gradle wrapper</a> used for internal builds.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">style</code></td>
      <td>Guidelines and rules enforced and consumed by project’s various static analysis checkers, such as Checkstyle and Findbugs.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">support</code></td>
      <td>Extensions that enrich one’s CAS experience with lots and lots of functionality and integrations. (i.e. LDAP, MFA, etc)</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">travis</code></td>
      <td>Configuration artifacts used by <a href="travis-ci.org/apereo/cas/builds">Travis CI</a>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">webapp-mgmt</code></td>
      <td>Artifacts that pertain to the configuration and deployment of the <a href="https://apereo.github.io/cas/5.1.x/installation/Installing-ServicesMgmt-Webapp.html">CAS Service Management Web Application</a>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">webapp</code></td>
      <td>Artifacts that pertain to the deployment of the core CAS web application and its many sisters.</td>
    </tr>
  </tbody>
</table>

<p>As you drill into each category, you are presented with a hierarchy and a naming scheme that intends to explain what each project folder is all about. Note that the above organization is not only rather <em>pleasing</em> to the eye, but it also tries to reduce the initial <em>scare factor</em> to some degree. All visitors, friend and foe alike, who happen to step into the project space on Github are not immediately greeted with a structure that demonstrates 221+ things, forcing them to endlessly scroll downward to finally get to the actual <code class="highlighter-rouge">README.md</code> file. So, this model is a representation of the project’s organization and essential components, gently and without risk to gradually boil the proverbial frog and get one acclimated for contributions.</p>

<p>After all, that is what we want we to do.</p>

<h1 id="no-feature-left-behind">No Feature Left Behind</h1>

<p>Core CAS components aside, there are a lot of other individual modules (i.e. <code class="highlighter-rouge">JAR</code> artifacts) which act as support modules or more accurately put, <em>intentions</em>. What is that about?</p>

<p>In order to ease the maintenance burden of both code and documentation and to create a sustainable development environment for the project to grow and keep up with the times and additions of new [more complicated] features (i.e. multifactor authentication), CAS 5 took an orthogonal approach where most if not all CAS features are <a href="https://apereo.github.io/2017/02/21/cas-autocfg-strategy/">automatically configured</a> by CAS itself, given deployer’s consent, relieving the deployer from having to deal with manual configuration. This is a model referred to as <strong>Intention-driven configuration</strong>.</p>

<p>Each support module essentially focuses on a single feature or intention or a particular variation of one. It latches onto the runtime and does what it should, inserting itself in all the right places dynamically in order to provide the intended functionality in an automated way. It’s nice that one can fiddle with a variety of configuration files to make something work. It’s a whole lot better though ambitious to <em>automate once, run everywhere</em>.</p>

<p>Modules are super cheap and modest. Sometimes they only provide the necessary dependencies to provide functionality. Sometimes they provide a specific implementation for an existing feature, such as the ability to store device registrations into a relational database during multifactor authentication flows. Sometimes they actually provide essential functionality, such as multifactor authentication support via Google Authenticator.</p>

<p>Whatever it may be, the question ultimately for the deployer is:</p>

<blockquote>
  <p>I intend to do X with the software and there is a module that lets me.</p>
</blockquote>

<p>You want the feature? Drop the module in and it does stuff. You don’t want the feature? Remove the module and it will stop doing that. 
Is it perfect? Surely not, but it should be THAT simple.</p>

<div class="alert alert-info">
<strong>Not OSGi</strong><br />The project structure might seemingly have you suppose that this all somehow stemmed from or was inspired by OSGi principals. While that claim is not entirely false, you should know that CAS today does [and has] nothing to do with OSGi.
</div>

<h1 id="delete-such-joy">Delete: Such Joy</h1>

<p>One of the more important advantages of such decomposition is that it allows one to write code that is very easy, nay, a joy to delete. If the configuration and logic of a given behavior are all housed inside a subproject, you should be able to press delete at any given time without causing mass chaos in other parts of the codebase. This is the concept of encapsulation and self-containment. With proper design and organization, removing cruft should be as easy as striking the appropriate key on the keyboard.</p>

<h1 id="challenges">Challenges</h1>

<p>Of course, not everything is peachy all the time. There are a number of concerns that one needs to take into account. Summarily, here are a few:</p>

<h2 id="circular-dependencies">Circular Dependencies</h2>

<p>As the codebase is broken apart, it will slowly become apparent that certain modules require a dependency on other modules. If not done carefully, these relationships very quickly turn into an unending cat-and-mouse game. Tread lightly.</p>

<h2 id="when-enough-is-enough">When Enough Is Enough</h2>

<p>In certain literatures, it is argued that managing one big thing is much easier, conceptually, than managing 100 small things. That’s not entirely false. It, decomposition, requires not only skill and command but also capacity, availability and self-control. All good things are usually done in moderation; so do not overdo. The boundaries of where one module stops and another begins should be designed and apparent at reasonable granular levels and no more, where you decide what <em>reasonable</em> and <em>granular</em> mean.</p>

<h2 id="talk-is-cheap-show-me-the-code">Talk Is Cheap; Show Me The Code</h2>

<blockquote>
  <p>Don’t suggest code improvements. Code your suggested improvements.</p>
</blockquote>

<p>Remember that nothing is perfect; Improve and iterate as often as possible. There will always be better ways. There will always be better ideas. Jot them down and encourage friend and foe to starting executing on such ideas rather than merely suggesting them.</p>

<h1 id="so">So…</h1>

<p>I hope this brief overview was of some assistance to you. If you happen to come across other ideas and innovative solutions that would make all our CAS lives easier, by all means and without hesitation, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">please get involved</a>.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/06/12/cas-codebase-overview/</guid>
                <description>
                    
                    An overview of the CAS codebase organization and layout in which I also dig into the rationale behind project's efforts on modularization and code decomposition.
                    
                </description>
                <pubDate>Mon, 12 Jun 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5 Load Tests by Lafayette College</title>
                <link>https://apereo.github.io/2017/06/09/cas5-perfresults-LafayetteCollege/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-info">
  <strong>Contributed Content</strong><br />Carl Waldbieser (<code>&lt;waldbiec [at] lafayette.edu&gt;</code>), an active member of the CAS community, was kind enough to share this analysis.
</div>

<!-- TOC -->

<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#deployment-architecture">Deployment Architecture</a></li>
  <li><a href="#the-test-swarm">The Test Swarm</a></li>
  <li><a href="#the-trials">The Trials</a>
    <ul>
      <li><a href="#trial-1">Trial 1</a></li>
      <li><a href="#trial-2">Trial 2</a></li>
      <li><a href="#trial-3">Trial 3</a></li>
      <li><a href="#trial-4">Trial 4</a></li>
      <li><a href="#trial-5">Trial 5</a></li>
      <li><a href="#trial-6">Trial 6</a></li>
    </ul>
  </li>
  <li><a href="#conclusions">Conclusions</a></li>
</ul>

<!-- /TOC -->

<h1 id="overview">Overview</h1>

<p>Load testing trials were conducted on the CAS stage environment in order to provide insight into what kind of sustained load the production CAS service will be able to carry. All trials were carried out against the same deployment architecture, with all nodes configured identically.</p>

<h1 id="deployment-architecture">Deployment Architecture</h1>

<p>The deployment architecture itself consists of 3 virtual machine nodes. Each node has 3.7 GiB real memory available to it and 2 CPUs.</p>

<p>The characteristics of the CPUs are as follows:</p>

<ul>
  <li>Architecture: x86_64</li>
  <li>CPU op-mode(s): 32-bit, 64-bit</li>
  <li>Byte Order: Little Endian</li>
  <li>CPU(s): 2</li>
  <li>On-line CPU(s) list: 0,1</li>
  <li>Thread(s) per core: 1</li>
  <li>Core(s) per socket: 2</li>
  <li>Socket(s): 1</li>
  <li>NUMA node(s): 1</li>
  <li>Vendor ID: GenuineIntel</li>
  <li>CPU family: 6</li>
  <li>Model: 42</li>
  <li>Model name: Intel Xeon E312xx (Sandy Bridge)</li>
  <li>Stepping: 1</li>
  <li>CPU MHz: 1899.999</li>
  <li>BogoMIPS: 3799.99</li>
  <li>Hypervisor vendor: KVM</li>
  <li>Virtualization type: full</li>
  <li>L1d cache: 32K</li>
  <li>L1i cache: 32K</li>
  <li>L2 cache: 4096K</li>
  <li>NUMA node0 CPU(s): 0,1</li>
</ul>

<p>The nodes are deployed behind an Nginx+ proxy in an active-active-active configuration. The nodes share ticket information using encrypted Hazelcast messages, a feature built into the CAS software, so any application state is shared.</p>

<h1 id="the-test-swarm">The Test Swarm</h1>

<p>The testing framework used was <code class="highlighter-rouge">locust.io</code>, a Python based load testing framework. The test suite deploys a fixed number of “locusts” against a web site. To lean more about locust, please <a href="https://apereo.github.io/cas/5.1.x/planning/High-Availability-Performance-Testing.html">see this guide</a>.</p>

<p>The initial population ramps up with a configurable “hatch rate”. In the tests, locusts were conceptually divided into 3 “lifetime” categories:</p>

<ul>
  <li>Short-lived locusts live approximately 60 seconds.</li>
  <li>Medium-lived locusts last for approximately 5 minutes.</li>
  <li>Long-lived locusts exist for approximately 2 hours.</li>
</ul>

<p>The category to which a given locust is assigned is randomly determined with a ratio of short : medium : long being 7:2:1.  Ideally, 70% of the population is short-lived, 20% is medium lived, and 10% is long-lived.</p>

<p>The lifetime of a locust determines how long it will retain and make use of a single web SSO session.  Short-lived locusts discard their sessions quickly.  Long-lived locusts hold on to them for considerable time.</p>

<p>All locusts are only 25% likely to log out upon their deaths.  The CAS service must continue to track TGTs of locusts that have not logged out until the ticket expires, so this behavior can put pressure on the memory storage resources of the nodes.</p>

<p>Each locust uses credentials taken randomly from one of 9 test accounts.  Each locust has a 1% chance of entering an erroneous password for an account.  Locusts that fail to authenticate will die immediately.</p>

<p>When a locust dies, it is reborn immediately.  Its lifetime category remains the same, but its SSO session and all other random parameters are reset.</p>

<h1 id="the-trials">The Trials</h1>

<h2 id="trial-1">Trial 1</h2>

<table>
  <thead>
    <tr>
      <th># of Locusts</th>
      <th>Hatch Rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">300</code></td>
      <td><code class="highlighter-rouge">10/s</code></td>
    </tr>
  </tbody>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/26984798-cc315252-4d0e-11e7-9802-058f29576dd9.png" alt="" /></p>

<p>The first trial produced authentication events at a rate of over 3,500 event/minute.  The majority of these were service ticket creation and validation events.  By 13:40 (~5 hours into the trial), degraded performance became noticeable.  By 15:50 (~7 hours in), the nodes were swamped.  The trial was discontinued shortly thereafter.</p>

<h2 id="trial-2">Trial 2</h2>

<table>
  <thead>
    <tr>
      <th># of Locusts</th>
      <th>Hatch Rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">300</code></td>
      <td><code class="highlighter-rouge">10/s</code></td>
    </tr>
  </tbody>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/26984871-1d38b550-4d0f-11e7-8242-6e7d646f8ca4.png" alt="" /></p>

<p>The 2nd trial was similar to the first, but the number of locusts was briefly increased to 500 for a 3 minute duration.</p>

<p>The characteristics of trial 2 are very similar to those of trial 1. After responding to ~3,500 / minute for close to 6 hours, the nodes were overwhelmed.</p>

<h2 id="trial-3">Trial 3</h2>

<table>
  <thead>
    <tr>
      <th># of Locusts</th>
      <th>Hatch Rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">150</code></td>
      <td><code class="highlighter-rouge">10/s</code></td>
    </tr>
  </tbody>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/26984914-48d894f0-4d0f-11e7-9e68-c43eafb8804b.png" alt="3" /></p>

<p>The 3rd trial used half the number of locusts used in the first 2 trials.  The sustained event rate was ~1,700 authentication events per minute.  Unlike the previous 2 trials, this trial was concluded prior to the nodes becoming overwhelmed.  It is unknown whether the nodes could continue to sustain responding to events at this rate indefinitely.</p>

<h2 id="trial-4">Trial 4</h2>

<table>
  <thead>
    <tr>
      <th># of Locusts</th>
      <th>Hatch Rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">50</code></td>
      <td><code class="highlighter-rouge">10/s</code></td>
    </tr>
  </tbody>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/26984957-68665370-4d0f-11e7-82ac-ca61673e09ec.png" alt="4" /></p>

<p>The 4th trial showed the nodes were capable of sustaining a ~600 authentication events/minute rate for a full 24 hours.  Because the maximum lifetime of a TGT is 8 hours, there is some reason to believe this rate could have been sustained indefinitely.</p>

<h2 id="trial-5">Trial 5</h2>

<table>
  <thead>
    <tr>
      <th># of Locusts</th>
      <th>Hatch Rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">25</code></td>
      <td><code class="highlighter-rouge">10/s</code></td>
    </tr>
  </tbody>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/26984978-8439edbe-4d0f-11e7-992d-8a80eca2a276.png" alt="5" /></p>

<p>This trial was useful in establishing the mean rate of 291 events per minute given a swarm of 25 locusts.  This test and test 6 are notably shorter in duration than the other tests, as it is assumed at this point the nodes can sustain the loads indefinitely.</p>

<h2 id="trial-6">Trial 6</h2>

<table>
  <thead>
    <tr>
      <th># of Locusts</th>
      <th>Hatch Rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">10</code></td>
      <td><code class="highlighter-rouge">10/s</code></td>
    </tr>
  </tbody>
</table>

<p><img src="https://user-images.githubusercontent.com/1205228/26985007-a23ce76c-4d0f-11e7-9ccf-670146fc8ba6.png" alt="6" /></p>

<p>The mean rate of authentication events for this trial is 118 events per minute.</p>

<h1 id="conclusions">Conclusions</h1>

<p>Measurements taken from the production CAS service from April 17-21, 2017 during normal business hours (9am to 5pm) have the following characteristics:</p>

<table>
  <thead>
    <tr>
      <th>Mean</th>
      <th>Median</th>
      <th>Mode</th>
      <th>Max</th>
      <th>Min</th>
      <th>Std Dev</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>149 events/minute</td>
      <td>139 events/minute</td>
      <td>126 events/minute</td>
      <td>494 events/minute</td>
      <td>2 events/minute</td>
      <td>68</td>
    </tr>
  </tbody>
</table>

<p>While there appears to be some “burstiness” in the rate of authentication events, all 3 types of averages are well below the the expected threshold which the trials suggest are indefinitely sustainable.  Even the maximum rate of 494 events per minute is well below the sustained rate of trial 4 (~ 600 events / minute).</p>

<p>The data suggests that the production CAS service is operating well under the maximum sustainable load, and should have plenty of capacity to spare for temporary spikes in utilization.</p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/06/09/cas5-perfresults-LafayetteCollege/</guid>
                <description>
                    
                    Lafayette College shares the results of stress tests executed against a recent CAS 5.0.x deployment.
                    
                </description>
                <pubDate>Fri, 09 Jun 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Shibbolizing Apereo CAS</title>
                <link>https://apereo.github.io/2017/05/26/cas-shibsp-samlidp/</link>
                <content:encoded>
                    <![CDATA[
                    <p>This is a brief overview that explains how to <em>shibbolize</em> the Apereo CAS server; that is to let the CAS server be <em>protected</em> by an instance of the <a href="https://shibboleth.net/products/service-provider.html">Shibboleth Service Provider</a>, where the SP is then tasked to delegate authentication requests to a remote SAML2 identity provider. The entire SAML2 interaction is kept between the SP and the IdP while CAS on the return trip eventually picks up the user profile from the SP in form of special headers, etc.</p>

<h1 id="butwhy">But…Why?</h1>

<p>This is a very elaborate setup, yes. The goal originally was to let CAS simply and directly delegate authentication requests to the SAML2 identity provider. <a href="https://apereo.github.io/2017/03/22/cas51-delauthn-tutorial/">This can very easily be done</a>, <em>except</em> that in this particular case the SAML2 identity provider only supported a very specific and rather complicated variation of the SAML2 protocol, whose support is absent in CAS today. Convincing the identity provider to provide support for the more-mainstream <em>SAML2 WebSSO Browser Profile</em> led to a path riddled with uncertainties. After further analysis, we came to the conclusion that implementing built-in support for the IdP-supported SAML2 profile variation in CAS is unnecessarily complicated, needlessly expensive and possibly soon-to-be obsolete.</p>

<p>Of course, <a href="https://apereo.github.io/2017/02/18/onthe-theoryof-possibility/">it is certainly possible to do</a>. If you have to ask: all you need is love, coffee and access to decent hair conditioning products.</p>

<p>So the path to least resistance turned out to be a deployment with a few additional components and with a clear separation of boundaries. Thanks to Docker and outstanding help from colleagues, we managed to get this working.</p>

<p>Read on.</p>

<h1 id="how">How</h1>

<p>Starting out with a proof of concept, we came up with a dockerized deployment as such:</p>

<ul>
  <li>CAS Server <code class="highlighter-rouge">5.1.0-SNAPSHOT</code>, running inside an embedded Apache Tomcat</li>
  <li><a href="https://wiki.shibboleth.net/confluence/display/SHIB2/Installation">Shibboleth Service Provider for Apache</a></li>
  <li>Apache Web Server</li>
  <li>A sample CASified PHP application</li>
  <li><a href="https://wiki.shibboleth.net/confluence/display/IDP30">Shibboleth Identity Provider</a> <code class="highlighter-rouge">3.4.x</code> running inside Jetty</li>
</ul>

<p>Shy of a pretty sequence diagram, here’s how the interaction between the above components works:</p>

<ol>
  <li>Client browser attempts to access the sample CASified PHP application.</li>
  <li>Requests to the CAS <code class="highlighter-rouge">/login</code> endpoint are intercepted by the SP and Apache.</li>
  <li>The SP, configured to speak the special SAML2 protocol, routes the request to the IdP.</li>
  <li>The IdP accepts user credentials and posts back the response to the SP.</li>
  <li>The SP <em>passes</em> the response back to the CAS <code class="highlighter-rouge">/login</code> endpoint.</li>
  <li>CAS is configured to <em>trust</em> the response and proceeds to extract user profile data from the request.</li>
  <li>CAS proceeds to issue an <code class="highlighter-rouge">ST</code> for the PHP application that initiated the request.</li>
  <li>Having received and validated the <code class="highlighter-rouge">ST</code>, user is granted entry to the PHP application.</li>
</ol>

<h1 id="cas">CAS</h1>

<p>We also applied a few minor patches to CAS:</p>

<ul>
  <li>Ensure CAS could easily lend itself to be intercepted by Apache when running in embedded mode.</li>
  <li>Ensure user profile data can correctly be recognized from the SP.</li>
  <li>Ensure attributes collected from the SP can be merged and combined with CAS’ own, in cases where supplementary attribute sources are directly defined inside CAS.</li>
</ul>

<p>The <em>trusted</em> authentication piece <a href="https://apereo.github.io/cas/development/installation/Trusted-Authentication.html">is already handled by CAS</a> today.</p>

<h1 id="how-do-i">How Do I…?</h1>

<p>All patches are contributed back to the CAS project. You are most welcome! :-)</p>

<h1 id="so">So…</h1>

<p>Special thanks to <a href="https://github.com/jtgasper3">@jtgasper3</a> for beautifully cementing the deployment foundation of each component via Docker, big kudos to <a href="https://github.com/scalding">@scalding</a> for making the integration magic work seamlessly and to <a href="https://github.com/apetro">@apetro</a> for having previously worked on the <em>trusted</em> authentication piece in CAS.</p>

<p>Of course, I intend to take all the credit.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/05/26/cas-shibsp-samlidp/</guid>
                <description>
                    
                    Learn about a rather fancy Apereo CAS server deployment, sitting behind the Shibboleth Service Provider.
                    
                </description>
                <pubDate>Fri, 26 May 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Easier CLA submission</title>
                <link>https://apereo.github.io/2017/05/05/jotform-clas/</link>
                <content:encoded>
                    <![CDATA[
                    <p>Now it is easier to submit a contributor licensing agreement (CLA) to Apereo, with online forms, one for each type of agreement, linked from <a href="https://www.apereo.org/licensing">the licensing page</a>.</p>

<p>Contributor agreements allow Apereo to sublicense your contributions to others under flexible terms, including under the open source licenses adopted by the Apereo projects. The Apereo Foundation collects and maintains licensing agreements and grant assignments at the institutional and individual level and <a href="http://licensing.apereo.org/">publishes the results publicly</a>.</p>

<p>With thanks especially to John Lewis and Neal Caidin for the JotForm implementation of these online forms.</p>

<p>-<a href="https://apetro.ghost.io">Andrew Petro</a></p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/05/05/jotform-clas/</guid>
                <description>
                    
                    A new online form supplements prior ways of submitting contributor license agreements.
                    
                </description>
                <pubDate>Fri, 05 May 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.0.x Integration w/ Apache ZooKeeper</title>
                <link>https://apereo.github.io/2017/04/30/cas50-zookeepercfg/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-info">
  <strong>Contributed Content</strong><br />Giovanni Morelli (Email: <kbd>giannimorell at gmail.com</kbd>, Github: <kbd>@GiovanniMorelli</kbd>) was kind enough to share this guide.
</div>

<p>I have created a <code class="highlighter-rouge">cas-server-core-configuration-cloud-zookeeper</code> module for CAS <code class="highlighter-rouge">5.0.4</code> based on <code class="highlighter-rouge">cas-server-core-configuration-cloud-mongo</code>
When CAS is started, it reads all properties under zookeeper’s path: <code class="highlighter-rouge">/cas/config/cas</code> without the need to configure <code class="highlighter-rouge">cas.properties</code>.</p>

<p>The project source code is <a href="https://drive.google.com/file/d/0B984z5r9uFKgR3dNa3JIbm1lRnM/view">available here</a>.</p>

<h1 id="configuration">Configuration</h1>

<ul>
  <li>Add parameter <code class="highlighter-rouge">cas.spring.cloud.zookeeper.uri=localhost:2181</code> in <code class="highlighter-rouge">bootstrap.properties</code></li>
  <li>Add configurations on Zookeeper. Example: <code class="highlighter-rouge">cas.server.name: https://localhost:9327</code></li>
  <li>Start CAS.</li>
</ul>

<h1 id="build">Build</h1>

<p>Download the codebase for CAS <code class="highlighter-rouge">5.0.4</code> first and add the project source code into the <code class="highlighter-rouge">core</code> directory.</p>

<p>Make the following changes:</p>

<ul>
  <li><code class="highlighter-rouge">settings.gradle</code> (Root project)
    <ul>
      <li>Add <code class="highlighter-rouge">include "core:cas-server-core-configuration-cloud-zookeeper"</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">gradle.properties</code> (Root project)
    <ul>
      <li>Update version zookeeper : <code class="highlighter-rouge">zookeeperVersion=3.4.10</code></li>
      <li>Add <code class="highlighter-rouge">springCloudZookeeperVersion=1.0.4.RELEASE</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">build.gradle</code> (into project <code class="highlighter-rouge">cas-server-core-configuration-cloud-zookeeper</code>)</li>
</ul>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">description</span> <span class="o">=</span> <span class="s2">"Apereo CAS Core Configuration - Zookeeper"</span>

<span class="n">dependencies</span> <span class="o">{</span>
  <span class="n">compile</span> <span class="n">libraries</span><span class="o">.</span><span class="na">springboot</span>
  <span class="n">compile</span> <span class="n">libraries</span><span class="o">.</span><span class="na">spring</span>
  <span class="n">compile</span> <span class="n">libraries</span><span class="o">.</span><span class="na">springcloud</span>
  <span class="n">compile</span> <span class="n">libraries</span><span class="o">.</span><span class="na">zookeeper</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Classes used in the ZooKeeper project:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/cas-server-core-configuration-cloud-zookeeper/src/main/java/org/apereo/cas/ZookeeperPropertySource.java
/cas-server-core-configuration-cloud-zookeeper/src/main/java/org/apereo/cas/ZookeeperPropertySourceLocator.java
/cas-server-core-configuration-cloud-zookeeper/src/main/java/org/apereo/cas/config/ZookeeperCloudConfigBootstrapConfiguration.java
</code></pre></div></div>

<p>Build the codebase with <code class="highlighter-rouge">gradlew clean build --parallel -x test -x javadoc -x check</code>.</p>

<h1 id="overlay">Overlay</h1>

<p>Add this configuration in <code class="highlighter-rouge">pom.xml</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>cas-server-core-configuration-cloud-zookeeper<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h1 id="todo">TODO</h1>

<ul>
  <li>When you add a new configuration to Zookeeper, reload the configuration property automatically in CAS.</li>
</ul>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/04/30/cas50-zookeepercfg/</guid>
                <description>
                    
                    Learn how to have Apache ZooKeeper manage the configuration of CAS 5.0.x
                    
                </description>
                <pubDate>Sun, 30 Apr 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.1.0 RC4 Feature Release</title>
                <link>https://apereo.github.io/2017/04/28/rc4-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<p>The official CAS <code class="highlighter-rouge">5.0.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.0.0">November 7th 2016</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.1.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the fourth release candidate in the <code class="highlighter-rouge">5.1.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.1.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<p>If you are looking for additional info on the previous release candidate, <a href="https://apereo.github.io/2017/03/31/rc3-release/">please see this post</a>.</p>

<!-- TOC -->

<ul>
  <li><a href="#saml2-service-providers">SAML2 Service Providers</a></li>
  <li><a href="#cas-demos">CAS Demos</a></li>
  <li><a href="#surrogate-authentiction">Surrogate Authentication</a></li>
  <li><a href="#saml2-nameid-qualifiers">SAML2 NameID Qualifiers</a></li>
  <li><a href="#scripted-attribute-release">Scripted Attribute Release</a></li>
  <li><a href="#distributed-tracing">Distributed Tracing</a></li>
  <li><a href="#encrypted-service-usernames">Encrypted Service Usernames</a></li>
  <li><a href="#automated-docker-cloud-builds">Automated Docker Cloud Builds</a></li>
  <li><a href="#eureka-service-discovery">Eureka Service Discovery</a></li>
  <li><a href="#spring-cloud-w-apache-zookeeper">Spring Cloud w/ Apache ZooKeeper</a></li>
  <li><a href="#logging-enhancements">Logging Enhancements</a></li>
  <li><a href="#spring-boot-administration-server">Spring Boot Administration Server</a></li>
  <li><a href="#multifactor-entityid-trigger">Multifactor EntityID Trigger</a></li>
  <li><a href="#principal-id-as-attribute">Principal ID As Attribute</a></li>
  <li><a href="#groovy-attribute-value-filters">Groovy Attribute Value Filters</a></li>
  <li><a href="#documentation">Documentation</a></li>
  <li><a href="#minor-changes">Minor Changes</a>
    <ul>
      <li><a href="#community-contributions">Community Contributions</a></li>
      <li><a href="#others">Others</a></li>
    </ul>
  </li>
  <li><a href="#library-upgrades">Library Upgrades</a></li>
  <li><a href="#whats-next">What’s Next?</a></li>
  <li><a href="#get-involved">Get Involved</a></li>
  <li><a href="#das-ende">Das Ende</a></li>
</ul>

<!-- /TOC -->

<h2 id="saml2-service-providers">SAML2 Service Providers</h2>

<p>A few more <a href="https://apereo.github.io/cas/development/integration/Configuring-SAML-SP-Integrations.html">SAML2 service providers</a> are added to this release namely Adobe Cloud, AcademicWorks, Infinite Campus, Slack, Gartner, Zendesk and more.</p>

<h2 id="cas-demos">CAS Demos</h2>

<p>CAS demos are neatly organized and deployed on <a href="https://apereo.github.io/cas/development/#demos">Heroku</a>.</p>

<h2 id="surrogate-authentiction">Surrogate Authentiction</h2>

<p>The ability to authenticate on behalf of another user, so called <a href="https://apereo.github.io/cas/development/installation/Surrogate-Authentication.html">Surrogate Authentication</a>, is now included
in this release.</p>

<h2 id="saml2-nameid-qualifiers">SAML2 NameID Qualifiers</h2>

<p>SAML2 service definitions are now allowed the option to override the name qualifiers for a given subject’s name id.</p>

<h2 id="scripted-attribute-release">Scripted Attribute Release</h2>

<p>Scripted <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Policies.html">attribute release policies</a> are now able to accept an inlined groovy script as well.</p>

<h2 id="distributed-tracing">Distributed Tracing</h2>

<p>CAS embraces <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html#distributed-tracing">Spring Cloud Sleuth</a> which implements a distributed tracing solution for Spring Cloud.</p>

<h2 id="encrypted-service-usernames">Encrypted Service Usernames</h2>

<p>CAS username providers are now able to <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-PrincipalId.html">encrypt the resolved username</a> using the service public key. Applications are expected to decrypt of course using their paired private key.</p>

<h2 id="automated-docker-cloud-builds">Automated Docker Cloud Builds</h2>

<p>CAS is now taking advantage of <a href="https://docs.docker.com/docker-cloud/builds/automated-build/">Docker Cloud’s automated builds</a>
to auto-publish CAS images for the <code class="highlighter-rouge">latest</code> and all other relevant tagged releases.</p>

<h2 id="eureka-service-discovery">Eureka Service Discovery</h2>

<p>Thanks to Spring Cloud, CAS provides integration support for <a href="https://apereo.github.io/cas/development/installation/Service-Discovery-Guide.html">Eureka Service Discovery</a>.</p>

<h2 id="spring-cloud-w-apache-zookeeper">Spring Cloud w/ Apache ZooKeeper</h2>

<p>More of a documentation enhancement and thanks to community contributions and expertise, the CAS Spring Cloud configuration server is now able to use <a href="https://apereo.github.io/cas/development/installation/Configuration-Server-Management.html#apache-zookeeper">Apache ZooKeeper</a> as the backend storage service to house CAS settings.</p>

<h2 id="logging-enhancements">Logging Enhancements</h2>

<p>Another documentation improvement, the <a href="https://apereo.github.io/cas/development/installation/Logging.html">CAS logging guide</a> introduces a few new sections to explain logging layouts. There is also some verbiage that describes how to integrate CAS logs with Papertrail.</p>

<h2 id="spring-boot-administration-server">Spring Boot Administration Server</h2>

<p>Starting with this release, the actuator endpoints provided by Spring Boot can be managed remotely via the <a href="https://apereo.github.io/cas/development/installation/Configuring-Monitoring-Administration.html">Spring Boot Admin server dashboard</a>.</p>

<h2 id="multifactor-entityid-trigger">Multifactor EntityID Trigger</h2>

<p>In cases where authentication is delegated to CAS most commonly from a <a href="https://apereo.github.io/cas/development/integration/Shibboleth.html">Shibboleth Identity Provider</a>, the <code class="highlighter-rouge">entityId</code> is passed to CAS as an extra request parameter to indicate the service provider. In this release, CAS begins to recognize the <code class="highlighter-rouge">entityId</code> parameter and treat it as a normal <code class="highlighter-rouge">service</code> that is linked to the CAS service registry which can then be assigned different access strategy and <a href="https://apereo.github.io/cas/development/installation/Configuring-Multifactor-Authentication-Triggers.html">multifactor authentication policies</a>.</p>

<h2 id="principal-id-as-attribute">Principal ID As Attribute</h2>

<p>A small enhancement to CAS <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Policies.html">attribute release policies</a> where now, the principal id itself can be released as a custom attribute of your own choosing on a per-service basis.</p>

<h2 id="groovy-attribute-value-filters">Groovy Attribute Value Filters</h2>

<p>Attribute values for release policies can now <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Policies.html#groovy">take advantage of Groovy scripts</a> to weed through the released collection dynamically.</p>

<h2 id="documentation">Documentation</h2>

<p>Additional docs are now available to explain:</p>

<ul>
  <li><a href="https://apereo.github.io/cas/development/installation/Configuration-Management-Extensions.html">How to extend the CAS configuration</a></li>
  <li><a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-Extensions.html">How to extend the CAS webflow</a></li>
  <li><a href="https://apereo.github.io/cas/development/installation/Configuring-Multifactor-Authentication-Triggers.html#custom">How to design custom triggers for multifactor authentication</a></li>
  <li><a href="https://apereo.github.io/cas/development/installation/Configuring-Custom-Authentication.html">How to design custom authentication strategies</a></li>
</ul>

<p>Additionally, common CAS configuration settings that apply to more than one module are given <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties-Common.html">their own dedicated space</a>.</p>

<h2 id="minor-changes">Minor Changes</h2>

<p>A number of small bug fixes and improvements have been incorporated into this feature release:</p>

<h3 id="community-contributions">Community Contributions</h3>

<ul>
  <li>Acceptable Usage Policy is now able to correctly accept and store user decisions.</li>
  <li>Hazelcast ticket registry is now able to properly decode and find encrypted tickets.</li>
  <li>Minor updates to CAS messages bundles for non-english languages.</li>
  <li>Support for configuration of container-managed JDBC connections is added to this release candidate.</li>
  <li>Minor fixes to how OAuth/OpenID Connect tickets are deserialized and stored in JSON-based ticket registries.</li>
  <li>Google Apps integration correctly should handle the <code class="highlighter-rouge">inResponseTo</code> attribute.</li>
  <li>X509 authentication should correctly route the user back to the login form in cases of authentication failures.</li>
  <li>Google authenticator backed by JDBC should properly create and name databasse tables.</li>
  <li>Minor fixes to OpenID module to ensure views can proper render for ticket validation and other requests.</li>
  <li>Minor fixes to OpenID Connect module to ensure scopes can properly be filtered, and that clients are fully loaded and management via the services management web application.</li>
</ul>

<h3 id="others">Others</h3>

<ul>
  <li>MDC logging is now respecting nullable properties of the HTTP request.</li>
  <li>Authy as a multifactor authentication provider gains the ability to specify the country code for the user phone number.</li>
  <li>MFA flows are now able to correctly handle scenarios where authentication produces warnings.</li>
  <li>OAuth2 <code class="highlighter-rouge">password</code> grant type is now correctly able to issue user profiles.</li>
  <li>Ticket registry cleaner is no longer scheduled as a no-op if it’s disabled in the configuration.</li>
  <li>A regression; CAS should resume supporting the duration syntax (i.e <code class="highlighter-rouge">PT20S</code>) for settings.</li>
  <li>Documentation additions to explain how to generate various signing and encryption keys for CAS manually.</li>
</ul>

<h2 id="library-upgrades">Library Upgrades</h2>

<ul>
  <li>Apache Tomcat</li>
  <li>Spring Cloud</li>
  <li>Hazelcast</li>
  <li>Thymeleaf</li>
  <li>Log4j</li>
  <li>Spring</li>
  <li>Hibernate</li>
  <li>HSQLDB</li>
  <li>AWS SDK</li>
  <li>Spring Boot</li>
</ul>

<h2 id="whats-next">What’s Next?</h2>

<p>The development team is working to make sure the CAS <code class="highlighter-rouge">5.1.0</code> release is
on <a href="https://github.com/apereo/cas/milestones">schedule</a>. This is the last release candidate in the <code class="highlighter-rouge">5.1.x</code> release and the project will gear up to perform a few more rounds of testing and validation before the official GA release is tagged and made available.</p>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Review and suggest documentation improvements.</li>
  <li>Review the release schedule and make sure you report your desired feature requests on the project’s issue tracker.</li>
</ul>

<h2 id="das-ende">Das Ende</h2>

<p>A big hearty thanks to all who participated in the development of this release to submit patches, report issues and suggest improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/04/28/rc4-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.1.0 RC4 release.
                    
                </description>
                <pubDate>Fri, 28 Apr 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.1.0 RC3 Feature Release</title>
                <link>https://apereo.github.io/2017/03/31/rc3-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<p>The official CAS <code class="highlighter-rouge">5.0.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.0.0">November 7th 2016</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.1.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the third release candidate in the <code class="highlighter-rouge">5.1.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.1.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<p>If you are looking for additional info on the previous release candidate, <a href="https://apereo.github.io/2017/02/24/rc2-release/">please see this post</a>.</p>

<!-- TOC -->

<ul>
  <li><a href="#embedded-container-modules">Embedded Container Modules</a></li>
  <li><a href="#hazelcast-ticket-registry">Hazelcast Ticket Registry</a></li>
  <li><a href="#embedded-tomcat-ssl-valve">Embedded Tomcat SSL Valve</a></li>
  <li><a href="#administrative-endpoint-security">Administrative Endpoint Security</a></li>
  <li><a href="#scripted-username-attribute-providers">Scripted Username Attribute Providers</a></li>
  <li><a href="#spnego-webflow-authentication">SPNEGO Webflow Authentication</a></li>
  <li><a href="#jpa-ticket-registry">JPA Ticket Registry</a></li>
  <li><a href="#ticket-metadata-and-catalog">Ticket Metadata and Catalog</a></li>
  <li><a href="#embedded-tomcat-default-connector-settings">Embedded Tomcat Default Connector Settings</a></li>
  <li><a href="#code-cleanup-and-optimization">Code Cleanup and Optimization</a></li>
  <li><a href="#configuration-panel">Configuration Panel</a></li>
  <li><a href="#spring-cloud-configuration-server">Spring Cloud Configuration Server</a></li>
  <li><a href="#dynamodb-ticket-registry">DynamoDb Ticket Registry</a></li>
  <li><a href="#cas-heroku-demos">CAS Heroku Demos</a></li>
  <li><a href="#attribute-repositories--attributes">Attribute Repositories &amp; Attributes</a></li>
  <li><a href="#aws-cloudwatch-support">AWS CloudWatch Support</a></li>
  <li><a href="#sass-auto-compilation">Sass Auto Compilation</a></li>
  <li><a href="#rest-authentication-via-x509">REST Authentication via X.509</a></li>
  <li><a href="#x509-principal-resolution">X.509 Principal Resolution</a></li>
  <li><a href="#ws-fed-protocol">WS-Fed Protocol</a></li>
  <li><a href="#attribute-filtering-policies">Attribute Filtering Policies</a></li>
  <li><a href="#jasypt-support">Jasypt Support</a></li>
  <li><a href="#dynamodb-service-registry">DynamoDb Service Registry</a></li>
  <li><a href="#minor-bug-fixes">Minor Bug Fixes</a>
    <ul>
      <li><a href="#community-contributions">Community Contributions</a></li>
      <li><a href="#others">Others</a></li>
    </ul>
  </li>
  <li><a href="#library-upgrades">Library Upgrades</a></li>
  <li><a href="#whats-next">What’s Next?</a></li>
  <li><a href="#get-involved">Get Involved</a></li>
  <li><a href="#das-ende">Das Ende</a></li>
</ul>

<!-- /TOC -->

<h2 id="embedded-container-modules">Embedded Container Modules</h2>

<p>In previous feature releases, the CAS server web application module shipped automatically with an embedded Tomcat container.
This presented a few difficulties to folks who wanted to step outside the box and get the CAS web application deployed in alternative
containers such as WebSphere, JBoss, etc.</p>

<p>Starting with this release candidate, the CAS server web application switches back to its original vanilla state where nothing is embedded by default. This should allow you to deploy CAS to any container that is servlet-spec compliant by CAS requirements. However, <a href="https://apereo.github.io/cas/development/installation/Configuring-Servlet-Container.html">additional modules are provided for embedded containers</a> that are Apache Tomcat, Jetty and Undertow. If you had been previously working with the embedded container and running Apache Tomcat natively, you do need to switch the webapp module to one that contains an embedded container of your choice.</p>

<p>Note that embedded-container modules may be deployed to externally-configured containers too. CAS should detect the external instance and auto-disable the embedded container from bootstrapping itself, regardless of container type.</p>

<h2 id="hazelcast-ticket-registry">Hazelcast Ticket Registry</h2>

<p>Thanks to community contributions, the Hazelcast Ticket Registry is <a href="https://github.com/apereo/cas/pull/2361">reorganized</a> to improve its performance, by splitting the underlying cache in half. Work is also done to ensure the registry is prepped to handle additional ticket types dynamically.</p>

<h2 id="embedded-tomcat-ssl-valve">Embedded Tomcat SSL Valve</h2>

<p>Thanks to community contributions, the embedded tomcat container gains support for configuration of the SSL Valve.
This should be useful if you are trying to handle X.509 authentication at the servlet container level.</p>

<h2 id="administrative-endpoint-security">Administrative Endpoint Security</h2>

<p>Individual endpoints that are exposed by the CAS admin panels each have their own security settings. To make the configuration easier, there now exists a single block that may control the security of all settings globally, while still allowing individual overrides to take over.</p>

<p>As an additional option, endpoints that are secured with Spring Security now can take advantage of JAAS authentication.</p>

<h2 id="scripted-username-attribute-providers">Scripted Username Attribute Providers</h2>

<p><a href="https://apereo.github.io/cas/development/integration/Attribute-Release-PrincipalId.html">Username attribute providers</a> linked to a service definition are enhanced to accommodate further scripting techniques via Groovy.
Also, a number of providers are now able to apply transformations on the final username returned back to the application, such as turning the id into all caps, etc.</p>

<h2 id="spnego-webflow-authentication">SPNEGO Webflow Authentication</h2>

<p>The <a href="https://apereo.github.io/cas/development/installation/SPNEGO-Authentication.html">SPNEGO functionality</a> still had a few references and instructions on how changes that needed to be manually applied to the webflow. Those are now removed and automated internally to match the manual steps.</p>

<h2 id="jpa-ticket-registry">JPA Ticket Registry</h2>

<p>The <a href="https://apereo.github.io/cas/development/installation/JPA-Ticket-Registry.html">JPA ticket registry</a> no longer requests a hardcoded dependency link to the OAuth module. In the past, the registry simply auto-created OAuth tables and entities given the components were found and scanned automatically as a result of that dependency link. Today, that chain is removed and the registry shall only recognize and act upon OAuth functionality, if the functionality is explicitly turned on.</p>

<h2 id="ticket-metadata-and-catalog">Ticket Metadata and Catalog</h2>

<p>Traditionally, ticket types in CAS are mostly concerned with ticket-granting tickets, service tickets, proxy tickets, etc. These are distinct types that are defined as first-class citizens of the CAS public API. Over time, there have emerged additional tickets types that represent various other forms of <em>tokens</em> to CAS, such as OAuth codes, access tokens, refresh tokens, etc. Each ticket type has its own lifespan and other settings too. How do ticket registries deal with additional types, given their presence and functionality can only be discovered at runtime dynamically?</p>

<p>Some took shortcuts. For instance, the JPA ticket registry created a hard-link to the OAuth module (described above) so it could ensure OAuth tickets were stored in separate tables as distinct entities, etc. It asked for pre-authorized knowledge of the CAS API, even though the functionality controlled by that API may not even be in use at all. Is there a reason the registry should handle OAuth-related functionality <em>even when</em> OAuth is not even enabled or required by the deployment?</p>

<p>Not a trick question.</p>

<p>So the target goal is that each registry implementation (and all of CAS really) should be able to dynamically realize what ticket types are used by the CAS runtime and what ticketing-related functionality is actually enabled by the deployer. The discovery mechanism should provide enough information, as a catalog, to the relevant modules about known types, their metadata and various other required properties so each registry can dynamically and generically look up that metadata and regroup itself to handle each unique type. Advantages of this approach are:</p>

<ol>
  <li>No need to establish static linkage between CAS modules to teach each about various ticket types exposed in the module API. As you can imagine, over time given new tickets types that have emerged and the list of registries supported by CAS, static linking is simply non-maintainable and core logic in each registry can get very messy if it were to deal with 8+ different ticket types, caches, storage requirements, etc.</li>
  <li>Given no static linking, LOC will be reduced down to the bare minimum and what may be auto-discovered at runtime.</li>
  <li>Given no static linking, maintenance and extensions to the CAS API can be done much more comfortably.</li>
  <li>Given no static linking, the amount of extra [yet needless] work that would be carried out by each registry is only activated <em>IIF</em> the feature is actually utilized by the deployment.</li>
</ol>

<p>So starting with this release candidate, modules that intend to provide their own special flavors of tickets when necessary register the relevant types into the “global ticket catalog” as it were. Registries are then freed up look into the catalog and reorganize themselves as needed to handle all ticket types.</p>

<h2 id="embedded-tomcat-default-connector-settings">Embedded Tomcat Default Connector Settings</h2>

<p>In the event that you decide to run CAS without any SSL configuration in <em>proxying</em> mode and perhaps on a non-secure port,
there are now additional settings exposed in the configuration that allow you to control the behavior of the connector linked 
to the port, to mark it as <code class="highlighter-rouge">secure</code> with a scheme of <code class="highlighter-rouge">https</code>, etc.</p>

<h2 id="code-cleanup-and-optimization">Code Cleanup and Optimization</h2>

<p>Thanks to community contributions, the CAS codebase is revitalized ever more to make sure
most if not all underlying components adhere to proper coding standards and design practices.
Changes in this area include adjustments to style guidelines, constructor-based dependency injections
and better adherence to the native Java 8 Collections and Lambda APIs.</p>

<h2 id="configuration-panel">Configuration Panel</h2>

<p>A number of enhancements are applied to the CAS configuration panel to ensure it can detect properties that are changed manually
in configuration sources (i.e <code class="highlighter-rouge">cas|application.properties</code>). The panel is also able to now immediately apply configuration changes. This item is closely related to the changes done, described below, to externalize the deployment of the Spring Cloud Configuration Server.</p>

<p><img src="https://cloud.githubusercontent.com/assets/1205228/23504845/60464f12-ff56-11e6-8c82-1e4107638dac.png" alt="image" /></p>

<h2 id="spring-cloud-configuration-server">Spring Cloud Configuration Server</h2>

<div class="alert alert-warning">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Beware</strong><br />This may be a breaking configuration change. 
  Consult <a href="https://apereo.github.io/cas/development/">the docs</a> to learn more.
</div>

<p>In previous versions and release candidates, CAS shipped with an embedded configuration server backed by Spring Cloud. While extremely powerful, this added a number of complications such as bootstrap start-up times and extra care around securing various endpoints, etc. In this release candidate, the <a href="https://apereo.github.io/cas/development/installation/Configuration-Server-Management.html">configuration server functionality</a> is pulled out of the main CAS server web application and is produced as a separate project with its own overlay. Deployments may choose to run CAS in a <em>standalone</em> mode or they may wish to let CAS become a client of the centralized configuration server consuming settings from multiple sources for a variety of profiles, etc.</p>

<p>Note that if you’d deployed CAS with the understanding of reading configuration files from the default <code class="highlighter-rouge">/etc/cas/config</code>, then you should have very little, if anything, to worry about if and when you make the jump. If you have deviated from the defaults and decided to go your own way, please consult the documentation to learn about needed readjustments.</p>

<h2 id="dynamodb-ticket-registry">DynamoDb Ticket Registry</h2>

<p>CAS gains <a href="https://apereo.github.io/cas/development/installation/DynamoDb-Ticket-Registry.html">support for DynamoDb</a> as yet another option for its ticket registry. This feature might look more attractive for those who wish to use AWS as the deployment environment and take advantage of native platform services and offerings.</p>

<h2 id="cas-heroku-demos">CAS Heroku Demos</h2>

<p>Demo instances of both the CAS server and CAS Management server web applications have been updated to run the latest versions of CAS 5.</p>

<h2 id="attribute-repositories--attributes">Attribute Repositories &amp; Attributes</h2>

<div class="alert alert-warning">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>Beware</strong><br />This may be a breaking configuration change. 
  Consult <a href="https://apereo.github.io/cas/development/">the docs</a> to learn more.
</div>

<p>A <a href="https://github.com/apereo/cas/issues/2083">requested improvement</a> from the <code class="highlighter-rouge">5.0.x</code> days; Deployments that cannot not rely on the attribute retrieval mechanism done during the same authentication request/transaction typically use separate attribute repositories to define retrieval rules. This allows one to for instance say:</p>

<p><em>Authenticate against a JDBC source, but retrieve attributes from separate LDAP and Groovy sources.</em></p>

<p>Or a bit more advanced:</p>

<p><em>Authenticate against an LDAP source, but retrieve attributes from multiple LDAP repositories yet map attributes for each differently depending on the authentication source</em>.</p>

<p>So long story short, attributes that were to be retrieved from such sources were all defined in one common block global to all repositories. In this release, the attributes are removed from the global common block in CAS configuration settings and made specific for each attribute repository instance that is defined. This provides a much more flexible configuration where one could for instance then say:</p>

<p><em>Authenticate against a JDBC source, but define two LDAP sources for attributes where one is only allowed to request/retrieve attributes A,B,C while the other can only request/retrieve X,Y,C. Oh…map these attributes for each source differently. Then merge it all together and resolve conflicts. Have fun while doing it!</em></p>

<p>Fun times.</p>

<h2 id="aws-cloudwatch-support">AWS CloudWatch Support</h2>

<p>CAS gains support to route logs automatically to <a href="https://aws.amazon.com/cloudwatch/">AWS CloudWatch</a>. You can review <a href="https://apereo.github.io/cas/development/installation/Logging.html">this guide here</a> to learn more. You are also allowed to use other logging and monitoring tools such as Sentry, Syslog and Logstash to manage and route CAS logs in addition to all the usual options.</p>

<h2 id="sass-auto-compilation">Sass Auto Compilation</h2>

<p>Sass files are now automatically and as part of the build compiled to <code class="highlighter-rouge">.css</code> files for the main CAS server web application.</p>

<h2 id="rest-authentication-via-x509">REST Authentication via X.509</h2>

<p>CAS <a href="https://apereo.github.io/cas/development/protocol/REST-Protocol.html">REST Protocol</a> gains the ability to authenticate credentials via X.509, thanks to community contributions.</p>

<h2 id="x509-principal-resolution">X.509 Principal Resolution</h2>

<p>Thanks to community contributions, X.509 principal resolution by serial number is now able to support HEX and other configurable radixes.</p>

<h2 id="ws-fed-protocol">WS-Fed Protocol</h2>

<p>Starting with this release candidate, CAS gains <a href="https://apereo.github.io/cas/development/protocol/WS-Federation-Protocol.html">modest support</a> for the WS-Fed protocol, acting both as an identity provider and security token service.</p>

<h2 id="attribute-filtering-policies">Attribute Filtering Policies</h2>

<p>A number of <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Policies.html#attribute-filters">new attribute filters</a> are worked into this release that provide support for selectively applying patterns to attributes values to allow or disallow them.</p>

<h2 id="jasypt-support">Jasypt Support</h2>

<p>Running CAS in standalone mode now allows you the option to place encrypted settings into the CAS configuration files and then have them be decoded automatically.
This feature is brought to you by <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties-Security.html">CAS taking advantage of Jasypt</a>.</p>

<h2 id="dynamodb-service-registry">DynamoDb Service Registry</h2>

<p>CAS gains <a href="https://apereo.github.io/cas/development/installation/DynamoDb-Service-Management.html">support for DynamoDb</a> as yet another option for its service registry. This feature might look more attractive for those who wish to use AWS as the deployment environment and take advantage of native platform services and offerings.</p>

<h2 id="minor-bug-fixes">Minor Bug Fixes</h2>

<p>A number of small bug fixes have been incorporated into this feature release:</p>

<h3 id="community-contributions">Community Contributions</h3>

<ul>
  <li>SAML2 <code class="highlighter-rouge">InResponseTo</code> field is now correctly set in response.</li>
  <li>JDBC data sources are massaged to correctly handle the minimum number of idle connections.</li>
  <li>YAML properties are now correctly loaded both from the embedded web application as well as externalized sources.</li>
  <li>Regressions that made service properties in the CAS management webapp dysfunctional are now removed/fixed.</li>
  <li>LDAP authentication removes the need for separate SASL authentication type option, folding it neatly into <code class="highlighter-rouge">AUTHENTICATED</code>.</li>
  <li>Documentation improvements to explain the proper encoding used for <code class="highlighter-rouge">.properties</code> and <code class="highlighter-rouge">.yml</code> files.</li>
</ul>

<h3 id="others">Others</h3>

<ul>
  <li>OAuth services are now properly recognized during the logout process.</li>
  <li>SAML2 authenication statements should now properly include a session index.</li>
  <li>CAS cookies are set to <code class="highlighter-rouge">httpOnly</code> by default with options to control this behavior externally.</li>
  <li>SAML2 attribute statements should now correctly use the SAML2 prefix when constructing attribute values.</li>
  <li>SAML2 ECP functionality gets a brand new pass to resolve a series of issues with encodings and responses.</li>
</ul>

<h2 id="library-upgrades">Library Upgrades</h2>

<ul>
  <li>Spring</li>
  <li>Hazelcast</li>
  <li>Spring Boot</li>
  <li>Apache Tomcat</li>
  <li>Spring Cloud</li>
  <li>Hibernate</li>
  <li>Log4j</li>
  <li>HJSON</li>
  <li>Metrics</li>
  <li>Groovy</li>
  <li>JodaTime</li>
  <li>…</li>
</ul>

<h2 id="whats-next">What’s Next?</h2>

<p>The development team is working to make sure the CAS <code class="highlighter-rouge">5.1.0</code> release is
on <a href="https://github.com/apereo/cas/milestones">schedule</a>. Additional release candidates
and more updates will likely be released prior to the official GA release.</p>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Review and suggest documentation improvements.</li>
  <li>Review the release schedule and make sure you report your desired feature requests on the project’s issue tracker.</li>
</ul>

<h2 id="das-ende">Das Ende</h2>

<p>A big hearty thanks to all who participated in the development of this release to submit patches, report issues and suggest improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/03/31/rc3-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.1.0 RC3 release.
                    
                </description>
                <pubDate>Fri, 31 Mar 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.0.x Deployment - WAR Overlays</title>
                <link>https://apereo.github.io/2017/03/28/cas5-gettingstarted-overlay/</link>
                <content:encoded>
                    <![CDATA[
                    <p>This is a short and sweet tutorial on how to deploy CAS via <a href="https://apereo.github.io/cas/5.0.x/installation/Maven-Overlay-Installation.html">the WAR Overlay method</a>.</p>

<p>This tutorial specifically requires and focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.0.x</code></li>
  <li>Java 8</li>
</ul>

<!--
Furthermore, this tutorial assumes that you are running CAS in its `standalone` mode, [described here](https://apereo.github.io/cas/5.0.x/installation/Configuration-Server-Management.html).
-->

<h1 id="overlaywhat">Overlay…What?</h1>

<p>Overlays are a strategy to combat repetitive code and/or resources. Rather than downloading the CAS codebase and building it from source, overlays allow you to download a pre-built vanilla CAS web application server provided by the project itself, override/insert specific behavior into it and then merge it all back together to produce the final (web application) artifact. You can find a lot more about how overlays work <a href="https://apereo.github.io/cas/5.0.x/installation/Maven-Overlay-Installation.html">here</a>.</p>

<p>The concept of the WAR Overlay is NOT a CAS invention. It’s specifically an Apache Maven eature and of course there are techniques and plugins available to apply the same concept to Gradle-based builds as well.You are free to choose between Maven or Gradle. For this tutorial I opted into the <a href="https://github.com/apereo/cas-overlay-template">Maven WAR overlay</a>.</p>

<p>Once you have forked and cloned the repository locally, you’re ready to begin.</p>

<div class="alert alert-info">
  <strong>Note</strong><br />Remember to switch to the appropriate branch. Today, the <code>master</code> branch of the repository applies to CAS <code>5.0.x</code> deployments. That may not necessarily remain true when you start your own deployment. So examine the branches and make sure you <code>checkout</code> the one matching your intended CAS version.
</div>

<h1 id="overlays-anatomy">Overlay’s Anatomy</h1>

<p>Similar to Grey’s, a <em>Maven</em> WAR overlay is composed of several facets the most important of which is the <code class="highlighter-rouge">pom.xml</code> file. This is a build descriptor file whose job is to teach Apache Maven how to obtain, build, configure (and in certain cases deploy) artifacts.</p>

<div class="alert alert-info">
  <strong>KISS</strong><br />You do not need to download Apache Maven separately. The project provides one for you automatically with the embedded Maven Wrapper.
</div>

<p>The <code class="highlighter-rouge">pom.xml</code> is composed of several sections. The ones you need to worry about are the following.</p>

<h2 id="properties">Properties</h2>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;cas.version&gt;</span>5.0.4<span class="nt">&lt;/cas.version&gt;</span>
    <span class="nt">&lt;springboot.version&gt;</span>1.4.2.RELEASE<span class="nt">&lt;/springboot.version&gt;</span>
    <span class="nt">&lt;maven.compiler.source&gt;</span>1.8<span class="nt">&lt;/maven.compiler.source&gt;</span>
    <span class="nt">&lt;maven.compiler.target&gt;</span>1.8<span class="nt">&lt;/maven.compiler.target&gt;</span>
    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre></div></div>

<p>This is the bit that describes build settings, and specifically here, what versions of CAS, Spring Boot and Java are required for the deployment. You are in practice mostly concerned with the <code class="highlighter-rouge">&lt;cas.version&gt;</code> setting and as new (maintenance) releases come out, it would be sufficient to simply update that version and re-run the build.</p>

<p>This might be a good time to review the CAS project’s <a href="https://apereo.github.io/cas/developer/Release-Policy.html">Release Policy</a> as well as <a href="https://apereo.github.io/cas/developer/Maintenance-Policy.html">Maintenance Policy</a>.</p>

<h2 id="dependencies">Dependencies</h2>

<p>The next piece describes the <em>dependencies</em> of the overlay build. These are the set of components almost always provided by the CAS project that will be packaged up and put into the final web application artifact. At a minimum, you need to have the <code class="highlighter-rouge">cas-server-webapp</code> module available because that is the web application into which you intend to inject your settings and customizations, if any. Also, note that the module declarations are typically configured to download the CAS version instructed by the property <code class="highlighter-rouge">${cas.version}</code>.</p>

<p>Here is an example:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cas-server-webapp<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>war<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<p>Including a CAS module/dependency in the <code class="highlighter-rouge">pom.xml</code> simply advertises to CAS <em>your intention</em> of turning on a new feature or a variation of a current behavior. Do NOT include something in your build just because it looks and sounds cool. Remember that the point of an overlay is to only keep track of things you actually need and care about, and no more.</p>

<div class="alert alert-warning">
  <strong>Remember</strong><br />Keep your build clean and tidy. A messy build often leads to a messy deployment, complicates your upgrade path and is a documented cause of early hair loss. Keep changes down to the absolute essentials and document their need for your deployment. If you review the configuration a year from now, you should have an idea of why things are the way they are.
</div>

<h2 id="and-what-about">And What About…?</h2>

<p>There are many other pieces in the <code class="highlighter-rouge">pom.xml</code>, such as repositories, profiles, plugins, etc that I skipped. For everything else, there is MasterCard…and of course the official <a href="http://maven.apache.org/guides/">Apache Maven guides</a>. Enjoy!</p>

<h1 id="the-build">The Build</h1>

<p>Now that you have a basic understanding of the build descriptor, it’s time to actually run the build. An Apache Maven build is often executed by passing specific goals/commands to Apache Maven itself, aka <code class="highlighter-rouge">mvn</code>. So for instance in the the terminal and once inside the project directory you could execute things like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
mvn clean
</code></pre></div></div>

<p>…which may be a problem if you don’t have already have Apache Maven downloaded and installed. While you can do that separate install, the WAR Overlay project provides you with an embedded Apache Maven instance whose job is to first determine whether you have Maven installed and if not, download and configure one for you based on the project’s needs. So you can replace that command above with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
mvnw clean
</code></pre></div></div>

<p>…which may be a problem because, how are you supposed to know what commands/goals can be passed to the build? You can <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">study them</a> for sure, but the project provides you with a shell script that wraps itself around the Maven wrapper and provides an easy facade for you to remember commands and their use. This is the <code class="highlighter-rouge">build.sh</code> file, which you can run as such:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
./build.sh <span class="nb">help
</span>Usage: build.sh <span class="o">[</span>copy|clean|package|run|debug|bootrun]
</code></pre></div></div>

<p>What do these commands do?</p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">copy</code></td>
      <td>Copies the configuration from the local <code class="highlighter-rouge">etc/cas/config</code> directory to <code class="highlighter-rouge">/etc/cas/config</code>. <a href="https://apereo.github.io/cas/5.0.x/installation/Configuration-Server-Management.html">See this guide</a> to learn more.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">clean</code></td>
      <td>Deletes any previously-built and leftover artifacts from the <code class="highlighter-rouge">target</code> directory.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">package</code></td>
      <td>Runs <code class="highlighter-rouge">clean</code> and <code class="highlighter-rouge">copy</code>. Then packages the CAS web application artifact and run through the overlay to inject local customizations. The outcome is a <code class="highlighter-rouge">target/cas.war</code> file which is ready to be deployed.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">run</code></td>
      <td>Invokes <code class="highlighter-rouge">package</code> and then deploys and runs the CAS web application via its own embedded server container.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">debug</code></td>
      <td>Same thing as <code class="highlighter-rouge">run</code>, except that you can remote-debug the CAS web application over port <code class="highlighter-rouge">5000</code>.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">bootrun</code></td>
      <td>Same thing as <code class="highlighter-rouge">run</code>, except the deployment is managed by the <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html">Spring Boot Maven plugin</a>. This command has very specialized and limited use cases. Please <a href="https://github.com/apereo/cas/issues/2334">review this issue</a> to learn more.</td>
    </tr>
  </tbody>
</table>

<div class="alert alert-info">
  <strong>Remember</strong><br />Docs grow old. Always consult the overlay project's <code>README</code> file to keep to date.
</div>

<p>As an example, here’s what I see if I were to run the <code class="highlighter-rouge">package</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh package

Creating configuration directory under /etc/cas
Copying configuration files from etc/cas to /etc/cas/config
etc/cas/config/application.yml -&gt; /etc/cas/config/application.yml
etc/cas/config/cas.properties -&gt; /etc/cas/config/cas.properties
etc/cas/config/log4j2.xml -&gt; /etc/cas/config/log4j2.xml

<span class="o">[</span>INFO] Scanning <span class="k">for </span>projects...
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] Using the MultiThreadedBuilder implementation with a thread count of 5
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Building cas-overlay 1.0
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-clean-plugin:2.5:clean <span class="o">(</span>default-clean<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:resources <span class="o">(</span>default-resources<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Using <span class="s1">'UTF-8'</span> encoding to copy filtered resources.
<span class="o">[</span>INFO] skip non existing resourceDirectory /cas-overlay-template/src/main/resources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.3:compile <span class="o">(</span>default-compile<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] No sources to compile
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-resources-plugin:2.6:testResources <span class="o">(</span>default-testResources<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Using <span class="s1">'UTF-8'</span> encoding to copy filtered resources.
<span class="o">[</span>INFO] skip non existing resourceDirectory /cas-overlay-template/src/test/resources
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-compiler-plugin:3.3:testCompile <span class="o">(</span>default-testCompile<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] No sources to compile
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-surefire-plugin:2.12.4:test <span class="o">(</span>default-test<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] No tests to run.
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] <span class="nt">---</span> maven-war-plugin:2.6:war <span class="o">(</span>default-war<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Packaging webapp
<span class="o">[</span>INFO] Assembling webapp <span class="o">[</span>cas-overlay] <span class="k">in</span> <span class="o">[</span>/cas-overlay-template/target/cas]
<span class="o">[</span>info] Copying manifest...
<span class="o">[</span>INFO] Processing war project
<span class="o">[</span>INFO] Processing overlay <span class="o">[</span> id org.apereo.cas:cas-server-webapp]
<span class="o">[</span>INFO] Webapp assembled <span class="k">in</span> <span class="o">[</span>786 msecs]
<span class="o">[</span>INFO] Building war: /cas-overlay-template/target/cas.war
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Total <span class="nb">time</span>: 2.504 s <span class="o">(</span>Wall Clock<span class="o">)</span>
<span class="o">[</span>INFO] Finished at: 2017-03-23T14:57:11+04:30
<span class="o">[</span>INFO] Final Memory: 12M/441M
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
</code></pre></div></div>

<p>You can see that the build attempts to download, clean, compile and package all artifacts, and finally it produces a <code class="highlighter-rouge">/cas-overlay-template/target/cas.war</code> which you can then use for actual deployments.</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />You are allowed to pass any of Maven's native command-line arguments to the <code>build.sh</code> file. Things like <code>-U</code> or <code>-X</code> might be useful to have handy.
</div>

<h1 id="configuration">Configuration</h1>

<p>I am going to skip over the configuration of <code class="highlighter-rouge">/etc/cas/config</code> and all that it deals with. If you need the reference, you may always <a href="https://apereo.github.io/cas/5.0.x/installation/Configuration-Management.html">use this guide</a> to study various aspects of CAS configuration.</p>

<p>Suffice it to say that, quite simply, CAS deployment expects <em>the main</em> configuration file to be found under <code class="highlighter-rouge">/etc/cas/config/cas.properties</code>. This is a key-value store that is able to dictate and alter behavior of the running CAS software.</p>

<p>As an example, you might encouter something like:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.server.name</span><span class="p">=</span><span class="s">https://cas.example.org:8443</span>
<span class="py">cas.server.prefix</span><span class="p">=</span><span class="s">https://cas.example.org:8443/cas</span>
<span class="py">logging.config</span><span class="p">=</span><span class="s">file:/etc/cas/config/log4j2.xml</span>
</code></pre></div></div>

<p>…which at a minimum, identifies the CAS server’s url and prefix and instructs the running server to locate the logging configuration at <code class="highlighter-rouge">file:/etc/cas/config/log4j2.xml</code>. The overlay by default ships with a <code class="highlighter-rouge">log4j2.xml</code> that you can use to customize logging locations, levels, etc. Note that the presence of all that is contained inside <code class="highlighter-rouge">/etc/cas/config/</code> is optional. CAS will continue to fall back onto defaults if the directory and the files within are not found.</p>

<h2 id="keep-track">Keep Track</h2>

<p>It is <strong>VERY IMPORTANT</strong> that you contain and commit the entire overlay directory (save the obvious exclusions such as the <code class="highlighter-rouge">target</code> directory) into some sort of source control system, such as <code class="highlighter-rouge">git</code>. Treat your deployment just like any other project with tags, releases and functional baselines.</p>

<h1 id="overlay-customization">Overlay Customization</h1>

<p>If I <code class="highlighter-rouge">cd</code> into the <code class="highlighter-rouge">target/cas</code> directory, I can see an <em>exploded</em> version of the <code class="highlighter-rouge">cas.war</code> file. This is the directory that contains the results of the overlay process. Since I have not actually customized and overlaid anything yet, all configuration files simply match their default and are packaged as such. So as an example, let’s change something.</p>

<p>Digging further down, I notice there exists a <code class="highlighter-rouge">/target/cas/WEB-INF/classes/messages.properties</code> file, which is <a href="https://apereo.github.io/cas/5.0.x/installation/User-Interface-Customization-Localization.html">the default message bundle</a>. I decide that I am going to change the text associated with <code class="highlighter-rouge">screen.welcome.instructions</code>.</p>

<div class="alert alert-warning">
  <strong>Remember</strong><br />Do NOT ever make changes in the <code>target</code> directory. The changesets will be cleaned out and set back to defaults every time you do a build. Follow the overlay process to avoid surprises.
</div>

<p>First, I will need to move the file to my project directory so that Apache Maven during the overlay process can use that instead of what is provided by default.</p>

<p>Here we go:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cas-overlay-template
mkdir <span class="nt">-p</span> src/main/resources
cp target/cas/WEB-INF/classes/messages.properties src/main/resources/
</code></pre></div></div>

<p>Then I’ll leave everything in that file alone, except the line I want to change.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="py">screen.welcome.instructions</span><span class="p">=</span><span class="s">Speak Friend and you shall enter.</span>
<span class="err">...</span>
</code></pre></div></div>

<p>Then I’ll package things up as usual.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./build.sh package

...
<span class="o">[</span>INFO] <span class="nt">---</span> maven-war-plugin:2.6:war <span class="o">(</span>default-war<span class="o">)</span> @ cas-overlay <span class="nt">---</span>
<span class="o">[</span>INFO] Packaging webapp
<span class="o">[</span>INFO] Assembling webapp <span class="o">[</span>cas-overlay] <span class="k">in</span> <span class="o">[</span>/cas-overlay-template/target/cas]
<span class="o">[</span>info] Copying manifest...
<span class="o">[</span>INFO] Processing war project
<span class="o">[</span>INFO] Processing overlay <span class="o">[</span> id org.apereo.cas:cas-server-webapp]
<span class="o">[</span>INFO] Webapp assembled <span class="k">in</span> <span class="o">[</span>1005 msecs]
<span class="o">[</span>INFO] Building war: /cas-overlay-template/target/cas.war
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
...

</code></pre></div></div>

<p>If I look at <code class="highlighter-rouge">target/cas/WEB-INF/classes/messages.properties</code> after the build, I should see that the overlay process has picked and overlaid onto the default <em>my version</em> of the file.</p>

<div class="alert alert-info">
  <strong>Remember</strong><br />Only overlay and modify files you actually need, and try to use externalized resources and configuration as much as possible. Just because you CAN override something in the default package, it doesn't mean that you should.
</div>

<h1 id="deploy">Deploy</h1>

<p>You have a number of options when it comes to deploying the final <code class="highlighter-rouge">cas.war</code> file. <a href="https://apereo.github.io/2016/10/04/casbootoverlay/">This post</a> should help.</p>

<h1 id="so">So…</h1>

<p>I hope this brief tutorial was of some assistance to you. It’s important that you start off simple and make changes one step at a time. Once you have a functional environment, you can gradually and slowly add customizations to move files around.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/03/28/cas5-gettingstarted-overlay/</guid>
                <description>
                    
                    Learn how to configure and build your own CAS deployment via the WAR overlay method, get rich quickly, stay healthy indefinitely and respect family and friends in a few very easy steps.
                    
                </description>
                <pubDate>Tue, 28 Mar 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5 LDAP AuthN and Jasypt Configuration</title>
                <link>https://apereo.github.io/2017/03/24/cas51-ldapauthnjasypt-tutorial/</link>
                <content:encoded>
                    <![CDATA[
                    <p>This is a short and sweet tutorial on how to configure CAS for LDAP authentication and secure bind credentials via Jasypt encryption.
Most of the material is based on the available documentation <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties-Security.html">here</a> and <a href="https://apereo.github.io/cas/development/installation/LDAP-Authentication.html">here</a>.</p>

<p>This tutorial specifically focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.1.0-RC3-SNAPSHOT</code></li>
  <li>Java 8</li>
  <li>Docker 1.13.x</li>
  <li>Apache Tomcat <code class="highlighter-rouge">8.5.x</code></li>
  <li><a href="http://www.jasypt.org/cli.html">Jasypt CLI</a>. You can download the distribution <a href="http://www.jasypt.org/download.html">from here</a>.</li>
</ul>

<p>This tutorial assumes that you are running CAS in its <code class="highlighter-rouge">standalone</code> mode, <a href="https://apereo.github.io/cas/development/installation/Configuration-Server-Management.html">described here</a>.</p>

<h1 id="ldap-setup">LDAP Setup</h1>

<p>For this tutorial, I am using a 398-ds LDAP server <a href="https://github.com/jtgasper3/docker-images/tree/master/389-ds">from this docker image</a>.
Once you have the image running, you can connect to the underlying LDAP server at <code class="highlighter-rouge">localhost:10389</code> with <code class="highlighter-rouge">cn=Directory Manager</code> and <code class="highlighter-rouge">password</code>. The LDAP server is also prepped with a <code class="highlighter-rouge">users.ldif</code> file that contains the test account <code class="highlighter-rouge">jsmith:password</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ps

CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS              PORTS                    NAMES
0f2a75441fb5        jtgasper3/389ds-basic   <span class="s2">"/bin/sh -c '/usr/..."</span>   11 days ago         Up 6 minutes        0.0.0.0:10389-&gt;389/tcp   ldap-server
</code></pre></div></div>

<p>Sweet! Moving on…</p>

<h1 id="deploy-cas">Deploy CAS</h1>

<p>Hop over to <a href="https://apereo.github.io/cas/development/installation/Maven-Overlay-Installation.html">the overlay installation</a> and get CAS built and deployed. The CAS version I am using today is <code class="highlighter-rouge">5.1.0-RC3-SNAPSHOT</code>. It does not matter whether you end up using Maven or Gradle. Choose what fits you best. When you have a baseline functioning build, continue on.</p>

<h1 id="configure-cas">Configure CAS</h1>

<p>Once you have added the LDAP module to your build as is described <a href="https://apereo.github.io/cas/development/installation/LDAP-Authentication.html">here</a>, you then need to teach CAS about the running LDAP server.</p>

<p>Here is what I did in the <code class="highlighter-rouge">cas.properties</code> file, along with all the other usual suspects:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.ldap[0]</span><span class="py">.type</span><span class="p">=</span><span class="s">AUTHENTICATED</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.ldapUrl</span><span class="p">=</span><span class="s">ldap://localhost:10389</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.useSsl</span><span class="p">=</span><span class="s">false</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.baseDn</span><span class="p">=</span><span class="s">ou=People,dc=example,dc=edu</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.userFilter</span><span class="p">=</span><span class="s">uid={user}</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindDn</span><span class="p">=</span><span class="s">cn=Directory Manager</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindCredential</span><span class="p">=</span><span class="s">password</span>
</code></pre></div></div>

<p>I also need to disable static authentication. It would also be very nice if I could turn on <code class="highlighter-rouge">DEBUG</code> logs and see what CAS attempts to do:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">logging.level.org.apereo</span><span class="p">=</span><span class="s">DEBUG</span>
<span class="py">cas.authn.accept.users</span><span class="p">=</span>
</code></pre></div></div>

<h1 id="build-and-deploy">Build and Deploy</h1>

<p>Once you get CAS built and deployed, logs should indicate something like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-03-22 16:01:06,915 INFO <span class="o">[</span>o.a.c.c.LdapAuthenticationConfiguration] - &lt;Ldap authentication <span class="k">for</span> <span class="o">[</span>LdapAuthenticationHandler] is to chain principal resolvers via <span class="o">[[</span>org.apereo.cas.authentication.principal.resolvers.ChainingPrincipalResolver@1452f4cb[chain<span class="o">=[</span>org.apereo.cas.authentication.principal.resolvers.PersonDirectoryPrincipalResolver@1b7c5e6a[returnNullIfNoAttributes<span class="o">=</span><span class="nb">false</span>,principalAttributeName<span class="o">=</span>&lt;null&gt;], org.apereo.cas.authentication.principal.resolvers.EchoingPrincipalResolver@6824495c[]]]]] <span class="k">for </span>attribute resolution&gt;
</code></pre></div></div>

<p>Great. Next, pull up CAS in your browser and log in with <code class="highlighter-rouge">jsmith</code> and <code class="highlighter-rouge">password</code> and you should be in. Viola!</p>

<h1 id="jasypt-encryption">Jasypt Encryption</h1>

<p>You may have noted that the LDAP <code class="highlighter-rouge">bindCredential</code> is put into the <code class="highlighter-rouge">cas.properties</code> file in plain-text. As the next steps:</p>

<ul>
  <li>We will first encrypt the <code class="highlighter-rouge">bindCredential</code> value via Jasypt and put it into CAS.</li>
  <li>We will instruct CAS to decrypt the setting at runtime invisibly and resume as usual.</li>
</ul>

<p>Note that there is nothing stopping you from encrypting any other setting!</p>

<h2 id="encrypt-via-jasypt">Encrypt via Jasypt</h2>

<p>Once you download the <a href="http://www.jasypt.org/cli.html">Jasypt CLI</a>, at a minimum you need to decide which algorithm you want to use for encryption and what your encryption key/password should be which is the thing that is later taught to CAS to decode the value. In the <code class="highlighter-rouge">bin</code> directory of the distribution, you can invoke <code class="highlighter-rouge">./listAlgorithms.sh|bat</code> to see what may be possible for algorithms and then use the <code class="highlighter-rouge">./encrypt.sh|bat</code> to encrypt values.</p>

<p>So for me to encrypt the value of <code class="highlighter-rouge">bindCredential</code>, I ran the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./encrypt.sh <span class="nv">input</span><span class="o">=</span>password <span class="nv">algorithm</span><span class="o">=</span>PBEWithMD5AndTripleDES <span class="nv">password</span><span class="o">=</span>MySuperPassword

<span class="nt">----ENVIRONMENT-----------------</span>
Runtime: Oracle Corporation Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM 25.121-b13 

<span class="nt">----ARGUMENTS-------------------</span>
algorithm: PBEWithMD5AndTripleDES
input: password
password: MySuperPassword

<span class="nt">----OUTPUT----------------------</span>
mqWuN+/U7oofNhdSVNcEgmVcwGmxiOaS
</code></pre></div></div>

<p>I can also confirm that this value can be decoded as well:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./decrypt.sh <span class="nv">input</span><span class="o">=</span>mqWuN+/U7oofNhdSVNcEgmVcwGmxiOaS <span class="nv">algorithm</span><span class="o">=</span>PBEWithMD5AndTripleDES <span class="nv">password</span><span class="o">=</span>MySuperPassword

<span class="nt">----ENVIRONMENT-----------------</span>
Runtime: Oracle Corporation Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM 25.121-b13 

<span class="nt">----ARGUMENTS-------------------</span>
algorithm: PBEWithMD5AndTripleDES
input: mqWuN+/U7oofNhdSVNcEgmVcwGmxiOaS
password: MySuperPassword

<span class="nt">----OUTPUT----------------------</span>
password
</code></pre></div></div>

<p>Cool. Let’s move on.</p>

<h2 id="configure-cas-1">Configure CAS</h2>

<p>So now that I have encrypted value in the <code class="highlighter-rouge">OUTPUT</code> section, I am going to slightly massage my configuration as such:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindCredential</span><span class="p">=</span><span class="s">{cipher}mqWuN+/U7oofNhdSVNcEgmVcwGmxiOaS</span>
<span class="err">...</span>
</code></pre></div></div>

<p>Finally, we need to teach CAS to handle the reverse of this operation. Consulting the docs <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties-Security.html">here</a>, I ended up adjusting my configuration as such:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.standalone.config.security.alg</span><span class="p">=</span><span class="s">PBEWithMD5AndTripleDES</span>
</code></pre></div></div>

<p>Using the embedded tomcat container, I configured my “run CAS” command to pass along the encryption key as a command-line parameter. If you prefer, you could do the same thing with environment variables and system properties.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-jar</span> target/cas.war <span class="nt">--cas</span>.standalone.config.security.psw<span class="o">=</span>MySuperPassword
</code></pre></div></div>

<p>Next time when attempt to deploy and run CAS, you should be able to bind and connect to LDAP and authenticate as before.</p>

<p>That’s it!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/03/24/cas51-ldapauthnjasypt-tutorial/</guid>
                <description>
                    
                    Learn how to configure LDAP AuthN with CAS and secure LDAP credentials via Jasypt.
                    
                </description>
                <pubDate>Fri, 24 Mar 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5 SAML2 Delegated AuthN Tutorial</title>
                <link>https://apereo.github.io/2017/03/22/cas51-delauthn-tutorial/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>This is a short and sweet tutorial on how to configure CAS to delegate authentication to an external SAML2 identity provider.
Most of the material is based on the <a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">available documentation</a>.</p>

<p>This tutorial specifically focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.1.0-RC3-SNAPSHOT</code></li>
  <li>Java 8</li>
  <li>Apache Tomcat <code class="highlighter-rouge">8.5.11</code></li>
  <li><a href="http://developer.okta.com/standards/SAML/setting_up_a_saml_application_in_okta">Okta Developer account</a></li>
</ul>

<h1 id="deploy-cas">Deploy CAS</h1>

<p>Hop over to <a href="https://apereo.github.io/cas/development/installation/Maven-Overlay-Installation.html">the overlay installation</a> and get CAS built and deployed. The CAS version I am using today is <code class="highlighter-rouge">5.1.0-RC3-SNAPSHOT</code>. It does not matter whether you end up using Maven or Gradle. Choose what fits you best. When you have a baseline functioning build, continue on.</p>

<h1 id="configure-cas">Configure CAS</h1>

<p>Add the required module specified here in the <a href="https://apereo.github.io/cas/development/integration/Delegate-Authentication.html">documentation</a> to your build. Next, we need to teach CAS about the external SAML2 Identity Provider. The configuration displayed below simply wants to have CAS act as a sevice provider with its own unique entity id, keystore, etc. CAS itself will generate the relevant service-provider credentials, keystores and metadata and will then examine the identity provider metadata document to learn about endpoints, etc. So you only really have to provide the values and let the software handle the rest.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.pac4j.saml[0]</span><span class="py">.keystorePassword</span><span class="p">=</span><span class="s">pac4j-demo-passwd</span>
<span class="err">cas.authn.pac4j.saml[0]</span><span class="py">.privateKeyPassword</span><span class="p">=</span><span class="s">pac4j-demo-passwd</span>
<span class="err">cas.authn.pac4j.saml[0]</span><span class="py">.serviceProviderEntityId</span><span class="p">=</span><span class="s">urn:mace:saml:pac4j.org</span>
<span class="err">cas.authn.pac4j.saml[0]</span><span class="py">.serviceProviderMetadataPath</span><span class="p">=</span><span class="s">/etc/cas/config/sp-metadata.xml</span>
<span class="err">cas.authn.pac4j.saml[0]</span><span class="py">.keystorePath</span><span class="p">=</span><span class="s">/etc/cas/config/samlKeystore.jks</span>
<span class="err">cas.authn.pac4j.saml[0]</span><span class="py">.identityProviderMetadataPath</span><span class="p">=</span><span class="s">https://dev-12345.oktapreview.com/app/486ngfgf/sso/saml/metadata</span>
</code></pre></div></div>

<p>Note that the above settings are indexed, which means that if you needed to, you could delegate authentication to more than one identity provider. Also remember that metadata, keystores and such are only created if they are absent from the specified locations. You can certainly hand-massage them if needed, and CAS will let them be as they are without complaints.</p>

<h1 id="configure-okta">Configure Okta</h1>

<p>Follow the documentation <a href="http://developer.okta.com/standards/SAML/setting_up_a_saml_application_in_okta">described here</a>
to create a developer account and add a new application as a SAML2 IdP. At a minimum, you need to provide Okta with the SSO (ACS) url and entity id of the service provider, that being CAS in this case. You do have the entity id above and the ACS url takes on the following form:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://sso.example.org/cas/login?client_name<span class="o">=</span>SAML2Client
</code></pre></div></div>

<p>The configuration would look something like the following image:</p>

<p><img src="https://cloud.githubusercontent.com/assets/1205228/24192129/9d0f828c-0f0b-11e7-8cec-698be1b31cee.png" alt="image" /></p>

<p>Finally you need to assign people/users to the SAML2 Identity Provider application to allow for authentication:</p>

<p><img src="https://cloud.githubusercontent.com/assets/1205228/24192186/c09b0ad2-0f0b-11e7-9e6a-12752de7c125.png" alt="image" /></p>

<p>Okta is then able to provide you with a metadata for this instance, which you can then use to plug back into the above settings.</p>

<h1 id="thats-it">That’s It</h1>

<p>When you deploy CAS, your default logs (though you could certainly turn on <code class="highlighter-rouge">DEBUG</code> to observe a lot more) would indicate something along the following lines:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-03-22 13:33:59,147 INFO <span class="o">[</span>o.a.c.s.p.c.s.a.Pac4jAuthenticationEventExecutionPlanConfiguration] - &lt;Located and prepared <span class="o">[</span>1] delegated authentication clients&gt;
2017-03-22 13:33:59,182 INFO <span class="o">[</span>o.a.c.s.p.c.s.a.Pac4jAuthenticationEventExecutionPlanConfiguration] - &lt;Registering delegated authentication clients...&gt;
</code></pre></div></div>

<p>…and when you get to the login page, you will see the following:</p>

<p><img src="https://cloud.githubusercontent.com/assets/1205228/24192477/c4bb918a-0f0c-11e7-94b9-ac2187588b9c.png" alt="image" /></p>

<p>The same strategy simply applies to all other forms of delegated authentication, such as social identity providers or other CAS servers.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/03/22/cas51-delauthn-tutorial/</guid>
                <description>
                    
                    Learn how to delegate authentication requests to external SAML2 identity providers.
                    
                </description>
                <pubDate>Wed, 22 Mar 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Busting the Myth - GA Release</title>
                <link>https://apereo.github.io/2017/03/08/the-myth-of-ga-rel/</link>
                <content:encoded>
                    <![CDATA[
                    <p>If you are a member of an open source community, currently waiting for something to be <em>officially</em> tagged as a GA release so you can begin planning your production deployments and schedule, this post is for you.</p>

<p>You are holding it wrong.</p>

<h1 id="the-ga-release">The GA Release</h1>

<p>A GA release is typically the last step in the software release life cycle. It is the point where the overall developer and user communities have reasonable confidence in the viability of the software and consider the release physique to generally be in a good-enough shape.</p>

<p>How is a release beaten into shape?</p>

<p>A GA release typically follows after one or more <em>release candidates</em>. The release candidate is a beta version of the software with potential to be a final product unless significant bugs are discovered during trials. Release candidates provide opportunities for the community to begin testing new and old product features to the extent and interest reasonable, until show-stopper defects are all evaluated and possibly removed.</p>

<h1 id="to-ga-or-not-to-ga">To GA or Not to GA</h1>

<p>There are a number of risky assumptions made about GA releases that typically end up affecting the overall [production] deployment schedule in negative ways. Here is what I have learned.</p>

<h2 id="no-magic">No Magic</h2>

<p>Some deployments tend to consider a GA release as “This is good to go”. This statement may be true in larger communities (and not even then) with many active participants, testers and enthusiasts who get involved and step forward to test features, troubleshoot and diagnose issues, provide feedback and patches. After all, that’s how one develops confidence for a release, right? <em>“This was tested by 20 people and in the end they were all found with a smile on their face.”</em></p>

<p>If your community and your membership does not filter through those parameters and yet you’re planning your production rollouts and schedules based on the availability of that release, I promise, you have set yourself up for surprises. Of course, some tend to assume that confidence in a given release somehow stems from the deep chasms of the Misty Mountains. While an avid hiker myself and having not visited the place for certain, I find that claim to be suspicious.</p>

<p>A GA tag is just a tag. That’s all….Yes, it’s just a tag. It holds no magical powers. Really.</p>

<h2 id="love-thyself">Love Thyself</h2>

<p>I might be stating the obvious here…</p>

<blockquote>
  <p>The only person that really cares about you…is you.</p>
</blockquote>

<p>Why does that matter and how is that relevant?</p>

<p>When you begin to plan your production deployment, you inevitably have to make a number of assumptions about your overall environment. You may be upgrading from a previous version and need to figure out how to transition the old to the new. The product may also bring about a few new features in which you may want to invest and then have other applications and systems utilize. You may have to strengthen and modify the infrastructure, security policy, integrations, high-availability and scalability requirements, etc. It’s not an easy thing.</p>

<p>Are you willing to trust your plans with the (possible, if any) test results of other beta testers in the community? Does your community even have beta testers? Do you know if they might have the same interests and needs in the software capabilities as you? Do you have access to their test results? Are you aware of their testing policies? What sort of tests anyway? Integration tests, functional tests, HA tests, accessibility tests, smoke tests…?</p>

<p>In my experience, it’s much more effective to take direct control of the situation beforehand. Community members and testers test and spend time on features they care about. That may not necessarily include yours.</p>

<h2 id="another-left-turn">Another Left Turn</h2>

<p>Sigh. This is my least favorite thing to jot down. Here’s how it goes:</p>

<ol>
  <li>You are waiting for <em>others</em> (developers, beta testers, goblins, etc) to test features before it’s to become GA.</li>
  <li>Others are waiting for you and <em>others</em> to test features before it’s to become GA.</li>
  <li>Tail-recursion back to #1.</li>
</ol>

<p>Something eventually breaks that cycle; it’s usually the release schedule. Most development communities find themselves saying <em>“We have tested what we could. Nobody else has reported anything. It’s been 6 months. This is good-enough”</em>.</p>

<p>Do not put yourself in situations where you have to face the question of the falling tree not having any witnesses. Your time is better spent elsewhere on other things…like testing!</p>

<h1 id="ok-what-now">OK. What Now?</h1>

<p>In short, I have learned that early involvement is tremendously valuable. Sure, it is very helpful to rely on others’ vote of confidence and make plans. It’s immensely better if YOU are that confidence.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/03/08/the-myth-of-ga-rel/</guid>
                <description>
                    
                    Musings on the trustworthiness of a general availability (GA) release and its production-readiness calibre in open source.
                    
                </description>
                <pubDate>Wed, 08 Mar 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS Vulnerability Disclosure</title>
                <link>https://apereo.github.io/2017/03/06/moncfgsecvulndisc/</link>
                <content:encoded>
                    <![CDATA[
                    <h1 id="overview">Overview</h1>

<p>This is the public version of an Apereo CAS project vulnerability disclosure describing an issue in CAS
where an adversary may be able to bypass certain administrative endpoints, in spite of
CAS access rule in place. The following administrative endpoints are exposed
and vulnerable to this attack:</p>

<ul>
  <li><code class="highlighter-rouge">/configserver/</code></li>
  <li><code class="highlighter-rouge">/cas/status/metrics</code></li>
</ul>

<h1 id="affected-deployments">Affected Deployments</h1>

<p>The attack vector specifically applies to all deployments of CAS <code class="highlighter-rouge">5.0.x</code> deployments.
If you have deployed <strong>any version</strong> of CAS <code class="highlighter-rouge">5.0.x</code>, you <strong>MUST</strong> take action to upgrade.
If you have deployed any <strong>other</strong> versions of CAS, disregard this announcement.</p>

<h1 id="severity">Severity</h1>

<p>This is a serious issue where successfully exercising this vulnerability allows the adversary
gain insight into the running CAS software, collect stats and metrics and potentially observe the collection
of configured CAS settings in configuration files.</p>

<h1 id="patching">Patching</h1>

<p>Patch releases are available to address CAS <code class="highlighter-rouge">5.0.x</code> deployments.
Upgrades to the next patch version for each release should be a drop-in replacement.
The patch simply ensures that the exposed endpoints honor the CAS access rules,
and otherwise block attempts. When you have applied the patch, please double check all endpoints
and ensure access is appropriately controlled.</p>

<h2 id="timeline">Timeline</h2>

<p>The issue was originally reported to the CAS application security team
on February 20, 2017. Upon confirmation, CAS was patched on February 22, 2017
and released. The original release
announcement is <a href="https://github.com/apereo/cas/releases/tag/v5.0.3.1">available here</a>.</p>

<h2 id="procedure">Procedure</h2>

<h3 id="update-version">Update Version</h3>

<p>Modify your CAS overlay to point to version <code class="highlighter-rouge">5.0.3.1</code>. A snippet of a <code class="highlighter-rouge">pom.xml</code> for a CAS overlay follows:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.jasig.cas<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cas-server-webapp<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>war<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;cas.version&gt;</span>5.0.3.1<span class="nt">&lt;/cas.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre></div></div>

<p>Double check your <code class="highlighter-rouge">cas.properties</code> file for the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.adminPagesSecurity.ip=the-authorized-ip-pattern
</span></code></pre></div></div>

<h3 id="adjust-overlay">Adjust Overlay</h3>

<p>If your CAS build has overlaid the <code class="highlighter-rouge">src/main/resources/bootstrap.properties</code> file, 
make sure the following line is corrected there:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.cloud.config.server.prefix</span><span class="p">=</span><span class="s">/status/configserver</span>
</code></pre></div></div>

<h2 id="alternatives">Alternatives</h2>

<p>If you are unable to apply the patch, it’s then best to ensure the outlined
endpoints are blocked completely via load balancers, proxies, firewalls, etc.</p>

<h1 id="support">Support</h1>

<p>If you have questions on the details this vulnerability and how it might be reproduced,
please contact <code class="highlighter-rouge">security@apereo.org</code> or <code class="highlighter-rouge">cas-appsec-public@apereo.org</code>.</p>

<h1 id="resources">Resources</h1>

<ul>
  <li><a href="https://apereo.github.io/cas/developer/Sec-Vuln-Response.html">CAS Security Vulnerability Response Model</a></li>
</ul>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/03/06/moncfgsecvulndisc/</guid>
                <description>
                    
                    Disclosure of a security issue with the CAS administrative endpoints exposure.
                    
                </description>
                <pubDate>Mon, 06 Mar 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.1.0 RC2 Feature Release</title>
                <link>https://apereo.github.io/2017/02/24/rc2-release/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<p>The official CAS <code class="highlighter-rouge">5.0.0</code> GA was released on <a href="https://github.com/apereo/cas/releases/tag/v5.0.0">November 7th 2016</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.1.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the second release candidate in the <code class="highlighter-rouge">5.1.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.1.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<p>If you are looking for additional info on the previous release candidate, <a href="https://apereo.github.io/2016/12/23/51rc1/">please see this post</a>.</p>

<!-- TOC -->

<ul>
  <li><a href="#authentication-sequence">Authentication Sequence</a></li>
  <li><a href="#monitoringstatus-protection-with-spring-security">Monitoring/Status Protection with Spring Security</a></li>
  <li><a href="#saml-idp-metadata-generation">SAML IdP Metadata Generation</a></li>
  <li><a href="#code-cleanup-and-optimization">Code Cleanup and Optimization</a></li>
  <li><a href="#xml-test-configuration">XML Test Configuration</a></li>
  <li><a href="#mongodb-ticket-registry">MongoDb Ticket Registry</a></li>
  <li><a href="#cas-documentation-improvements">CAS Documentation Improvements</a></li>
  <li><a href="#custom-password-encoders">Custom Password Encoders</a></li>
  <li><a href="#management-webapp-authorization">Management Webapp Authorization</a></li>
  <li><a href="#fido-u2f-mfa">FIDO U2F MFA</a></li>
  <li><a href="#microsoft-azure-mfa">Microsoft Azure MFA</a></li>
  <li><a href="#principal-scim-provisioning">Principal SCIM Provisioning</a></li>
  <li><a href="#internal-support-for-kotlin">Internal Support for Kotlin</a></li>
  <li><a href="#clearpass-internal-encryption">Clearpass Internal Encryption</a></li>
  <li><a href="#database-audit-default-catalogschema">Database Audit Default Catalog/Schema</a></li>
  <li><a href="#openid-connect-jwks-caching">OpenID Connect JWKS Caching</a></li>
  <li><a href="#openid-connect-scope-based-claim-release">OpenID Connect Scope-based Claim Release</a></li>
  <li><a href="#grouper-groups-as-principal-attributes">Grouper Groups as Principal Attributes</a></li>
  <li><a href="#openid-connect-encrypted-id-tokens">OpenID Connect Encrypted ID Tokens</a></li>
  <li><a href="#native-configuration-monitoring">Native Configuration Monitoring</a></li>
  <li><a href="#openid-connect-implicit-profile">OpenID Connect Implicit Profile</a></li>
  <li><a href="#dynamic-acceptable-usage-policy">Dynamic Acceptable Usage Policy</a></li>
  <li><a href="#x509-authentication-ldap-crl-fetching">X509 Authentication: LDAP CRL Fetching</a></li>
  <li><a href="#google-authenticator-token-tracking">Google Authenticator Token Tracking</a></li>
  <li><a href="#delegated-authentication-providers">Delegated Authentication Providers</a></li>
  <li><a href="#google-authenticator-json-storage">Google Authenticator JSON Storage</a></li>
  <li><a href="#cas-banner--git-commit-id">CAS Banner &amp; Git Commit Id</a></li>
  <li><a href="#multifactor-authentication-trigger-via-authentication-attribute">Multifactor Authentication Trigger via Authentication Attribute</a></li>
  <li><a href="#ldap-authentication-search-entry-resolvers">LDAP Authentication Search Entry Resolvers</a></li>
  <li><a href="#domain-services-manager">Domain Services Manager</a></li>
  <li><a href="#saml-sp-integrations">SAML SP Integrations</a></li>
  <li><a href="#pythonjavascript-attribute-release-policies">Python/Javascript Attribute Release Policies</a></li>
  <li><a href="#graphical-user-authentication">Graphical User Authentication</a></li>
  <li><a href="#saml-incommon-rs-attribute-release">SAML InCommon R&amp;S Attribute Release</a></li>
  <li><a href="#database-password-policy-enforcement">Database Password Policy Enforcement</a></li>
  <li><a href="#rest-password-management">REST Password Management</a></li>
  <li><a href="#management-webapp">Management Webapp</a></li>
  <li><a href="#minor-bug-fixes">Minor Bug Fixes</a></li>
  <li><a href="#library-upgrades">Library Upgrades</a></li>
  <li><a href="#whats-next">What’s Next?</a></li>
  <li><a href="#get-involved">Get Involved</a></li>
  <li><a href="#das-ende">Das Ende</a></li>
</ul>

<!-- /TOC -->

<h2 id="authentication-sequence">Authentication Sequence</h2>

<p>At runtime, CAS maintains a collection of authentication handlers/strategies that typically execute one after another. Each CAS module that presents a form of authentication strategy will simply insert itself into this collection at bootstrap time. This means the sequence of authentication execution is very much non-deterministic upon server restarts. At the end of the process, the result of all authentication transactions is collected and optionally processed by an authentication policy where success/failure of certain strategies/sources may be taken into account to fully satisfy the authentication requirements.</p>

<p>Starting with this feature release, the collection of authentication handlers tries to preserve order in a rather more deterministic way. Authentication handlers can be assigned a weight/order value thereby explicitly positioning themselves in the collection and controlling executionsequence.</p>

<p>At this time, the LDAP and JDBC authentication handlers are the only ones that have qualified for an <code class="highlighter-rouge">order</code> setting via the usual CAS properties.</p>

<h2 id="monitoringstatus-protection-with-spring-security">Monitoring/Status Protection with Spring Security</h2>

<p>CAS endpoints that provide <a href="https://apereo.github.io/cas/development/installation/Monitoring-Statistics.html#spring-security">monitoring and diagnostics</a>
features are now able to support various modes of authorization/authentication backed by Spring Security. Additional modes now include backend authentication support
via LDAP or JDBC storage facilities.</p>

<h2 id="saml-idp-metadata-generation">SAML IdP Metadata Generation</h2>

<p>The process of generating SAML2 metadata has been smoothened much better to ensure endpoints, ports and url
in the metadata correctly match pre-defined CAS settings in order to reduce/remove manual work.</p>

<h2 id="code-cleanup-and-optimization">Code Cleanup and Optimization</h2>

<p>Thanks to community contributions, the CAS codebase is revitalized ever more to make sure
most if not all underlying components adhere to proper coding standards and design practices.
Changes in this area include adjustments to style guidelines, constructor-based dependency injections
and navigating to the native Java 8 lambda APIs.</p>

<h2 id="xml-test-configuration">XML Test Configuration</h2>

<p>CAS test infrastructure continues to move away from XML configuration files and towards the facilities provided by Spring Boot. This will allow the project to mirror the deployment runtime configuration as much as possible while troubleshooting and fixing regressions, if any. A number of small enhancements have also gone into the core build system to ensure tests can be built and run in parallel modes via Gradle, which would cut down a full build/release cycle in half (i.e. close to 20 minutes).</p>

<p>This is rather helpful when adopters wish to be quick enough to try out <code class="highlighter-rouge">SNAPSHOT</code> releases during defect trials.</p>

<h2 id="mongodb-ticket-registry">MongoDb Ticket Registry</h2>

<p>CAS gains support for MongoDb as a storage mechanism for its ticket registry backend.
You can learn more about the registry behavior via <a href="https://apereo.github.io/cas/development/installation/MongoDb-Ticket-Registry.html">this guide</a>.</p>

<h2 id="cas-documentation-improvements">CAS Documentation Improvements</h2>

<p>Most if not all CAS documentation is reviewed to make sure various features properly point to their respective settings/properties
via relevant anchor links. Additional work will be done on the settings as well to ensure all properties are properly explained as much as possible.</p>

<h2 id="custom-password-encoders">Custom Password Encoders</h2>

<p>The collection of supported authentication password encoders now allows for the specification of a 
fully qualified <code class="highlighter-rouge">com.example.MyPasswordEncoder</code> implementation class to handle custom encoding use cases.</p>

<h2 id="management-webapp-authorization">Management Webapp Authorization</h2>

<p>Authorized access to the management webapp via LDAP now allows for groups and roles in addition to a single search for the user and attributes.</p>

<h2 id="fido-u2f-mfa">FIDO U2F MFA</h2>

<p>Another multifactor authentication option; basic support is added to provide <a href="https://apereo.github.io/cas/development/installation/FIDO-U2F-Authentication.html">FIDO U2F</a>.</p>

<h2 id="microsoft-azure-mfa">Microsoft Azure MFA</h2>

<p>As an extra multifactor authentication provider, CAS adds support for <a href="https://apereo.github.io/cas/development/installation/MicrosoftAzure-Authentication.html">Microsoft Azure</a>. A limited number of options are available to verify credentials with Azure that today include:</p>

<ul>
  <li>A phone call to a predefined phone number, as an attribute, where user has to press <code class="highlighter-rouge">#</code> only.</li>
  <li>A phone call to a predefined phone number, as an attribute, where user has to provide a CAS-generated token that is presented on the page.</li>
</ul>

<p>Integration with Azure mobile applications may be worked out in future releases based on interest and demand.</p>

<h2 id="principal-scim-provisioning">Principal SCIM Provisioning</h2>

<p>CAS gains the ability to provision the authenticated principal via <a href="https://apereo.github.io/cas/development/integration/SCIM-Integration.html">SCIM</a>.</p>

<h2 id="internal-support-for-kotlin">Internal Support for Kotlin</h2>

<p>The internal gradle build for the CAS codebase is adjusted to allow compilation of <a href="https://kotlinlang.org">Kotlin</a>’s <code class="highlighter-rouge">.kt</code> files, if any.</p>

<h2 id="clearpass-internal-encryption">Clearpass Internal Encryption</h2>

<p>Captures of credential password via Clearpass gain the option to encrypt the password internally via pre-defined keys.
The credential upon release in decoded internally in memory and then encrypted with the service’s public key defined in the registry.</p>

<h2 id="database-audit-default-catalogschema">Database Audit Default Catalog/Schema</h2>

<p>Database audits are now able to take advantage of new settings that control the default catalog and schema.</p>

<h2 id="openid-connect-jwks-caching">OpenID Connect JWKS Caching</h2>

<p>Small improvements have been put in to ensure JWKS resource fetching can go through caching channels
to help with processing keystores and performance.</p>

<h2 id="openid-connect-scope-based-claim-release">OpenID Connect Scope-based Claim Release</h2>

<p>Additional attribute and claim release policies are now provided to ensure a given OpenID Connect service
<a href="https://apereo.github.io/cas/development/installation/OIDC-Authentication.html">can release attributes</a>
based on pre-defined scope bundles.</p>

<h2 id="grouper-groups-as-principal-attributes">Grouper Groups as Principal Attributes</h2>

<p>Thanks to Person Directory’s built-in support of Internet2’s Grouper,
CAS is now able to collect a Grouper subject’s groups as principal attributes
and perhaps further use them in authorization decisions.</p>

<h2 id="openid-connect-encrypted-id-tokens">OpenID Connect Encrypted ID Tokens</h2>

<p>ID tokens generated by CAS are now able to be encrypted, provided the client/service is configured
appropriately in the registry.</p>

<h2 id="native-configuration-monitoring">Native Configuration Monitoring</h2>

<p>In the event that the <code class="highlighter-rouge">native</code> configuration profile is enabled, CAS is able to automatically
monitor the relevant configuration directories and refresh the context upon change.
Note that not all CAS components that process settings can be auto-reloaded. YMMV.</p>

<h2 id="openid-connect-implicit-profile">OpenID Connect Implicit Profile</h2>

<p>Support for OpenID Connect’s implicit workflow is worked into <a href="https://apereo.github.io/cas/development/installation/OIDC-Authentication.html">this release</a>.</p>

<h2 id="dynamic-acceptable-usage-policy">Dynamic Acceptable Usage Policy</h2>

<p>Sometimes deployments of CAS’ <a href="https://apereo.github.io/cas/development/installation/Webflow-Customization-AUP.html">Acceptable Usage Policy</a> consist of several policies
that may be shown to the user depending on membership, affiliation and even perhaps <code class="highlighter-rouge">objectclass</code>. In this release, CAS makes the fully resolved <code class="highlighter-rouge">Principal</code> available to AUP-related views and pages such that different views housing appropriate policies may be displayed depending on the resolved principal attributes.</p>

<h2 id="x509-authentication-ldap-crl-fetching">X509 Authentication: LDAP CRL Fetching</h2>

<p>A small improvement; an additional property is exposed to allow adopters the specification of the LDAP binary attribute that holds the certificate revocation list.</p>

<h2 id="google-authenticator-token-tracking">Google Authenticator Token Tracking</h2>

<p>To prevent immediate OTP reuse while using <a href="https://apereo.github.io/cas/development/installation/GoogleAuthenticator-Authentication.html">Google Authenticator</a> as the second authentication factor, CAS starts to track issued tokens that successfully were able to authenticate users. There are also built-in facilities that allow the underlying token-tracking repository to clean up after itself once the token’s expiration tag is removed.</p>

<h2 id="delegated-authentication-providers">Delegated Authentication Providers</h2>

<p>Delegated authentication in CAS adds support for Bitbucket, Paypal, Wordpress and generic OAuth20 providers.
Likewise, CAS should now allow delegating authentication to <em>multiple</em> CAS, SAML, OIDC and OAuth2 servers where before only single instances were supported.</p>

<h2 id="google-authenticator-json-storage">Google Authenticator JSON Storage</h2>

<p>To assist smaller deployments and to also allow for quicker testing and development, <a href="https://apereo.github.io/cas/development/installation/GoogleAuthenticator-Authentication.html">Google Authenticator</a> gains support for a JSON storage facility that is able to quickly keep track of user registration records.</p>

<h2 id="cas-banner--git-commit-id">CAS Banner &amp; Git Commit Id</h2>

<p>To facilitate testing of <code class="highlighter-rouge">SNAPSHOT</code> versions, the CAS banner on startup attempts to demonstrate the Git commit id of the release so adopters and developers may exactly determine the version of the source code deployed.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CAS Version: 5.1.0-RC2-SNAPSHOT
CAS Commit Id: 0b75fabbb0f865c497327695e30ecf08b6f15e63
CAS Build Date/Time: 2017-01-09T21:27:28Z
Spring Boot Version: 1.4.3.RELEASE
Apache Tomcat Version: Apache Tomcat/8.5.9
</code></pre></div></div>

<p>Additionally, the set of diagnostics messages are also printed when one deploys the CAS Management web application.</p>

<h2 id="multifactor-authentication-trigger-via-authentication-attribute">Multifactor Authentication Trigger via Authentication Attribute</h2>

<p>Title says it all.</p>

<p>CAS has had a number of options for triggering multifactor authentication based on a principal attribute.
This release adds an additional trigger that allows CAS to directly look into the authentication object to find metadata/attributes captured during the authentication event. This metadata in form of authentication attribute can be used to trigger multifactor authentication events. This is useful in scenarios where the underlying authentication machinery may signal back additional requirements in order for the authentication to fully succeed or, as another example, you may wish to trigger multifactor authentication if the captured <code class="highlighter-rouge">authenticationDate</code> matches a certain pattern of your own choosing, etc.</p>

<h2 id="ldap-authentication-search-entry-resolvers">LDAP Authentication Search Entry Resolvers</h2>

<p>CAS adds support for configuring search entry resolvers for LDAP authentication. Additional properties are exposed
to support the full range of resolvers that are made available to CAS.</p>

<h2 id="domain-services-manager">Domain Services Manager</h2>

<p>Thanks to <a href="https://github.com/tsschmidt">@tsschmidt</a>, the default services manager implementation in CAS that acts as the orchestrator on top of the service registry has been switched out to group service definitions by domain. This is the first step in allowing not only making a more performant CAS when dealing with large collections of service definitions, but also presents a nice opportunity for the management webapp and its UIs to organize definitions in a more sane way.</p>

<h2 id="saml-sp-integrations">SAML SP Integrations</h2>

<p>CAS adds support for a few additional built-in SAML SP integrations: <a href="https://apereo.github.io/cas/development/integration/Configuring-SAML-SP-Integrations.html">Zoom, Asana, Tableau and Evernote</a>.</p>

<h2 id="pythonjavascript-attribute-release-policies">Python/Javascript Attribute Release Policies</h2>

<p>Additional <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Policies.html">attribute release policies</a> are worked into CAS that allow one to filter attributes for applications
based on external python or javascript files.</p>

<h2 id="graphical-user-authentication">Graphical User Authentication</h2>

<p>There now exists basic/modest support for <a href="https://apereo.github.io/cas/development/installation/GUA-Authentication.html">GUA</a>.</p>

<h2 id="saml-incommon-rs-attribute-release">SAML InCommon R&amp;S Attribute Release</h2>

<p>There are dedicated <a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html#attribute-release">attribute release policies</a> now in CAS that allow one to release the required attribute bundle to InCommon’s R&amp;S service providers.</p>

<h2 id="database-password-policy-enforcement">Database Password Policy Enforcement</h2>

<p>Thanks to community contributions, database authentication gains modest support for enforcing
<a href="https://apereo.github.io/cas/development/installation/Password-Policy-Enforcement.html">password policy rules</a>.</p>

<h2 id="rest-password-management">REST Password Management</h2>

<p><a href="https://apereo.github.io/cas/development/installation/Password-Management.html">Password Management</a> capabilities of CAS begin to support REST APIs and endpoints that wish to take over the maintenance of the user account and updates to the password.</p>

<h2 id="management-webapp">Management Webapp</h2>

<p>The service management web application is enhanced to support a few more additional settings added to the CAS
service model for SAML2 and OpenID Connect services. Settings are also organized and grouped by categories that should be easier to find:</p>

<p><img src="https://cloud.githubusercontent.com/assets/1205228/22838635/6867ef06-efc6-11e6-8b09-a6fdaa45bd16.PNG" alt="capture" /></p>

<h2 id="minor-bug-fixes">Minor Bug Fixes</h2>

<p>A number of small bug fixes have been incorporated into this feature release:</p>

<ul>
  <li>Database schema update/generation accounts for more accurate column types and lengths.</li>
  <li>Google Authenticator QR code generation is remapped in the Spring Boot configuration.</li>
  <li>Expiration policy of OAuth refresh tokens is now taking into account the correct time unit of measure.</li>
  <li>Credential validation failures in multifactor authentication scenarios prompt error messages back to the user.</li>
  <li>Password change actions are now recorded in the CAS audit log.</li>
  <li>Service ticket creation based on authentication sessions established via <code class="highlighter-rouge">renew</code> are now correctly honored.</li>
  <li>Removed the need to re-create LDAP connection pools during LDAP authentication for entry resolution, etc.</li>
  <li>SAML assertion encryption is now able to properly locate the encryption credential.</li>
  <li>Added missing view for CAS responses that require <code class="highlighter-rouge">POST</code>.</li>
</ul>

<h2 id="library-upgrades">Library Upgrades</h2>

<ul>
  <li>Cryptacular</li>
  <li>JodaTime</li>
  <li>MongoDb Driver</li>
  <li>Spring Boot</li>
  <li>Apache Tomcat</li>
  <li>Log4j2</li>
  <li>…</li>
</ul>

<h2 id="whats-next">What’s Next?</h2>

<p>The development team is working to make sure the CAS <code class="highlighter-rouge">5.1.0</code> release is
on <a href="https://github.com/apereo/cas/milestones">schedule</a>. Additional release candidates
and more updates will likely be released prior to the official GA release.</p>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Review and suggest documentation improvements.</li>
  <li>Review the release schedule and make sure you report your desired feature requests on the project’s issue tracker.</li>
</ul>

<h2 id="das-ende">Das Ende</h2>

<p>A big hearty thanks to all who participated in the development of this release to submit patches, report issues and suggest improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/02/24/rc2-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.1.0 RC2 release.
                    
                </description>
                <pubDate>Fri, 24 Feb 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5 Database Authentication Tutorial</title>
                <link>https://apereo.github.io/2017/02/22/cas51-dbauthn-tutorial/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>This is a short and sweet tutorial on how to configure CAS to authenticate against a database and then resolve/release attributes.
Most of the material is based on the <a href="https://apereo.github.io/cas/development/installation/Database-Authentication.html">available documentation</a>.</p>

<p>This tutorial specifically focuses on:</p>

<ul>
  <li>CAS <code class="highlighter-rouge">5.1.0-RC2-SNAPSHOT</code></li>
  <li>HSQLDB <code class="highlighter-rouge">2.3.4</code></li>
  <li>Java 8</li>
  <li>Apache Tomcat <code class="highlighter-rouge">8.5.11</code></li>
</ul>

<h1 id="database">Database</h1>

<p>To keep things rather simple, we’ll be installing an instance of <a href="http://hsqldb.org/">HSQLDB</a>. For this exercise, I am running <code class="highlighter-rouge">2.3.4</code>, though note that the recipe is for the most part the same when dealing with other database instances as well, whether installed manually or run in a dockerized fashion.</p>

<p>So running HSQL shows me:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Server@2ff4acd0]: <span class="o">[</span>Thread[main,5,main]]: checkRunning<span class="o">(</span><span class="nb">false</span><span class="o">)</span> entered
<span class="o">[</span>Server@2ff4acd0]: <span class="o">[</span>Thread[main,5,main]]: checkRunning<span class="o">(</span><span class="nb">false</span><span class="o">)</span> exited
<span class="o">[</span>Server@2ff4acd0]: Startup sequence initiated from main<span class="o">()</span> method
<span class="o">[</span>Server@2ff4acd0]: Could not load properties from file
<span class="o">[</span>Server@2ff4acd0]: Using cli/default properties only
<span class="o">[</span>Server@2ff4acd0]: Initiating startup sequence...
<span class="o">[</span>Server@2ff4acd0]: Server socket opened successfully <span class="k">in </span>46 ms.
<span class="o">[</span>Server@2ff4acd0]: Database <span class="o">[</span><span class="nv">index</span><span class="o">=</span>0, <span class="nv">id</span><span class="o">=</span>0, <span class="nv">db</span><span class="o">=</span>file:mydb, <span class="nb">alias</span><span class="o">=</span>xdb] opened successfully <span class="k">in </span>349 ms.
<span class="o">[</span>Server@2ff4acd0]: Startup sequence completed <span class="k">in </span>396 ms.
<span class="o">[</span>Server@2ff4acd0]: 2017-02-21 13:44:37.717 HSQLDB server 2.3.4 is online on port 9001
<span class="o">[</span>Server@2ff4acd0]: To close normally, connect and execute SHUTDOWN SQL
<span class="o">[</span>Server@2ff4acd0]: From <span class="nb">command </span>line, use <span class="o">[</span>Ctrl]+[C] to abort abruptly
</code></pre></div></div>

<p>Great. Moving on…</p>

<h1 id="create-schema">Create Schema</h1>

<p>In my setup, I have two tables: one called <code class="highlighter-rouge">USERS</code> where user accounts are kept and another called <code class="highlighter-rouge">USERATTRS</code> where user attributes are kept. My <code class="highlighter-rouge">USERS</code> table is rather simple, but the <code class="highlighter-rouge">USERATTRS</code> follows something of a <em>multi-row</em> setup. You want to learn more about this setup <a href="https://apereo.github.io/cas/development/integration/Attribute-Resolution.html#person-directory">here</a>.</p>

<p>So here goes the SQL:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">USERS</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">USERATTRS</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">USERATTRS</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">INT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">IDENTITY</span> <span class="p">,</span>
  <span class="n">uid</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">attrname</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">attrvalue</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">USERS</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">INT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">IDENTITY</span> <span class="p">,</span>
  <span class="n">uid</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">psw</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">USERS</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">psw</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'mmoayyed'</span><span class="p">,</span> <span class="s1">'TheBestPasswordEver'</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">USERATTRS</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span>  <span class="n">attrname</span><span class="p">,</span> <span class="n">attrvalue</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'mmoayyed'</span><span class="p">,</span> <span class="s1">'firstname'</span><span class="p">,</span> <span class="s1">'Misagh'</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">USERATTRS</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">attrvalue</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'mmoayyed'</span><span class="p">,</span> <span class="s1">'lastname'</span><span class="p">,</span> <span class="s1">'Moayyed'</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">USERATTRS</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">attrvalue</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'mmoayyed'</span><span class="p">,</span> <span class="s1">'phone'</span><span class="p">,</span> <span class="s1">'+13476452319'</span><span class="p">);</span>
</code></pre></div></div>

<p>Note that for the time being, I am just keeping the password as plain-text in the table. No encoding or anything has taken place.</p>

<h1 id="deploy-cas">Deploy CAS</h1>

<p>Hop over to <a href="https://apereo.github.io/cas/development/installation/Maven-Overlay-Installation.html">the overlay installation</a> and get CAS built and deployed. The CAS version I am using today is <code class="highlighter-rouge">5.1.0-RC2-SNAPSHOT</code>. It does not matter whether you end up using Maven or Gradle. Choose what fits you best. When you have a baseline functioning build, continue on.</p>

<h1 id="configure-cas">Configure CAS</h1>

<p>Follow the steps <a href="https://apereo.github.io/cas/development/installation/Database-Authentication.html">described here</a> to add the needed CAS modules. Once the module/dependency is added to your build, hop over to <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html#database-authentication">the settings page</a> and add the properties.</p>

<p><em>Note that I did not have to add any additional JARs and such for database drivers. CAS ships with a few <a href="https://apereo.github.io/cas/development/installation/JDBC-Drivers.html">automatically and by default</a></em></p>

<p>For this tutorial, this is what I actually needed to make this work:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.jdbc.query[0]</span><span class="py">.sql</span><span class="p">=</span><span class="s">SELECT * FROM USERS WHERE uid=?</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.url</span><span class="p">=</span><span class="s">jdbc:hsqldb:hsql://localhost:9001/xdb</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.dialect</span><span class="p">=</span><span class="s">org.hibernate.dialect.HSQLDialect</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.user</span><span class="p">=</span><span class="s">sa</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.password</span><span class="p">=</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.driverClass</span><span class="p">=</span><span class="s">org.hsqldb.jdbcDriver</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.fieldPassword</span><span class="p">=</span><span class="s">psw</span>
</code></pre></div></div>

<p>I also need to disable static authentication. It would also be very nice if I could turn on <code class="highlighter-rouge">DEBUG</code> logs and see what CAS attempts to do:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">logging.level.org.apereo</span><span class="p">=</span><span class="s">DEBUG</span>
<span class="py">cas.authn.accept.users</span><span class="p">=</span>
</code></pre></div></div>

<h1 id="build-and-deploy">Build and Deploy</h1>

<p>Once you get CAS built and deployed, logs should indicate something like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-02-21 14:20:18,267 DEBUG <span class="o">[</span>org.apereo.cas.configuration.support.Beans] - &lt;No password encoder shall be created given the requested encoder <span class="nb">type</span> <span class="o">[</span>NONE]&gt;
2017-02-21 14:20:18,277 DEBUG <span class="o">[</span>org.apereo.cas.adaptors.jdbc.config.CasJdbcAuthenticationConfiguration] - &lt;Created authentication handler <span class="o">[</span>QueryDatabaseAuthenticationHandler] to handle database url at <span class="o">[</span>jdbc:hsqldb:hsql://localhost:9001/xdb]&gt;
</code></pre></div></div>

<p>Log in with <code class="highlighter-rouge">mmoayyed</code> and <code class="highlighter-rouge">TheBestPasswordEver</code> and you should be in. Viola!</p>

<h1 id="password-encoding">Password Encoding</h1>

<p>As an extra bonus exercise, let’s turn on <code class="highlighter-rouge">MD5</code> password encoding. The MD5 hash of <code class="highlighter-rouge">TheBestPasswordEver</code> is <code class="highlighter-rouge">ca541f57a3041c3b85c553d12d3e64a8</code>.</p>

<p>So we will update the database accordingly.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">USERS</span> <span class="k">SET</span> <span class="n">psw</span><span class="o">=</span><span class="s1">'ca541f57a3041c3b85c553d12d3e64a8'</span> <span class="k">WHERE</span> <span class="n">uid</span><span class="o">=</span><span class="s1">'mmoayyed'</span><span class="p">;</span>
</code></pre></div></div>

<p>Then configure CAS to handle <code class="highlighter-rouge">MD5</code> password encoding:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.jdbc.query[0]</span><span class="py">.passwordEncoder.type</span><span class="p">=</span><span class="s">DEFAULT</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.passwordEncoder.encodingAlgorithm</span><span class="p">=</span><span class="s">MD5</span>
<span class="err">cas.authn.jdbc.query[0]</span><span class="py">.passwordEncoder.characterEncoding</span><span class="p">=</span><span class="s">UTF-8</span>
</code></pre></div></div>

<h1 id="build-and-deploy-1">Build and Deploy</h1>

<p>Once you get CAS built and deployed, logs should indicate something like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-02-21 14:44:31,884 DEBUG <span class="o">[</span>org.apereo.cas.configuration.support.Beans] - &lt;Creating default password encoder with encoding alg <span class="o">[</span>MD5] and character encoding <span class="o">[</span>UTF-8]&gt;
</code></pre></div></div>

<p>Build and deploy. Log in with <code class="highlighter-rouge">mmoayyed</code> and <code class="highlighter-rouge">TheBestPasswordEver</code> and you should be in. Logs may indicate:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-02-21 14:45:55,517 DEBUG <span class="o">[</span>org.apereo.cas.util.crypto.DefaultPasswordEncoder] - &lt;Encoded password via algorithm <span class="o">[</span>MD5] and character-encoding <span class="o">[</span>UTF-8] is <span class="o">[</span>ca541f57a3041c3b85c553d12d3e64a8]&gt;
2017-02-21 14:45:55,517 DEBUG <span class="o">[</span>org.apereo.cas.util.crypto.DefaultPasswordEncoder] - &lt;Provided password does match the encoded password&gt;
2017-02-21 14:45:55,519 DEBUG <span class="o">[</span>org.apereo.cas.authentication.AbstractAuthenticationManager] - &lt;Authentication handler <span class="o">[</span>QueryDatabaseAuthenticationHandler] successfully authenticated <span class="o">[</span>mmoayyed]&gt;
</code></pre></div></div>

<p>Good job! Lets get some attributes now.</p>

<h1 id="attributes">Attributes</h1>

<p>Because the <code class="highlighter-rouge">USERATTRS</code> follows something of a <em>multi-row</em> setup, we want to make sure CAS <a href="(https://apereo.github.io/cas/development/integration/Attribute-Resolution.html#person-directory)">can understand</a> the specifics of this schema model. Today, CAS is unable to retrieve attributes as part of authentication directly so we need to set up a separate attribute repository instance that CAS will contact once the user is fully authenticated. In our case, the attribute repository is the same database instance. So the configuration may look something like this:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.singleRow</span><span class="p">=</span><span class="s">false</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.sql</span><span class="p">=</span><span class="s">SELECT * FROM USERATTRS WHERE {0}</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.username</span><span class="p">=</span><span class="s">uid</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.url</span><span class="p">=</span><span class="s">jdbc:hsqldb:hsql://localhost:9001/xdb</span>
<span class="err">cas.authn.attributeRepository.jdbc[0]</span><span class="py">.columnMappings.attrname</span><span class="p">=</span><span class="s">attrvalue</span>
</code></pre></div></div>

<p>Once CAS understands the schema, we should then specify which attributes really should be retrieved by CAS.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.attributeRepository.attributes.firstname</span><span class="p">=</span><span class="s">firstname</span>
<span class="py">cas.authn.attributeRepository.attributes.lastname</span><span class="p">=</span><span class="s">lastname</span>
<span class="c"># cas.authn.attributeRepository.attributes.phone=phone
</span></code></pre></div></div>

<p>Note how I am skipping over <code class="highlighter-rouge">phone</code>.</p>

<p>The above says, <em>Retrieve attributes <code class="highlighter-rouge">firstname</code> and <code class="highlighter-rouge">lastname</code> from the repositories and keep them as they are</em>.
If we wanted to, we could virtually rename the attributes to for instance <code class="highlighter-rouge">TheFir$tN@me</code> and <code class="highlighter-rouge">simpleL@stnam3</code>.</p>

<h1 id="release-attributes">Release Attributes</h1>

<p>There are multiple ways of <a href="https://apereo.github.io/cas/development/integration/Attribute-Release.html">releasing attributes</a>. For this tutorial, I am going to release them globally to all applications:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">cas.authn.attributeRepository.defaultAttributesToRelease</span><span class="p">=</span><span class="s">firstname,lastname</span>
</code></pre></div></div>

<p>Note how I am skipping over <code class="highlighter-rouge">phone</code>.</p>

<h1 id="build-and-deploy-2">Build and Deploy</h1>

<p>For this to actually be tested, we need a client to which we can release attributes, right? You can use whatever client/application you like, as long as it’s able to retrieve attributes. I ended up using <a href="https://github.com/cas-projects/cas-sample-java-webapp">this</a>. When attempting to access the application, I get redirected to CAS. Once I log in and return, I see the following in the CAS logs on startup:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2017-02-21 14:54:04,885 DEBUG <span class="o">[</span>org.apereo.cas.config.CasPersonDirectoryConfiguration] - &lt;Configured multi-row JDBC attribute repository <span class="k">for</span> <span class="o">[</span>jdbc:hsqldb:hsql://localhost:9001/xdb]&gt;
2017-02-21 14:54:04,889 DEBUG <span class="o">[</span>org.apereo.cas.config.CasPersonDirectoryConfiguration] - &lt;Configured multi-row JDBC column mappings <span class="k">for</span> <span class="o">[</span>jdbc:hsqldb:hsql://localhost:9001/xdb] are <span class="o">[{</span><span class="nv">attrname</span><span class="o">=</span>attrvalue<span class="o">}]&gt;</span>
2017-02-21 14:54:04,890 DEBUG <span class="o">[</span>org.apereo.cas.config.CasPersonDirectoryConfiguration] - &lt;Configured result attribute mapping <span class="k">for</span> <span class="o">[</span>jdbc:hsqldb:hsql://localhost:9001/xdb] to be <span class="o">[{</span><span class="nv">firstname</span><span class="o">=</span>firstname, <span class="nv">lastname</span><span class="o">=</span>lastname<span class="o">}]&gt;</span>
</code></pre></div></div>

<p>Which shows that CAS has been able to understand the schema and map columns to attributes. Logging into the client application also shows me:</p>

<p><img src="https://cloud.githubusercontent.com/assets/1205228/23163353/5c39f42a-f847-11e6-806e-6d4e3ca88805.png" alt="image" /></p>

<h1 id="so">So…</h1>

<p>I hope this brief tutorial was of some assistance to you. Remember that the point here is not to enumerate best practices and such. It’s just to show the possibilities. It’s important that you start off simple and make changes one step at a time. Once you have a functional environment, you can gradually and slowly add customizations to move files, tables and queries around.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/02/22/cas51-dbauthn-tutorial/</guid>
                <description>
                    
                    Learn how to configure database authentication in CAS 5.
                    
                </description>
                <pubDate>Wed, 22 Feb 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Intro To CAS Auto Configuration Strategy</title>
                <link>https://apereo.github.io/2017/02/21/cas-autocfg-strategy/</link>
                <content:encoded>
                    <![CDATA[
                    <blockquote>
  <p>The post specifically applies to CAS 5.1.x which, as of this writing today, is still in development.</p>
</blockquote>

<p>If you scan the recent literature on <a href="https://apereo.github.io/cas/development/installation/Configuration-Management.html#auto-configuration-strategy">CAS configuration model and strategy</a>, you would notice that there is a great amount of emphasis on letting CAS modules dynamically alter the application context at runtime to activate features, massage webflow definitions and move settings around without asking for a whole lot of manual input.</p>

<p>How does this all work?</p>

<h1 id="java-based-configuration">Java-based Configuration</h1>

<p>Given CAS’ adoption of <a href="https://github.com/spring-projects/spring-boot">Spring Boot</a>, most if not all of the old XML configuration is transformed into <code class="highlighter-rouge">@Configuration</code> components. These are classes declared by each relevant module that are automatically picked up at runtime whose job is to declare and configure beans and register them into the application context. Another way of thinking about it is, components that are decorated with <code class="highlighter-rouge">@Configuration</code> are loose equivalents of old XML configuration files that are highly organized where <code class="highlighter-rouge">&lt;bean&gt;</code> tags are translated to java methods tagged with <code class="highlighter-rouge">@Bean</code> and configured dynamically.</p>

<p>Sidestepping irrelevant details, here is an example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">apereo</span><span class="o">.</span><span class="na">cas</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="s">"casCoreMonitorConfiguration"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CasCoreMonitorConfiguration</span> <span class="o">{</span>

    <span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"healthCheckMonitor"</span><span class="o">)</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Monitor</span> <span class="nf">healthCheckMonitor</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Monitor</span><span class="o">&gt;</span> <span class="n">monitors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

        <span class="c1">// Add monitors to the list as needed dynamically</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">HealthCheckMonitor</span><span class="o">(</span><span class="n">monitors</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The above done in XML form manually in a <code class="highlighter-rouge">monitors-configuration.xml</code> file
would roughly translate into the following:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"healthCheckMonitor"</span> <span class="na">class=</span><span class="s">"org.apereo.cas.monitor.HealthCheckMonitor"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"monitors"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;list&gt;</span>
        <span class="c">&lt;!-- Add monitors to the list as needed dynamically. --&gt;</span>
      <span class="nt">&lt;/list&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div>

<h1 id="configuration-registration"><code class="highlighter-rouge">@Configuration</code> Registration</h1>

<p>How are <code class="highlighter-rouge">@Configuration</code> components picked up? Each CAS module declares its set of configuration components as such, <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html">per guidelines laid out by Spring Boot</a>:</p>

<ul>
  <li>Create a <code class="highlighter-rouge">src/main/resources/META-INF/spring.factories</code> file</li>
  <li>Add the following into the file:</li>
</ul>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span><span class="p">=</span><span class="se">\
</span><span class="s">org.apereo.cas.config.CasCoreMonitorConfiguration</span>
</code></pre></div></div>

<p>The above done in XML form would roughly translate into the following:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">"monitors-configuration.xml"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>Note that the you can use the same exact technique in CAS overlays to register your own configuration components, or remove/disable CAS’ auto-configuration strategy. For instance, if you prefer to not let CAS bootstrap its monitoring configuration automatically, you can remove it from the registration process in the <code class="highlighter-rouge">application.properties</code> file:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.autoconfigure.exclude</span><span class="p">=</span><span class="s">org.apereo.cas.config.CasCoreMonitorConfiguration</span>
</code></pre></div></div>

<h1 id="overrides-and-conditional">Overrides and <code class="highlighter-rouge">@Conditional</code></h1>

<p>What if you needed to override the definition of that <code class="highlighter-rouge">healthCheckMonitor</code> bean to add/remove monitors? Or perhaps entirely remove and disable it? This is where <code class="highlighter-rouge">@Conditional</code> components come to aid. Most component/bean definitions in CAS are registered with some form of <code class="highlighter-rouge">@Conditional</code> tag that indicates to the bootstrapping process to ignore them, if <em>a bean definition with the same id</em> is already defined. This means you can create your own configuration class, register it and the design a <code class="highlighter-rouge">@Bean</code> definition only to have the context utilize yours rather than what ships with CAS by default:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">custom</span><span class="o">.</span><span class="na">mine</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="s">"MyOwnMonitorConfiguration"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyOwnMonitorConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Monitor</span> <span class="nf">healthCheckMonitor</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Monitor</span><span class="o">&gt;</span> <span class="n">monitors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

        <span class="c1">// Do what you will to replace the provided CAS monitor.</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">HealthCheckMonitor</span><span class="o">(</span><span class="n">monitors</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Make sure your component is registered:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span><span class="p">=</span><span class="se">\
</span><span class="s">org.custom.mind.config.MyOwnMonitorConfiguration</span>
</code></pre></div></div>

<p>The trick here is, in order to override a bean definition, you need to know its name as your own structure identified by the method name must <em>exactly</em> match that of CAS or the process fails. This is where you look into the CAS source code to learn about various beans, etc.</p>

<p>I <em>strongly</em> advise against making this sort of change, unless absolutely warranted and reasonable (To learn why, please read on).</p>

<h1 id="what-else">What Else?</h1>

<ul>
  <li>Your <code class="highlighter-rouge">@Bean</code> definitions can also be tagged with <code class="highlighter-rouge">@RefreshScope</code> to become auto-reloadable when the CAS context is refreshed as a result of an external property change.</li>
  <li><code class="highlighter-rouge">@Configuration</code> classes can be assigned an order with <code class="highlighter-rouge">@Order(1234)</code> which would place them in an ordered queue waiting to be loaded in that sequence.</li>
  <li>To be more explicit, <code class="highlighter-rouge">@Configuration</code> classes can also be loaded exactly before/after another <code class="highlighter-rouge">@Configuration</code> component with <code class="highlighter-rouge">@AutoConfigureBefore</code> or <code class="highlighter-rouge">@AutoConfigureAfter</code> tags and annotations.</li>
</ul>

<h1 id="why-spring-boot">Why Spring Boot?</h1>

<p>That is a fair question; Why prefer a Java-based configuration model over XML. Isn’t XML, by intention and definition, more extensible and easier to modify and tweak? Why should you have to write Java-code to extend and modify the context?</p>

<p>There are several advantages to this model.</p>

<h2 id="compiled">Compiled</h2>

<p>Often times when you build the CAS application package via Maven or Gradle, the build process simply outputs <code class="highlighter-rouge">BUILD SUCCESS</code> at the end somehow tricking you into thinking “Great! My changes are going to work.” where in fact that may be entirely false. All that message tells you is that the build tool was able to assemble and package a bunch of configuration files and form a binary archive at the end. The output is going to be all the same, even if you had a typo in the configuration, a missing tag or a bad configuration piece. Also, if a new CAS version decides [for whatever reason] to move that <code class="highlighter-rouge">HealthCheckMonitor</code> from <code class="highlighter-rouge">org.apereo.cas.monitor</code> into <code class="highlighter-rouge">org.apereo.cas.monitors</code> or even rename it to something else, then you end up with a broken configuration when you upgrade. Why? Because it’s exactly that; just configuration. A small piece of fragmented code that tells the application how to behave a tad too late in the deployment lifecycle.</p>

<p>Java-based configuration components are the exact opposite. They are <em>source code</em>. They compile. Any typos, mistakes or repackaging of the components will immediately stop the build from succeeding.</p>

<p>Think of it this way; if you are designing the electrical system of a building:</p>

<ul>
  <li>Would you prefer the wiring system stop you from making potentially fatal mistakes as you attempt to connect the cables and wires together?</li>
  <li>Or would you prefer to do the whole thing in one go, turn on the lights, have the entire building blow up only to (possibly, maybe) succeed later after a few more iterations?</li>
</ul>

<h2 id="automated">Automated</h2>

<p>The above note really may not be all that attractive, unless you start to consider that Java-based configuration components can entirely automate the behavior of the application. They can be done once and for all, with small modest options here and there to tweak certain aspects of the feature, and then can ship with the application as first-class citizens only to be activated conditionally at deployer’s command. They are not affected by trivial mistakes, copy-paste errors, maintenance burdens and steep learning curves.</p>

<p>XML is a terribly poor choice as a programming language to automate configuration conditionally. If you were asked to turn on and configure a few different features in the application:</p>

<ul>
  <li>Would you prefer to go to your build script, declare feature modules, tweak settings and run?</li>
  <li>Or would you prefer to go to the documentation, copy various [and large] pieces of XML fragments into [perhaps many] configuration files, build and run, trusting that the documentation is accurate for the deployment version, hoping that it all works so you don’t have to understand what a <code class="highlighter-rouge">&lt;bean&gt;</code> is, praying you haven’t fat fingered an ending XML tag?</li>
</ul>

<h2 id="self-documented">Self-Documented</h2>

<p>The best advantage of configuration automation is that it removes the amount of boilerplate documentation one may have to apply or maintain. There is no longer a need to look after various XML fragments in the documentation, maintain and update them or try to verbosely explain their behavior and function in tutorials and guides [and thus duplicating what Spring or Spring Webflow may have already done in their own documentation!]. The technical details of how Spring or Spring Webflow or LDAP/JDBC libraries work have been abstracted away into what is now commonly referred to as <em>Intentions</em>.</p>

<p>To see this in action, see the contents of <a href="https://apereo.github.io/cas/4.1.x/installation/OAuth-OpenId-Authentication.html#add-the-oauth20wrappercontroller">this page</a> and compare with <a href="https://apereo.github.io/cas/development/installation/OAuth-OpenId-Authentication.html#configuration">this page</a>. The former expects a lot more from the deployer while the latter simply translates a deployer’s intention into a small feature module/plugin. As a result, the documentation tends to get a lot more focused and compact.</p>

<h2 id="modernized">Modernized</h2>

<p>It would not be unfair to say that that CAS 3.x software, released almost over a decade ago, laid down the sweet architectural foundations for an open and extensible platform with flexible APIs and outlined public injection points. At the time, using technologies such as Spring, JSP and Spring Webflow were superbly attractive and significantly useful in allowing adopters to modify the platform decoratively and extend it programmatically. As a result, many extensions and add-ons and customizations flourished into existence based on the CAS 3.x platform, making the software that much more attractive [and perhaps more complicated to reason about] for adopters’ evaluation.</p>

<p>Now a decade later, the CAS software has revitalized its roots and designs to ensure it can keep up with today’s demands and resources and future’s solid and stable technical trends. To that end, Spring Boot is simply the best choice available as a flexible and modern albeit opinionated platform on top of which CAS can continue to grow. With the shift towards cloud-friendly micro-services and such, CAS needed to stay on top of its game by allowing deployments to be <a href="https://12factor.net/">self-contained and self-sufficient</a> by employing technologies such as Spring Boot, <a href="http://projects.spring.io/spring-cloud/">Spring Cloud</a>, Thymeleaf and such so development and maintenance could sustain given project’s resources and team availabilities and with the presence of more complicated use cases such as <a href="https://apereo.github.io/cas/development/installation/Configuring-Multifactor-Authentication.html">MFA</a>, etc.</p>

<h1 id="why-not">Why Not?</h1>

<p>There are of course many difficulties and challenges inherent in this model as well, especially if you are new to Spring Boot and have an existing background with XML-based configuration.</p>

<h2 id="learning-curve">Learning Curve</h2>

<p>There is undoubtedly a learning curve here both for deployers and developers. Deployers who are used to the copy-paste XML configuration model may find the auto-configuration magic way too confusing and black-boxish while developers may find the same process to be composed of many moving and puzzling parts.</p>

<h2 id="documentation">Documentation</h2>

<p>One could argue that XML-based configuration given its explicit nature could be reasoned about easier where injections of properties and settings into XML beans and such could be more comfortably understood and then tweaked. This is perfectly true that while the documentation has removed the boilerplate fragments needed to activate features, there is still <em>a most definitive need</em> to document and explain away <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html">all the settings</a> that activate and control behavior in CAS. The strategy certainly is not to downplay the importance of good documentation and guides; it’s to only highlight what is absolutely expected of the adopter to keep around and maintain in local deployments.</p>

<p>It’s also evident that producing good documentation is very much a time-consuming and delicate process, given various levels of technical expertise and skill. It takes time as the platform is still very very young. So by all means, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">feel free to contribute</a>.</p>

<h2 id="customizations">Customizations</h2>

<p>The XML configuration was right in front of you, right? All you had to do was to change an element here and a property there and you were done. It’s quite true that the old model provides easier flexibility though perhaps at the cost of complexity as the platform grows larger.</p>

<p>It should be noticed that the ability to configure the CAS application context via XML is <em>not removed</em>. There still exists a <code class="highlighter-rouge">deployerConfigContext.xml</code> that may be of assistance for truly special and customized needs and requirements. However, most everything is translated into auto-configuration modules with a specific set of externalized properties and settings that control behavior.</p>

<p>So what do you do if you wanted to code an extension, or plug in a component/setting to modify behavior? The following options come to mind:</p>

<ul>
  <li>
    <p><a href="https://apereo.github.io/cas/Support.html">Talk to the project</a>. Discuss use cases and requirements, <a href="https://github.com/apereo/cas">open up issues</a> and better yet <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches and pull requests</a> to see your change become a first-class feature of the CAS product rather than something you specially have to control, maintain, document, teach and then understand.</p>
  </li>
  <li>
    <p>If the use case you have in mind truly applies to your own specific workflows and integration strategies, your best option is to <em>not</em> try to find a way based on the old XML-based configuration model to shoehorn your changes into CAS. That will simply result into long-term disastrous results. Follow the same pattern discussed here. If you find anything that is missing or have suggestions for things that need to be improved or made conditional to make extensions easier, discuss those with the project and contribute back. Write the code where it belongs.</p>
  </li>
</ul>

<p>If none of those options appeal to you, it’s likely that you may be heavily disappointed with the CAS software.</p>

<h1 id="so">So…</h1>

<p>I hope this brief tutorial was of some assistance to you. If you have other suggestions for content and material or have questions about this particular post here, please get in touch.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/02/21/cas-autocfg-strategy/</guid>
                <description>
                    
                    A short and painless introduction into how CAS uses Spring Boot to tickle the runtime conditionally.
                    
                </description>
                <pubDate>Tue, 21 Feb 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>On The Theory of Possibility</title>
                <link>https://apereo.github.io/2017/02/18/onthe-theoryof-possibility/</link>
                <content:encoded>
                    <![CDATA[
                    <p>If you are a member of an open source community and have been developing, designing and maintaining open source code for some time, it is very likely that from time to time you may encounter requests, comments and questions such as this:</p>

<blockquote>
  <p>We are starting with our deployment of [insert-name]. One of our major requirements is that once the user logs into the application, a request via our own very special protocol is submitted to his/her automobile to schedule a job with the vehicle’s IOT system to start up the A/C in 8 hours. When the user finishes work in a typical 8-hour work day, he/she can very comfortably get back into the car that is prepped with an exact and very personalized degree of temperature for all seasons. We’d also like the timespan to be configurable. Oh, we also use Active Directory.</p>
</blockquote>

<p>So far, very cool. Exciting, rather. I wonder if we could also automatically submit an order to Pizza Hut to deliver a large Hawaiian pizza to the user’s residence. That would be sweet.</p>

<p>The post follows:</p>

<blockquote>
  <p>Is it possible?</p>

  <p>If not, are there plans to support this?</p>
</blockquote>

<p>I don’t know about you, dear reader, but I posit that there is virtually nothing in life that is impossible. My half serious reaction, in my head, usually is something along the lines of the following:</p>

<blockquote>
  <p>Dear [insert-name],</p>

  <p>All things are possible in open source.</p>

  <p>4000 hours.</p>

  <p>Regards,</p>
</blockquote>

<p>Some things, however, are improbable [1].</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

<p><em>[1]There is no such thing as a ‘plan’. Just a pending pull request.</em></p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/02/18/onthe-theoryof-possibility/</guid>
                <description>
                    
                    Musings on the definition of Possibility and strategies one may use to empower friends, family and colleagues in open source.
                    
                </description>
                <pubDate>Sat, 18 Feb 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Design CAS-Enabled Custom Protocols</title>
                <link>https://apereo.github.io/2017/02/17/cas-custom-protocols/</link>
                <content:encoded>
                    <![CDATA[
                    <p><img src="https://cloud.githubusercontent.com/assets/1205228/23062372/c06e1e1a-f51a-11e6-8e5a-60692af7728c.jpg" alt="" /></p>

<p>That’s right. If you enjoy designing your own authentication protocols, integration strategies and workflows and then face the requirement of letting your Apereo CAS deployment support them, you have come to the right place. This is a guide for you.</p>

<p>Today, <a href="https://apereo.github.io/cas">Apereo CAS</a> presents itself as a multilingual platform supporting protocols such as CAS, SAML2, OAuth2 and OpenID Connect. There are even <a href="https://github.com/apereo/cas/issues/2340">plans and projections</a> to provide support for the necessary parts of the <code class="highlighter-rouge">WS-*</code> protocol stack. Support and functionality for each of these protocols continually improves per every iteration and release of the software thanks to excellent community feedback and adoption. While almost all such protocols are similar in nature and intention, they all have their own specific bindings, parameters, payload and security requirements. So, in order for you to understand how to add support for yet another protocol into CAS, it’s very important that you first begin to study and understand how existing protocols are supported in CAS. The strategy you follow and implement will most likely be very similar.</p>

<p>It all starts with something rather trivial: The Bridge. Pay attention. This one actually does go somewhere.</p>

<h1 id="the-bridge">The Bridge</h1>

<p>If you have ever deployed the <a href="https://github.com/Unicon/shib-cas-authn3">ShibCas AuthN plugin</a> to <em>bridge</em> the gap between the Shibboleth IdP and Apereo CAS, then you are very familiar with this pattern. The plugin simply acts as a link between the two platforms, allowing authentication requests from the IdP to be routed “invisibly” to CAS and then back. It sits between the two platforms and knows how to translate one protocol (SAML) to another (CAS) and then does it all in reverse order on the trip back to the SAML service provider.</p>

<p>This is a neat trick because to the SAML Service Provider, that fact that authentication from the IdP is delegated to somewhere else is entirely irrelevant and unimportant. Likewise, the IdP also does not care what external authentication system handles and honors that request. All it cares about is, “I routed the request to X. As long as X gives me back the right stuff, I should be fine to resume”.</p>

<p>So the bridge for the most part is the “control tower” of the operation. It speaks both languages and protocols, and just like any decent translator, it knows about the quirks and specifics of each language and as such is able to dynamically translate the technical lingo.</p>

<p>So far, so good.</p>

<h1 id="cas-supported-protocols">CAS Supported Protocols</h1>

<p>If you understand the above strategy, then you would be glad to learn that almost all protocols supported by CAS operate with the same exact intentions. A given CAS deployment is equipped with an embedded “plugin” that knows how to speak SAML2 and CAS, OAuth2 and CAS, or OpenID Connect and CAS or whatever. The right-hand side of that equation is always CAS when you consider, as an example, the following authentication flow with an OAuth2-enabled client application:</p>

<ol>
  <li>The CAS deployment has turned on the OAuth2 plugin.</li>
  <li>An OAuth2 authorization request is submitted to the relevant CAS endpoint.</li>
  <li>The OAuth2 plugin verifies the request and translates it to a CAS authentication request!</li>
  <li>The authentication request is routed to the relevant CAS login endpoint.</li>
  <li>User authenticates and CAS routes the flow back to the OAuth2 plugin, having issued a service ticket for the plugin.</li>
  <li>The OAuth2 plugin attempts to validate that ticket to retrieve the necessary user profile and attributes.</li>
  <li>The OAuth2 plugin then proceeds to issue the right OAuth2 response by translating and transforming the profile and validated assertions into what the client application may need.</li>
</ol>

<h2 id="notes">Notes</h2>

<ol>
  <li>The right-hand side of the flow is always CAS, because the plugin always translates protocol requests into CAS requests.</li>
  <li>Another way of looking at it is that all protocol plugins and modules are themselves clients of the CAS server! They are issued service tickets and they proceed to validate them just like any other CAS-enabled client.</li>
  <li>Just like above, to the OAuth2-enabled client all such details are totally transparent and as long as “the right stuff” is produced back to the client, it shall not care.</li>
</ol>

<h2 id="advantages">Advantages</h2>

<p>There are some internal technical and architectural advantages to this approach. Namely:</p>

<ol>
  <li>The core of the CAS authentication engine, flow and components need not be modified at all. After all, we are just integrating yet another client even if it’s embedded directly in CAS itself. (If you recall and are familiar, the original Clearpass integration via authentication proxying worked in very similar terms).</li>
  <li>…and because of that, support for that protocol can be very easily removed, if needed. After all, protocols come and go every day. That’s why you’re reading this blog post, right?!</li>
  <li>…and because of that and just like any other CAS client, all features of the CAS server are readily available and translated to the relevant client removing the need to duplicate and re-create protocol-specific configuration as much as  possible. Things like access strategies, attribute release, username providers, etc.</li>
</ol>

<h2 id="challenges">Challenges</h2>

<p>This process is rather difficult to get right, because just like any other decent translator, you do have to learn and speak both languages just-in-time. The plugin module needs to be designed generically and with a reasonable degree of abstraction such that it can dynamically insert itself into the right core areas of CAS without getting too entangled in the internal architecture.</p>

<h1 id="your-road-to-fame">Your Road to Fame</h1>

<p>So if you mean to build support for your very own authentication protocol, you’d do well to follow in the same footsteps. Take inspiration from the approach that current plugins and modules implement and design your own plugin that itself is the client of the CAS server hosting and housing it.</p>

<p>Happy Designing.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/02/17/cas-custom-protocols/</guid>
                <description>
                    
                    Learn how to design and mass-promote your very own custom authentication protocol, get rich quickly, stay healthy indefinitely and reach a new state of enlightenment in a few very easy steps.
                    
                </description>
                <pubDate>Fri, 17 Feb 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Design Authentication Handlers in CAS 5.1.x</title>
                <link>https://apereo.github.io/2017/02/02/cas51-authn-handlers/</link>
                <content:encoded>
                    <![CDATA[
                    <p>While <a href="https://apereo.github.io/cas/development/installation/Configuring-Authentication-Components.html">authentication support</a>
in CAS for a variety of systems is somewhat comprehensive and complex, a common deployment use case 
is the task of designing custom authentication schemes. This post describes the necessary steps needed to design
and register a custom authentication strategy (i.e. <code class="highlighter-rouge">AuthenticationHandler</code>) in CAS <code class="highlighter-rouge">5.1.x</code>.</p>

<h2 id="audience">Audience</h2>

<p>This post is intended for java developers with a basic-to-medium familiarity with Spring, Spring Boot and Spring Webflow. This is <strong>NOT</strong> a tutorial to be used verbatim via copy/paste. It is instead a recipe for developers to extend CAS based on specialized requirements.</p>

<h2 id="steps">Steps</h2>

<p>The overall tasks may be categorized as such:</p>

<ol>
  <li>Design the authentication handler</li>
  <li>Register the authentication handler with the CAS authentication engine.</li>
  <li>Tell CAS to recognize the registration record and authentication configuration.</li>
</ol>

<h2 id="step-1-design-authentication-handlers">Step 1: Design Authentication Handlers</h2>

<p>First step is to define the skeleton for the authentication handler itself. This is the core principal component whose job is to declare support for a given type of credential only to then attempt validate it and produce a successful result. The core parent component from which all handlers extend is the <code class="highlighter-rouge">AuthenticationHandler</code> interface.</p>

<p>With the assumption that the type of credentials used here deal with the traditional username and password, noted by the infamous <code class="highlighter-rouge">UsernamePasswordCredential</code> below, a more appropriate skeleton to define for a custom authentication handler may seem like the following:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAuthenticationHandler</span> <span class="kd">extends</span> <span class="n">AbstractUsernamePasswordAuthenticationHandler</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="kd">protected</span> <span class="n">HandlerResult</span> <span class="nf">authenticateUsernamePasswordInternal</span><span class="o">(</span><span class="kd">final</span> <span class="n">UsernamePasswordCredential</span> <span class="n">credential</span><span class="o">,</span>
                                                                 <span class="kd">final</span> <span class="n">String</span> <span class="n">originalPassword</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">everythingLooksGood</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">createHandlerResult</span><span class="o">(</span><span class="n">credential</span><span class="o">,</span> 
                    <span class="k">this</span><span class="o">.</span><span class="na">principalFactory</span><span class="o">.</span><span class="na">createPrincipal</span><span class="o">(</span><span class="n">username</span><span class="o">),</span> <span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">FailedLoginException</span><span class="o">(</span><span class="s">"Sorry, you are simply a big huge failure!"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="review">Review</h3>

<ul>
  <li>
    <p>Authentication handlers have the ability to produce a fully resolved principal along with attributes. If you have the ability to retrieve attributes
from the same place as the original user/principal account store, the final <code class="highlighter-rouge">Principal</code> object that is resolved here must then be able to carry all 
those attributes and claims inside it at construction time.</p>
  </li>
  <li>
    <p>The last parameter, <code class="highlighter-rouge">null</code>, is effectively a collection of warnings that is eventually worked into the authentication chain and conditionally
shown to the user. Examples of such warnings include password status nearing an expiration date, etc.</p>
  </li>
  <li>
    <p>Authentication handlers also have the ability to block authentication by throwing a number of specific exceptions. A more common exception to throw 
back is <code class="highlighter-rouge">FailedLoginException</code> to note authentication failure. Other specific exceptions may be thrown to indicate abnormalities with the account status
itself, such as <code class="highlighter-rouge">AccountDisabledException</code>.</p>
  </li>
  <li>
    <p>Various other components such as <code class="highlighter-rouge">PrincipalNameTransformer</code>s, <code class="highlighter-rouge">PasswordEncoder</code>s and such may also be injected into our handler if need be, though these are skipped for now in this post for simplicity.</p>
  </li>
</ul>

<h2 id="step-2-register-authentication-handlers">Step 2: Register Authentication Handlers</h2>

<p>Once the handler is designed, it needs to be registered with CAS and put into the authentication engine.
This is done via the magic of <code class="highlighter-rouge">@Configuration</code> classes that are picked up automatically at runtime, per your approval,
whose job is to understand how to dynamically modify the application context.</p>

<p>So let’s design our own <code class="highlighter-rouge">@Configuration</code> class:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">cas</span><span class="o">;</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="s">"MyAuthenticationEventExecutionPlanConfiguration"</span><span class="o">)</span>
<span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="n">CasConfigurationProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAuthenticationEventExecutionPlanConfiguration</span> 
                    <span class="kd">implements</span> <span class="n">AuthenticationEventExecutionPlanConfigurer</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CasConfigurationProperties</span> <span class="n">casProperties</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">AuthenticationHandler</span> <span class="nf">myAuthenticationHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">MyAuthenticationHandler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyAuthenticationHandler</span><span class="o">();</span>
        <span class="cm">/*
            Configure the handler by invoking various setter methods.
            Note that you also have full access to the collection of resolved CAS settings.
            Note that each authentication handler may optionally qualify for an 'order` 
            as well as a unique name.
        */</span>
        <span class="k">return</span> <span class="n">h</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureAuthenticationExecutionPlan</span><span class="o">(</span><span class="kd">final</span> <span class="n">AuthenticationEventExecutionPlan</span> <span class="n">plan</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">feelingGoodOnASundayMorning</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">plan</span><span class="o">.</span><span class="na">registerAuthenticationHandler</span><span class="o">(</span><span class="n">myAuthenticationHandler</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="step-3-register-configuration">Step 3: Register Configuration</h2>

<p>Now that we have properly created and registered our handler with the CAS authentication machinery, we just need to ensure that CAS is able to pick up our special configuration. To do so, create a <code class="highlighter-rouge">src/main/resources/META-INF/spring.factories</code> file and reference the configuration class in it as such:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span><span class="p">=</span><span class="s">com.example.cas.MyAuthenticationEventExecutionPlanConfiguration</span>
</code></pre></div></div>

<p>Note that the configuration registration is not of CAS doing. It’s a mechanism provided to CAS via <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html">Spring Boot</a>
and it’s an efficient way to pick up and register components into the runtime application context without the additional overhead of component-scanning and such.</p>

<h3 id="review-1">Review</h3>

<p>At runtime, CAS will try to automatically detect all components and beans that advertise themselves as <code class="highlighter-rouge">AuthenticationEventExecutionPlanConfigurer</code>s. Each detected <code class="highlighter-rouge">AuthenticationEventExecutionPlanConfigurer</code> is then invoked to register its own authentication execution plan. The result of this operation at the end will produce
a ready-made collection of authentication handlers that are ready to be invoked by CAS in the given order defined, if any.</p>

<h2 id="whats-next">What’s Next?</h2>

<p>CAS <code class="highlighter-rouge">5.1.0</code> is not released today in GA form. The development team is working to make sure the CAS <code class="highlighter-rouge">5.1.0</code> release is 
on <a href="https://github.com/apereo/cas/milestones">schedule</a>. Additional release candidates
and more updates will likely be released prior to the official GA release.</p>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Review and suggest documentation improvements.</li>
  <li>Review the release schedule and make sure you report your desired feature requests on the project’s issue tracker.</li>
</ul>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/02/02/cas51-authn-handlers/</guid>
                <description>
                    
                    Learn and master writing custom authentication handlers/schemes in CAS 5.1.x
                    
                </description>
                <pubDate>Thu, 02 Feb 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Guy walks into an Auto Shop</title>
                <link>https://apereo.github.io/2017/01/20/theart-of-mechanics/</link>
                <content:encoded>
                    <![CDATA[
                    <blockquote>
  <p><em>A true story inspired by real events. Seriously. Bryan Cranston has been approached for the role of the “Guy”.</em></p>
</blockquote>

<p>A guy walks into an auto shop, calls over a mechanic and says:</p>

<ul>
  <li>Hey there! I have been trying to use my car for the past 3 days. It doesn’t work. Drives very badly. I remember taking it to a car wash and then a friend drove it around for a while. After that, it stopped working. Can you help?</li>
  <li>Sure. Do you have your car with you?</li>
  <li>I am afraid I don’t.</li>
  <li>No problem. Do you know the model and the year of the car?</li>
  <li>I am not sure I do. My attorney handles all of that.</li>
  <li>OK. What symptoms does it show?</li>
  <li>I guess it just makes this weird noise when I honk the horn.</li>
  <li>When was the last time you took it to the shop? Any previous diagnostics, issues, history of failures?</li>
  <li>It was a while ago. My son asked me to get it checked out years ago. I suppose he worries too much. Do you think his worrying might have anything to do with the car sluggish performance?</li>
  <li>No.</li>
  <li>OK. Well, I really appreciate any suggestions you might have. What are your thoughts?</li>
  <li>My thoughts?</li>
  <li>Yes.</li>
  <li>Well, I think <a href="https://thepianoguys.com/">The Piano Guys</a> are terrific. You should check them out.</li>
  <li>Pardon me?</li>
</ul>

<p>Mechanic walks away. Camera slowly fades away into the horizon with smooth piano music playing in the background.</p>

<p><img src="https://cloud.githubusercontent.com/assets/1205228/22529773/00372422-e8d9-11e6-868f-5a70e27f5074.jpg" alt="c54650b7278f88a3eeaa7aa7d5fce4f7" /></p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/01/20/theart-of-mechanics/</guid>
                <description>
                    
                    A true story inspired by real events. Seriously. Bryan Cranston has been approached for the role of the &quot;Guy&quot;.
                    
                </description>
                <pubDate>Fri, 20 Jan 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>MyUW in 2016</title>
                <link>https://apereo.github.io/2017/01/19/myuw-2016/</link>
                <content:encoded>
                    <![CDATA[
                    <p>MyUW had a great 2016. This post summarizes some highlights.</p>

<p>Edits:</p>
<ul>
  <li>adjusted to reflect the new name <code class="highlighter-rouge">uPortal app framework</code> and new repository location for what was previously known as <code class="highlighter-rouge">uw-frame</code></li>
  <li>adjusted to reflect the new name <code class="highlighter-rouge">uPortal home</code> and new repository location for what was previously known as <code class="highlighter-rouge">AngularJS-portal</code></li>
</ul>

<h2 id="open-source-software-products">Open source software products</h2>

<p>MyUW develops several free and open source products in the course of delivering MyUW.</p>

<h3 id="uportal-home"><a href="https://github.com/uPortal-project/uportal-home">uPortal home</a></h3>

<p><a href="https://it.wisc.edu/services/myuw/">MyUW</a> shipped 20 <a href="https://github.com/uPortal-project/uportal-home/releases">releases of uPortal home</a> in 2016. <a href="https://github.com/uPortal-project/uportal-home">uPortal home</a> is an alternative front end for uPortal.</p>

<p>Progress included:</p>

<ul>
  <li>fixed accessibility bugs</li>
  <li>proved out multi-tenant support (as implemented in MyUW, this software serves each of the University of Wisconsin campuses)</li>
  <li>proved out unauthenticated experience support (this software delivers the public.my.wisc.edu experience)</li>
  <li>adopted <a href="https://material.google.com/">Material Design</a></li>
  <li>redesigned search and header</li>
  <li>enhanced notifications and announcements</li>
  <li>detected and proactively handled expired sessions</li>
  <li>added more and better widget templates (search with links, RSS)</li>
  <li>eased adoption via overlay</li>
  <li>documented</li>
</ul>

<h3 id="uportal-app-framework">uPortal app framework</h3>

<p>MyUW shipped 22 <a href="https://github.com/uPortal-project/uportal-app-framework/releases">releases of uPortal app framework</a> in 2016, from version 2.0.1 to 3.0.3. <a href="https://github.com/uPortal-project/uportal-app-framework">uPortal app framework</a> is the framework in which we develop uPortal home. uPortal app framework is also the framework in which we and other groups in the University of Wisconsin develop applications for inclusion in the portal. Writing a frame-based app is conceptually an alternative to writing a Java Portlet.</p>

<ul>
  <li>adopted <a href="https://material.google.com/">Material Design</a></li>
  <li>improved theme support</li>
  <li>handled session timeouts proactively</li>
  <li>cleaned up the way uPortal app framework is adopted in frame-based apps</li>
  <li>sourced dependencies from CDNs</li>
</ul>

<h3 id="microservices">microservices</h3>

<p>The MyUW team shipped eight releases of a growing slate of supporting microservices in 2016.</p>

<ul>
  <li><a href="https://github.com/UW-Madison-DoIT/KeyValueStore">KeyValueStore</a></li>
  <li><a href="https://github.com/UW-Madison-DoIT/lti-proxy">lti-proxy</a></li>
  <li><a href="https://github.com/UW-Madison-DoIT/rest-proxy">rest-proxy</a></li>
  <li><a href="https://github.com/UW-Madison-DoIT/rssToJson">rssToJson</a></li>
  <li><a href="https://github.com/UW-Madison-DoIT/token-crypt">token-crypt</a></li>
</ul>

<p>We also participated directly in the development or release engineering of four <a href="https://github.com/Jasig/WebproxyPortlet">Apereo WebProxy Portlet</a> releases in 2016.</p>

<h2 id="myuw-services">MyUW services</h2>

<p>We develop these and other software products in order to operate them in <a href="https://it.wisc.edu/services/myuw/">the MyUW portal</a>.</p>

<p>MyUW delivered around 10,000,000 user sessions in the course of serving UW-Madison and the entire University of Wisconsin system in 2016.</p>

<p>MyUW eases discovery of and navigation to other systems. In 2016, users followed a link in MyUW out to something outside MyUW more than 8,000,000 times.</p>

<p>Besides helping users navigate to other applications, MyUW helps users understand what they need to do and where they might need to navigate. MyUW presented its full notifications experience (not just the indicator that the user has a notification) around 100,000 times in 2016.</p>

<p>Not all MyUW content relevant to all users can fit on default home pages, so MyUW supports users searching and browsing the available content. MyUW presented the directory of applications around 100,000 times and provided search results in around 100,000 user sessions in 2016.</p>

<p>Once you’ve searched or browsed to something interesting, you can add it to your home page. Users modified their home pages almost one hundred thousand times in 2016, including adding the new Wiscard Balance widget almost 6,000 times.</p>

<h2 id="looking-forward">Looking forward</h2>

<p>Let’s do more to serve the portal needs of higher education and the University of Wisconsin in 2017.</p>

<p><a href="http://apetro.ghost.io/">Andrew Petro</a></p>

<p>PS: Other ways to consume this content:</p>

<ul>
  <li><a href="https://www.apereo.org/content/case-study-myuw-university-wisconsin-2016-review">on Apereo website</a> (Alas, no hyperlinks).</li>
  <li><a href="https://groups.google.com/a/apereo.org/d/msg/announcements/gEubp0iejn4/IMyt-AfjBQAJ">in January 2017 newsletter as posted to announcements email list</a> (Alas, no hyperlinks).</li>
  <li><a href="https://www.apereo.org/sites/default/files/Newsletters/Images%20for%20Newsletter%20Articles/January2017Apereo%20NL.pdf">in January 2017 newsletter as posted in a Word doc</a> (Alas, no hyperlinks).</li>
</ul>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2017/01/19/myuw-2016/</guid>
                <description>
                    
                    Looking back on MyUW progress in 2016.
                    
                </description>
                <pubDate>Thu, 19 Jan 2017 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.1.0 RC1 Feature Release</title>
                <link>https://apereo.github.io/2016/12/23/51rc1/</link>
                <content:encoded>
                    <![CDATA[
                    <!--
<div class="alert alert-danger">
  <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
  <strong>WATCH OUT!</strong><br/>This post is not official yet and may be heavily edited as CAS development makes progress. <a href="https://apereo.github.io/feed.xml">Watch</a> for further updates.
</div>
-->

<p>The official CAS <code class="highlighter-rouge">5.0.0</code> GA <a href="https://github.com/apereo/cas/releases/tag/v5.0.0">was released about 6 weeks ago</a>. Since then,
the project has been moving forward with development of the next feature release
that is tagged as <code class="highlighter-rouge">5.1.0</code>. This post intends to highlight some of the improvements
and enhancements packed into the first release candidate in the <code class="highlighter-rouge">5.1.0</code> series.</p>

<p>The in-development documentation of CAS <code class="highlighter-rouge">5.1.0</code> is <a href="https://apereo.github.io/cas/development/">available here</a>.
The release schedule is also <a href="https://github.com/apereo/cas/milestones">available here</a>. The release policy 
is <a href="https://apereo.github.io/cas/developer/Release-Policy.html">available here</a>.</p>

<!-- TOC -->

<ul>
  <li><a href="#log-levels-via-cas-properties">Log Levels via CAS Properties</a></li>
  <li><a href="#name-authentication-handlers">Name Authentication Handlers</a></li>
  <li><a href="#jwsjwe-compression">JWS/JWE Compression</a></li>
  <li><a href="#security-filters-enabled-by-default">Security Filters Enabled by Default</a></li>
  <li><a href="#cors-security-filter">CORS Security Filter</a></li>
  <li><a href="#database-authn-bcrypt-encoder">Database AuthN BCrypt Encoder</a></li>
  <li><a href="#duration-as-unit-of-measure">Duration as Unit of Measure</a></li>
  <li><a href="#risk-based-authentication">Risk-Based Authentication</a></li>
  <li><a href="#authn-events-in-audit-log">AuthN Events in Audit Log</a></li>
  <li><a href="#duo-security-account-checking">Duo Security Account Checking</a></li>
  <li><a href="#duo-security-multiple-configurations-sup1sup">Duo Security Multiple Configurations <em><sup>[1]</sup></em></a></li>
  <li><a href="#embedded-container-version">Embedded Container Version</a></li>
  <li><a href="#redis-ticket-registry">Redis Ticket Registry</a></li>
  <li><a href="#code-cleanup-and-optimization">Code Cleanup and Optimization</a></li>
  <li><a href="#registered-service-legacy-definitions">Registered Service Legacy Definitions</a></li>
  <li><a href="#ldap-search-filter-parametrization">LDAP Search Filter Parametrization</a></li>
  <li><a href="#ldap-connection-strategies">LDAP Connection Strategies</a></li>
  <li><a href="#mongodb-authentication-password-encoding">MongoDb Authentication: Password Encoding</a></li>
  <li><a href="#service-registry-performance">Service Registry Performance</a></li>
  <li><a href="#ldap-principal-attributes-merged-with-attribute-repositories">LDAP Principal Attributes Merged with Attribute Repositories</a></li>
  <li><a href="#internal-auto-configuration-sup1sup">Internal Auto Configuration <em><sup>[1]</sup></em></a></li>
  <li><a href="#multiple-attribute-repositories-sup1sup">Multiple Attribute Repositories <em><sup>[1]</sup></em></a></li>
  <li><a href="#attribute-repositories-order">Attribute Repositories Order</a></li>
  <li><a href="#service-ui-info-on-login-screen">Service UI Info on Login Screen</a></li>
  <li><a href="#saml2-ecp">SAML2 ECP</a></li>
  <li><a href="#saml2-incommon-metadata">SAML2 InCommon Metadata</a></li>
  <li><a href="#saml2oauthoidc-multifactor-authentication">SAML2/OAuth/OIDC Multifactor Authentication</a></li>
  <li><a href="#saml2-idp-metadata-signature-validation">SAML2 IdP Metadata Signature Validation</a></li>
  <li><a href="#saml2-idp-metadata-location-uri">SAML2 IdP Metadata Location URI</a></li>
  <li><a href="#service-registry-json-auto-init">Service Registry JSON Auto-Init</a></li>
  <li><a href="#embedded-container-http2-support">Embedded Container HTTP2 Support</a></li>
  <li><a href="#internet2-grouper-mfa-trigger">Internet2 Grouper MFA Trigger</a></li>
  <li><a href="#rest-api-performance">REST API Performance</a></li>
  <li><a href="#ldap-validator-configuration">LDAP Validator Configuration</a></li>
  <li><a href="#logging-panel">Logging Panel</a></li>
  <li><a href="#improved-hazelcast-configuration">Improved Hazelcast Configuration</a></li>
  <li><a href="#saml2-idp-handling-of-relaystate">SAML2 IdP Handling of RelayState</a></li>
  <li><a href="#json-enhancements-to-cas-apis">JSON Enhancements to CAS APIs</a></li>
  <li><a href="#multifactor-authentication-bypass-per-service">Multifactor Authentication Bypass Per Service</a></li>
  <li><a href="#oidc-delegated-authn-scope">OIDC Delegated AuthN Scope</a></li>
  <li><a href="#linkedin-delegated-authn">LinkedIn Delegated AuthN</a></li>
  <li><a href="#management-webapp-authorization-roles-sup1sup">Management Webapp Authorization Roles <em><sup>[1]</sup></em></a></li>
  <li><a href="#oidc-dynamic-client-registration">OIDC Dynamic Client Registration</a></li>
  <li><a href="#jwts-as-service-tickets">JWTs as Service Tickets</a></li>
  <li><a href="#delegated-authn-auto-redirect">Delegated AuthN Auto Redirect</a></li>
  <li><a href="#library-upgrades">Library Upgrades</a></li>
  <li><a href="#whats-next">What’s Next?</a></li>
  <li><a href="#get-involved">Get Involved</a></li>
  <li><a href="#das-ende">Das Ende</a></li>
</ul>

<!-- /TOC -->

<h2 id="log-levels-via-cas-properties">Log Levels via CAS Properties</h2>

<p>The configuration of CAS logging levels is traditionally done directly inside the <code class="highlighter-rouge">log4j2.xml</code> file.
As an easier option and thanks to Spring Boot, log levels may also be specified via the normal
CAS properties:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">logging.level.org.springframework.web</span><span class="p">=</span><span class="s">DEBUG</span>
<span class="py">logging.level.org.apereo.cas</span><span class="p">=</span><span class="s">DEBUG</span>
</code></pre></div></div>

<h2 id="name-authentication-handlers">Name Authentication Handlers</h2>

<p>Additional CAS properties are exposed for all authentication handlers so
they can individually be named. By default, handler names are set to the name
of the defining Java class. Given the class name might change, it’s preferred if each adopter
defines unique/custom names for each scheme.</p>

<p>You generally do NOT have to worry about this behavior at all; It’s only relevant if you, for instance,
have defined multifactor authentication bypass rules based on authentication handler names.</p>

<h2 id="jwsjwe-compression">JWS/JWE Compression</h2>

<p>CAS ciphers that deal with signing/encryption based on JWEs are now by default configured
to force compression via the <code class="highlighter-rouge">zip</code> claim.</p>

<h2 id="security-filters-enabled-by-default">Security Filters Enabled by Default</h2>

<p>CAS has long had options to enforce a number of request headers to enable XSS/HSTS/etc protection.
These filters are turned on by default, starting from this release candidate.</p>

<h2 id="cors-security-filter">CORS Security Filter</h2>

<p>Much like the above option, CAS adds support for enabling a CORS filter
that should help more with CAS enabled applications which are accessed via XHR/Ajax requests.
This filter is off by default and needs to be explicitly configured by the adopter.</p>

<h2 id="database-authn-bcrypt-encoder">Database AuthN BCrypt Encoder</h2>

<p>Thanks to community contributions, minor changes are made to the internal CAS authentication API to ensure
password encoding can execute correctly specially when the <code class="highlighter-rouge">BCrypt</code> encoder is defined.</p>

<h2 id="duration-as-unit-of-measure">Duration as Unit of Measure</h2>

<p>Thanks to community contributions, all CAS settings that deal with time units
should start to support the duration syntax for full clarity on unit of measure:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"PT20S"</span>     <span class="nt">--</span> parses as <span class="s2">"20 seconds"</span>
<span class="s2">"PT15M"</span>     <span class="nt">--</span> parses as <span class="s2">"15 minutes"</span>
<span class="s2">"PT10H"</span>     <span class="nt">--</span> parses as <span class="s2">"10 hours"</span>
<span class="s2">"P2D"</span>       <span class="nt">--</span> parses as <span class="s2">"2 days"</span>
<span class="s2">"P2DT3H4M"</span>  <span class="nt">--</span> parses as <span class="s2">"2 days, 3 hours and 4 minutes"</span>
</code></pre></div></div>

<h2 id="risk-based-authentication">Risk-Based Authentication</h2>

<p>CAS is able to track and examine authentication requests for suspicious behavior.
Risk-based authentication allows CAS to detect suspicious and seemingly-fraudulent authentication requests 
based on past user behavior and collected authentication events, statistics, etc. 
Once and after primary authentication where the principal is identified, 
the authentication transaction is analyzed via a number of configurable criteria and 
fences to determine how risky the attempt may be. The result of the evaluation step is a 
cumulative risk score that is then weighed against a risk threshold set by the CAS operator. 
In the event that the authentication attempt is considered risky well beyond the risk threshold, 
CAS may be allowed to take action and mitigate that risk.</p>

<p>You can learn more about this feature <a href="https://apereo.github.io/cas/development/installation/Configuring-RiskBased-Authentication.html">here</a>.
At this point, the changeset and accompanying modules are fairly experimental and are going through rounds of testing
and patching. If this functionality interests you, by all means give it a trial run and share feedback as much as possible.</p>

<h2 id="authn-events-in-audit-log">AuthN Events in Audit Log</h2>

<p>CAS events are now routed to the CAS audit logs. This allows one,
for instance, to learn when an MFA event is triggered and to note
if MFA was successfully honored and executed:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">=============================================================</span>
WHO: audit:unknown
WHAT: <span class="o">[</span><span class="nv">event</span><span class="o">=</span>mfa-duo,timestamp<span class="o">=</span>Mon Nov 14 12:01:17 MST 2016,source<span class="o">=</span>RankedAuthenticationProviderWebflowEventResolver]
ACTION: AUTHENTICATION_EVENT_TRIGGERED
APPLICATION: CAS
WHEN: Mon Nov 14 12:01:17 MST 2016
CLIENT IP ADDRESS: 110.5.75.1
SERVER IP ADDRESS: 110.2.75.1
<span class="o">=============================================================</span>
</code></pre></div></div>

<h2 id="duo-security-account-checking">Duo Security Account Checking</h2>

<p>Presently, if users are unregistered with Duo Security or allowed through via a direct bypass,
CAS puts the user through multifactor authentication and simply validates the response internally
and somewhat invisibly, allowing the application to receive an authentication context that indicates 
multifactor authentication did actually commence.</p>

<p>In this release, CAS starts to <a href="https://apereo.github.io/cas/development/installation/DuoSecurity-Authentication.html">query the user account</a>
apriori to learn
whether user is registered or configured for direct bypass. If the account status matches either of those conditions or the
user account is not registered yet the new-user enrollment policy allows folks to skip registration, CAS will bypass
Duo Security altogether and will <strong>NOT</strong> report back a multifactor-enabled authentication context back to the application.</p>

<h2 id="duo-security-multiple-configurations-1">Duo Security Multiple Configurations <em><sup>[1]</sup></em></h2>

<p>CAS is now able to support <a href="https://apereo.github.io/cas/development/installation/DuoSecurity-Authentication.html">different configuration blocks</a>
for multiple Duo Security instances:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.authn.mfa.duo[0].duoSecretKey=
# cas.authn.mfa.duo[0].duoApplicationKey=
# cas.authn.mfa.duo[0].duoIntegrationKey=
# cas.authn.mfa.duo[0].duoApiHost=
# cas.authn.mfa.duo[0].id=mfa-duo
</span><span class="err">...</span>
<span class="c"># cas.authn.mfa.duo[1].duoSecretKey=
# cas.authn.mfa.duo[1].duoApplicationKey=
# cas.authn.mfa.duo[1].duoIntegrationKey=
# cas.authn.mfa.duo[1].duoApiHost=
# cas.authn.mfa.duo[1].id=mfa-second-duo
</span><span class="err">...</span>
</code></pre></div></div>

<p>By default, a Duo Security provider in CAS is registered under <code class="highlighter-rouge">mfa-duo</code>
noted by the above id. However, additional providers can now be registered
with arbitrary identifiers. All MFA triggers shall function exactly as before
and as long as they are configured to produce the right match for the right
provider id, CAS will activate MFA for the Duo Security configuration
that is linked to the selected identifier.</p>

<p>At this point in time, Duo Security is the only provider in CAS
whose configuration can be specified in blocks. However,
[and this turned out to be a VERY non-trivial task], adjustments are made
internally to ensure other providers can be configured in much the same way
should there be demands.</p>

<h2 id="embedded-container-version">Embedded Container Version</h2>

<p>The embedded container version now shows up in the CAS banner on startup:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CAS Version: 5.1.0-SNAPSHOT
...
Container Version: Apache Tomcat/8.5.x
</code></pre></div></div>

<h2 id="redis-ticket-registry">Redis Ticket Registry</h2>

<p>Thanks to community contributions, CAS gains support for Redis as a storage machenism for its ticket registry backend.
Redis is an open source in-memory data structure store, used as a database, cache and message broker.
You can learn more about the registry behavior via <a href="https://apereo.github.io/cas/development/installation/Redis-Ticket-Registry.html">this guide</a>.</p>

<h2 id="code-cleanup-and-optimization">Code Cleanup and Optimization</h2>

<p>Thanks to community contributions, the CAS codebase is revitalized ever more to make sure
most if not all underlying components adhere to proper coding standards and design practices.
Changes in this area include adjustments to style guidelines, constructor-based dependency injections
and navigating from Guava Collections to the native Java 8 Collections/Lambda APIs.</p>

<h2 id="registered-service-legacy-definitions">Registered Service Legacy Definitions</h2>

<p>Thanks to community contributions, CAS’ handling of 
<a href="https://apereo.github.io/cas/development/installation/JSON-Service-Management.html">legacy service registry definitions</a>
that are backed by JSON are now slightly improved to preserve backwards compatibility
with prior CAS versions whose service definition was based on the old <code class="highlighter-rouge">org.jasig</code> namespace.</p>

<h2 id="ldap-search-filter-parametrization">LDAP Search Filter Parametrization</h2>

<p>A number of LDAP search filters for SPNEGO and attribute repository configurations
are relaxed to be more consistent with other parameter names via supporting both <code class="highlighter-rouge">{user}</code>
and <code class="highlighter-rouge">{0}</code> for both named and index parameter values.</p>

<h2 id="ldap-connection-strategies">LDAP Connection Strategies</h2>

<p>Additional configuration options are now made available to allow users to define
a connection strategy of their own choosing, should multiple LDAP urls be specified in the configuration.</p>

<h2 id="mongodb-authentication-password-encoding">MongoDb Authentication: Password Encoding</h2>

<p>Minor bug fix; Improper construction of password encoders caused MongoDb authentication attempts
to reject all user credentials, failing to apply proper hashing/encoding on the password for validation.
This should now be fixed.</p>

<h2 id="service-registry-performance">Service Registry Performance</h2>

<p>Thanks to community contributions, there have been a number of performance improvement applied
to the way CAS saves, updates and locates services internally. Likewise, improvements are applied
to the way CAS services handle regex pattern matching when responding to requests.</p>

<h2 id="ldap-principal-attributes-merged-with-attribute-repositories">LDAP Principal Attributes Merged with Attribute Repositories</h2>

<p>LDAP authentication in CAS can be made to directly resolve attributes without involving
external attribute repositories via Person Directory. While simple, this isn’t always the use case.
For instance, if there is ever a requirement to additionally resolve attributes from a JDBC source,
the adopter is to abandon attribute resolution directly as part of LDAP authentication and is then
forced to define a separate LDAP attribute repository source alongside a JDBC source
so the final result from both can be merged.</p>

<p>This is now improved such that attributes retrieved as part of LDAP authentication are now
merged with all other attributes retrieved from attribute repository sources, if any.</p>

<h2 id="internal-auto-configuration-1">Internal Auto Configuration <em><sup>[1]</sup></em></h2>

<p>CAS 5 took the auto-configuration strategy to the next level, thanks to Spring Boot and Spring Cloud.
The approach was to component-scan the application context under <code class="highlighter-rouge">org.apereo.cas</code>
and load components and beans that were declared via the housing <code class="highlighter-rouge">@Configuration</code>s.</p>

<p>In this release, CAS entirely turns off component scanning and switches to Spring Boot’s auto-configure style.
The strategy is more or less the same where <code class="highlighter-rouge">@Configuration</code> classes still register CAS components as <code class="highlighter-rouge">@Bean</code>s.
The difference is that each CAS module provides a <code class="highlighter-rouge">spring.factories</code> file in which configuration
classes and application context initializers are placed. This strategy allows CAS to exactly control
the set of configurations that are loaded very explicitly for each mdule and also helps with deterministic load behavior
where configurations for instance can register themselves to be loaded before or after a particular component
to accommodate runtime behavioral dependencies.</p>

<p>This may partially help with start-up times as well when CAS is run via the embedded container, but so far
tests show that performance more or less remains the same.</p>

<p>Note that while this isn’t generally something that the average adopter needs to worry about,
this is nonetheless a breaking change <strong>IIF</strong> you have designed Java components/classes that are 
auto-scanned under <code class="highlighter-rouge">org.apereo.cas</code>.
Those will NO LONGER be picked up by CAS automatically and you will need to either manually register them
as CAS does via your own <code class="highlighter-rouge">spring.factories</code> or set up a auto-scanning configuration
under your own package names via <code class="highlighter-rouge">@ComponentScan</code>, etc.</p>

<h2 id="multiple-attribute-repositories-1">Multiple Attribute Repositories <em><sup>[1]</sup></em></h2>

<p>Attribute repository sources that are controlled and managed via Person Directory
have now turned into lists. This allows you to create more than one source
if necessary and then have all sources be merged into a single repository
automatically to resolve CAS principals and attributes.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.authn.attributeRepository.ldap[0].ldapUrl=ldaps://ldap1.example.edu,...
</span><span class="err">...</span>
<span class="c"># cas.authn.attributeRepository.ldap[1].ldapUrl=ldaps://ldap2.example.edu,...
</span><span class="err">...</span>
</code></pre></div></div>

<h2 id="attribute-repositories-order">Attribute Repositories Order</h2>

<p>You have to consider that when you have more than one attribute repository source
defined, there may be cases where two sources end up colliding as they both may produce
the same attribute. In such cases, CAS already provides capabilities to merge the final
result and take action to either add, replace or ignore subsequent attempts at producing
an attribute, if one already is found and fixed. This becomes important as it directly impacts
the execution order of sources.</p>

<p>For instance, consider that you have sources <code class="highlighter-rouge">S1</code> and <code class="highlighter-rouge">S2</code> defined both of which
are configured to produce an attribute <code class="highlighter-rouge">A1</code>. Policies are configured to note that if <code class="highlighter-rouge">A1</code>
is already found via one source, no other source should attempt to overwrite it.
The question then really becomes: which source should execute and query for data first?</p>

<p>To handle this, CAS allows you to order attribute repositories.
Those with a lower order execute first and take priority in querying
for attributes:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.authn.attributeRepository.ldap[0].ldapUrl=ldaps://ldap1.example.edu,...
# cas.authn.attributeRepository.ldap[0].order=1
</span><span class="err">...</span>
<span class="c"># cas.authn.attributeRepository.ldap[1].ldapUrl=ldaps://ldap2.example.edu,...
# cas.authn.attributeRepository.ldap[1].order=10
</span><span class="err">...</span>
</code></pre></div></div>

<h2 id="service-ui-info-on-login-screen">Service UI Info on Login Screen</h2>

<p>In situations where CAS ends up playing proxy behind a protocol
such as SAML2, OAuth or OIDC, the login screen wrongly displayed the
UI metadata (i.e. logo, description, etc) about the proxying (callback) service.
This is now corrected so relevant UI information about the real service/destination
is displayed on the screen per the SAML metadata or the CAS service registry.</p>

<h2 id="saml2-ecp">SAML2 ECP</h2>

<p>CAS starts to support a rather modest implementation of the SAML2 ECP profile.
At this point, the changeset and accompanying modules are fairly experimental 
and are going through rounds of testing
and patching. If this functionality interests you, by all means give
it a trial run and share feedback as much as possible.</p>

<h2 id="saml2-incommon-metadata">SAML2 InCommon Metadata</h2>

<p>A number of improvements are applied to the way CAS handles the retrieval
and resolution of large SAML metadata files that are downloaded over the web.
The download strategy is now handled over a multi-part multi-threaded connection
which should boost performance and startup times quite a bit.</p>

<p>InCommon SPs are now supported directly via the usual CAS configuration settings, while in the past
adopters expicitly had to register InCommon in the CAS service registry.</p>

<h2 id="saml2oauthoidc-multifactor-authentication">SAML2/OAuth/OIDC Multifactor Authentication</h2>

<p>CAS triggers for multifactor authentication have all been reorganized
in much the same way as the above item to ensure that authentication
requests via SAML2, OAuth or OpenID Connect may all go through
multifactor authentication based on the real service and not the proxying (callback) url.</p>

<h2 id="saml2-idp-metadata-signature-validation">SAML2 IdP Metadata Signature Validation</h2>

<p>Metadata signature validation can now be done both via public keys and certificate files.</p>

<h2 id="saml2-idp-metadata-location-uri">SAML2 IdP Metadata Location URI</h2>

<p>A trivial bug fix; the location of the metadata for CAS’ SAML2 IdP functionality
can now be specified in URI format as well. (i.e. <code class="highlighter-rouge">file://etc/cas/somewhere</code>)</p>

<h2 id="service-registry-json-auto-init">Service Registry JSON Auto-Init</h2>

<p>Service registries can now take advantage of the auto-initialization feature
in a more direct manner. The previous behavior only populated a given registry
if it was left empty by the adopter. However, in certain cases CAS modules auto-insert
service definitions into the registry and interfere with this auto-initialization
behavior. This is now corrected to ensure the service registry, if permitted,
can forcefully be populated regardless of size while gracefully ignoring
duplicate entries that may already be present.</p>

<h2 id="embedded-container-http2-support">Embedded Container HTTP2 Support</h2>

<p>The <a href="https://apereo.github.io/cas/development/installation/Configuring-Servlet-Container.html">embedded container</a>
is now configured to automatically upgrade the protocol
and support HTTP2. Note that activation of this feature for an external Apache Tomcat
instance requires Apache Tomcat <code class="highlighter-rouge">8.5.6</code> or above.</p>

<h2 id="internet2-grouper-mfa-trigger">Internet2 Grouper MFA Trigger</h2>

<p>As an extra option, CAS can now integrate with <a href="http://www.internet2.edu/grouper/software.html">Grouper</a> 
and use a subject [CAS principal] groups’ 
to <a href="https://apereo.github.io/cas/development/installation/Configuring-Multifactor-Authentication.html#triggers">learn whether MFA should be triggered</a>.
As an example, you could devise a use case
where all subjects who are assigned to an <code class="highlighter-rouge">mfa-duo</code> groups may be asked to execute MFA
via Duo Security. If you have deployed Grouper, this may be a much more immediate option
than to pick up changes based on a given principal attribute once after provisioning
has had a chance to process.</p>

<h2 id="rest-api-performance">REST API Performance</h2>

<p>Thanks to community contributions, improvements have gone into the implementation of
CAS REST APIs to ensure best coding practices are in-place, performance-wise.</p>

<h2 id="ldap-validator-configuration">LDAP Validator Configuration</h2>

<p>Additional properties are now exposed to allow configuration of LDAP validators
for ALL operations that deal with LDAP functionality. CAS supports
both <code class="highlighter-rouge">SEARCH</code> and <code class="highlighter-rouge">COMPARE</code> modes.</p>

<h2 id="logging-panel">Logging Panel</h2>

<p>CAS provides an administrative screen to manage and review logs.
This screen is now improved to allow one to update logger levels immediately
from the UI and observe better CAS diagnostics data.</p>

<p><img src="https://cloud.githubusercontent.com/assets/1205228/20279208/d9e43d12-aa64-11e6-903e-acb559d4882b.png" alt="image" /></p>

<p>Note that at present, changes applied to the configuration UI are only
persisted in memory since the underlying framework does not yet provide a
way to save changes back out to disk, etc. This means, once you restart the
CAS server node all changes applied to logs via the configuration panel are lost.</p>

<h2 id="improved-hazelcast-configuration">Improved Hazelcast Configuration</h2>

<p>Minor adjustments are made to the Hazelcast configuration
to stop using deprecated settings for internal eviction policies.</p>

<h2 id="saml2-idp-handling-of-relaystate">SAML2 IdP Handling of RelayState</h2>

<p>Thanks to community contributions, the SAML2 functionality of CAS
is now able to properly retain the <code class="highlighter-rouge">RelayState</code> parameter.</p>

<h2 id="json-enhancements-to-cas-apis">JSON Enhancements to CAS APIs</h2>

<p>Thanks to community contributions, CAS APIs are now slightly massaged
to handle JSON serialization of core ticketing components. This is useful
for ticket registry implementations that are based on NoSQL databases such as
Apache Cassandra, which as a <a href="https://github.com/apereo/cas/pull/2111">pending pull request</a>
may also soon become a first-class CAS ticket registry feature.</p>

<h2 id="multifactor-authentication-bypass-per-service">Multifactor Authentication Bypass Per Service</h2>

<p>In this release CAS starts to provide options to 
selectively <a href="https://apereo.github.io/cas/development/installation/Configuring-Multifactor-Authentication.html#triggers">exclude a set of applications</a>
from multifactor authentication. This is useful in cases where you have turned on multifactor authentication globally.
A number of other bugs also in this area have been fixed to ensure handler/authentication attribute names
can correctly be defined to bypass multifactor authentication.</p>

<h2 id="oidc-delegated-authn-scope">OIDC Delegated AuthN Scope</h2>

<p>Having upgraded to early snapshots of Pac4J, additional CAS configurtion options
are now made available to allow for providing <code class="highlighter-rouge">scope</code> when delegating authentication
to an external OIDC provider.</p>

<h2 id="linkedin-delegated-authn">LinkedIn Delegated AuthN</h2>

<p>Thanks to the early Pac4J upgrade, CAS now starts to support
delegating authentication to LinkedIn in addition to a variety of other social providers.</p>

<h2 id="management-webapp-authorization-roles-1">Management Webapp Authorization Roles <em><sup>[1]</sup></em></h2>

<p>The authorization roles for the management webapp and the administrative user interfaces
are now modified to allow distinct roles for access without the need for extra data parsing:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.adminPagesSecurity.adminRoles[0]=ROLE_ADMIN
</span><span class="err">...</span>
<span class="c"># cas.mgmt.adminRoles[0]=ROLE_ADMIN
# cas.mgmt.adminRoles[1]=ROLE_SUPER_USER
</span></code></pre></div></div>

<h2 id="oidc-dynamic-client-registration">OIDC Dynamic Client Registration</h2>

<p><a href="https://apereo.github.io/cas/development/installation/OIDC-Authentication.html">OpenId Connect in CAS</a>
is now starting to support modest implementations of
the <a href="https://tools.ietf.org/html/draft-ietf-oauth-dyn-reg-management-01">dynamic client registration</a>
protocol.</p>

<h2 id="jwts-as-service-tickets">JWTs as Service Tickets</h2>

<p>Starting with this release candidate, CAS gains the ability
to issue <a href="https://apereo.github.io/cas/development/installation/JWT-Authentication.html">JWTs as service tickets</a>.
JWTs are entirely self-contained
and include enough information about the authenticated principal
and available claims for given application integration.</p>

<h2 id="delegated-authn-auto-redirect">Delegated AuthN Auto Redirect</h2>

<p>In the event that you have configured CAS to delegate authentication to
an external [social] identity provider, options are now made available to
automatically redirect the authentication flow to the provider bypassing
the CAS login screen. This option today is only relevant and active
if there is a single provider available.</p>

<h2 id="library-upgrades">Library Upgrades</h2>

<ul>
  <li>Spring</li>
  <li>Spring Boot</li>
  <li>Spring Cloud</li>
  <li>Spring Security</li>
  <li>Thymeleaf</li>
  <li>Commons Lang</li>
  <li>Guava</li>
  <li>Pac4J</li>
  <li>Ldaptive</li>
  <li>MongoDb</li>
  <li>OpenSAML</li>
  <li>FindBugs</li>
  <li>Checkstyle</li>
  <li>Joda Time</li>
  <li>Couchbase</li>
  <li>Hibernate</li>
  <li>MySQL, MaridaDb and PostgreSQL Drivers</li>
  <li>Kryo</li>
</ul>

<h2 id="whats-next">What’s Next?</h2>

<p>The development team is working to make sure the CAS <code class="highlighter-rouge">5.1.0</code> release is 
on <a href="https://github.com/apereo/cas/milestones">schedule</a>. Additional release candidates
and more updates will likely be released prior to the official GA release.</p>

<h2 id="get-involved">Get Involved</h2>

<ul>
  <li>Start your CAS deployment today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Review and suggest documentation improvements.</li>
  <li>Review the release schedule and make sure you report your desired feature requests on the project’s issue tracker.</li>
</ul>

<h2 id="das-ende">Das Ende</h2>

<p>A big hearty thanks to all who participated in the development of this release to submit patches, report issues and suggest improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

<ul>
  <li>[1] This is a breaking configuration change. Please consult the <a href="https://apereo.github.io/cas/development/">CAS docs</a> to learn more.</li>
</ul>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/12/23/51rc1/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5.1.0 RC1 release.
                    
                </description>
                <pubDate>Fri, 23 Dec 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>uPortal 2016-11-14 Webproxy Portlet caching vulnerability</title>
                <link>https://apereo.github.io/2016/11/14/web-proxy-overcaching/</link>
                <content:encoded>
                    <![CDATA[
                    <p>This is a <strong>public disclosure of a security vulnerability</strong>, near the tail end of applying <a href="https://docs.google.com/document/d/1s-xvqbeHS_EjU6EKlv8ftXgQ-R56CU0tAjuQE3SSH4s/edit">the uPortal Security Incident Response Plan</a> to <a href="https://issues.jasig.org/browse/WPP-101">this issue</a>.</p>

<p>Affected software products:</p>

<ul>
  <li>Webproxy Portlet , versions <code class="highlighter-rouge">2.0.0</code> through <code class="highlighter-rouge">2.2.1</code> . <a href="https://github.com/Jasig/WebproxyPortlet/releases/tag/WebProxyPortlet-2.2.2"><code class="highlighter-rouge">2.2.2</code></a> includes a fix.</li>
</ul>

<p>Recent uPortal versions ship with bugged Webproxy Portlet versions.</p>

<h1 id="problem">Problem:</h1>

<p>Affected versions</p>

<ul>
  <li>By default, cache proxied content, and</li>
  <li>Require a source code edit to turn off this default behavior, and</li>
  <li>Improperly compute the cache keys such that in some cases too little information is considered in computing cache keys.</li>
</ul>

<h2 id="consequence">Consequence:</h2>

<ul>
  <li>Most adopters will not have locally turned off this caching strategy even if it is inappropriate for local usages, and</li>
  <li>Usages where different users proxy the same backing URL may yield improper cross-user cache hits, with user B seeing content proxied for user A.</li>
</ul>

<h2 id="saving-graces">Saving graces:</h2>

<ul>
  <li>For security purposes, this only matters if the proxies are interesting, providing personalized content.</li>
  <li>Usages with unique URLs, such as where user attributes are conveyed as request parameters in the URL or the initial request in a typical Proxy CAS integration, will not yield improper cache hits.</li>
</ul>

<h1 id="solutions">Solutions:</h1>

<ul>
  <li>Upgrade to Webproxy Portlet version <code class="highlighter-rouge">2.2.2</code> or later.</li>
  <li>Locally modify your Webproxy Portlet 2 implementation to turn off caching, <a href="https://github.com/Jasig/WebproxyPortlet/pull/24">by</a> de-activating or removing <code class="highlighter-rouge">CachingHttpContentServiceImpl</code> and instead activating <code class="highlighter-rouge">HttpContentServiceImpl</code>.</li>
</ul>

<p>-<a href="https://apetro.ghost.io">Andrew</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/11/14/web-proxy-overcaching/</guid>
                <description>
                    
                    Webproxy Portlet v2 is bugged; upgrade.
                    
                </description>
                <pubDate>Mon, 14 Nov 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>MyUW 2016-10-25 release</title>
                <link>https://apereo.github.io/2016/10/25/myuw-release/</link>
                <content:encoded>
                    <![CDATA[
                    <p>Today MyUW promoted a new release to production. This post highlights some aspects of this.</p>

<p>Edits:</p>

<ul>
  <li>Updated to reflect new name <code class="highlighter-rouge">uPortal home</code> and new git repository location for what was once called <code class="highlighter-rouge">AngularJS-portal</code></li>
</ul>

<h2 id="this-release">This release</h2>

<p><a href="https://kb.wisc.edu/myuw/page.php?id=68015">This release</a> upgraded MyUW to <code class="highlighter-rouge">uPortal home</code> <a href="https://github.com/uPortal-project/uportal-home/releases/tag/angularjs-portal-parent-5.4.1">v5.4.1</a> from <a href="https://github.com/uPortal-project/uportal-home/releases/tag/angularjs-portal-parent-5.2.4">v5.2.4</a>.</p>

<h2 id="highlights-for-apereo-community">Highlights for Apereo community</h2>

<ul>
  <li>Continued implementation of <a href="https://material.google.com/">Material Design</a>. Piggybacking on Google’s Material Design in higher education web applications is an opportunity to raise the baseline for design and consistency without having to invent and maintain that design guidance using scarce higher education resources. To the extent feasible, we’re trying to use MyUW design resources on unique-to-MyUW design problems rather than on web-application-general design problems. Also, Material Design theming is rocking the skinning problem, supporting different color treatments across the many Wisconsin system campuses MyUW serves.</li>
  <li>Continued development of lightweight notifications technology. Notifications now have optional associated actions and more options for priority treatment and end-user option to dismiss unneeded notifications.</li>
</ul>

<h3 id="lessons-to-learn">Lessons to learn</h3>

<ul>
  <li>Semantic versioning is important. We had a hiccup in this release because a <code class="highlighter-rouge">rest-proxy</code> change wasn’t backwards-compatible as regards <code class="highlighter-rouge">endpoints.properties</code>. In retrospect, the properties file configuring this product <em>is</em> its API so breaking changes would be better signaled with a <code class="highlighter-rouge">MAJOR</code> version change (and avoided when not strictly necessary).</li>
  <li>Deep linking is important, enabling better communication about and leverage of content in your portal. This release fixed support for deep links into <code class="highlighter-rouge">uPortal home</code> content.</li>
</ul>

<h2 id="calls-to-action">Calls to action</h2>

<h3 id="talk-about-what-you-are-doing">Talk about what you are doing.</h3>

<p>It is only possible to discover opportunities to collaborate, to share code, to compare notes on the practices of portals in higher education if we talk about what we are doing.</p>

<h3 id="adopt-and-collaborate-on-microservices">Adopt and collaborate on microservices.</h3>

<p>You don’t have to adopt everything MyUW has adopted to find something that would add value to your local projects.</p>

<ul>
  <li><a href="https://github.com/UW-Madison-DoIT/KeyValueStore">KeyValueStore</a></li>
  <li><a href="https://github.com/UW-Madison-DoIT/rest-proxy">rest-proxy</a></li>
  <li><a href="https://github.com/UW-Madison-DoIT/token-crypt">Token Crypt</a> : A project that can encrypt/decrypt tokens and files using public/private key pairs.</li>
</ul>

<p>Likewise, maybe you’ve got some microservice projects and products we could be collaborating on if we knew about them.</p>

<h3 id="adopt-uportal-home">Adopt <code class="highlighter-rouge">uPortal home</code>.</h3>

<p><a href="https://github.com/uPortal-project/uportal-home">uPortal home</a> is a modern user experience layer to plop down in front of your uPortal.</p>

<ul>
  <li>You don’t have to adopt it all at once, for everyone, for every user experience in your portal. MyUW variously implemented it as opt-in, opt-out, at certain hostnames, for certain identities, for certain experiences within MyUW. It’s been a long walk using the new technology for more and more experiences, and we’re still using the traditional uPortal rendering pipeline to render some maximized portlet user experiences. <code class="highlighter-rouge">uPortal home</code> is engineered to be flexible because it had to be.</li>
  <li>You don’t have to stay stuck on AngularJS 1. We too want to migrate forward to AngularJS2, when time and technology allow.</li>
</ul>

<p><a href="http://apetro.ghost.io/">Andrew Petro</a></p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/10/25/myuw-release/</guid>
                <description>
                    
                    A modest MyUW release
                    
                </description>
                <pubDate>Tue, 25 Oct 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS Vulnerability Disclosure</title>
                <link>https://apereo.github.io/2016/10/24/servlvulndisc/</link>
                <content:encoded>
                    <![CDATA[
                    <h1 id="overview">Overview</h1>

<p>This is the public version of an <a href="https://groups.google.com/a/apereo.org/d/msg/cas-announce/Xt-quYhBV7w/oCpvF0caCAAJatom">Apereo CAS project vulnerability disclosure</a>, describing an issue in CAS
where an adversary may be able to bypass certain administrative endpoints, in spite of
CAS access rule in place. The following administrative endpoints are exposed
and vulnerable to this attack:</p>

<ul>
  <li><code class="highlighter-rouge">/statistics/ping</code></li>
  <li><code class="highlighter-rouge">/statistics/threads</code></li>
  <li><code class="highlighter-rouge">/statistics/metrics</code></li>
  <li><code class="highlighter-rouge">/statistics/healthcheck</code></li>
  <li><code class="highlighter-rouge">/statistics/ssosessions</code> and all sub endpoints</li>
</ul>

<h1 id="affected-deployments">Affected Deployments</h1>

<p>The attack vector specifically applies to all deployments of CAS <code class="highlighter-rouge">v4.2.x</code> deployments.
If you have deployed <strong>any version</strong> of CAS 4.2.x, you <strong>MUST</strong> take action to upgrade.
If you have deployed any <strong>other</strong> versions of CAS, disregard this announcement.</p>

<h1 id="severity">Severity</h1>

<p>This is a serious issue where successfully exercising this vulnerability allows the adversary
gain insight into the running CAS software, collect running threads, DOS the server repeatedly
via <code class="highlighter-rouge">ping</code>s and potentially observe the collection of active SSO sessions and meddle with user single sign-on activity.</p>

<h1 id="patching">Patching</h1>

<p>Patch releases are available to address CAS <code class="highlighter-rouge">v4.2.x</code> deployments.
Upgrades to the next patch version for each release should be a drop-in replacement.
The patch simply ensures that the exposed endpoints honor the CAS access rules,
and otherwise block attempts. When you have applied the patch, please double check all endpoints
and ensure access is appropriately controlled.</p>

<h2 id="timeline">Timeline</h2>

<p>The issue was originally reported to the CAS application security team
on September 27, 2016. Upon confirmation, CAS was patched on September 28, 2016
and released. The original release
announcement is <a href="https://groups.google.com/a/apereo.org/d/msg/cas-announce/Xt-quYhBV7w/oCpvF0caCAAJ">available here</a>.</p>

<h2 id="procedure">Procedure</h2>

<p>Modify your CAS overlay to point to version <code class="highlighter-rouge">4.2.6</code>. A snippet of a <code class="highlighter-rouge">pom.xml</code> for a CAS overlay follows:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.jasig.cas<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cas-server-webapp<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>war<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;cas.version&gt;</span>4.2.6<span class="nt">&lt;/cas.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre></div></div>

<p>Double check your <code class="highlighter-rouge">cas.properties</code> file for the following setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cas.securityContext.adminpages.ip=127\.0\.0\.1
</span></code></pre></div></div>

<p>Make sure the correct IP pattern is authorized to access admin pages.</p>

<h2 id="alternatives">Alternatives</h2>

<p>If you are unable to apply the patch, it’s then best to ensure the outlined
endpoints are blocked completely via load balancers, proxies, firewalls, etc.</p>

<h1 id="support">Support</h1>

<p>If you have questions on the details this vulnerability and how it might be reproduced,
please contact <code class="highlighter-rouge">security@apereo.org</code> or <code class="highlighter-rouge">cas-appsec-public@apereo.org</code>.</p>

<h1 id="resources">Resources</h1>

<ul>
  <li><a href="https://groups.google.com/a/apereo.org/d/msg/cas-announce/Xt-quYhBV7w/oCpvF0caCAAJ">Original Announcement</a></li>
  <li><a href="https://apereo.github.io/cas/developer/Sec-Vuln-Response.html">CAS Security Vulnerability Response Model</a></li>
</ul>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/10/24/servlvulndisc/</guid>
                <description>
                    
                    Disclosure of a security issue with the CAS administrative endpoints exposure.
                    
                </description>
                <pubDate>Mon, 24 Oct 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Activating MFA in CAS 5</title>
                <link>https://apereo.github.io/2016/10/19/mfacas5-extcfg/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>Perhaps one of the more attractive features of <a href="https://apereo.github.io/cas/development">CAS 5</a> is the ability to support <a href="https://apereo.github.io/cas/development/installation/Configuring-Multifactor-Authentication.html">multifactor authentication</a>
via a number of providers/vendors that can be triggered in many ways. While support for triggers may seem extensive, there is always
that edge use case that would have you trigger MFA based on a special set of requirements.</p>

<p>Here is what you can do.</p>

<h1 id="audience">Audience</h1>

<p>This post is intended for java developers with a basic-to-medium familiarity with Spring, Spring Boot and Spring Webflow.
This is <strong>NOT</strong> a tutorial to be used verbatim via copy/paste. It is instead a recipe for developers to extend CAS
based on specialized requirements.</p>

<h1 id="stop-coding">Stop Coding</h1>

<blockquote>
  <p>Hearken to the reed flute, how it complains, lamenting its banishment from its home: “Ever since they tore me from my osier bed, my plaintive notes have moved men and women to tears. I burst my breast, striving to give vent to sighs, and to express the pangs of my yearning for my home. He who abides far away from his home is ever longing for the day he shall return.</p>

  <p>[The Reed Flute’s Song, Rumi, 1207-1273]</p>
</blockquote>

<p>Before diving into code, I <strong>MUST</strong> emphasize that developing custom extensions/addons, while certainly keeewl and exciting, would eventually lead to long-term maintenance/upgrade burdens. Consider direct contributions to the project if/when feasible and solve the problem where it needs solving.</p>

<p>If you are going to write code, you might as well write it where it belongs.</p>

<h1 id="requirements">Requirements</h1>

<p>You will need to have compile-time access to the following modules:</p>

<ul>
  <li><code class="highlighter-rouge">org.apereo.cas:cas-server-core-webflow</code></li>
  <li><code class="highlighter-rouge">org.apereo.cas:cas-server-core-web</code></li>
</ul>

<p>These are modules that ship with CAS by default and thou shall mark them with a <code class="highlighter-rouge">compile</code> or <code class="highlighter-rouge">provided</code> scope in your build configuration.</p>

<h1 id="create-mfa-triggers">Create MFA Triggers</h1>

<p>You should create an event resolver that houses and implements your special requirements for MFA. A typical example might be: <em>Activate MFA provider <code class="highlighter-rouge">mfa-duo</code> if the request client IP address matches the pattern <code class="highlighter-rouge">123.+</code></em></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">apereo</span><span class="o">.</span><span class="na">cas</span><span class="o">.</span><span class="na">custom</span><span class="o">.</span><span class="na">mfa</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomWebflowEventResolver</span> <span class="kd">extends</span> <span class="n">AbstractCasWebflowEventResolver</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">CasConfigurationProperties</span> <span class="n">casProperties</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Event</span><span class="o">&gt;</span> <span class="nf">resolveInternal</span><span class="o">(</span><span class="kd">final</span> <span class="n">RequestContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">RegisteredService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">WebUtils</span><span class="o">.</span><span class="na">getRegisteredService</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="n">WebUtils</span><span class="o">.</span><span class="na">getAuthentication</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="kd">final</span> <span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">WebUtils</span><span class="o">.</span><span class="na">getHttpServletRequest</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>

        <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">MultifactorAuthenticationProvider</span><span class="o">&gt;</span> <span class="n">providerMap</span> <span class="o">=</span>
            <span class="n">WebUtils</span><span class="o">.</span><span class="na">getAllMultifactorAuthenticationProviders</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">applicationContext</span><span class="o">);</span>

        <span class="c1">// Somehow, select a provider based on the above map...    </span>
        <span class="kd">final</span> <span class="n">MultifactorAuthenticationProvider</span> <span class="n">provider</span> <span class="o">=</span> <span class="o">...</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">areWeDoingMfa</span><span class="o">())</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="n">Event</span> <span class="n">event</span> <span class="o">=</span> <span class="n">validateEventIdForMatchingTransitionInContext</span><span class="o">(</span><span class="n">provider</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">context</span><span class="o">,</span>
                        <span class="n">buildEventAttributeMap</span><span class="o">(</span><span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">(),</span> <span class="n">service</span><span class="o">,</span> <span class="n">provider</span><span class="o">)));</span>
            <span class="k">return</span> <span class="n">ImmutableSet</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Not doing MFA, sorry."</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note that you have full access to the resolved CAS authentication, the principal associated with it, the service requesting authentication as well as the original web request. You also have access to the full body of CAS configuration settings, should you need to externalize values.</p>

<h1 id="register-mfa-triggers">Register MFA Triggers</h1>

<p>Your trigger then needs to be registered. We do this via CAS’ native auto-configuration strategy, which scans the application context
for relevant annotations inside <code class="highlighter-rouge">org.apereo.cas</code> sub-packages. If you change package names, you <strong>MUST</strong> account for the custom context scan too.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">apereo</span><span class="o">.</span><span class="na">cas</span><span class="o">.</span><span class="na">custom</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="s">"SomethingConfiguration"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomethingConfiguration</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"initialAuthenticationAttemptWebflowEventResolver"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">CasDelegatingWebflowEventResolver</span> <span class="n">initialEventResolver</span><span class="o">;</span>

    <span class="nd">@RefreshScope</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">CasWebflowEventResolver</span> <span class="nf">customWebflowEventResolver</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">CustomWebflowEventResolver</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@PostConstruct</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">initialEventResolver</span><span class="o">.</span><span class="na">addDelegate</span><span class="o">(</span><span class="n">customWebflowEventResolver</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We simply register our trigger as a Spring <code class="highlighter-rouge">@Bean</code> and add it to the
chain of event resolvers that kick into action as part of CAS authentication machinery.</p>

<h1 id="so">So…</h1>

<p>Note that:</p>

<ul>
  <li>You are really not doing anything <em>custom</em>. All CAS triggers behave in the same exact way when
they attempt to resolve the next event.</li>
  <li>The API is completely oblivious to multifactor authentication; all it cares about is finding the next event in the chain in a very generic way. Our custom implementation of course makes the next event be concerned about MFA but in theory we could have resolved the next event to be <code class="highlighter-rouge">hello-world</code> and CAS would not have cared.</li>
</ul>

<p>Happy Coding!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/10/19/mfacas5-extcfg/</guid>
                <description>
                    
                    Learn and master custom MFA triggers in CAS 5.
                    
                </description>
                <pubDate>Wed, 19 Oct 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Bootiful CAS 5 Overlay</title>
                <link>https://apereo.github.io/2016/10/04/casbootoverlay/</link>
                <content:encoded>
                    <![CDATA[
                    <h1 id="overview">Overview</h1>

<p>As you may know, the recommended strategy to start a CAS deployment today is via the
<a href="https://apereo.github.io/cas/development/installation/Maven-Overlay-Installation.html">WAR Overlay Installation Method</a>. The idea is that a deployment gets to keep only local customizations
and <em>inherits</em> everything else from a pre-built pre-configured instance. Not only this allows
one to keep track of intentional changes, but also makes it easier to upgrade
the software in place by simply bumping the CAS version in the overlay script.</p>

<p>CAS 5 itself is entirely based on Spring Boot. Today, CAS 5 overlays for both <a href="https://github.com/apereo/cas-overlay-template/tree/5.0">Maven</a> and <a href="https://github.com/apereo/cas-gradle-overlay-template/tree/5.0">Gradle</a> too are modified to accommodate easier deployment options via Spring Boot.</p>

<p>Here’s how.</p>

<h1 id="bootiful-overlay">Bootiful Overlay</h1>

<p>Today, adopters are given 3 choices to deploy an overlay:</p>

<ol>
  <li>Run the CAS web application as an executable WAR via a <code class="highlighter-rouge">java -jar &lt;cas-war-file&gt;</code> type of command.</li>
  <li>Deploy the <code class="highlighter-rouge">&lt;cas-war-file&gt;</code> into an external container of choice, such as Apache Tomcat.</li>
  <li>[<strong>NEW</strong>] Run the CAS web application as an executable WAR via the Spring Boot’s Maven/Gradle plugin, though you may be interested in <a href="https://github.com/apereo/cas/issues/2334">this issue</a>.</li>
</ol>

<p>The 3rd option is similar to the native <code class="highlighter-rouge">java -jar ...</code> command with the main difference that the Spring Boot plugin is able to recognize the presence of Spring Boot’s <code class="highlighter-rouge">devtools</code> that is shipped with CAS by default and allows for ad-hoc live monitoring of CAS resources.</p>

<p>This is specially helpful perhaps during UI design; such that you could keep modifying
<code class="highlighter-rouge">html</code>, <code class="highlighter-rouge">css</code>, and <code class="highlighter-rouge">js</code> resources and CAS will auto-detect changes and allows you to
see them via a simple refresh of your browser.</p>

<p>Lots quicker!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/10/04/casbootoverlay/</guid>
                <description>
                    
                    A quick tutorial on running a CAS Overlay with Spring Boot.
                    
                </description>
                <pubDate>Tue, 04 Oct 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.0.0-RC3 Released</title>
                <link>https://apereo.github.io/2016/10/01/cas5rc3-release/</link>
                <content:encoded>
                    <![CDATA[
                    <p>We are excited to announce the 3rd release candidate in the CAS 5 series. There are a <a href="https://github.com/apereo/cas/releases/tag/v5.0.0.RC3">few  items</a> packed into this release that are worthy to publicize. So here it goes.</p>

<p>Before we get started, it should be pointed out that <a href="https://github.com/apereo/cas-overlay-template/tree/5.0">releases of CAS 5 are available to adopters to try</a>. Deployers are more than welcome to try out the milestone releases and share feedback.</p>

<p>The current in-development documentation of CAS 5 is also <a href="https://apereo.github.io/cas/development/index.html">available here</a>.</p>

<h1 id="mfa">MFA</h1>

<p>A series of patches have been applied to address issues related to multi-factor authentication:</p>

<ul>
  <li>Activating MFA based on multi-valued principal attributes</li>
  <li>Activating MFA for non-interactive authentication flows such as SPNEGO</li>
</ul>

<h1 id="password-management">Password Management</h1>

<p>The CAS self-service password management functionality is patched to better report back password policy requirements on the screen, and changes have gone in to ensure password updates can successfully be executed against Active Directory.</p>

<h1 id="delegated-authn">Delegated AuthN</h1>

<p>Summary of fixes are:</p>

<ul>
  <li>Better reporting of authentication failures in case a provider (i.e. Facebook) denies user access.</li>
  <li>Better management of locating resources through CAS properties, specially when dealing with delegated SAML AuthN.</li>
</ul>

<h1 id="admin-uis">Admin UIs</h1>

<p>Some adjustments have been made to the way admin user interfaces are protected via CAS itself. A few additional screens have also been worked into the interface to display the CAS audit log as well as a list of trusted devices/browsers registered for MFA bypass.</p>

<h1 id="cas-attributes">CAS Attributes</h1>

<p>Additional validation checks are now in place to ensure CAS attributes are properly formatted, encoded and named in the final validation response. For instance, CAS is now able to detect the proper syntax if it’s configured to release an attribute that is <code class="highlighter-rouge">system:people:admins:something</code>.</p>

<h1 id="groovy-based-attributes">Groovy-based Attributes</h1>

<p>When it comes to mapping attributes conditionally at release time, CAS is now able to correctly and more accurately support groovy-based attribute definitions, whether inline or as a full standalone groovy script file.</p>

<h1 id="jwt-authn">JWT AuthN</h1>

<p>Thanks to Pac4J, a number of fixes have gone in to ensure JWTs can successfully be validated based on customizable encryption and signing algorithms, which can now be specified for a given CAS service definition. Additional checks are also in place to report on the validity of the JWT itself and its required fields such as the <code class="highlighter-rouge">sub</code>.</p>

<h1 id="dependency-upgrades">Dependency Upgrades</h1>

<p>We have taken a pass at the core CAS dependencies to ensure we are running on the latest stable component releases, some of which include:</p>

<ul>
  <li>Spring Core</li>
  <li>Spring Boot</li>
  <li>Spring Cloud</li>
  <li>Thymeleaf</li>
  <li>Pac4J</li>
  <li>Tomcat</li>
  <li>Hazelcast</li>
</ul>

<p>…and plenty more.</p>

<h1 id="whats-next">What’s Next?</h1>

<p>Short of a few more last rounds to ensure everything is tested as much as possible, we should be gearing up for the official GA release shortly. The release schedule will likely be adjusted to note the correct final release date, and when all is said and done, there will be planning sessions to discuss the project roadmap for the next upcoming release.</p>

<p>Yes, there is plenty of more work left to do!</p>

<h1 id="how-can-you-help">How can you help?</h1>

<p>Do NOT wait for the final GA release to begin your deployment. If you do discover a problem after the GA is out, it may be a while for you to receive the next upgrade with the fix in place. Now is the best time to start trying out the release candidates and report back findings. The software is only as stable and bug-free as it is reported back to the community.</p>

<p>So:</p>

<ul>
  <li>Start your early <a href="https://github.com/apereo/cas-overlay-template/tree/5.0">CAS 5 deployment</a> today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Review and suggest documentation improvements.</li>
  <li>Review the release schedule and make sure you report your desired feature requests on the project’s issue tracker.</li>
</ul>

<h1 id="das-ende">Das Ende</h1>

<p>A big hearty thanks to all who participated in the development of this release to submit patches, report issues and suggest improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/10/01/cas5rc3-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5 RC3 release.
                    
                </description>
                <pubDate>Sat, 01 Oct 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Singing &quot;I Love Bug Reports&quot;</title>
                <link>https://apereo.github.io/2016/09/26/love-thy-bugs/</link>
                <content:encoded>
                    <![CDATA[
                    <p>Having been involved in the open-source space for some time, I have noticed that various communities and software engineers react differently to bug reports and issue submissions. Some tend to discuss issues and shortcomings of the software <em>in private</em> as developers may consider those defects cause for embarrassment and failure! Some tend to disregard issues and close the conversation loop immediately, routing the user to other <em>appropriate</em> channels and reemphasizing a <em>this is not a bug</em> mentality without any sort of user education or guidance. Some welcome bug reports in all shapes and sizes and consider those an acknowledgement and positive feedback even when/if the underlying reported problem turns out to be moot.</p>

<p>Here is my personal recipe.</p>

<h2 id="if-you-are-about-to-submit-a-bug">If you are about to submit a bug</h2>

<h3 id="data-data-data">Data, Data, Data</h3>

<p>Always ensure you have enough diagnostics data in your report. Are you reporting the exact version numbers that exhibit the seemingly-faulty behavior? Have you described your deployment/development environment in enough detail? Have you included error logs, screenshots and other useful snippets of your configuration to demonstrate the issue? Have you included steps to explain how one might duplicate the problem? Unit tests to recreate the issue?</p>

<p>Put another way; readers of your case aren’t necessarily housed in your head! They don’t know what you know. Help them out. Would you want to respond to your own report? Think about that before you press submit.</p>

<h3 id="is-this-a-bug">Is this a bug?</h3>

<p>Research the issue and be sure to do your due diligence. Have you scanned the web archives for similar cases? Have you looked at the project’s documentation to find better explanations? Have you reviewed the project’s mailing lists, chatrooms and other facilities to find possible solutions?</p>

<h3 id="should-i-submit">Should I submit?</h3>

<p>Some projects consider their issue tracking system as a placeholder to track genuine traceable issues and tasks. If you have a general question about the workings of the software, or if you’re unsure how something is supposed to work and are in need of an analysis and further discussion, consider choosing alternative vessels for contact. Use mailing lists, chatrooms, Stackoverflow and other similar tools to engage with the project owners. When the dust has settled and you have arrived at a legitimate theory to explain the root cause of the problem, file a submission.</p>

<h3 id="be-part-of-the-solution">Be part of the solution</h3>

<p>If you can, always volunteer to post a patch and work up a solution. Be prepared to follow up to test the produced patch in your environment and always try to provide a confirmation. Simply complaining about something and letting it sit in the issue tracker for someone else to handle isn’t going to get you much.</p>

<p>If you find something that you deem worth someone else’s time to fix for you, be sure to demonstrate the issue is first and foremost worth your own time as well. “It ain’t a problem for me if it ain’t a problem for you”, sort of thing.</p>

<h2 id="if-you-are-responding-to-a-bug">If you are responding to a bug</h2>

<h3 id="collaborate">Collaborate</h3>

<p>Bugs are an opportunity for collaboration. They allow you to engage with the community and start a conversation. It’s a two-way street. After all, that’s why you’re involved in open-source, right?</p>

<h3 id="marketing">Marketing</h3>

<p>Bug reports are the perfect opportunity for marketing. It’s free data! You get to learn which entities and companies from which industry sectors use the software. And how. The more you get involved, the more advertising and marketing is going to flood your way and that might radically change the way you think about the original platform requirements.</p>

<h3 id="learn">Learn</h3>

<p>Bug reports are fun; you learn how people are actually using the software in ways you had never imagined, which may influence you more on a technical level to rethink design, implementation and learn about new integration prospects and partners.</p>

<h3 id="be-nice">Be nice</h3>

<p>This is perhaps <strong>the most important bit of all</strong>. Do NOT ever create an atmosphere where the user community feels like they are being treated as buffoons with severe visual impairments who are dispossessed of the ability to read your perfect documentation and walkthroughs. As far as you should be concerned, [albeit a tad too extreme perhaps], if someone can’t figure out how to use the solution in reasonable time, then the bug is on you. Resist the urge to call out folks on their “stupid mistakes” and don’t be inclined to respond to every single “foolish” post. Eat something sweet. The feeling will pass, I promise you.</p>

<p>Be nice. Welcome bug reports with open arms.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/09/26/love-thy-bugs/</guid>
                <description>
                    
                    A personal, painfully obvious recipe for handling bug reports in open source.
                    
                </description>
                <pubDate>Mon, 26 Sep 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS Git Repository Maintenance</title>
                <link>https://apereo.github.io/2016/09/21/gitrepo-maint/</link>
                <content:encoded>
                    <![CDATA[
                    <p>If you have managed to clone the <a href="https://github.com/apereo/cas">CAS Github repository</a> recently, you would notice that the repository is obscenely large; 1.2GB large that is. Depending on your connection bandwidth, the initial <code class="highlighter-rouge">git clone</code> operation could take a very long time specially time that could otherwise be spent wisely to catch Pokémon. Over the years, the CAS development has collected a lot of history in the git commit log. Given the <a href="https://github.com/apereo/cas/milestones">upcoming CAS 5 release</a>, we feel this is a good time to do a little bit of housekeeping to compress the repository and leave it in a functional efficient state.</p>

<p>Here are the details.</p>

<h2 id="what-does-this-mean-to-adopters">What does this mean to adopters?</h2>

<p>If you are a CAS deployer and have started your CAS deployment using a <a href="https://apereo.github.io/cas/development/installation/Maven-Overlay-Installation.html">WAR overlay method</a>, this will have <strong>absolutely NO IMPACT</strong> on your deployment and future upgrades. None whatsoever. Keep building, patching and upgrading.</p>

<p>If you are a CAS deployer and have started your CAS deployment via building directly from source, you <strong>MIGHT</strong> be in trouble. We certainly recommend all CAS deployments start with the official and suggested deployment strategy, but if you wish to stick to your own ways, read on.</p>

<h2 id="what-does-this-mean-to-developers">What does this mean to developers?</h2>

<p>Well, we are simply creating history here.</p>

<p>Here is the <a href="https://github.com/apereo/cas/issues/1814">issue</a> tracking this particular task.</p>

<p>One of the caveats of cleanup process is that the commit log is massaged to rewrite the project history. This means that all project activity remains in place along with commit messages, authors and dates yet SHAs will be replaced and regenerated. This also implies that anyone else with a local clone or fork of the CAS repository will need to either use <code class="highlighter-rouge">git rebase</code> or create a fresh clone. If you fail to do so and manage to <code class="highlighter-rouge">push</code> again, old history is going to get pushed along with it and the repository will be reset to the state it was in before! So nuke your existing clones and forks and start again.</p>

<p>Note that the cleanup process affects not just <code class="highlighter-rouge">master</code> but all CAS repository branches, and there are quite a few. This means that before you start over with a fresh clone, you will need to make sure lingering branches in your local fork of the CAS repository are either:</p>

<ul>
  <li>Safely backed up and stored somewhere else, so they can be reworked later into the fresh clone.</li>
  <li>Merged into the canonical CAS repository prior to the cleanup effort.</li>
</ul>

<h2 id="how-do-we-do-this">How do we do this?</h2>

<p>We plan to follow <a href="http://stevelorek.com/how-to-shrink-a-git-repository.html">this guide</a>. Initial experiments seem to demonstrate that repository size would shrink down to about 500MB, which is quite an improvement.</p>

<p>Prior to the cleanup process, we plan to store the existing CAS repository in a separate git repository for safekeeping as a backup.</p>

<h2 id="when-do-we-do-this">When do we do this?</h2>

<p>The cleanup process takes a while to complete, somewhere between 2-4 hours. Announcements will follow on the <a href="https://apereo.github.io/cas/Mailing-Lists.html">CAS mailing lists</a> to give developers a headsup on the individual milestones within the cleanup task. Keep an eye out.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/09/21/gitrepo-maint/</guid>
                <description>
                    
                    The CAS development team is starting with a bit of git repository housekeeping. Here is how and why.
                    
                </description>
                <pubDate>Wed, 21 Sep 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>September 2016 Apereo Newsletter</title>
                <link>https://apereo.github.io/2016/09/19/newsletter/</link>
                <content:encoded>
                    <![CDATA[
                    <p>This newsletter, dated September 15th, was <a href="https://groups.google.com/a/apereo.org/forum/#!topic/announcements/y1c-AErU0co">published</a> to <a href="https://groups.google.com/a/apereo.org/forum/#!forum/announcements">the Apereo Announcements Google Group</a>.</p>

<p>It is re-published here as an experiment in publishing using Jekyll / Markdown. This content is lightly edited and hyperlink-enhanced to take advantage of this publishing medium.</p>

<p><em>Upcoming Events</em></p>

<p>1) UCLA and Unicon Webinar on Identity &amp; Access Management, Hosted by Internet2</p>

<p>2) Virtual Sakai Conference: Wednesday, November 2</p>

<p>3) Request for Volunteers: Open Apereo 2017 Conference Planning Group</p>

<p>4) Apereo Africa 2017</p>

<p><em>Announcements</em></p>

<p>5) uPortal Announces Supporting Subscription Model</p>

<p>6) Ra11y Plan for Sakai Accessibility Phase 1 Complete</p>

<p>Project News &amp; Releases</p>

<p>7) News from the Opencast Community</p>

<p>8) Karuta Portfolio Ready To Replace OSP in Sakai 11</p>

<p>9) uPortal 5 Roadmap</p>

<p>10) Xerte Online Toolkits v3.3: Expanded SCORM Tracking!</p>

<p>11) CAS 5 Available by Late September</p>

<p><em>Case Studies: Early Sakai 11 Implementation at Three Institutions</em></p>

<p>12) MCI’s roadmap to an early Sakai 11 update</p>

<p>13) Migrating to Sakai 11 at HEC Montréal</p>

<p>14) Sakai 11 Early Adopter: Notes from the Trenches at Marist College</p>

<hr />

<h1 id="from-the-editor">From the Editor:</h1>

<p>A new semester is underway, bringing with it releases, project news, and new opportunities to collaborate and share.</p>

<p>Remember that the Apereo newsletter provides an important opportunity for communicating within and across the many projects in our community. This is your vehicle to share what you’re doing and invite others to join. Our newsletter is also an important place for sharing strategies and success stories for pursuing an open source philosophy in educational technology.</p>

<p>We are looking for contributions of all kinds – examples might include (but are not limited to) articles, video clips, screencasts, graphics, or short announcements on:</p>

<ul>
  <li>How you’re using software produced by an Apereo community at your institution</li>
  <li>Major releases or minor tweaks</li>
  <li>Ideas for new projects you’d like to get feedback on or gauge interest in</li>
  <li>Important discussions of general educational technology issues that emerge on community email lists</li>
</ul>

<p>Contributions of all lengths, from snippet to think pieces, are welcome.</p>

<p>Send your submissions (and any questions!) to <code class="highlighter-rouge">newsletter@apereo.org</code>. The newsletter will publish on or about the 15th of the month, with items due by the 10th.</p>

<p>– Lucy Appert, Newsletter Editor</p>

<hr />

<h1 id="upcoming-events">Upcoming Events</h1>

<h2 id="1-ucla-and-unicon-webinar-on-identity--access-management-hosted-by-internet2">1) UCLA and Unicon Webinar on Identity &amp; Access Management, Hosted by Internet2</h2>

<p>September 21, 2016 – 2 p.m. EST http://bit.ly/2cd4SwN</p>

<p>Join UCLA and Unicon for an interactive webinar, hosted by Internet2, to discover how open source Grouper and Shibboleth are meeting UCLA’s identity and access management needs. This webinar will also give an update on open source project customizations for Grouper and Shibboleth (completed by Unicon for its clients) that have been donated back to the open source community.</p>

<p>– Lisa Di Pietro</p>

<hr />

<h2 id="2-virtual-sakai-conference-wednesday-november-2">2) Virtual Sakai Conference: Wednesday, November 2</h2>

<p>Make plans now to attend the Sakai Virtual Conference on Wednesday, November 2nd from 9AM to 5PM EDT (-4 GMT).</p>

<p>The conference will be held entirely online, and will have an emphasis on pedagogy and best practices. Join us for a faculty-friendly day of learning, sharing, and community building with your fellow Sakai users around the globe, all without the need to travel!</p>

<p>For more details, visit <a href="http://virtconf.apereo.org">the conference website</a>.</p>

<p>– Neal Caidin, Sakai Community Coordinator, Apereo Foundation</p>

<p>– Wilma Hodges, Sakai Virtual Conference 2016 Planning Committee Chair</p>

<p>– Ian Dolphin, Executive Director, Apereo Foundation</p>

<hr />

<h2 id="3-request-for-volunteers-open-apereo-2017-conference-planning-group">3) Request for Volunteers: Open Apereo 2017 Conference Planning Group</h2>

<p>The Open Apereo Conference will be held between the 4th and 8th of June 2017, in sunny Philadelphia.</p>

<p>As with every Apereo conference, community engagement is the key to a successful event. Key to this engagement are community volunteers who serve on the conference planning group. Please consider volunteering. The planning group meets for around an hour every two weeks, and consists of volunteers, Foundation staff, and our conference planners, Concentra. Joining the group is a great way to get involved, and work with other community members to shape the conference program and social activities.</p>

<p>If you’re interested, contact me directly at <code class="highlighter-rouge">ian.dolphin@apereo.org</code> .</p>

<p>– Ian Dolphin</p>

<hr />

<h2 id="4-apereo-africa-2017">4) Apereo Africa 2017</h2>

<p>Mark your calendars! Apereo Africa 2017 conference will be held in Cape Town next year on the 9th and 10th of May</p>

<p>Contact details: <code class="highlighter-rouge">tshego@opencollab.co.za</code> or <code class="highlighter-rouge">elsabe@opencollab.co.za</code>.</p>

<p>Kind regards</p>

<p>Elsabe Botha</p>

<hr />

<h1 id="announcements">Announcements</h1>

<h2 id="5-uportal-announces-supporting-subscription-model">5) uPortal Announces Supporting Subscription Model</h2>

<p>The new Apereo membership model consists of two elements. The first is a Core Foundation Subscription, paid by all members. This covers key services Apereo provides for all its software communities – technical infrastructure, legal and licensing support, community coordination, events, and outreach. The second is a Supporting Subscription for specific Apereo Projects. This is an important way that organizations can substantively and collectively support projects they use and depend on. External to Apereo, organizations may also subscribe to commercial support offerings which address local support and targeted development. All three of these mechanisms address different but important needs.</p>

<p>The uPortal Steering Committee is responsible for determining how subscription funds will be used. Our primary use is in support of securing a uPortal Community Liaison and Release Lead. This person would focus on:</p>

<ul>
  <li>Coordination and engineering of releases</li>
  <li>Testing</li>
  <li>Bug fixing</li>
  <li>Fit and finish of code and documentation pull requests</li>
  <li>Welcoming and bootstrapping new developers and community participants</li>
</ul>

<p>The uPortal Steering Committee has developed a tiered rate for uPortal Supporting Subscriptions that gives institutions flexibility to determine what level of financial support they would like to demonstrate for uPortal. Supporting subscriptions are annual, on top of the standard Apereo Member/Affiliate rates.</p>

<p>uPortal Supporting Subscription Rates:</p>

<ul>
  <li>$1,000 bronze, uPortal Friend</li>
  <li>$5,000 silver, uPortal Booster</li>
  <li>$10,000 gold, uPortal Sustainer</li>
  <li>$20,000 platinum, uPortal Champion</li>
</ul>

<p>All uPortal Supporting Subscribers are entitled to:</p>

<ul>
  <li>Vote for a uPortal Supporting Subscriber representative on the uPortal Steering Committee</li>
  <li>Being recognized as a uPortal Supporting Subscriber on the project web site</li>
  <li>The gratitude from the uPortal Community for their valuable support</li>
</ul>

<p>By becoming a uPortal Supporting Subscriber, you can help support continued improvements to the uPortal project such as releases that are more frequent, more complete, more stable, and better documented. Your support also helps make possible additional contributions from the community as potential contributors feel more welcome and encouraged.</p>

<p>By coming together as a community through uPortal Supporting Subscriptions we can collectively ensure that uPortal better meets the needs of higher education organizations and beyond. We encourage you to consider becoming an Apereo Member/Affiliate organization and a uPortal Supporting Subscriber.</p>

<p>– Jim Helwig</p>

<hr />

<h2 id="6-ra11y-plan-for-sakai-accessibility-phase-1-complete">6) Ra11y Plan for Sakai Accessibility Phase 1 Complete</h2>

<p>Dear Community,</p>

<p>Thanks to you, <a href="https://confluence.sakaiproject.org/display/2ACC/rA11y+Plan">Phase 1 of the Ra11y plan</a> is complete!</p>

<p>What does this mean? It means that we completed a substantive review of the accessibility of the Sakai system by contracting out the assessment to a reputable 3rd party, <a href="http://www.ssbbartgroup.com/">SSB Bart</a>. Improving Sakai’s accessibility means making it easier for people of all abilities to use our system. Our aim, as it always has been, is to make the system genuinely as accessible as possible, which directly impacts students, instructors, and other users in a positive way with a better user experience. We also wish to achieve WCAG 2 certification, which validates the community’s hard work in this area. A double win!</p>

<p>The good news is that Sakai, as it stands now, is assessed at 74% compliant, which is not a bad starting point. Also we have gone painstakingly through the 453 identified issues and consolidated them into <a href="https://jira.sakaiproject.org/issues/?filter=15821">51 Jiras</a> .  We are off to a great start and we don’t want to lose the momentum!</p>

<h3 id="deadline">Deadline</h3>

<p>Now we are in phase 2 and we have a deadline to complete the work to address issues identified by January 28, 2017.</p>

<h3 id="contributions">Contributions</h3>

<p>Please consider contributing to <a href="https://sites.google.com/a/apereo.org/farm/home/current-projects/in-progress/sakai-ra11y">this FARM project</a> either with a cash contribution, resources to fix bugs, or QA resources to help test Accessibility fixes. At the moment, resources for fixing bugs is the most urgent.</p>

<p>We would like to target Sakai 11.2 or Sakai 11.3 maintenance release to complete this project, though we realize this might be ambitious.</p>

<h3 id="why-contribute">Why Contribute?</h3>

<ul>
  <li>Accessibility reflects our values as a community; probably reflects your institutional values; and I am guessing that for most of us, reflects our personal values too.</li>
  <li>Accessibility is becoming a must-have requirement for institutions looking to adopt a learning management system. Many institutions will not consider a learning management system that is not accessible.</li>
  <li>Legal compliance in many countries</li>
  <li>Accessibility is the right thing to do.</li>
  <li>Accessibility in most cases, if not all, benefits ALL users of our system.</li>
</ul>

<h3 id="consequences-of-not-meeting-the-end-of-year-date">Consequences of not meeting the end of year date</h3>

<p>If we don’t meet our goal of 100% compliance by the January 2017 deadline then we can still get a conditional certification based on the percentage of completion we do make. But then if we want the full WCAG2 certification and don’t meet the deadline , we will have to start the process over, which will be more time-consuming, will require another round of funding, and will mean the overall cost to complete might as much as double.</p>

<h3 id="approach">Approach</h3>

<p>Collaborating with developers and with SSB Bart, the Accessibility team aims to identify the best way to fix certain types of accessibility issues, and to document these approaches to make it as easy as possible for our developer community to participate and help fix bugs. The documentation will be in our community wiki, Confluence. More details to come.</p>

<h3 id="invitation">Invitation</h3>

<p>Every little bit helps. If you think your institution might be able to contribute in any way, please contact our Accessibility chair, Matt Clare, for more information, <code class="highlighter-rouge">matt.clare@brocku.ca</code>.</p>

<p>Thanks for your attention,</p>

<p>The Sakai Accessibility WG</p>

<hr />

<h1 id="project-news--releases">Project News &amp; Releases</h1>

<h2 id="7-news-from-the-opencast-community">7) News from the Opencast Community</h2>

<ul>
  <li>On September 26-27, the annual meeting of the German speaking Opencast community will take place. This time, the conference is hosted by the University of Stuttgart. More details will be released soon.</li>
  <li>The annual Opencast community summit will take place March 1-3 2017 at Universitat Politécnica de Valencia. This event will coincide with a meeting of the Spanish/European Sakai/Apereo community. Expect to hear more over the next couple of months.</li>
  <li>Opencast 2.2.2 is expected to be released on Monday, September 12th,2016</li>
  <li>Bruno Seoane (Teltek) and Lars Kiesow (ELAN e.V.) have been elected as Opencast 2.3 release managers. Feature freeze is set to October 1st and the final release is expected on December 13th.</li>
</ul>

<p>– Lars Kiesow</p>

<hr />

<h2 id="8-karuta-portfolio-ready-to-replace-osp-in-sakai-11">8) Karuta Portfolio Ready To Replace OSP in Sakai 11</h2>

<p>The Karuta Open Source Portfolio 2.0 stands ready to replace (and upgrade!) your OSP implementation – now that OSP is not included in Sakai 11.</p>

<p>From the Resources page on <a href="http://karutaproject.org">the Karuta website</a>, you can access our sandbox instance, try out a customization involving the AAC&amp;U Value Rubrics, download our two designer workbooks to help you build your own customization, and/or download the Karuta 2.0 code.</p>

<p>You can also access demos of Karuta</p>

<ul>
  <li><a href="https://www.youtube.com/channel/UCA4hSOqMqVk3ufvR37fHppQ">Karuta YouTube channel</a></li>
  <li><a href="https://www.youtube.com/watch?v=oh14bi3IoP8">Sakai Showcase Webinar Series: Karuta Open Source Portfoloio For LTI Integration with Sakai</a></li>
  <li><a href="https://www.youtube.com/watch?v=Xkx7kIehs3A">2015-11-04 15:20 Karuta 1.1 - A Complete Portfolio Solution LTI Integrated with Sakai</a></li>
  <li><a href="https://www.youtube.com/watch?v=o53beS5C6RI">Karuta Open Source Portfolio: a flexible architecture for assessment, accreditation and much more</a></li>
  <li><a href="https://www.youtube.com/watch?v=32k7B9w7wdY">(French language) Screencast ePortfolio IUT2 KARUTA 2015</a></li>
</ul>

<p>The Karuta Project under the umbrella of the Apereo Foundation also offers online demos for groups at your institution. Please let us know if you are interested in checking out Karuta!</p>

<p>– Janice A. Smith</p>

<hr />

<h2 id="9-uportal-5-roadmap">9) uPortal 5 Roadmap</h2>

<p>The uPortal Steering Committee, project committers, and uPortal adopters met virtually in early September to discuss the uPortal roadmap and <a href="https://wiki.jasig.org/x/GYBfB">plans for uPortal 5</a>. The overall theme for this next version is to make the project more “modern” for today’s IT professionals. It includes an overhaul of the way the uPortal project sources are organized and how the project is built and deployed. Our high level goals are to:</p>

<ul>
  <li>Shift the customary deployment paradigm away from building on each portal server</li>
  <li>Allow multiple adopters to deploy the same, Apereo-provided binaries</li>
  <li>Move uPortal toward “cloud native”</li>
  <li>Make uPortal easier to work with for developers, especially new developers</li>
</ul>

<p>– uPortal Steering Committee</p>

<hr />

<h2 id="10-xerte-online-toolkits-v33-expanded-scorm-tracking">10) Xerte Online Toolkits v3.3: Expanded SCORM Tracking!</h2>

<p>On behalf of the wonderful people of the Xerte developer community, we are pleased to announce that the latest version of Xerte Online Toolkits, v3.3 is now available. The most significant aspect of this release provides support for SCORM tracking for a much wider range of interactions. The following page types can now all be tracked:</p>

<ul>
  <li>Dictation</li>
  <li>Matching pairs / Timeline</li>
  <li>Matching text</li>
  <li>Interactive Text</li>
  <li>Media lesson</li>
  <li>Gap fill</li>
  <li>Sortable Grid</li>
  <li>Drag &amp; Drop</li>
  <li>Quiz</li>
  <li>MCQ</li>
</ul>

<p>Additional New Features</p>

<ul>
  <li>A new interactive page type, Word Search has been added to the ‘Games’ category.</li>
  <li>Display of learning objects has been improved for iPhone.</li>
  <li>Pages can now be hidden from view until you are ready to publish them into the learning object.</li>
  <li>You can now add JavaScript to a learning object for custom functionality.</li>
  <li>The card graphics in Memory Game can now be customised.</li>
  <li>When exporting zip packages, the filename now reflects the project exported.</li>
  <li>Workspace has been enhanced to make the best use of the available screen resolution.</li>
  <li>New features added to Decision Tree.</li>
  <li>MathJax is now usable in Decision Tree.</li>
  <li>Interface enhancements to the Bootstrap pages to better handle projects with many pages.</li>
</ul>

<p>This release contains a large number of other fixes and enhancements. Upgrading is highly recommended.</p>

<p>– Julian Tenney</p>

<hr />

<h2 id="11-cas-5-available-by-late-september">11) CAS 5 Available by Late September</h2>

<p>The CAS development team is marching towards a major release – CAS 5. <a href="https://mmoayyed.github.io/cas/2016/08/26/cas5-rc1-release/">The first release candidate</a> has been available for some time and the project intends to officially make the release available by late September. Adopters are encouraged to try the release candidate and report back issues as early as possible.</p>

<p>The CAS 4.2.x release line is also actively maintained and 4.2.5 is the current and most recent version that is recommended for production deployments.</p>

<p>Also the CAS PMC recently approved of <a href="https://apereo.github.io/cas/developer/Maintenance-Policy.html">the CAS maintenance and EOL policy</a> that describes how CAS releases are generally maintained. It’s important for adopters to understand how long their particular deployment is set to receive patches and attention from the developer community.</p>

<p>– Misagh Moayyed</p>

<hr />

<h1 id="case-studies-early-sakai-11-implementation-at-three-institutions">Case Studies: Early Sakai 11 Implementation at Three Institutions</h1>

<h2 id="12-mcis-roadmap-to-an-early-sakai-11-update">12) MCI’s roadmap to an early Sakai 11 update</h2>

<p>At MCI (MCI Management Center Innsbruck) we are proud to be among the very first institutions having upgraded to Sakai 11 - including a new Morpheus compatible skin for a responsive UI and MCI-specific adaptations and processes. Our user feedback has been great so far! We really would like to thank the Apereo Foundation, the Sakai community, and the developers who did a terrific job and made this possible!</p>

<p>For this update, the available time frame at MCI was smaller than usual – less than 5 months, of course with maintaining the 10.6 instance alongside. Changes in development and the community processes of Sakai 11 made it possible to keep a tighter schedule than ever before! We do believe that the change to GIT source code management was one of the most important factors making more timely local releases including adaptations possible.</p>

<p>Up to Sakai 10 we used a local subversion repository with a vendor-branch approach for keeping our source code in sync with the official Sakai versions. Importing the new community source code was an error-prone and tedious process and as a consequence was done only few times a year. Important security patches were integrated manually, bigger updates are only implemented twice a year. The time cost of the workflow enforced a sequential workflow that meant that we always had to wait for a Sakai release to have gold release status before we started work on source code integration and adaptation.</p>

<p>With GIT we were able to start adaptation, testing and integration <em>in parallel</em> to community development. In order to be up-to-date, we regularly rebased our changes on the 11.x-code instead of the tags. Implementing it this way, we already finalized our local adaptations when Sakai 11 was released officially.</p>

<h3 id="timeline">Timeline:</h3>

<p>Summer 2015</p>

<ul>
  <li>First local tests of Morpheus</li>
</ul>

<p>February 2016</p>

<ul>
  <li>Last update Sakai 10 (10.6)</li>
</ul>

<p>March 2016</p>

<ul>
  <li>Download 11.x, still without local GIT workflow</li>
  <li>Change of development environment to Tomcat 8 and Java 8</li>
  <li>First local instance of Sakai 11.x</li>
  <li>Risk assessment for planned update in summer</li>
</ul>

<p>April/May 2016</p>

<ul>
  <li>Introduction of GIT repositories for development at MCI</li>
  <li>Concept for removal of previous adaptations (especially for navigation, UI)</li>
  <li>Final strategic decision for summer update to Sakai 11</li>
</ul>

<p>June/July2016</p>

<ul>
  <li>Local Git-Rebase workflow and documentation created, based on remote 11.x upstream and local multi-developer git repository</li>
  <li>Morpheus skin adaptations (mixture of scss-config and injection of a custom.css which contains our skin code not configurable with the existing scss-variables)</li>
</ul>

<p>July 22, 2016</p>

<ul>
  <li>Integration of latest blocker bugfixes and last git-rebase to 11.x before update.</li>
</ul>

<p>July 23, 2016</p>

<ul>
  <li>Official Apereo Sakai 11 release</li>
</ul>

<p>July 25, 2016</p>

<ul>
  <li>Update of sakai.mci4me.at to Sakai 11 (we didn’t really plan to be that close to the official release date, we decided to use 25/7 about 1 month before :-) )</li>
</ul>

<p>The update started at 13:00 CEST and was finished at about 15:00 CEST.</p>

<p>Administrative tasks during the update process were:</p>

<ul>
  <li>Backup (filesystem snapshot, fast)</li>
  <li>update of required environment (Java, …, fast)</li>
  <li>uploading new configuration files (sakai.properties and init scripts, debugging necessary, took most of the time)</li>
  <li>Deployment of new Sakai build (fast)</li>
  <li>configuring and resetting user workspaces with a webservice-script (debugging necessary, took some time)</li>
  <li>repairing the Favorite Sites of every user with the conversion script: <code class="highlighter-rouge">java -cp "lib/*" -Dtomcat.dir="$PWD" org.sakaiproject.user.util.ConvertUserFavoriteSitesSakai11</code> (easy and fast)</li>
</ul>

<p>The contrib-tools we are using are the following:</p>

<ul>
  <li>Dashboard (using that one since summer 2013): Still not a core tool, but it just works fine for our needs, is placed on every users starting page and is everybodys favorite timesaver. Lots of trouble, but lots of benefit.</li>
  <li>YAFT: Still in triage (so no real user feedback), but it seems to work with Sakai 11.</li>
  <li>CLOG: Introduced that with Sakai 11, so no conversion experience.</li>
  <li>Contentreview/TII: We highly customized this one in Sakai 10, and simply kept that for 11, since the switch to the LTI-tool is coming soon (we guess).</li>
</ul>

<p>Thank you once again &amp; best wishes from the Alps!</p>

<p>IT-Services team @ MCI</p>

<p>If there is further interest in particular aspects of our update-roadmap, feel free to send a request to our developers:</p>

<ul>
  <li><code class="highlighter-rouge">Thomas.Lampert@mci.edu</code></li>
  <li><code class="highlighter-rouge">Wolfgang.Rohregger@mci.edu</code></li>
</ul>

<p>In cases of organizational questions, you can also contact our IT-Lead:</p>

<p><code class="highlighter-rouge">Peter.Mirski@mci.edu</code></p>

<hr />

<h2 id="13-migrating-to-sakai-11-at-hec-montréal">13) Migrating to Sakai 11 at HEC Montréal</h2>

<p>HEC Montréal went live with Sakai 11 on August 10th. Our migration from a Sakai 2.9/10 hybrid went smoothly. We took the decision in April to forge ahead with our migration process without knowing the release date of Sakai 11. We were confident that the community would put tremendous effort to get the release out before the fall semester and we were not disappointed!</p>

<p>It was very important for HEC to migrate to Sakai 11 this summer since we plan to use 2017 summer to release a new course outline tool to our users. This new Sakai tool called ‘TenJin’ is currently under development at HEC and we plan to make it available to the Apereo Community as an open source project.</p>

<p>– Philippe Rancourt</p>

<hr />

<h2 id="14-sakai-11--early-adopter-notes-from-the-trenches-at-marist-college">14) Sakai 11 – Early Adopter: Notes from the Trenches at Marist College</h2>

<p>We didn’t think we would go first. In fact, we were hoping to be somewhere in the middle of the pack, a bit out towards the front.  It had been several years since Marist College had a major Sakai upgrade and it was critical we move as quickly as possible off of Sakai 2.9.4 to a new version. Pressure had been mounting since student and faculty feedback indicated the system seems “dated” and “clunky” and of course, it didn’t work on mobile devices.  Sakai 11 included “must have” features like “Lessons”, GradebookNG, and a pleasant, user-centric, responsive design.  To assure success, we partnered with Longsight, who worked with us in preparation for the upgrade and who was instrumental on the day of our upgrade.</p>

<p>With our deadline looming, we charged on. As a result we learned from our successes as well as our failures.   Here’s are some of the lessons we learned.</p>

<h3 id="prepare-if-you-can">Prepare, if you can.</h3>

<p>In 2015, we knew we would be upgrading at some point and changed our old 2.9.4 skin to be reflective of Sakai 11 in an effort to prepare faculty and students for the change to the User Interface (UI).   We made a copy of our production database and ran the Sakai 10 and 11 upgrade scripts against it.  This gave us a chance to see, in advance, if we would have any data issues as part of the upgrade.  We actually ran into an issue with the Job Scheduler tables; this issue was fixed as a Community Jira, saving others from running into the same problem.</p>

<p>Lesson learned: Give yourself a bit more time than you think you need to get your existing skin(s) into Morpheus.  It does take some trial and error to get buttons and some other features set the way you want.  You will also need to go through all the tools to make sure that they are themed the way you want.  We ended up with a few buttons that had the text color the same as the button color.  This was not the best user experience.  The more skins you have, the more time you will need to dedicate to the Morpheus conversion especially if your skins are heavily customized.</p>

<h3 id="be-aware-of-deprecated-tools">Be aware of deprecated tools.</h3>

<p>We started a bit late out of the gate in locating a solution for our faculty to migrate their Melete content into the Lessons tool. However, once a process was in place, we took initiative to reach out to our faculty, especially to those who teach fully online courses and were the heaviest users of these tools.  Communication took the form of announcements, email, newsletters, and workshops.   We also created pages dedicated to the upgrade on our website.  We directed all customers there for the latest information related to the upgrade.</p>

<h3 id="timing-is-everything">Timing is everything.</h3>

<p>An important question arose: do we  allow faculty to begin creating their fall courses prior to the upgrade?  This meant jumping through some hoops to make sure that tools available to faculty building courses in 2.9.4 would be supported in Sakai 11.  We switched from Gradebook 2 to Gradebook 1 as it was supported in both versions.  After the upgrade we ran a script against the database to convert all the courses with Gradebook 1 to GradebookNG.  This was only possible because the database tables were the same between the two tools. This method eased the impact on faculty and students for courses running during the upgrade.</p>

<h3 id="recommendations">Recommendations</h3>

<ul>
  <li>Create an inventory of tools with in both course and project sites.  Identify outliers (tools that may be deprecated such as Clog or LTI tools). These are the issues we received the most critical calls about. We even had to bring back up a copy of Sakai 2.9.4 so that one instructor could grade the Clog content in his summer course.</li>
  <li>It may sound redundant, but prepare the faculty for what is about to change within each of the tools they use in various formats, such as documentation, outreach, and supplemental information.  The jump from 2.9.4 to Sakai 11 turned out to be overwhelming for some faculty because of the changes in interface, tool behavior, and new tools coupled with impacts on course and content development and delivery.</li>
  <li>Don’t forget about the Adjunct Faculty.  Many who teach once or twice a year may be completely unaware of the upgrade.</li>
  <li>Keep the Help Desk in the loop and make sure they have “how to clear your browser cache” documents handy, along with the extensive documentation regarding new features.</li>
  <li>Join the Sakai QA community and maintain continuous engagement. Participation offers the best opportunity  to experience the latest version  and prepare for  new tool behavior and functional changes.</li>
  <li>Last but not least, keep up with the latest software. In other words, upgrade regularly.</li>
</ul>

<p>Although we had issues and missteps, the overall the feedback we have received has been quite positive and many of our initial concerns were able to be quickly addressed.   We were not planning on being an early adopter, yet with the lessons we have learned from this successful upgrade, the idea may not be unusual in the future.</p>

<p>– Dede Hourican</p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/09/19/newsletter/</guid>
                <description>
                    
                    Lightly formatted re-publication of newsletter.
                    
                </description>
                <pubDate>Mon, 19 Sep 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Veresk Software Architecture</title>
                <link>https://apereo.github.io/2016/09/17/practical-soft-arch/</link>
                <content:encoded>
                    <![CDATA[
                    <p>I suspect you have never had a chance to visit the Veresk Bridge. That’s cool. Neither have I. But humor me please and take a peek at it <a href="https://en.wikipedia.org/wiki/Veresk_Bridge">here</a>.</p>

<p>Here is a slightly better-than-Wikipedia picture of the bridge:</p>

<p><img src="https://cloud.githubusercontent.com/assets/1205228/18591877/b70c9152-7c49-11e6-9f97-f3b576b7b9fd.jpg" alt="veresk_bridge_3" /></p>

<p>I am going to tell you about the part that my mom told me when I was a kid and it’s a story that likely most Iranians-by-origin know as well, though its authenticity is still somewhat questionable.</p>

<p>The story goes that as the chief engineer, Mr. Walter Aigner, finished the architecture work and once the bridge construction was fully ready to be “tested”, he called upon Reza Shah (the head monarch of Iran at the time) to come visit the beauty in all its glory. He did also request that Reza Shah must have the honor of boarding the very first train ever to cross the bridge and cut the metaphorical ribbon with wheels on burning coal.</p>

<p>The bridge was a very big deal at the time; a symbol of magnificence, pride and glory for the nation. The opportunity for the common folk to see their Shah up close and witness him take part in the community to “ride the train along with his countrymen” was going to be both advantageous to the administration and a note of joy and amusement for the people.</p>

<p>So of course, he obliged. I also suspect that Reza Shah was not a big fan of testing things in production either. But he did ask that Mr. Aigner along with the rest of his family stand <em>underneath the bridge</em> and watch as he, aboard the train, crossed over. Remember; this was a first test. A smoke test that could have literally ended in smokes.</p>

<p>Mr. Aigner was of course so confident in his design and implementation of the bridge that he accepted. His family patiently watched from 100 meters below while the train successfully crossed the bridge without any accidents. “Cheers to the Shah”, people must have yelled.</p>

<p>So why am I telling you about all this? Because that’s exactly how I feel about software architecture and the responsibility of architects as they pass through iterations of design and implementation.</p>

<p>If you are not willing to stand by your design and your ideas in confidence…if you are not able to execute in action what may only seem a pretty diagram on paper…if you are not willing to get hands-on and learn the nuances of implementing said ideas and weigh pros and cons of each in practice…none of that is of any use to anybody, really.</p>

<p>Of course, let’s clarify that I:</p>

<ul>
  <li>Have nothing against bridges, trains or crossing over things.</li>
  <li>Am not advocating for any sort of monarchy.</li>
  <li>Am not advocating for any kind of violence and hostility during software design.</li>
  <li>Am not advocating that you should gather your folks and sprawl out underneath the data center as you press the power button on your Pentium II.</li>
  <li>Seriously shall question your sanity if you go to production with Pentium IIs.</li>
</ul>

<p>All I am saying is, you should be held accountable. That’s all.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

<p>PS: The Chief Engineer, Austrian Walter Aigner, following his wishes, is today buried in the local cemetery of Veresk. </p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/09/17/practical-soft-arch/</guid>
                <description>
                    
                    Soapbox alert; I ramble on about software architecture, taking notes from historical monarchs.
                    
                </description>
                <pubDate>Sat, 17 Sep 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Hope for GitHub Pages</title>
                <link>https://apereo.github.io/2016/09/16/hope-for-gh-pages/</link>
                <content:encoded>
                    <![CDATA[
                    <h1 id="short-version">Short version</h1>

<ul>
  <li>“+1” for Apereo adoption of <a href="https://pages.github.com/">GitHub Pages</a> for this website.</li>
  <li>I’m hopeful for applying this approach beyond blogging.</li>
  <li>Static site generators have lots of advantages. Those advantages align with Apereo values and realities.</li>
  <li>Call to action to use <a href="https://pages.github.com/">GitHub Pages</a> more and better and thereby make Apereo websites better.</li>
</ul>

<h1 id="1">+1</h1>

<p>I’m really excited and supportive about Apereo’s adopting <a href="https://pages.github.com/">GitHub Pages</a> for this website, and I’m hopeful about using it for more than just a blog.</p>

<p>Not only do I concur that this is a good idea,</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/dm1p9mE9RBw?rel=0&amp;t=2s" frameborder="0" allowfullscreen=""></iframe>

<p>(Which is to say, “+1”, in Apache parlance.)</p>

<h1 id="advantages-of-static-site-generator-websites">Advantages of static site generator websites</h1>

<p><a href="https://jekyllrb.com/">Jekyll</a>-driven <a href="https://pages.github.com/">GitHub Pages</a> has tremendous advantages aligned with Apereo values and operations.</p>

<ul>
  <li>Driving the website by <a href="https://github.com/apereo/apereo.github.io">a public Git repository</a> improves <strong>transparency</strong>. It means anyone can inspect the content and <a href="https://github.com/apereo/apereo.github.io/commits/master">history</a> of the site to understand just what is being said and the history of saying it. And anyone can inspect the program that generates the site from the content files. Not just the open source technology used in the abstract - the <a href="https://github.com/apereo/apereo.github.io/tree/master/_layouts">specific configuration</a>, instantiation of that automation.</li>
  <li>Driving the website by a public GitHub repository improves <strong>openness</strong>. It means <a href="https://help.github.com/articles/creating-a-pull-request/">anyone can propose a change</a>. Anyone can even <a href="https://help.github.com/articles/editing-files-in-another-user-s-repository/">edit through the GitHub UI in a Web browser</a> if working with text files locally is off-putting.</li>
  <li>Driving the website by a public GitHub repository improves <strong>meritocracy</strong>. It means when anyone proposes a change, that proposed change can be publicly evaluated on its merits. GitHub Pull Requests and their <a href="https://help.github.com/articles/reviewing-changes-in-pull-requests/">review features</a> are a beautiful thing.</li>
  <li>Driving the website by a public GitHub repository improves <strong>collaboration</strong>. It means anyone can collaborate with anyone in any branches they need, in public or private forks if need be.</li>
  <li>Modeling the website content as text files in a public GitHub repository better enables (much) <strong>better tools for working on the content</strong>. Programmers edit text files. A website that is fundamentally text files as content is more amenable to programmers and technically minded people doing great things efficiently. <code class="highlighter-rouge">grep</code> and its kin are beautiful and powerful. As is your text editor of choice.</li>
  <li>Driving the website by an open and openly configured static site generator enables (much) <strong>better tools for working on the website framework</strong>. To the extent necessary, programmers can collaborate not just on the content but also on the “program” that generates the website from the content – the CSS, the templating, all the way through <a href="https://jekyllrb.com/">the free and open source static site generator framework itself</a>.</li>
  <li>GitHub Pages is much better aligned with affordable and sustainable Apereo operations practices. Apereo runs very thin on infrastructure and even thinner on staff and volunteer bandwidth to wrangle infrastructure. GitHub Pages <strong>adds zero to Apereo’s server and database footprint</strong>.</li>
  <li>GitHub Pages websites are also <strong>free as in cheapness</strong>, which lines up well with Apereo funding levels. Apereo maybe should pay someone to develop awesome website content (arguable). Apereo definitely shouldn’t be paying anyone to host a website, operate its database, keep WordPress patched. Accept free-as-in-cheapness infrastructure for commodity website hosting and repurpose scarce resources for something more higher-ed-open-source-IT-aligned.</li>
  <li>Static site generators enable higher quality results. It’s easier for web developers to collaborate on making a website much sharper, much snappier, much better when using sharper tools.</li>
  <li>Using <a href="https://jekyllrb.com/">Jekyll</a>-driven <a href="https://pages.github.com/">GitHub Pages</a> <strong>eases future migrations</strong>. While GitHub Pages operates with panache, <a href="https://jekyllrb.com/">Jekyll</a> is open source and generates a static website that can be served up from just about anywhere on just about any technology stack. Using GitHub Pages <em>doesn’t</em> entail vendor lock-in.</li>
  <li>Using <a href="https://jekyllrb.com/">Jekyll</a>-driven <a href="https://pages.github.com/">GitHub Pages</a> eases future migrations. If Apereo ever wants to port this content to a different website management platform, well, all the content is just text files. It’s hard to beat that as a friendly starting point for laying hands on this content and importing it into something else.</li>
</ul>

<p>(These are advantages of open source public-git-repository-driven static site generators more generally. Jekyll-driven GitHub Pages is a particularly nice implementation of an approach that can be achieved with more hassle using other specific technologies.)</p>

<h1 id="examples-of-use-of-github-pages-outside-and-within-apereo">Examples of use of GitHub Pages, outside and within Apereo</h1>

<p>Okay, so <a href="https://pages.github.com/">GitHub Pages</a> in particular, and static site generators more generally, are technically awesome. You might reasonably ask, why is this website nonetheless so very ugly?</p>

<p>I want to assure that GitHub Pages sites can be beautiful, usable, arbitrarily comprehensive, etc.</p>

<p>GitHub has a <a href="https://github.com/showcases/github-pages-examples">showcase of GitHub Pages examples</a>. These are some of the more website-flavored examples:</p>

<ul>
  <li><a href="http://electron.atom.io/community/">Electron</a></li>
  <li><a href="https://facebook.github.io/react/">react</a></li>
  <li><a href="https://developer.github.com/">developer.github</a></li>
</ul>

<p>We need not look so far afield to find examples of using GitHub Pages to make websites happen: there are usages within Apereo already.</p>

<ul>
  <li><a href="https://apereo.github.io/cas/">CAS</a></li>
  <li><a href="http://apereo-learning-analytics-initiative.github.io/OpenDashboard/">OpenDashboard</a></li>
  <li><a href="http://oaeproject.org/">OAE</a> (note this demonstrates that GitHub Pages sites can have arbitrary hostnames, don’t have to be .github.io branded.)</li>
  <li><a href="https://csev.github.io/tsugi/">Tsugi</a></li>
</ul>

<h1 id="next-steps">Next steps</h1>

<p>Better is better. Make things better, and then make things better again. Repeat.</p>

<p>I believe that static site generator approaches are better than database-backed-web-application approaches (WordPress, Drupal, even my beloved Ghost) for web sites, more often than not.</p>

<p>GitHub Pages-driven <a href="http://oaeproject.org/">oaeproject.org</a> feels more awesome, more beautiful, more full of potential to me than does <a href="https://www.apereo.org/projects/apereo-oae">its equivalent pages within apereo.org</a>.</p>

<p>The next step is to do more of that. To keep making Apereo content better using better tools. And then to repeat.</p>

<p>I hope these steps will add up to a walk will be a walk out of database-backed website solutions and into static site generator solutions, for the better productivity, quality, openness, transparency, and sustainability of Apereo website delivery.</p>

<h1 id="disclaimer">Disclaimer</h1>

<p>Opinions expressed are my own and are not necessarily those of Apereo, of my employer, of the uPortal project, or of other projects and organizations with which I am involved.</p>

<p><a href="https://twitter.com/awpetro">Andrew Petro</a></p>


                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/09/16/hope-for-gh-pages/</guid>
                <description>
                    
                    GitHub Pages could be a win for Apereo beyond blogging.
                    
                </description>
                <pubDate>Fri, 16 Sep 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>MyUW (University of Wisconsin) Build Process</title>
                <link>https://apereo.github.io/2016/09/15/myuw-build-now-and-future/</link>
                <content:encoded>
                    <![CDATA[
                    <p>During the most recent uPortal development meeting we were discussing how uPortal building and deployment currently works and ought to work. It came up that other campuses are checking out the project on each server, building the ear, and shipping it to Tomcat. UW does not take that approach and we thought it may be helpful to articulate what we do to maybe help steer the next generation uPortal project (aka uPortal 5).</p>

<p>Edits:</p>
<ul>
  <li>adjusted to reflect the new name <code class="highlighter-rouge">uPortal app framework</code> and new repository location for what was previously known as <code class="highlighter-rouge">uw-frame</code></li>
  <li>adjusted to reflect the new name <code class="highlighter-rouge">uPortal home</code> and new repository location for what was previously known as <code class="highlighter-rouge">AngularJS-portal</code></li>
</ul>

<h2 id="the-now">The Now</h2>

<p>There are many pieces of technology that the UW uses. Here are the components and some other definitions that will be used in this technical document:</p>

<ul>
  <li>CI : Continuous integration</li>
  <li><a href="https://jenkins.io/">Jenkins</a> : A platform to build and deliver projects</li>
  <li><a href="https://www.jfrog.com/artifactory/">Maven Repository</a> : A storage application to place and retrieve built Java artifacts</li>
  <li><a href="https://about.gitlab.com/">Gitlab</a> : A git repository GUI (UW has an on-prem instance running in Docker, very easy)</li>
  <li><a href="http://maven.apache.org/plugins/maven-war-plugin/overlays.html">Maven Overlay</a> : A process in maven where you can overlay files on top of a project to change things such as configuration.</li>
  <li><a href="https://www.docker.com/">Docker</a> : shipping containers with a single process* running in a encapsulated environment.</li>
  <li><a href="https://github.com/UW-Madison-DoIT/token-crypt">Token Crypt</a> : A project that can encrypt/decrypt tokens and files using public/private key pairs.</li>
</ul>

<p>We use Jenkins for two different reasons. First we build the project and deploy the snapshot to our maven repository. We also use Jenkins for CI. For example, let’s say that someone makes a change to our fork of uPortal. When we merge the merge request from Gitlab into <code class="highlighter-rouge">master</code>, we push out a post merge web hook to Jenkins. Then we have a Jenkins job that runs <code class="highlighter-rouge">mvn deploy</code> which packages all the artifacts for uPortal and deploys it to the snapshot maven repository. It is important to note that the artifact we ship to maven has no passwords or configuration files in it. These are environment agnostic artifacts.</p>

<p>After the environment agnostic war has been shipped to the maven repository, we trigger a test uPortal war build. This build is just an overlay.  It takes the environment agnostic war, unwraps it, injects in the configuration files for test, and wraps it back up. It is then stored in our server’s local <code class="highlighter-rouge">.m2/repository</code>. During this process we decrypt the tokens that are passwords using Token Crypt’s maven plugin. Since it has passwords at this point, it’s important to keep it local and not push it anywhere.</p>

<p>At this point the ear job for test is triggered. This ear job is just a <code class="highlighter-rouge">pom.xml</code> that pulls in the artifacts from all the overlay projects for that given environment. You can see an example of said <code class="highlighter-rouge">pom.xml</code> <a href="https://github.com/UW-MultiEnvironment-Build/dev-ear">here</a>. All that happens is we run a <code class="highlighter-rouge">mvn package</code> and then ship the ear (exploded) to a directory on the build server. Do note that none of this is happening on a server that will run uPortal.</p>

<p>So now we have a test version of our deliverable that we want to ship to our test instances. We use Docker for our servers, running on Linux VMs. We have a Docker container that has a preconfigured Java and Tomcat with an empty webapps directory.</p>

<p>After the ear build runs with the test ear, we then can deliver it to test. We have a docker jenkins job that does this task. It does the following:</p>

<ul>
  <li>Docker pull our latest container that has java/tomcat configured</li>
  <li>Copy the wars from the build directory to the running directory (versioned so we can always rollback)</li>
  <li>Take an instance offline and delete the container (e.g.: <code class="highlighter-rouge">docker stop test1 &amp;&amp; docker rm test1</code> )</li>
  <li>Do a docker run (e.g.: <code class="highlighter-rouge">docker run myuw/tomcat7-java7:latest -v /runner/810/webapp:/home/of/tomcat/webapp</code>)</li>
  <li>Water test the node to make sure tomcat started correctly</li>
  <li>Then trigger that instance back into the cluster, and rinse/repeat for other nodes</li>
</ul>

<h2 id="looking-ahead-to-where-we-would-like-to-go">Looking ahead to where we would like to go</h2>

<p>We like our current setup but we would like to improve on a few things. Here is our wish list. First we would love to stop having to fork uPortal to get our own skin and configuration (using the alternative <code class="highlighter-rouge">uPortal home</code> front end). If we could do a Docker overlay process that could be nice.</p>

<p>We would also like to have it possible to ship the content of the webapp directory instead of depending on a volume mount from the host. In order to accomplish that we need to get rid of the hard coded passwords in the configuration files. We are looking toward using <a href="https://www.vaultproject.io/">VaultProject</a> for that. This would have the sided bonus of removing the complexity of maven overlays. During startup vault could go fetch the configuration for that given environment.</p>

<p>It could also be interesting to be able to download a docker artifact containing a configured uPortal from docker hub. The only downside is we would like to be able to control the versions of Java and Tomcat. However, if we updated this often we could be alright with relieving that control.</p>

<p>A single Docker container running a big JVM can be painful to scale. We would like to look into splitting out our webapps into many docker containers so we can scale only the things that need scaling. A great example of that is the wave of students who need to get to our campus course guide (which is currently a portlet). If we wanted to increase the bandwidth of that one portlet, we would need to stand up another 6GB JVM. We are migrating that application to a normal webapp so this is possible. It will still have a MyUW presence, but just through widgets and links. It will have the added bonus to look like it is part of the MyUW experience using shared angular components from <a href="https://github.com/uPortal-project/uportal-app-framework">uPortal app framework</a>.</p>

<p>We are also looking toward running on AWS, but this is in the very early stages.</p>

<h2 id="more-resources">More Resources</h2>
<ul>
  <li><a href="https://github.com/orgs/UW-MultiEnvironment-Build/dashboard">Github overlay sample project</a></li>
</ul>

<p><a href="https://twitter.com/timtim192">Tim Levett</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/09/15/myuw-build-now-and-future/</guid>
                <description>
                    
                    A look into what MyUW does now for builds and what it hopes that the future looks like.
                    
                </description>
                <pubDate>Thu, 15 Sep 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.0.0-RC1 Release</title>
                <link>https://apereo.github.io/2016/08/26/rc1-release/</link>
                <content:encoded>
                    <![CDATA[
                    <div class="alert alert-success">
  <strong>Collaborate</strong><br />The blog is managed and hosted on GitHub. If you wish to update the contents of this post or if you have found an inaccuracy and wish to make corrections, we recommend that you please submit a pull request to <a href="https://github.com/apereo/apereo.github.io">this repository</a>.
</div>

<p>Based on the <a href="https://github.com/apereo/cas/milestones">CAS project release schedule</a>, today we are excited to announce the first release candidate in the CAS 5 series. There are a <a href="https://github.com/apereo/cas/releases/tag/v5.0.0.RC1">few enhancements</a> packed into this release that are worthy to publicize. So here it goes.</p>

<p>Before we get started, it should be pointed out that <a href="https://github.com/apereo/cas-overlay-template/tree/5.0">releases of CAS 5 are available to adopters to try</a>. Deployers are more than welcome to try these out and share feedback.</p>

<p>The current documentation of CAS 5 is also <a href="https://apereo.github.io/cas/development/index.html">available here</a>.</p>

<h1 id="openid-connect">OpenID Connect</h1>

<p>OIDC support in CAS gets a number of improvements and bug fixes thanks to <a href="https://github.com/leleuj">Jérôme</a>.</p>

<h1 id="google-recaptcha">Google reCAPTCHA</h1>

<p>Over the years, there have been several requests on the mailing list asking for guidance to enable a CAS integration with Google’s reCAPTCHA. While <a href="https://wiki.jasig.org/display/CASUM/Integrating+reCaptcha+with+CAS">a recipe</a> existed for enabling this feature for older CAS versions, over time it’d gotten rusty. In this release, CAS starts to support <a href="https://apereo.github.io/cas/development/integration/Configuring-Google-reCAPTCHA.html">Google’s reCAPTCHA</a> natively. Just like with all other features, there will be no need to modify
the CAS login webflow or any other configuration file. Include the relevant module, and provide your settings for reCAPTCHA.</p>

<blockquote class="imgur-embed-pub" lang="en" data-id="a/DBIcr"><a href="//imgur.com/DBIcr"></a></blockquote>
<script async="" src="//s.imgur.com/min/embed.js" charset="utf-8"></script>

<p><a href="http://news.softpedia.com/news/google-recaptcha-cracked-in-new-automated-attack-502677.shtml">This article</a> may be of further interest to you.</p>

<h1 id="default-redirect-url">Default Redirect URL</h1>

<p>What happens when users accidentally and incorrectly bookmark the <code class="highlighter-rouge">https://sso.example.org/cas/login</code> url? They get to the CAS login page, authenticate and then are greeted with a warm welcoming message that redirects them to nowhere important. Phone calls and support tickets flood IT services reporting that CAS or this/that application are broken.</p>

<p>That’s no fun.</p>

<p>So to accommodate this briefly, CAS starts to support a default redirect URL to which you can redirect your audience if no target application is specified upon authentication. The URL can be just about anywhere, as long as you have authorized and registered it correctly. In most cases, it’s a redirect to some sort of portal page that lists all services integrated with CAS.</p>

<h1 id="case-insensitive-attribute-release">Case Insensitive Attribute Release</h1>

<p>So you have set up CAS to retrieve attributes from your LDAP server and decided to retrieve the attribute <code class="highlighter-rouge">givenName</code>. You then register a few services and design them such that they would be allowed to receive <code class="highlighter-rouge">givenName</code>, yet nothing is released. Your logs show <code class="highlighter-rouge">givenName</code> is found and your LDAP queries and browsers all show that attribute has a valid value and all the right permissions are set. What’s happening? Is CAS secretly biased against that attribute?</p>

<p>Some LDAP servers seem to change the case of the attribute name when they pass it back to the requesting application. CAS may submit <code class="highlighter-rouge">givenName</code>, yet it receives <code class="highlighter-rouge">givenname</code>. When the application asks for attributes CAS looks at the associated attribute policy and finds that it’s authorized to release <code class="highlighter-rouge">givenName</code>, yet the actual principal has no such attribute! It only has <code class="highlighter-rouge">givenname</code>. As a result, the application gets nothing.</p>

<p>To accommodate this scenario, CAS starts to treat attributes that are specified in attribute release policies in a case insensitive manner. With this change, CAS may ask for <code class="highlighter-rouge">givenName</code> and the LDAP server is free to return <code class="highlighter-rouge">givenname</code>, <code class="highlighter-rouge">GIVENNAME</code> or a hyper-emo version of it, <code class="highlighter-rouge">gIvEnNaMe</code>. At release time, since case no longer matters the application will correctly receive <code class="highlighter-rouge">givenName</code>.</p>

<p>If it matters that much, note that you can always control the exact case of the attribute released as well and override the CAS behavior.</p>

<p>Also note that this behavior is applicable to all sources from which you retrieve
attributes. It’s not limited to LDAP though the issue described most commonly
affects LDAP.</p>

<h1 id="geoprofiling-authentication-requests">Geoprofiling Authentication Requests</h1>

<p>How do you block what you may consider a suspicious authentication attempt? For instance, you may wish to disallow requests from certain locations or IP addresses or even fancier, you may want those requests to pass through multifactor authentication for extra security.</p>

<p>As a variant of <a href="https://apereo.github.io/cas/development/installation/Configuring-Adaptive-Authentication.html">adaptive authentication</a> and starting with this release candidate CAS allows you to geoprofile authentication requests and then based on your devised rules, reject those or force them through a particular multifactor provider. Geoprofiling can be achieved via Maxmind or GoogleMaps, both of which are services that <strong>require a paid subscription</strong> for full API usage.</p>

<h1 id="groovy-maaan">Groovy, maaan!</h1>

<p>Furthermore, CAS starts to support <a href="https://apereo.github.io/cas/development/integration/Attribute-Release-Policies.html#groovy-script">attribute release</a> via
the Groovy programming language. In short, you can specify a groovy script
that is executed upon attribute resolution and/or release to dynamically
and programmatically decide which application should receive a selection
of attributes.</p>

<p>Note that attribute resolution could always be done via Groovy. This bit is not new.
We have just made the configuration of it a whole easier. Also note that in CAS, attribute resolution is a separate process from attribute release. You can mix and match options that are available for both.</p>

<p>Needless to say, the script is all Groovy and and is capable of executing
any kind of operation the Groovy language itself is able to support.</p>

<h1 id="spring-cloud-vault--mongodb">Spring Cloud: Vault &amp; MongoDb</h1>

<p>CAS adds support for <a href="https://www.vaultproject.io">Vault</a>
and MongoDb, as options that may be used to
house <a href="https://apereo.github.io/cas/development/installation/Configuration-Management.html">CAS configuration</a>.</p>

<h1 id="duosecurity-websdk-23">DuoSecurity WebSDK 2.3</h1>

<p>Thanks to contributions from DuoSecurity, the Duo WebSDK module is now
bumped to <code class="highlighter-rouge">2.3</code>.</p>

<h1 id="front-channel-slo">Front Channel SLO</h1>

<p>While it has been and still is somewhat of an experimental feature,
this release candidate improves the CAS front-channel single logout functionality.
CAS attempts to collect applications that are defined to use front-channel logout and
will use a bit of fancy javascript to contact each endpoint to pass along the logout notification request.
The payload and syntax of the request is identical to the current back-channel logout, and status of each
request is tracked and displayed in the user interface.</p>

<h1 id="saml2-sp-integrations">SAML2 SP Integrations</h1>

<p>Now that CAS 5 starts to support the SAML2 protocol, you gotta ask: what
if we could extend the auto-configuration strategy to provide built-in SP
integrations? That is, much like anything else, you should be able to declare what
your SP metadata is, what attributes it requires and so on in a simple <code class="highlighter-rouge">.properties</code>
file. CAS should auto-register the SP and take care of all the other technical details.</p>

<p>Right?</p>

<p>Right! With this release, CAS starts to support the following <a href="https://apereo.github.io/cas/development/integration/Configuring-SAML-SP-Integrations.html">SP Integrations</a>
out of the box:</p>

<ul>
  <li>Dropbox</li>
  <li>Box</li>
  <li>Salesforce</li>
  <li>SAManage</li>
  <li>ServiceNow</li>
  <li>PowerFAIDS Net Partner</li>
  <li>Workday</li>
  <li>WebEx</li>
  <li>Office365</li>
</ul>

<p>These are generally SPs for which the SAML2 integration recipe is quite simple.
As we progress forward, we hope to start collecting more and more
of such SPs, specially those that are more visible and used by the wider
community often, such that we can <strong>configure once, run everywhere</strong> rather than
document it repeatedly, maintain it separately and repeat it for every deployment
forever.</p>

<p>If you have SP suggestions, please feel free to share.</p>

<h1 id="audit-log">Audit Log</h1>

<p>In certain cases and depending on the nature of the request, CAS would produce
an <code class="highlighter-rouge">audit:unknown</code> in the audit log. Thanks to <a href="https://github.com/dima767">Dima</a>,
this behavior is corrected to ensure the audit log can produce a valid user id
for all cases.</p>

<h1 id="logging-dashboard">Logging Dashboard</h1>

<p>CAS starts to allow its administrators, permissions granting, to observe logging configuration and view log outputs in real time. This is done via the magic of Web Sockets, where
CAS and the browser establish a light-weight TCP connection to stream log data.</p>

<p>Here are a few screenshots:</p>

<blockquote class="imgur-embed-pub" lang="en" data-id="a/a2vUk"><a href="//imgur.com/a2vUk"></a></blockquote>
<script async="" src="//s.imgur.com/min/embed.js" charset="utf-8"></script>

<h1 id="custom-error-pages">Custom Error Pages</h1>

<p>Thanks to the magic of Spring Boot, CAS starts to present customized error
pages based on http error codes. You can for instance design a simple <code class="highlighter-rouge">401.html</code>
to explain the error to your users better. Error pages can be defined in form
of series as well, such as <code class="highlighter-rouge">5xx.html</code>.</p>

<p>Here are a few screenshots:</p>

<blockquote class="imgur-embed-pub" lang="en" data-id="a/jGMeo"><a href="//imgur.com/jGMeo"></a></blockquote>
<script async="" src="//s.imgur.com/min/embed.js" charset="utf-8"></script>

<h1 id="password-management">Password Management</h1>

<p>Starting with this release, CAS provides very modest <a href="https://apereo.github.io/cas/development/installation/Password-Policy-Enforcement.html">password management capabilities</a>.
This is an optional feature which allows users to change their password in-place
when CAS detects an authentication failure due to a rejected password. LDAP is supported
as a backend option for managing the account password, though you could always extend
CAS to provide your own implementations of password management services for various backends.</p>

<p>Note that this feature is off by default and without it, you simply get today’s CAS experience
which is a link redirecting to your own password management tool.</p>

<p>Here are a few screenshots:</p>

<blockquote class="imgur-embed-pub" lang="en" data-id="a/RMC7j"><a href="//imgur.com/RMC7j"></a></blockquote>
<script async="" src="//s.imgur.com/min/embed.js" charset="utf-8"></script>

<h1 id="whats-next">What’s Next?</h1>

<p>The development team is working to make sure the CAS 5 release is on <a href="https://github.com/apereo/cas/milestones">schedule</a>.</p>

<p>At this point, all new development has been frozen and project is solely focusing on testing the release candidate and applying bug fixes based on community reports. There will likely be other release candidates but short of any major incidents or changes, the CAS 5 GA release should be available right on schedule.</p>

<h1 id="how-can-you-help">How can you help?</h1>

<ul>
  <li>Start your early <a href="https://github.com/apereo/cas-overlay-template/tree/5.0">CAS 5 deployment</a> today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Review and suggest documentation improvements.</li>
  <li>Review the release schedule and make sure you report your desired feature requests on the project’s issue tracker.</li>
</ul>

<h1 id="das-ende">Das Ende</h1>

<p>A big hearty thanks to all who participated in the development of this release to submit patches, report issues and suggest improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/08/26/rc1-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5 RC1 release.
                    
                </description>
                <pubDate>Fri, 26 Aug 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Defining a Product Vision</title>
                <link>https://apereo.github.io/2016/08/24/soft-evolution/</link>
                <content:encoded>
                    <![CDATA[
                    <p>A long long while ago, I was having a conversation with a good colleague of mine, discussing how to evolve the roadmap of an open-source project to define a vision and how to handle user expectations to an extent so developers could meet and deliver them.</p>

<p>Our conversation sort of stuck with me afterwards in form of the following motto:</p>

<blockquote>
  <p>Ask not what X can do for you. Ask what you can do with X.</p>
</blockquote>

<p>I realize there are lots of “It Depends!” buried there. That’s fine. You have to factor in the relevant context though. This was coined, as I remember it, to embody the true open source and community spirit of a software platform and its users’ ability to extend and modify its capabilities as they see fit without any restrictions or hassle. The platform would continue to remain true to its roots while allowing adopters and deployers to take their deployments to the extreme edges of the world and build on top of it features and functionality that would be very different from the original core vision.</p>

<p>Very cool.</p>

<p>I want to say something different here. While I like that motto quite a lot and I think it says it all within the right context, I have been thinking about its complement. While it’s good and a true sign of power when deployers and users can take the <strong>platform</strong> and do absolutely whatever they want with it, it would be even more fantastic and awesome if the <strong>product</strong> did “everything” they wanted in the first place forcing them to keep their customizations to a minimum. This perhaps sounds like stating the obvious, but in my view, it’s the very delineating factor between failure and success. Evolution is key to success, and any platform or product that wishes to stay alive and stay relevant must redefine its core mission and vision every once in a while and must always be in pursuit of new ground to explore newer and exciting opportunities to help its community. There is no point in maintaining and working on a “beautiful, elegant, small design” that pushes all the responsibility and the liability to its community. If you find yourself often repeating the phrase “That’s not our core concern”, it’s time for you to joggle priorities and reevaluate concerns ‘cause those are what your community cares about. Beautiful design, more often than not, is secondary.</p>

<p>So, how do we deliver “everything”? How do we design the implementation of everything? Is it going to be a monolith? It’s going to be ugly? Big blob of mess and mud? Should it lead us to bloat? Must it be YOOOGE? Is <a href="http://www.bbc.com/news/blogs-news-from-elsewhere-37156962">nose-picking banned for the Philippines police</a>?</p>

<p>I don’t know. You figure it out. All I know is that my new motto is:</p>

<blockquote>
  <p>Ask what X should do for you. Then ask what you can do with X.</p>
</blockquote>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/08/24/soft-evolution/</guid>
                <description>
                    
                    This is my take on how to evolve a product/project vision, and lessons I have learned.
                    
                </description>
                <pubDate>Wed, 24 Aug 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS EOL Policy Proposal</title>
                <link>https://apereo.github.io/2016/08/08/eol-policy-proposal/</link>
                <content:encoded>
                    <![CDATA[
                    <p>The CAS project management committee has been reviewing a proposal on CAS release policies, maintenance and lifetime. In particular, this proposal attempts to provide answers to the following questions:</p>

<ul>
  <li>How long should a CAS release be maintained?</li>
  <li>What is the appropriate scope for release maintenance once a release is retired?</li>
</ul>

<h2 id="today">Today</h2>

<p>The project has been handling release management and maintenance in a semi-official capacity. Today’s release practices typically are:</p>

<ul>
  <li>Patch releases, once every 30 days.</li>
  <li>Minor releases, once every 3-4 months.</li>
  <li>Major releases, where appropriate based on community demand and technical landscape.</li>
  <li>Security patches, whenever needed and preferably as soon as humanly possible.</li>
</ul>

<p>There is no official policy to indicate the lifespan of a CAS release. Maintaining multiple release lines in an adhoc fashion is a very time-consuming and difficult process where the development team has to ensure patches across releases are ported backward or forward correctly and that changesets are properly cherry-picked into the target release, tested, documented and made available.</p>

<p>This process is simply not sustainable.</p>

<h2 id="proposal">Proposal</h2>

<p>To mitigate some of this pain, the following proposal and a decidedly simple one at that is in the making:</p>

<ul>
  <li>CAS adopters <strong>MAY EXPECT</strong> a CAS release to be maintained for one calendar year, starting from <a href="https://github.com/apereo/cas/milestones">the original release date</a>.</li>
  <li>Maintenance during this year includes bug fixes, security patches and general upkeep of the release.</li>
  <li>Once the year is passed, maintenance of the release is <strong>STRICTLY</strong> limited to security patches and fixing vulnerabilities for another calendar year.</li>
  <li>The lifespan of a release <strong>MAY</strong> be extended beyond a single year, to be decided by the CAS PMC and the community at large when and where reasonable.</li>
</ul>

<p>By “CAS Release”, we mean anything that is a minor release and above. (i.e. <code class="highlighter-rouge">4.1.x</code>, <code class="highlighter-rouge">4.2.x</code>, <code class="highlighter-rouge">5.0.0</code>, <code class="highlighter-rouge">5.1.0</code>, etc).</p>

<h2 id="what-does-this-mean">What does this mean?</h2>

<p>The above policy, once in effect, implies that the following CAS releases will transition into a security-patch mode (SPM) only and will be EOLed at the indicated dates.</p>

<table>
  <thead>
    <tr>
      <th>Release</th>
      <th style="text-align: center">SPM Starting Date</th>
      <th style="text-align: right">Full EOL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">4.0.x</code></td>
      <td style="text-align: center">October 31st, 2016</td>
      <td style="text-align: right">October 31st, 2017</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">4.1.x</code></td>
      <td style="text-align: center">January 31st, 2017</td>
      <td style="text-align: right">January 31st, 2018</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">4.2.x</code></td>
      <td style="text-align: center">January 31st, 2017</td>
      <td style="text-align: right">January 31st, 2018</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">5.0.x</code></td>
      <td style="text-align: center">September 30th, 2017</td>
      <td style="text-align: right">September 30th, 2018</td>
    </tr>
  </tbody>
</table>

<p>All past releases that are absent in the above table are considered EOLed.</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/08/08/eol-policy-proposal/</guid>
                <description>
                    
                    In which I attempt to provide an overview of the new CAS EOL policy.
                    
                </description>
                <pubDate>Mon, 08 Aug 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS 5.0.0-M3 Released</title>
                <link>https://apereo.github.io/2016/07/23/m3-release/</link>
                <content:encoded>
                    <![CDATA[
                    <p>Based on the <a href="https://github.com/apereo/cas/milestones">CAS project release schedule</a>, today we are excited to announce the 3rd milestone release in the CAS 5 series. There are a <a href="https://github.com/apereo/cas/releases/tag/v5.0.0.M3">few significant enhancements</a> packed into this release that are worthy to publicize. So here it goes.</p>

<p>Before we get started, it should be pointed out that <a href="https://github.com/apereo/cas-overlay-template/tree/5.0">such milestone releases of CAS 5 are available to adopters to try</a>. Deployers are more than welcome to try out the milestone releases and share feedback.</p>

<p>The current in-development documentation of CAS 5 is also <a href="https://apereo.github.io/cas/development/index.html">available here</a>.</p>

<h1 id="type-safe-properties">Type-safe Properties</h1>

<p>The <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties.html">entire collection of CAS settings</a> are now redesigned to take advantage of <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html#boot-features-external-config-typesafe-configuration-properties">Spring Boot’s typesafe properties</a>. These settings are safely mapped to a corresponding <code class="highlighter-rouge">SomeCasComonentProperties</code> Java class at runtime, support lists, sets and maps and can easily be refactored to contain more than one batch of settings.</p>

<p>As an example, to define LDAP authentication handlers:</p>

<figure class="highlight"><pre><code class="language-properties" data-lang="properties"><span class="err">...</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.ldapUrl</span><span class="p">=</span><span class="s">ldaps://ldap1.example.edu,...</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.baseDn</span><span class="p">=</span><span class="s">dc=example,dc=org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.userFilter</span><span class="p">=</span><span class="s">cn={user}</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindDn</span><span class="p">=</span><span class="s">cn=Directory Manager,dc=example,dc=org</span>
<span class="err">cas.authn.ldap[0]</span><span class="py">.bindCredential</span><span class="p">=</span><span class="s">Password</span>
<span class="err">...</span></code></pre></figure>

<p>Additional handlers can be defined by simply incrementing that <code class="highlighter-rouge">0</code> index.</p>

<p>Furthermore, this release takes on a super comprehensive approach into allowing the adopter to control all aspects of authentication handlers via such typesafe properties. You can now define individual password encoders, principal transformers and password policy settings for a given handler all via the same collection set. No need to resort to any sort of XML configuration file.</p>

<p>Note all that sensitive CAS settings <a href="https://apereo.github.io/cas/development/installation/Configuration-Properties-Security.html">can be encrypted and secured</a>. At runtime, CAS will auto-decrypt settings, making the configuration that much easier to be shared centrally in a central repository of some sort.</p>

<p>There are many other small little enhancements packed into this particular area that remove the need for <strong>explicit</strong> XML configuration. Things such as attribute resolution, PersonDirectory configuration, and more.</p>

<p>As you observe, <strong>ALL</strong> CAS properties are now collected inside a single page on the documentation site; they are no longer spread around here and there. This makes it easier for project developers to maintain them, and for you as deployers to find them all in one spot.</p>

<h1 id="bootiful-management-webapp">Bootiful Management Webapp</h1>

<p>The CAS management webapp is now bootified. It also boasts support for a few other additinal UI panes and sections that deal with MFA, OIDC, SAML, and more. Work continues to make sure all properties of a given CAS registered service can be configured and controlled via the UI.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">:cas-management-webapp:bootRun
Listening <span class="k">for </span>transport dt_socket at address: 5000


  ____     _     ____    __  __                                                            _   
 / ___|   / <span class="se">\ </span>  / ___|  |  <span class="se">\/</span>  |  __ _  _ __    __ _   __ _   ___  _ __ ___    ___  _ __  | |_
| |      / _ <span class="se">\ </span> <span class="se">\_</span>__ <span class="se">\ </span> | |<span class="se">\/</span>| | / _<span class="sb">`</span> <span class="o">||</span> <span class="s1">'_ \  / _` | / _` | / _ \| '</span>_ <span class="sb">`</span> _ <span class="se">\ </span> / _ <span class="se">\|</span> <span class="s1">'_ \ | __|
| |___  / ___ \  ___) | | |  | || (_| || | | || (_| || (_| ||  __/| | | | | ||  __/| | | || |_
 \____|/_/   \_\|____/  |_|  |_| \__,_||_| |_| \__,_| \__, | \___||_| |_| |_| \___||_| |_| \__|
                                                      |___/                                    </span></code></pre></figure>

<h1 id="dependency-upgrades">Dependency Upgrades</h1>

<p>This milestone builds on top of some significant dependency upgrades that include:</p>

<ul>
  <li>Spring Boot 1.4 *</li>
  <li>Ldaptive 1.2 *</li>
  <li>Pac4j 1.9.1</li>
</ul>

<p>(*) These components are today in <code class="highlighter-rouge">RC</code> or <code class="highlighter-rouge">SNAPSHOT</code> mode, and will be switched to their appropriate <code class="highlighter-rouge">GA</code> release prior to the official CAS 5 release.</p>

<p>I am most excited about Pac4j 1.9.1, which allows CAS easier support for delegated social authentication to:</p>

<ul>
  <li>Github</li>
  <li>Dropbox</li>
  <li>Yahoo!</li>
  <li>FourSquare</li>
  <li>Windows Live</li>
  <li>Google Plus</li>
</ul>

<h1 id="digest-authn">Digest AuthN</h1>

<p>Taking advantage of Pac4j 1.9, CAS now presents support for <a href="https://apereo.github.io/cas/development/installation/Digest-Authentication.html">Digest authentication</a> as another form of non-interactive authentication.</p>

<h1 id="ws-fed-encrypted-assertions">WS-Fed Encrypted Assertions</h1>

<p>In this milestone, the WS-FED CAS module starts to support encrypted assertions issued by ADFS. This change is also ported to the <code class="highlighter-rouge">4.2.x</code> release line.</p>

<h1 id="authy-otp-mfa">Authy OTP MFA</h1>

<p>Finally, CAS adds <a href="https://www.authy.com">Authy</a> to its collection of supported MFA providers. At this time, support is limited to <a href="https://apereo.github.io/cas/development/installation/AuthyAuthenticator-Authentication.html">Authy’s OTP REST API</a>. Given community demand and interest, support for Authy’s OneTouch API may be worked out in the future.</p>

<h1 id="whats-next">What’s Next?</h1>

<p>The development team is working hard to make sure the CAS 5 release is right on <a href="https://github.com/apereo/cas/milestones">schedule</a>.</p>

<p>This is likely the last milestone for v5. As the milestones schedule shows, the project will be preparing for its first release candidate in about a month. Please keep an eye out for further announcements.</p>

<h1 id="how-can-you-help">How can you help?</h1>

<ul>
  <li>Start your early <a href="https://github.com/apereo/cas-overlay-template/tree/5.0">CAS 5 deployment</a> today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Review and suggest documentation improvements.</li>
  <li>Review the release schedule and make sure you report your desired feature requests on the project’s issue tracker.</li>
</ul>

<h1 id="das-ende">Das Ende</h1>

<p>A big hearty thanks to all who participated in the development of this release to submit patches, report issues and suggest improvements. Keep’em coming!</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/07/23/m3-release/</guid>
                <description>
                    
                    ...in which I present an overview of CAS 5 M3 release.
                    
                </description>
                <pubDate>Sat, 23 Jul 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS Survey Results</title>
                <link>https://apereo.github.io/2016/06/26/survey-results/</link>
                <content:encoded>
                    <![CDATA[
                    <p>A <a href="https://groups.google.com/a/apereo.org/forum/#!searchin/cas-user/survey/cas-user/vQr3eBdHNg8/eKm9gkpxIwAJ">while ago</a> the CAS project management committee prepared a <a href="http://goo.gl/forms/rF9EeCN6GH">survey</a> to help plan the future roadmap of the project. The primary objectives of the survey were to gain a better understanding of the current configuration pain points from a deployer point of view and learn what additional features and enhancements should have to be prioritized for development.</p>

<p>In this post, I intend to provide a summarized view of the survey results and discuss what has or will be done to address the feedback.</p>

<h1 id="results">Results</h1>

<p>There were about 200 responses to the survey from both individuals and institutions. Some responses were submitted by consulting firms who provide CAS commercial services for their clients which indicates the actual number of deployers may be larger than the reported 200.</p>

<p>Participants of the survey indicated that on average, they have been running CAS for more than 10 years in a variety of industry sectors such as Government, Higher-Ed, Insurance, Finance, Travel and Health. More than 50% of the results indicated a CAS server deployment size of more than 10K users which is considered a rather large deployment of the platform.</p>

<p>The table below demonstrates what percentage of the community has chosen a given form of primary authentication:</p>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Adoption</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>LDAP/AD</td>
      <td>82%</td>
    </tr>
    <tr>
      <td>RDBMS</td>
      <td>8%</td>
    </tr>
    <tr>
      <td>Other</td>
      <td>10%</td>
    </tr>
  </tbody>
</table>

<p>The “Other” category being: NoSQL, X509, Rest, Social AuthN and many other forms of authentication supported by CAS.</p>

<h2 id="cas-version">CAS Version</h2>

<p>The table below shows what percentage of the community is using a given CAS server version.</p>

<table>
  <thead>
    <tr>
      <th>Version</th>
      <th>Adoption</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>3.x</td>
      <td>53%</td>
    </tr>
    <tr>
      <td>4.0.x</td>
      <td>22%</td>
    </tr>
    <tr>
      <td>4.1.x</td>
      <td>14%</td>
    </tr>
    <tr>
      <td>4.2.x</td>
      <td>4%</td>
    </tr>
    <tr>
      <td>Other</td>
      <td>7%</td>
    </tr>
  </tbody>
</table>

<p>It’s important to note that CAS 3.x has been EOLed for almost 2 years. What this means is that CAS 3.x will no longer be maintained, fixed or (in case of security vulnerabilities) patched by the development team. Therefor, it is strongly recommended that those deployments switch and upgrade to a more recent and stable version of the platform, which at the time of this writing is CAS 4.2.x.</p>

<h2 id="features">Features</h2>

<p>Survey participants were also asked to vote on a number of proposed features on a 1-5 scale with 5 being most desirable. The following table shows an aggregated view of the results for each given feature where the adoption percentage is a summary of category 4 and 5 response types, indicating  development should strongly focus on the completion or improvement of the proposed item.</p>

<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>Vote</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Admin UIs</td>
      <td>60%</td>
    </tr>
    <tr>
      <td>SAML2</td>
      <td>60%</td>
    </tr>
    <tr>
      <td>MFA</td>
      <td>52%</td>
    </tr>
    <tr>
      <td>Surrogate AuthN</td>
      <td>43%</td>
    </tr>
    <tr>
      <td>Adaptive AuthN</td>
      <td>42%</td>
    </tr>
    <tr>
      <td>Rest APIs</td>
      <td>40%</td>
    </tr>
    <tr>
      <td>GUI Wizard</td>
      <td>33%</td>
    </tr>
    <tr>
      <td>Front-Channel SLO</td>
      <td>33%</td>
    </tr>
    <tr>
      <td>WS-Fed</td>
      <td>31%</td>
    </tr>
    <tr>
      <td>OIDC</td>
      <td>29%</td>
    </tr>
    <tr>
      <td>OAuth2</td>
      <td>28%</td>
    </tr>
    <tr>
      <td>FIDO</td>
      <td>16%</td>
    </tr>
    <tr>
      <td>Dynamic Registration</td>
      <td>11%</td>
    </tr>
  </tbody>
</table>

<h2 id="additional-feedback">Additional Feedback</h2>

<p>The following items were also reported by the community as areas that require improvement and clarification:</p>

<h3 id="better-documentation">Better Documentation</h3>

<p>The current CAS documentation assumes a high degree of familiarity with deployment tools such as Maven, Tomcat/Jetty, etc. The adopter also at times has to deal with multiple XML configuration files for enabling features such as LDAP authentication. This presents varying degrees of difficulty for a novice deployer to quickly get started with a CAS deployment. Step-by-step installation instructions, more samples and clarity in the documentation when it comes to dealing with specific CAS modules and features would be strongly desirable. A non-Maven deployment strategy could also be devised to relieve some of that pain when it comes to managing dependencies and CAS artifacts.</p>

<h3 id="easier-upgrades">Easier Upgrades</h3>

<p>The current CAS deployment strategy consists of <a href="https://github.com/apereo/cas-overlay-template">constructing a Maven overlay</a> in order to combine and merge local customizations with the original CAS distribution. This at times can morph into a complicated CAS upgrade process, specially if local customizations end up at odd conflicts with the new CAS distribution. Adopters are invariably forced to compare locally overlaid artifacts with their original version and fill in the gaps where necessary. Needless to say, this process for a novice deployer is less than obvious to understand and utilize.</p>

<h3 id="other-features">Other Features</h3>

<p>A number of other features were requested by participants that were not part of proposed scope. These included:</p>

<ol>
  <li>JWT authentication</li>
  <li>Integrated Password Management</li>
  <li>Tracking and Geo-profiling authentication requests.</li>
  <li>Other registry types for managing CAS tickets and service definitions, such as YAML, Redis, ZeroMQ, etc.</li>
</ol>

<h1 id="response">Response</h1>

<p>The CAS development team has been working on the next major release of the platform, that is 5.0.0. Taking into account the community survey and feedback, here are a few notes to help clarify how CAS 5 attempts to address some of the reported issues.</p>

<p>Before we get started, it should be pointed out that <a href="https://github.com/apereo/cas-overlay-template/tree/5.0">early milestone releases of CAS 5 are available</a>. Deployers are more than welcome to try out the milestone releases and share feedback.</p>

<p>The current in-development documentation of CAS 5 is also <a href="https://apereo.github.io/cas/development/index.html">available here</a>.</p>

<h2 id="features-1">Features</h2>

<h3 id="core">Core</h3>

<p>CAS 5 will have built-in support for:</p>

<ul>
  <li><a href="https://apereo.github.io/cas/development/installation/Configuring-Multifactor-Authentication.html">MFA</a> based on Duo Security, Google Authenticator and more.</li>
  <li><a href="https://apereo.github.io/cas/development/installation/Configuring-SAML2-Authentication.html">SAML2 authentication</a>, acting as an identity provider consuming and producing SAML metadata.</li>
  <li><a href="https://apereo.github.io/cas/development/installation/OIDC-Authentication.html">OpenID Connect</a>, acting as an OP producing claims for RPs.</li>
  <li>A YAML-based service registry.</li>
  <li>Delegating authentication to a remote REST endpoint.</li>
  <li>Recording and Geotracking authentication events.</li>
</ul>

<p>Since CAS 4.2.x, the platform has supported:</p>

<ul>
  <li><a href="https://apereo.github.io/cas/4.2.x/installation/JWT-Authentication.html">JWT authentication</a>.</li>
  <li><a href="https://apereo.github.io/cas/4.2.x/integration/Delegate-Authentication.html">Delegating authentication</a> to <a href="https://apereo.github.io/cas/4.2.x/integration/ADFS-Integration.html">ADFS</a>, CAS, SAML2 IdPs and a large variety of social authentication providers such as Facebook, Twitter and more.</li>
  <li>Ticket registry implementations based on <a href="https://apereo.github.io/cas/4.2.x/installation/Infinispan-Ticket-Registry.html">Redis and Apache Cassandra</a>.</li>
</ul>

<h3 id="auto-configuration">Auto Configuration</h3>

<p>Loudly pointed out by the survey, a much-needed overhaul of the CAS documentation is needed to enable configuration of CAS features in a more intuitive and sustainable way. To address this issue, CAS 5 takes an orthogonal approach where most if not all CAS features are <strong>automatically configured</strong> by CAS itself, given deployer’s consent, relieving the deployer from having to deal with XML configuration. This is a model we refer to as <strong>Intention-driven configuration</strong>.</p>

<p>In the past in order to turn on a particular CAS feature, the adopter had to:</p>

<ul>
  <li>Find and declare the module as a dependency</li>
  <li>Fiddle with a variety of XML configuration files to declare components</li>
  <li>Touch a few properties and settings supplying the appropriate values for those components.</li>
  <li>Repackage and redeploy.</li>
</ul>

<p>This process was much prone to errors and at times had to be repeated over and over again until the final works was in place. It also was extremely dependent on an accurate and reasonably detailed and clear documentation. It goes without saying that sustaining this model of development and configuration presents a high degree of difficulty for maintainers of the project and adopters of the platform.</p>

<p>To remove some of this pain, CAS 5 presents the following approach to the deployer:</p>

<ul>
  <li>Find and declare the feature module as a dependency, thus <strong>announcing your intention</strong> of enabling a particular feature in CAS.</li>
  <li><strong>Optionally</strong>, configure the module by supplying settings via a simple <code class="highlighter-rouge">.properties</code> file.</li>
</ul>

<p>At deployment time, CAS will auto-determine every single change that is required for the functionality of declared modules and will auto-configure it all in order to remove the extra XML configuration pain. This is a strategy that is put into place for nearly <strong>ALL</strong> modules and features.</p>

<p>This strategy helps with the documentation noise as well to a large degree because there is no longer a need to document every single XML configuration file and change required for each module for a given needed feature. The CAS 5 platform starts to have very low expectations of the adopter in terms of learning its internals and different configuration mechanics. Simply declaring an intention and optionally configuring it should be more than sufficient.</p>

<p>This strategy also greatly assists with future upgrades because there would be very few, if any, local configuration files lying around in a deployment environment. The adopter should mostly care about the appropriate settings and values supplied to CAS that describe the core intended business functionality desired.</p>

<p>As an example, in order to configure LDAP authentication, all an adopter has to do is <strong>declare his/her intention</strong>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
     <span class="nt">&lt;groupId&gt;</span>org.apereo.cas<span class="nt">&lt;/groupId&gt;</span>
     <span class="nt">&lt;artifactId&gt;</span>cas-server-support-ldap<span class="nt">&lt;/artifactId&gt;</span>
     <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>…and <strong>declare the relevant settings</strong>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
# cas.authn.ldap[0].ldapUrl=ldaps://ldap1.example.edu,...
# cas.authn.ldap[0].baseDn=dc=example,dc=org
# cas.authn.ldap[0].userFilter=cn={user}
# cas.authn.ldap[0].bindDn=cn=Directory Manager,dc=example,dc=org
# cas.authn.ldap[0].bindCredential=Password
...
</code></pre></div></div>

<p>That’s all. There is no other change required.</p>

<p>This model would not have been possible without CAS taking full advantage of <a href="http://projects.spring.io/spring-boot/">Spring Boot</a>.</p>

<p>Note that auto configuration of modules not only takes into account core what-used-to-be XML configuration but also any additions that may be required for the CAS webflows.</p>

<p>Note that CAS 5 does not remove one’s ability to declare relevant changes and customizations in an XML file. There will be a <code class="highlighter-rouge">deployerConfigContext.xml</code> file, much like the old days, for those who feel more comfortable with an XML-friendly explicit form of configuration. However, for most if not ALL changes this strategy is completely unnecessary.</p>

<h3 id="managing-configuration">Managing Configuration</h3>

<p>Previously, adopters had to repackage and redeploy the CAS web application if a configuration property (i.e. LDAP URL) had to be changed. This will no longer be true in CAS 5 where <strong>most if not ALL</strong> CAS components become reloadable. What this means is, specific endpoints (and administrative UIs) are exposed to adopters which can receive a reload request (permissions granting) and auto-configure the running CAS application context with the new state of the world WITHOUT the need to repackage and/or deploy the CAS software.</p>

<p>This model would not have been possible without CAS taking full advantage of <a href="http://projects.spring.io/spring-cloud/">Spring Cloud</a>.</p>

<p>To learn more about how CAS manages the deployer configuration, particularly in a clustered environment, please <a href="http://unicon.github.io/cas/development/installation/Configuration-Management.html">review this page</a>.</p>

<h3 id="deployment">Deployment</h3>

<p>Once packaged, adopters previously had to grab the final CAS web application and deploy it into a servlet container of choice such as Tomcat or Jetty. While this model is and will be supported, CAS 5 takes this one step further and ships with a built-in Tomcat container that can simply launch the CAS application directly from the command line. The recipe is as simple as:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
mvn clean package
java <span class="nt">-jar</span> target/cas.war

...

  __  ____     _     ____  __
 / / / ___|   / <span class="se">\ </span>  / ___| <span class="se">\ \</span>
| | | |      / _ <span class="se">\ </span> <span class="se">\_</span>__ <span class="se">\ </span> | |
| | | |___  / ___ <span class="se">\ </span> ___<span class="o">)</span> | | |
| |  <span class="se">\_</span>___|/_/   <span class="se">\_\|</span>____/  | |
 <span class="se">\_\ </span>                      /_/

CAS Version: 5.0.0.M3-SNAPSHOT
Build Date/Time: 2016-06-26T20:55:15.345Z
Java Home: C:<span class="se">\P</span>rogram Files<span class="se">\J</span>ava<span class="se">\j</span>dk1.8.0_92<span class="se">\j</span>re
Java Vendor: Oracle Corporation
Java Version: 1.8.0_92
OS Architecture: amd64
OS Name: Windows 10
OS Version: 10.0
...
</code></pre></div></div>

<p>Every attempt has been made to ensure every aspect of the built-in Tomcat container (such as SSL, context path, etc) is configurable via the same <code class="highlighter-rouge">.properties</code> file that houses all other CAS configuration.</p>

<p>Built-in containers are also available, optionally, for Jetty and Undertow.</p>

<h3 id="user-interfaces">User Interfaces</h3>

<p>CAS 5 starts use to use <a href="http://www.thymeleaf.org/">Thymeleaf</a> as a rendering engine for its user interfaces. Thymeleaf’s main goal is to bring elegant natural templates to your development workflow — HTML that can be correctly displayed in browsers.</p>

<p>The old JSP model required adopters to test out UI-related changes directly inside a running servlet container such as Tomcat. Thymeleaf allows CAS to present HTML-native pages that can easily be viewed in the browser without requiring an underlying container engine.</p>

<p>CAS 5 also attempts to improve the user experience for the administrator in a cloud-friendly manner. There are many administrative control panels that expose insight into the running CAS software. The screens report back on the health of the running CAS server, various configuration options and status of active SSO sessions, etc. There is also additional upcoming work to further improve these control panels, allowing the adopter to monitor and configure logs, adjust CAS settings and manage SSO sessions more effectively without resorting access to the native command-line.</p>

<p>Of course if you wish, you can always resort back to the command-line if you wish to manually hand-massage the configuration.</p>

<p>Here are a few screenshots of the new CAS 5 user interfaces:</p>

<div align="center">
<blockquote class="imgur-embed-pub" lang="en" data-id="a/6uq4s"><a href="//imgur.com/a/6uq4s">View post on imgur.com</a></blockquote><script async="" src="//s.imgur.com/min/embed.js" charset="utf-8"></script>
</div>

<h1 id="whats-next">What’s Next?</h1>

<p>The development team is working hard to make sure the CAS 5 release is right on <a href="https://github.com/apereo/cas/milestones">schedule</a>.</p>

<p>For the time being, CAS 4.1.x and 4.2.x release lines will be maintained by the development team. However, the primary development focus and time will be dedicated to CAS 5, addressing bugs and extending the platform to be a more comfortable experience specially for some of the brand new features presented in this release.</p>

<h1 id="how-can-you-help">How can you help?</h1>

<ul>
  <li>Start your early <a href="https://github.com/apereo/cas-overlay-template/tree/5.0">CAS 5 deployment</a> today. Try out features and <a href="https://apereo.github.io/cas/Mailing-Lists.html">share feedback</a>.</li>
  <li>Better yet, <a href="https://apereo.github.io/cas/developer/Contributor-Guidelines.html">contribute patches</a>.</li>
  <li>Review and suggest documentation improvements.</li>
</ul>

<h1 id="das-ende">Das Ende</h1>

<p>I would like to thank all survey participants. None of this would have been possible without your engagement and involvement in a vibrant community.</p>

<p>Thank you for sharing. Thank you very much for all the kind words.</p>

<p>On behalf of the CAS project,</p>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/06/26/survey-results/</guid>
                <description>
                    
                    ...in which I present a summarized view of the latest CAS community survey and discuss results.
                    
                </description>
                <pubDate>Sun, 26 Jun 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>Hello World</title>
                <link>https://apereo.github.io/2016/06/25/first-post/</link>
                <content:encoded>
                    <![CDATA[
                    <p>This is <a href="/about">me</a> trying out Github Pages as a blog. Echo. Echo. Echo.</p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/06/25/first-post/</guid>
                <description>
                    
                    Trying out Github Pages as a blog. Echo. Echo. Echo
                    
                </description>
                <pubDate>Sat, 25 Jun 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
        
            <item>
                <title>CAS Vulnerability Disclosure</title>
                <link>https://apereo.github.io/2016/04/08/commonsvulndisc/</link>
                <content:encoded>
                    <![CDATA[
                    <h1 id="remember">Remember</h1>

<p>This post is <strong>NOT</strong> new. I am just collecting it here so it’s publicly available.
This was originally published as a secret gist on Github in April 2016.</p>

<h1 id="overview">Overview</h1>

<p>This is an Apereo CAS project vulnerability disclosure, describing an issue in CAS’s attempts to deserialize objects via the Apache Commons Collections library.</p>

<h1 id="affected-deployments">Affected Deployments</h1>

<p>The attack vector specifically applies to all deployments of CAS <code class="highlighter-rouge">v4.1.x</code> and <code class="highlighter-rouge">v4.2.x</code> deployments where the out-of-the-box default configuration of CAS is used for managing object serialization, encryption and signing of data.</p>

<p>You are <strong>NOT</strong> affected by this issue, if:</p>

<ul>
  <li>You have deployed a different CAS version, lower than <code class="highlighter-rouge">v4.1.0</code>.</li>
  <li>You have deployed CAS <code class="highlighter-rouge">v4.1.x</code> or <code class="highlighter-rouge">v4.2.x</code>, <strong>BUT</strong> you have removed the default CAS configuration for encryption/signing and have regenerated the appropriate settings for your own deployment.</li>
</ul>

<p>Exploiting the vulnerability hinges on getting the JVM to de-serialize Java objects from arbitrary serialized data. If the above conditions describe your deployment, we <strong>STRONGLY</strong> recommend that you take necessary action to patch your deployment based on the below instructions.</p>

<h1 id="severity">Severity</h1>

<p>This is a very serious issue where successfully exercising this vulnerability allows the adversary to inject arbitrary code. This disclosure is about a specific exploit path involving a bugged version of Apache Commons Collections. This exploit path is only an instance of a larger JVM Java object deserialization security concern.</p>

<h1 id="patching">Patching</h1>

<p>Patch releases are now available to address CAS <code class="highlighter-rouge">v4.1.x</code> and <code class="highlighter-rouge">v4.2.x</code> deployments. Upgrades to the next patch version for each release should be a drop-in replacement, with some effort to appropriately reconfigure CAS encryption/signing settings via the <code class="highlighter-rouge">cas.properties</code> file.</p>

<h2 id="cas-41x">CAS 4.1.x</h2>

<h3 id="overlay">Overlay</h3>
<p>Modify your CAS overlay to point to version <code class="highlighter-rouge">4.1.7</code>.</p>

<p>A snippet of a <code class="highlighter-rouge">pom.xml</code> for a CAS overlay follows:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

<span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.jasig.cas<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cas-server-webapp<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>war<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;cas.version&gt;</span>4.1.7<span class="nt">&lt;/cas.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
...
</code></pre></div></div>

<h3 id="tgc-settings">TGC Settings</h3>

<p>Locate your <code class="highlighter-rouge">cas.properties</code> file and find the <code class="highlighter-rouge">tgc.*</code> settings.</p>

<ul>
  <li>
    <p>If your CAS deployment is <strong>NOT</strong> using the default encryption/signing keys provided by CAS and you have regenerated new keys and have replaced the default, you can safely ignore this step and leave your key configuration of signing/encryption in place without any further changes.</p>
  </li>
  <li>
    <p>If your CAS deployment <strong>IS</strong> using the default encryption/signing keys provided by CAS and you have <strong>NOT</strong> regenerated new keys to replace the default, you <strong>MUST</strong> take action to regenerate the keys.</p>
  </li>
</ul>

<p>You can choose one of the two approaches described below to handle key regeneration.</p>

<h4 id="1-let-cas-generate-keys">1) Let CAS Generate Keys</h4>

<p>Blank/comment out the following <code class="highlighter-rouge">tgc</code> settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># tgc.encryption.key=
# tgc.signing.key=
</span></code></pre></div></div>

<p>Build and deploy your CAS deployment once. Upon startup, CAS will notice that no keys are defined, and it will appropriately generate keys for you automatically. Your CAS logs will then show the following snippet:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WARN <span class="o">[</span>org.jasig.cas.util.BaseStringCipherExecutor] - &lt;Secret key <span class="k">for </span>encryption is not defined. CAS will attempt to auto-generate the encryption key&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BaseStringCipherExecutor] - &lt;Generated encryption key ABC of size ... <span class="nb">.</span> The generated key MUST be added to CAS settings.&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BaseStringCipherExecutor] - &lt;Secret key <span class="k">for </span>signing is not defined. CAS will attempt to auto-generate the signing key&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BaseStringCipherExecutor] - &lt;Generated signing key XYZ of size ... <span class="nb">.</span> The generated key MUST be added to CAS settings.&gt;
</code></pre></div></div>

<p>You should then grab each generated key for encryption and signing, and put them inside your <code class="highlighter-rouge">cas.properties</code> file for each now-enabled setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">tgc.encryption.key</span><span class="p">=</span><span class="s">ABC</span>
<span class="py">tgc.signing.key</span><span class="p">=</span><span class="s">XYZ</span>
</code></pre></div></div>

<h4 id="2-manually-generate-keys">2) Manually Generate Keys</h4>

<p>Using a <code class="highlighter-rouge">git</code> client, clone and build the following project:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/mitreid-connect/json-web-key-generator.git
<span class="nb">cd </span>json-web-key-generator
mvn clean package
<span class="nb">cd </span>target

<span class="c"># Encryption Key</span>
java <span class="nt">-jar</span> json-web-key-generator-0.3-SNAPSHOT-jar-with-dependencies.jar <span class="nt">-t</span> oct <span class="nt">-s</span> 256

<span class="c">#</span>
<span class="c"># Full key:</span>
<span class="c"># {</span>
<span class="c">#   "kty": "oct",</span>
<span class="c">#   "k": "ABC"</span>
<span class="c"># }</span>
<span class="c">#</span>

<span class="c"># Signing Key</span>
java <span class="nt">-jar</span> json-web-key-generator-0.3-SNAPSHOT-jar-with-dependencies.jar <span class="nt">-t</span> oct <span class="nt">-s</span> 512

<span class="c"># Full key:</span>
<span class="c"># {</span>
<span class="c">#   "kty": "oct",</span>
<span class="c">#   "k": "XYZ"</span>
<span class="c"># }</span>

</code></pre></div></div>
<p>You should then grab each generated key for encryption and signing, and put them inside your <code class="highlighter-rouge">cas.properties</code> file for each now-enabled setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">tgc.encryption.key</span><span class="p">=</span><span class="s">ABC</span>
<span class="py">tgc.signing.key</span><span class="p">=</span><span class="s">XYZ</span>
</code></pre></div></div>

<h3 id="webflow-settings">Webflow Settings</h3>

<p>Locate your <code class="highlighter-rouge">cas.properties</code> file and find the <code class="highlighter-rouge">webflow.*</code> settings. If you do not see them in your configuration, go ahead and define them:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># webflow.encryption.key=
# webflow.signing.key=
</span></code></pre></div></div>

<p>You can choose one of the two approaches described below to handle key regeneration.</p>

<h4 id="1-let-cas-generate-keys-1">1) Let CAS Generate Keys</h4>

<p>Blank/comment out the following <code class="highlighter-rouge">webflow</code> settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># webflow.encryption.key=
# webflow.signing.key=
</span></code></pre></div></div>

<p>Build and deploy your CAS deployment once. Upon startup, CAS will notice that no keys are defined, and it will appropriately generate keys for you automatically. Your CAS logs will then show the following snippet:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Secret key <span class="k">for </span>encryption is not defined. CAS will attempt to auto-generate the encryption key&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Generated encryption key ABC of size ... <span class="nb">.</span> The generated key MUST be added to CAS settings.&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Secret key <span class="k">for </span>signing is not defined. CAS will attempt to auto-generate the signing key&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Generated signing key XYZ of size ... <span class="nb">.</span> The generated key MUST be added to CAS settings.&gt;
</code></pre></div></div>

<p>You should then grab each generated key for encryption and signing, and put them inside your <code class="highlighter-rouge">cas.properties</code> file for each now-enabled setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">webflow.encryption.key</span><span class="p">=</span><span class="s">ABC</span>
<span class="py">webflow.signing.key</span><span class="p">=</span><span class="s">XYZ</span>
</code></pre></div></div>

<h4 id="2-manually-generate-keys-1">2) Manually Generate Keys</h4>

<p>Using a <code class="highlighter-rouge">git</code> client, clone and build the following project:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/mitreid-connect/json-web-key-generator.git
<span class="nb">cd </span>json-web-key-generator
mvn clean package
<span class="nb">cd </span>target

<span class="c"># Encryption Key</span>
java <span class="nt">-jar</span> json-web-key-generator-0.3-SNAPSHOT-jar-with-dependencies.jar <span class="nt">-t</span> oct <span class="nt">-s</span> 96

<span class="c">#</span>
<span class="c"># Full key:</span>
<span class="c"># {</span>
<span class="c">#   "kty": "oct",</span>
<span class="c">#   "k": "ABC"</span>
<span class="c"># }</span>
<span class="c">#</span>

<span class="c"># Signing Key</span>
java <span class="nt">-jar</span> json-web-key-generator-0.3-SNAPSHOT-jar-with-dependencies.jar <span class="nt">-t</span> oct <span class="nt">-s</span> 512

<span class="c"># Full key:</span>
<span class="c"># {</span>
<span class="c">#   "kty": "oct",</span>
<span class="c">#   "k": "XYZ"</span>
<span class="c"># }</span>

</code></pre></div></div>
<p>You should then grab each generated key for encryption and signing, and put them inside your <code class="highlighter-rouge">cas.properties</code> file for each now-enabled setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">webflow.encryption.key</span><span class="p">=</span><span class="s">ABC</span>
<span class="py">webflow.signing.key</span><span class="p">=</span><span class="s">XYZ</span>
</code></pre></div></div>

<h3 id="xml-configuration">XML Configuration</h3>

<p>If you have manually overridden the <code class="highlighter-rouge">cas-servlet.xml</code> file, you will need to make sure the following blocks are present
in the configuration:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Note that the Person Directory project requires the following configuration in CAS overlays:

```xml

Note that the Person Directory project requires the following configuration in CAS overlays:

```xml
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"loginFlowStateTranscoder"</span> <span class="na">class=</span><span class="s">"org.jasig.spring.webflow.plugin.EncryptedTranscoder"</span>
        <span class="na">c:cipherBean-ref=</span><span class="s">"loginFlowCipherBean"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"loginFlowCipherBean"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.web.flow.CasWebflowCipherBean"</span>
    <span class="na">c:cipherExecutor-ref=</span><span class="s">"webflowCipherExecutor"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"webflowCipherExecutor"</span> <span class="na">class=</span><span class="s">"org.jasig.cas.util.BinaryCipherExecutor"</span>
    <span class="na">c:encryptionSecretKey=</span><span class="s">"${webflow.encryption.key:}"</span>
    <span class="na">c:signingSecretKey=</span><span class="s">"${webflow.signing.key:}"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>Re-adjust the beans accordingly, and remove the built-in keystore.</p>

<h3 id="finally">Finally</h3>
<p>Rebuild and redeploy your CAS overlay.</p>

<h2 id="cas-42x">CAS 4.2.x</h2>

<p>Modify your CAS overlay to point to version <code class="highlighter-rouge">4.2.1</code>.</p>

<p>A snippet of a <code class="highlighter-rouge">pom.xml</code> for a CAS overlay follows:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

<span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.jasig.cas<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cas-server-webapp<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${cas.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>war<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;cas.version&gt;</span>4.2.1<span class="nt">&lt;/cas.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
...
</code></pre></div></div>

<h3 id="tgc-settings-1">TGC Settings</h3>

<p>Locate your <code class="highlighter-rouge">cas.properties</code> file and find the <code class="highlighter-rouge">tgc.*</code> settings.</p>

<ul>
  <li>
    <p>If your CAS deployment is <strong>NOT</strong> using the default encryption/signing keys provided by CAS and you have regenerated new keys and have replaced the default, you can safely ignore this step and leave your key configuration of signing/encryption in place without any further changes.</p>
  </li>
  <li>
    <p>If your CAS deployment <strong>IS</strong> using the default encryption/signing keys provided by CAS and you have <strong>NOT</strong> regenerated new keys to replace the default, you <strong>MUST</strong> take action to regenerate the keys.</p>
  </li>
</ul>

<p>You can choose one of the two approaches described below to handle key regeneration.</p>

<h4 id="1-let-cas-generate-keys-2">1) Let CAS Generate Keys</h4>

<p>Blank/comment out the following <code class="highlighter-rouge">tgc</code> settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># tgc.encryption.key=
# tgc.signing.key=
</span></code></pre></div></div>

<p>Build and deploy your CAS deployment. Upon startup, CAS will notice that no keys are defined, and it will appropriately generate keys for you automatically. Your CAS logs will then show the following snippet:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WARN <span class="o">[</span>org.jasig.cas.util.BaseStringCipherExecutor] - &lt;Secret key <span class="k">for </span>encryption is not defined. CAS will attempt to auto-generate the encryption key&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BaseStringCipherExecutor] - &lt;Generated encryption key ABC of size ... <span class="nb">.</span> The generated key MUST be added to CAS settings.&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BaseStringCipherExecutor] - &lt;Secret key <span class="k">for </span>signing is not defined. CAS will attempt to auto-generate the signing key&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BaseStringCipherExecutor] - &lt;Generated signing key XYZ of size ... <span class="nb">.</span> The generated key MUST be added to CAS settings.&gt;
</code></pre></div></div>

<p>You should then grab each generated key for encryption and signing, and put them inside your <code class="highlighter-rouge">cas.properties</code> file for each now-enabled setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">tgc.encryption.key</span><span class="p">=</span><span class="s">ABC</span>
<span class="py">tgc.signing.key</span><span class="p">=</span><span class="s">XYZ</span>
</code></pre></div></div>
<p>Rebuild and redeploy your CAS overlay.</p>

<h4 id="2-manually-generate-keys-2">2) Manually Generate Keys</h4>

<p>Using a <code class="highlighter-rouge">git</code> client, clone and build the following project:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/mitreid-connect/json-web-key-generator.git
<span class="nb">cd </span>json-web-key-generator
mvn clean package
<span class="nb">cd </span>target

<span class="c"># Encryption Key</span>
java <span class="nt">-jar</span> json-web-key-generator-0.3-SNAPSHOT-jar-with-dependencies.jar <span class="nt">-t</span> oct <span class="nt">-s</span> 256

<span class="c">#</span>
<span class="c"># Full key:</span>
<span class="c"># {</span>
<span class="c">#   "kty": "oct",</span>
<span class="c">#   "k": "ABC"</span>
<span class="c"># }</span>
<span class="c">#</span>

<span class="c"># Signing Key</span>
java <span class="nt">-jar</span> json-web-key-generator-0.3-SNAPSHOT-jar-with-dependencies.jar <span class="nt">-t</span> oct <span class="nt">-s</span> 512

<span class="c"># Full key:</span>
<span class="c"># {</span>
<span class="c">#   "kty": "oct",</span>
<span class="c">#   "k": "XYZ"</span>
<span class="c"># }</span>

</code></pre></div></div>
<p>You should then grab each generated key for encryption and signing, and put them inside your <code class="highlighter-rouge">cas.properties</code> file for each now-enabled setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">tgc.encryption.key</span><span class="p">=</span><span class="s">ABC</span>
<span class="py">tgc.signing.key</span><span class="p">=</span><span class="s">XYZ</span>
</code></pre></div></div>

<h3 id="webflow-settings-1">Webflow Settings</h3>

<p>Locate your <code class="highlighter-rouge">cas.properties</code> file and find the <code class="highlighter-rouge">webflow.*</code> settings. If you do not see them in your configuration, go ahead and define them:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># webflow.encryption.key=
# webflow.signing.key=
</span></code></pre></div></div>

<p>You can choose one of the two approaches described below to handle key regeneration.</p>

<h4 id="1-let-cas-generate-keys-3">1) Let CAS Generate Keys</h4>

<p>Blank/comment out the following <code class="highlighter-rouge">webflow</code> settings:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># webflow.encryption.key=
# webflow.signing.key=
</span></code></pre></div></div>

<p>Build and deploy your CAS deployment once. Upon startup, CAS will notice that no keys are defined, and it will appropriately generate keys for you automatically. Your CAS logs will then show the following snippet:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Secret key <span class="k">for </span>encryption is not defined. CAS will attempt to auto-generate the encryption key&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Generated encryption key ABC of size ... <span class="nb">.</span> The generated key MUST be added to CAS settings.&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Secret key <span class="k">for </span>signing is not defined. CAS will attempt to auto-generate the signing key&gt;
WARN <span class="o">[</span>org.jasig.cas.util.BinaryCipherExecutor] - &lt;Generated signing key XYZ of size ... <span class="nb">.</span> The generated key MUST be added to CAS settings.&gt;
</code></pre></div></div>

<p>You should then grab each generated key for encryption and signing, and put them inside your <code class="highlighter-rouge">cas.properties</code> file for each now-enabled setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">webflow.encryption.key</span><span class="p">=</span><span class="s">ABC</span>
<span class="py">webflow.signing.key</span><span class="p">=</span><span class="s">XYZ</span>
</code></pre></div></div>

<h4 id="2-manually-generate-keys-3">2) Manually Generate Keys</h4>

<p>Using a <code class="highlighter-rouge">git</code> client, clone and build the following project:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/mitreid-connect/json-web-key-generator.git
<span class="nb">cd </span>json-web-key-generator
mvn clean package
<span class="nb">cd </span>target

<span class="c"># Encryption Key</span>
java <span class="nt">-jar</span> json-web-key-generator-0.3-SNAPSHOT-jar-with-dependencies.jar <span class="nt">-t</span> oct <span class="nt">-s</span> 96

<span class="c">#</span>
<span class="c"># Full key:</span>
<span class="c"># {</span>
<span class="c">#   "kty": "oct",</span>
<span class="c">#   "k": "ABC"</span>
<span class="c"># }</span>
<span class="c">#</span>

<span class="c"># Signing Key</span>
java <span class="nt">-jar</span> json-web-key-generator-0.3-SNAPSHOT-jar-with-dependencies.jar <span class="nt">-t</span> oct <span class="nt">-s</span> 512

<span class="c"># Full key:</span>
<span class="c"># {</span>
<span class="c">#   "kty": "oct",</span>
<span class="c">#   "k": "XYZ"</span>
<span class="c"># }</span>

</code></pre></div></div>
<p>You should then grab each generated key for encryption and signing, and put them inside your <code class="highlighter-rouge">cas.properties</code> file for each now-enabled setting:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">webflow.encryption.key</span><span class="p">=</span><span class="s">ABC</span>
<span class="py">webflow.signing.key</span><span class="p">=</span><span class="s">XYZ</span>
</code></pre></div></div>

<h3 id="finally-1">Finally</h3>
<p>Rebuild and redeploy your CAS overlay.</p>

<h1 id="clustered-cas-deployments">Clustered CAS Deployments</h1>

<p>If you are running a cluster of CAS nodes, please be advised that the newly generated keys for all settings (regardless of the method of generation, whether CAS or you) <strong>MUST</strong> be shared with all CAS nodes in form of either a centralized or replicated/shared <code class="highlighter-rouge">cas.properties</code> file.</p>

<p>Failure to do so will completely break CAS functionality.</p>

<p>If you only have a single-node CAS deployment, there is nothing further for you to do.</p>

<h1 id="support">Support</h1>
<p>If you have questions on the details this vulnerability and how it might be reproduced, please contact <code class="highlighter-rouge">security@apereo.org</code> or <code class="highlighter-rouge">cas-appsec-public@apereo.org</code>.</p>

<h1 id="resources">Resources</h1>

<ul>
  <li><a href="https://blogs.apache.org/foundation/entry/apache_commons_statement_to_widespread">Apache Commons statement to widespread Java object de-serialisation vulnerability</a></li>
  <li><a href="https://commons.apache.org/proper/commons-collections/security-reports.html">Apache Commons Collections security reports</a></li>
</ul>

<p><a href="https://twitter.com/misagh84">Misagh Moayyed</a></p>

                    ]]>
                </content:encoded>
                <guid isPermaLink="false">/2016/04/08/commonsvulndisc/</guid>
                <description>
                    
                    Disclosure of issue with the Apache Commons Collections
                    
                </description>
                <pubDate>Fri, 08 Apr 2016 00:00:00 +0000</pubDate>
                <author>Apereo Project Participants</author>
            </item>
        
    
  </channel>
</rss>
